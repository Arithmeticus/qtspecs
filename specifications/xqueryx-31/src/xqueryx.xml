<?xml version="1.0" encoding="UTF-8"?>
<!--  ================================================================================  -->
<!--  Errata applied:                                                                   -->
<!--  ================================================================================  -->
<!DOCTYPE spec SYSTEM "../../../schema/xsl-query.dtd" [

<!-- Things to update in these ENTITY definitions before publishing this document:
* Relationships between doc.stage, w3c-doctype, and doc.w3c-doctype-full
* doc.stage  w3c-doctype  doc.w3c-doctype-full
* FPWD       wd           First Public Working Draft
  WD         wd           Working Draft
  WD         wd           Last Call Working Draft
  CR         cr           Candidate Recommendation
  PR         pr           Proposed Recommendation
  PER        per          Proposed Edited Recommendation
  REC        rec          Recommendation
  WGNOTE     note         Working Group Note
* date.day, date.DD, date.month, date.monthnum, and date.year must represent the date of publication of the document
* doc.w3c-prevdesignation must properly represent the stage and shortname of the immediately preceding publication of the document
* Various status section generation ENTITY definitions below must be properly updated
-->

<!ENTITY doc.version "3.1">
<!ENTITY doc.major-version "3">
<!ENTITY doc.version-code "31">
<!ENTITY doc.stage "REC">
<!ENTITY doc.w3c-doctype "rec">
<!ENTITY doc.w3c-doctype-full "Recommendation">

<!ENTITY date.day "21">
<!ENTITY date.DD "21">
<!ENTITY date.month "March">
<!ENTITY date.monthnum "03">
<!ENTITY date.year "2017">
<!ENTITY doc.date "&date.year;&date.monthnum;&date.DD;">

<!ENTITY w3c.tr "https://www.w3.org/TR">
<!ENTITY doc.generic-shortname "xqueryx">
<!ENTITY doc.shortname "&doc.generic-shortname;-&doc.version-code;">
<!ENTITY doc.w3c-designation "&doc.stage;-&doc.shortname;">
<!ENTITY doc.publoc "&w3c.tr;/&date.year;/&doc.w3c-designation;-&doc.date;/">
<!ENTITY doc.latestloc "&w3c.tr;/&doc.shortname;/">
<!ENTITY doc.latestloc-major "&w3c.tr;/&doc.generic-shortname;-&doc.major-version;/">
<!ENTITY doc.latestloc-tech "&w3c.tr;/&doc.generic-shortname;/">
<!ENTITY doc.w3c-prev-designation "REC-&doc.shortname;">
<!ENTITY language-tech "XQueryX">
<!ENTITY language "XQueryX &doc.version;">
<!ENTITY language-major "XQueryX &doc.major-version;">
<!-- ************************ THIS MUST BE EITHER 'WG Review Draft' OR '' ************** -->
<!ENTITY version "">
<!-- ************************************************************************************* -->

<!ENTITY xqx-schema SYSTEM "included-files/xqueryx-CDATA.xsd.xml">
<!ENTITY xqx2xq-stylesheet SYSTEM "included-files/xqueryx-CDATA.xsl.xml">
<!ENTITY xq-grammarSnippet SYSTEM "included-files/xqueryx-grammar.xml.snippet-CDATA.xml">
<!ENTITY xqx-schemaSnippet SYSTEM "included-files/xqueryx.xsd.snippet-CDATA.xml">
<!ENTITY exmpl1xq SYSTEM "included-files/exmpl1-CDATA.xq.xml">
<!ENTITY exmpl2xq SYSTEM "included-files/exmpl2-CDATA.xq.xml">
<!ENTITY exmpl3xq SYSTEM "included-files/exmpl3-CDATA.xq.xml">
<!ENTITY exmpl1grammar SYSTEM "included-files/exmpl1-CDATA.grammar.xml">
<!ENTITY exmpl4xq SYSTEM "included-files/exmpl4-CDATA.xq.xml">
<!ENTITY exmpl1xqx SYSTEM "included-files/exmpl1-CDATA.xqx.xml">
<!ENTITY exmpl2xqx SYSTEM "included-files/exmpl2-CDATA.xqx.xml">
<!ENTITY exmpl3xqx SYSTEM "included-files/exmpl3-CDATA.xqx.xml">
<!ENTITY exmpl4xqx SYSTEM "included-files/exmpl4-CDATA.xqx.xml">
<!ENTITY exmpl1xqx2xq SYSTEM "included-files/exmpl1-CDATA.xqx2xq.xml">
<!ENTITY exmpl2xqx2xq SYSTEM "included-files/exmpl2-CDATA.xqx2xq.xml">
<!ENTITY exmpl3xqx2xq SYSTEM "included-files/exmpl3-CDATA.xqx2xq.xml">
<!ENTITY exmpl4xqx2xq SYSTEM "included-files/exmpl4-CDATA.xqx2xq.xml">
<!ENTITY mimetypeappendix SYSTEM "xqueryx-mime-type.xml">

<!ENTITY % status-entities SYSTEM "../../../etc/status-entities.dtd">
%status-entities;

<!ENTITY doc.WD-pubdate "24 April 2014">
<!ENTITY doc.LC-pubdate "7 October 2014">
<!ENTITY doc.LC-comments-due "7 November 2014">
<!ENTITY doc.CR-pubdate "13 December 2016">
<!ENTITY doc.CR-comments-due "10 January 2017">
<!ENTITY doc.PR-expected "10 January 2017">
<!ENTITY doc.PR-pubdate "17 January 2017">
<!ENTITY doc.PR-comments-due "28 February 2017">
<!ENTITY doc.REC-pubdate "21 March 2017">

<!ENTITY doc.pubdate "&doc.REC-pubdate;">
<!ENTITY doc.comments-due "&doc.PR-comments-due;">


<!ENTITY status-section-id "status">
<!ENTITY spec-devby    "&devby.xquery;">
<!ENTITY changelog-id  "changelog">
<!ENTITY changes-para  "&post.PR.nochanges;">
<!ENTITY implementation-report '&implementation-report-exists;'>
<!ENTITY implementation-report-location "&xqueryx-impl-report;">
<!ENTITY implementation-report-availability "&report-public;">
<!ENTITY disclosure.one    "&disclosure.xquery;"> 
<!ENTITY Bugzilla-key "XQX31">
<!ENTITY patent-policy-paragraph "&ppp-one;">
<!ENTITY documents-and-relationships "&set-of-documents-30-preREC;">
<!ENTITY advancement.statement "&advance.1WG;">
<!ENTITY document-stage "&doc-stage-REC;">
<!ENTITY doc-stability "&doc-stability-REC;">

<!ENTITY PR-entrance-criteria '<p>This document will be
considered ready for transition to Proposed Recommendation
when there are two independent implementations of Minimal Conformance
(see <xspecref spec="XQ31" ref="id-minimal-conformance"/>) to <bibref ref="xquery-31"/>,
at least one of them using the human-readable syntax and at least
one of them using the XML syntax and there are two independent implementations
of each optional feature (see <xspecref spec="XQ31" ref="id-conform-optional-features"/>
in <bibref ref="xquery-31"/>) using either syntax. 
The implementations of each optional feature need not necessarily conform
to the Minimal Conformance requirements. </p>'>
<!ENTITY features-at-risk-para "&no-features-at-risk;">
<!ENTITY features-at-risk "">

<!ENTITY customized-paragraph '<p diff="chg" at="2013-12-06">This &doc.w3c-doctype-full; specifies the XML syntax for XQuery
                               version 3.1, a fully compatible extension of <loc href="https://www.w3.org/TR/xqueryx-30/">XQueryX version 3.0</loc>.</p>
                               <p diff="chg" at="2014-07-14">This &doc.w3c-doctype-full;, dated &doc.pubdate;, contains changes to
                               align XQueryX 3.1 with changes to XQuery 3.1 up until the date of this publication.</p>'>

<!ENTITY status-section SYSTEM "../../../etc/status-general.xml">
]>

<!-- Remove the status attribute when publishing a public WD or later stage of progression -->
<spec id="spec-top"
      w3c-doctype="&doc.w3c-doctype;"
      status="int-review"
      >
  <header id="spec-header">
    <title>&language;</title>
    <version>&version;</version>
    <w3c-designation>&doc.w3c-designation;</w3c-designation>
<!--    <w3c-doctype>W3C Internal Draft</w3c-doctype> -->
    <w3c-doctype>W3C &doc.w3c-doctype-full;</w3c-doctype>
    <pubdate>
      <day>&date.day;</day>
      <month>&date.month;</month>
      <year>&date.year;</year>
    </pubdate>
    <publoc>
      <loc href="&doc.publoc;">&doc.publoc;</loc>
    </publoc>
<!-- These altlocs URIs are computed from the concatenation of doc.public, doc.shortname, and either '.xml' or
     '-diff-from-yyyymmdd.html', where 'yyyymmdd' is the earlier version of the spec from which a diff has been produced -->
    <altlocs>
      <loc href="&doc.publoc;&doc.shortname;.xml">XML</loc>
      <loc href="&doc.publoc;&doc.shortname;-diff.html">Change markings relative to previous Working Draft</loc>
    </altlocs>
<!-- The latestloc URI is computed from doc.latestloc -->
    <latestloc doc="&language;">
      <loc href="&doc.latestloc;">&doc.latestloc;</loc>
    </latestloc>
<!-- These prevlocs URIs are always hard-coded and are never computed from entities -->
    <prevlocs doc="&language;">
      <loc href="https://www.w3.org/TR/2017/PR-xqueryx-31-20170117/">https://www.w3.org/TR/2017/PR-xqueryx-31-20170117/</loc>
      <loc href="https://www.w3.org/TR/2016/CR-xqueryx-31-20161213/">https://www.w3.org/TR/2016/CR-xqueryx-31-20161213/</loc>
      <loc href="https://www.w3.org/TR/2014/CR-xqueryx-31-20141218/">https://www.w3.org/TR/2014/CR-xqueryx-31-20141218/</loc>
      <loc href="https://www.w3.org/TR/2014/WD-xqueryx-31-20141007/">https://www.w3.org/TR/2014/WD-xqueryx-31-20141007/</loc>
      <loc href="https://www.w3.org/TR/2014/WD-xqueryx-31-20140424/">https://www.w3.org/TR/2014/WD-xqueryx-31-20140424/</loc>
    </prevlocs>
    <latestloc-major doc="&language-major;">
      <loc href="&doc.latestloc-major;">&doc.latestloc-major;</loc>
    </latestloc-major>
    <latestloc-tech doc="&language-tech;">
      <loc href="&doc.latestloc-tech;">&doc.latestloc-tech;</loc>
    </latestloc-tech>
    <prevrec doc="&language-tech;">
      <loc href="https://www.w3.org/TR/2014/REC-xqueryx-30-20140408/">https://www.w3.org/TR/2014/REC-xqueryx-30-20140408/</loc>
    </prevrec>

    <authlist>
      <author>
        <name>Jim Melton</name>
        <affiliation>Oracle Corporation</affiliation>
        <email href="mailto:jim.melton@oracle.com">jim.melton@oracle.com</email>
      </author>
      <author>
        <name>Josh Spiegel</name>
        <affiliation>Oracle Corporation</affiliation>
        <email href="mailto:josh.spiegel@oracle.com">josh.spiegel@oracle.com</email>
      </author>
    </authlist>

    <errataloc diff="chg" href="https://www.w3.org/XML/2017/qt-errata/xqueryx-31-errata.html" xlink:type="simple"/>

    <translationloc href="https://www.w3.org/2003/03/Translations/byTechnology?technology=xqueryx-31"/>

    <abstract>
      <p>This document defines an XML Syntax for <phrase diff="chg"><bibref ref="xquery-31"/></phrase>.</p>
    </abstract>

&status-section;

    <langusage>
      <language id="EN">English</language>
    </langusage>

    <revisiondesc diff="chg">
      <p>This is the first WD of this spec. </p>
      <p>This is the FIrst Public Working Draft of this specification. 
         It is aligned with the XQuery grammar as published in <bibref ref="xquery-31"/>.</p>
    </revisiondesc>
  </header>

  <body>

    <div1 id="Introduction">
      <head>Introduction</head>

      <!--  bug 29257 -->
      <p diff="del">The <phrase diff="chg">XQuery 1.0 Requirements</phrase>
         states that <quote>The XML Query Language MAY have
         more than one syntax binding. One query language syntax MUST be convenient for
         humans to read and write. One query language syntax MUST be expressed in XML in
         a way that reflects the underlying structure of the query.</quote></p>

      <p>XQueryX is an XML representation of an XQuery. It was created by mapping
         the productions of the XQuery grammar into XML productions.
         The result is not particularly convenient for humans to read and write, but it
         is easy for programs to parse, and because XQueryX is represented in XML, standard
         XML tools can be used to create, interpret, or modify queries.</p>

<!-- 2009-01-29 JM: Add paragraph clarifying that all Notes are non-normative per Bugzilla Bug #6377 and Erratum XQX.E6 -->
        <p>In this document, examples and material labeled as <quote>Note</quote> are provided for
           explanatory purposes and are not normative. </p>

<!-- 2005-10-05 JM: Add informative note clarifying that the
     XQueryX static/dynamic contexts are the same as the XQuery contexts -->
      <note>
        <p>Because the two syntaxes are merely different grammars that express the
           same query semantics, they share all aspects of an XQuery processing system
           except for the component that recognizes and translates the source representation
           of a query (that is, the parser). 
           The aspects that are shared include both the static context and
           the dynamic context that are defined in <phrase diff="chg"><bibref ref="xquery-31"/></phrase>. </p>
      </note>

      <p>There are several environments in which XQueryX may be useful:</p>

      <ulist>
        <item>
          <p><emph>Parser Reuse.</emph> In heterogeneous environments, a
             variety of systems may be used to execute a query. One parser can generate XQueryX
             for all of these systems.</p>
        </item>

        <item>
          <p><emph>Queries on Queries.</emph> Because XQueryX is represented in XML, queries
             can be queried and can be transformed into new queries. For instance, a query can
             be performed against a set of XQueryX queries to determine which queries use
             FLWOR expressions to range over a set of invoices.</p>
        </item>

        <item>
          <p><emph>Generating Queries.</emph> In some XML-oriented programming
             environments, it may be more convenient to build a query in its XQueryX
             representation than in the corresponding XQuery representation, since ordinary
             XML tools can be used.</p>
        </item>

        <item>
          <p><emph>Embedding Queries in XML.</emph> XQueryX can be embedded
             directly in an XML document.</p>
        </item>

      </ulist>

    <p>This version of XQueryX is fully compatible with <bibref ref="xqueryx-30"/>. 
      It differs from that earlier version of the language by the addition of new XML Schema
      definitions and XSLT stylesheet templates.  All queries expressed in the syntax defined
      by <bibref ref="xqueryx-30"/> continue to be valid, with the same meaning, when processed
      by an implementation of this version of XQueryX. 
    </p>

	  <p>The most recent versions of the XQueryX XML Schema and the XQueryX XSLT stylesheet
       are available at
       <loc href="https://www.w3.org/&date.year;/&date.monthnum;/XQueryX/xqueryx.xsd">https://www.w3.org/&date.year;/&date.monthnum;/XQueryX/xqueryx.xsd</loc>
       and
       <loc href="https://www.w3.org/&date.year;/&date.monthnum;/XQueryX/xqueryx.xsl">https://www.w3.org/&date.year;/&date.monthnum;/XQueryX/xqueryx.xsl</loc>,
       respectively. </p>

    <note>
      <p>The locations at which the current versions of the XML Schema and XSLT stylesheet are located during development of
      this specification will vary with each Working Draft and Candidate Recommendation of the spec that is published. 
      The namespace target URI is identical to that used for <bibref ref="xqueryx-30"/>. </p>
    </note>

    </div1>


    <div1 id="Mapping">
      <head>Mapping the XQuery Syntax</head>

      <p>XQueryX is an XML representation of the abstract syntax found in
         Appendix A of <phrase diff="chg"><bibref ref="xquery-31"/></phrase>. 
         The XQueryX syntax is defined by the XQueryX Schema,
         which is specified in <specref ref="Schema"/>. 
         The XQueryX semantics are defined by a stylesheet that maps
         an instance of XQueryX to an instance of XQuery;
         see <specref ref="Stylesheet"/>.</p>

      <p>The main data structure in the XQueryX Schema is the set of types that describe
         expressions. We have chosen to model expressions using substitution groups,
         with an "expr" abstract base class and a number of intermediate abstract classes. </p>

      <p>Consider the following productions from the abstract syntax:</p>

      <!-- insert the grammar snippet here -->
      <eg>&xq-grammarSnippet;</eg>

      <note>
        <p>Those productions do not represent the entire FLWOR expression, so some of the
           BNF non-terminal names are not resolved in the example abstract syntax. </p>
      </note>

      <p>The following XQueryX Schema definitions reflect the structure of those
         productions from that abstract syntax:</p>

      <!-- insert schema snippet here -->
      <eg>&xqx-schemaSnippet;</eg>

      <p>Since XQuery uses the expression production liberally to allow
         expressions to be flexibly combined, XQueryX uses the exprWrapper type
         in embedded contexts to allow all expression types to occur.</p>

    </div1>


    <div1 id="Examples">
      <head>Examples from the XML Query Use Cases in XML Syntax</head>

      <p>Three of following examples are based on the data and queries in the XMP
         (Experiences and Exemplars) use case in
         <phrase diff="chg"><bibref ref="xquery-use-cases"/></phrase>,
         while a fourth example is based on the data and queries in the
         NS (Queries Using Namespaces) use case. 
         For each example, we show the English description of the query,
         the XQuery solution given in <phrase diff="chg"><bibref ref="xquery-use-cases"/></phrase>,
         an XQueryX solution, and the XQuery that results from applying the XQueryX-to-XQuery transformation
         defined by the stylesheet in <specref ref="Stylesheet"/> to the XQueryX solution. 
         The generated XQuery is presented only as a sanity-check &mdash;
         the intent of the stylesheet is not to create the identical
         XQuery expression given in <phrase diff="chg"><bibref ref="xquery-use-cases"/></phrase>,
         but to produce <emph>a</emph> valid
         XQuery expression with the same semantics. 
         The semantics of the XQueryX solution are determined by the semantics of the XQuery expression that
         results from that transformation.  The "correctness" of that transformation is determined by
         asking the following the question:
         Can some XQueryX processor QX process some XQueryX document D1 to produce results R1,
         after which the stylesheet is used to translate D1 into an XQuery expression E1 that,
         when processed by some XQuery processor Q, produces results R2 that are equivalent
         (under some meaningful definition of "equivalent") to results R1? </p>

      <p>Comparison of the results of the XQueryX-to-XQuery transformation given in this document
         with the XQuery solutions in the <phrase diff="chg"><bibref ref="xquery-use-cases"/></phrase>
         may be helpful in evaluating
         the correctness of the XQueryX solution in each example. </p>

      <p>The XQuery Use Cases solution given for each example is provided only to assist readers of this
         document in understanding the XQueryX solution.  There is no intent to imply that this
         document specifies a "compilation" or "transformation" of XQuery syntax into XQueryX syntax. </p>

      <p>In the following examples, note that path expressions are expanded to show their
         structure. Also, note that the prefix syntax for binary operators like "and" makes the
         precedence explicit. In general, humans find it easier to read an XML representation
         that does not expand path expressions, but it is less convenient for programmatic
         representation and manipulation.  XQueryX is designed as a language that is convenient
         for production and modification by software, and not as a convenient syntax for humans to
         read and write. </p>

      <p>Finally, please note that white space, including new lines, have been added to
         some of the XQueryX documents and XQuery expressions for readability. 
         That additional white space is not produced by the XQueryX-to-XQuery transformation. </p>

      <div2 id="Example1">
        <head>Example 1</head>

        <p>Here is Q1 from the <phrase diff="chg"><bibref ref="xquery-use-cases"/></phrase>,
           use case XMP (Experiences and Exemplars): "List books published by Addison-Wesley after 1991,
           including their year and title."</p>

        <div3 id="Example1-XQuery">
          <head>XQuery solution in XQuery Use Cases:</head>

          <eg>&exmpl1xq;</eg>

        </div3>

        <div3 id="Example1-XQueryX">
          <head>A Solution in XQueryX:</head>

          <eg>&exmpl1xqx;</eg>

        </div3>

        <div3 id="Example1-Transformation">
          <head>Transformation of XQueryX Solution into XQuery</head>

          <p>Application of the stylesheet in <specref ref="Stylesheet"/>
             to the XQueryX solution results in:</p>

          <eg>&exmpl1xqx2xq;</eg>

        </div3>

        <div3 id="Example1-Abstract">
          <head>Corresponding Grammar Abstract Parse Tree</head>

  <!-- replaced link to grammar applet per Bugzilla Bug #5323 -->
          <p>For comparison, here is the abstract parse tree corresponding to the
             XQuery for Example 1, as produced by the XQuery grammar applets found at
             <loc href="https://www.w3.org/2007/01/applets/">https://www.w3.org/2007/01/applets/</loc>. </p>

          <eg>&exmpl1grammar;</eg>

        </div3>

      </div2>

      <div2 id="Example2">
        <head>Example 2</head>

        <p>Here is Q4 from the <phrase diff="chg"><bibref ref="xquery-use-cases"/></phrase>,
           use case XMP (Experiences and Exemplars): "For each author in the bibliography, list the
           author's name and the titles of all books by that author, grouped inside a
           "result" element."</p>

        <div3 id="Example2-XQuery">
          <head>XQuery solution in XQuery Use Cases:</head>

          <eg>&exmpl2xq;</eg>

        </div3>

        <div3 id="Example2-XQueryX">
          <head>A solution in XQueryX:</head>

          <!-- insert exmpl2 here -->
          <eg>&exmpl2xqx;</eg>

        </div3>

        <div3 id="Example2-Transformation">
          <head>Transformation of XQueryX Solution into XQuery</head>

          <p>Application of the stylesheet in <specref ref="Stylesheet"/>
            to the XQueryX solution results in:</p>

          <eg>&exmpl2xqx2xq;</eg>

        </div3>

      </div2>

      <div2 id="Example3">
        <head>Example 3</head>

        <p>Here is Q7 from the <phrase diff="chg"><bibref ref="xquery-use-cases"/></phrase>,
           use case XMP (Experiences and Exemplars): "List the titles and years of all books published by
           Addison-Wesley after 1991, in alphabetic order."</p>
 
        <div3 id="Example3-XQuery">
          <head>XQuery solution in XQuery Use Cases:</head>
 
          <eg>&exmpl3xq;</eg>

        </div3>

        <div3 id="Example3-XQueryX">
          <head>A solution in XQueryX:</head>

          <!-- insert exmpl3 here -->
          <eg>&exmpl3xqx;</eg>

        </div3>

        <div3 id="Example3-Transformation">
          <head>Transformation of XQueryX Solution into XQuery</head>

          <p>Application of the stylesheet in <specref ref="Stylesheet"/> to the XQueryX solution
             results in:</p>

          <eg>&exmpl3xqx2xq;</eg>

        </div3>

      </div2>

      <div2 id="Example4">
        <head>Example 4</head>

        <p>Here is Q8 from the <phrase diff="chg"><bibref ref="xquery-use-cases"/></phrase>,
           use case NS (Queries Using Namespaces):
           "Select all traders (either seller or high bidder) without negative comments."</p>
 
        <div3 id="Example4-XQuery">
          <head>XQuery solution in XQuery Use Cases:</head>
 
          <eg>&exmpl4xq;</eg>

        </div3>

        <div3 id="Example4-XQueryX">
          <head>A solution in XQueryX:</head>

          <!-- insert exmpl4 here -->
          <eg>&exmpl4xqx;</eg>

        </div3>

        <div3 id="Example4-Transformation">
          <head>Transformation of XQueryX Solution into XQuery</head>

          <p>Application of the stylesheet in <specref ref="Stylesheet"/>
             to the XQueryX solution results in:</p>

          <eg>&exmpl4xqx2xq;</eg>

        </div3>

      </div2>

    </div1>


    <div1 id="Schema">
      <head>An XML Schema for the XQuery XML Syntax</head>

      <p>Here is the XML Schema against which XQueryX documents must be valid.</p>

      <eg>&xqx-schema;</eg>

    </div1>

<!-- Trivial Embedding, an At Risk feature, was dropped by the Joint XML Query and XSL WG meeting
     on 2006-11-02

    <div1 id="TrivialEmbedding">
      <head>A Trivial Embedding of XQuery</head>
      <p>
        <specref ref="Introduction"/> observed that the
<bibref ref="xquery-requirements"/> says <quote>The XML Query Language MAY have
more than one syntax binding. One query language syntax MUST be convenient for
humans to read and write. One query language syntax MUST be expressed in XML in
a way that reflects the underlying structure of the query.</quote>
There are many possible ways to define an XML syntax for XQuery. 
This document specifies two XML Syntaxes for XQuery: 
the one in <specref ref="Schema"/> and the <quote>trivial embedding</quote>
defined in this section. 
Of course, XQueries could be expressed in XML Syntax in other ways.</p>

      <p>The trivial embedding specified here can be used when an
      XQuery is exchanged with other entities as XML or embedded
      in an XML document, and when it is not necessary to communicate
      the underlying structure of the query. 
      When this alternative is chosen, the XQuery expression is treated
      as though it were ordinary text. </p>

      <p>The trivial embedding defined in this specification requires that the
entire query be enclosed within an element named "xquery" in the XQueryX namespace
(the "xqx:" namespace prefix is used here only for the purposes of this example),
as illustrated here:</p>

      <eg>&lt;xqx:xquery&gt;for $i... let $j...where $x = $y...return...&lt;/xqx:xquery&gt;</eg>

< ! - -  Response to Bugzilla bug #2611 - - >
<p>
XQuery expressions are, for the purposes of this trivial embedding, treated 
as literal text. Therefore, if the XQuery contains characters that are 
prohibited in XML text (specifically &lt; and &amp;), they must be "escaped" as 
character entity references (&amp;lt; and &amp;amp;, respectively) or as numeric 
character references (for example, &amp;#x3C; and &amp;#x26;, respectively), or 
they must be enclosed in a CDATA section (for example, &lt;![CDATA[&lt;]] or 
&lt;![CDATA[&amp;]]).  Note that this includes the leading "&lt;" of a CDATA section 
that appears in the original XQuery expression.  In addition, because the 
sequence of characters "]]&gt;" is always prohibited within element content,
it is recommended that instances of &gt; in the original XQuery always be 
"escaped" (for example, as &amp;gt;, &amp;#x3E;, or &lt;![CDATA[&gt;]]).
</p>

      <eg>&lt;xqx:xquery&gt;for $i... let $j...where $x &amp;lt; $y...return...&lt;/xqx:xquery&gt;</eg>

      <p>or</p>

      <eg>&lt;xqx:xquery&gt;for $i... let $j...where $x &amp;x003C; $y...return...&lt;/xqx:xquery&gt;</eg>

      <p>This limitation may require that user agents scan the XQuery text, escaping such
prohibited characters, before transmitting or embedding the XQuery as XML. </p>

< ! - - Response to Bugzilla bug #2611 - - >
< ! - - Response to Bugzilla bug #3056 - - >
      <p>The following two more complete examples (which are equivalent to one another
      and to "<code>for $i in (1 to 5) let $j := 4 where $i &lt; $j return
  &lt;x&gt;&lt;i&gt;{$i}&lt;/i&gt;&lt;/x&gt;</code>") further illustrate the use of the
         XQueryX trivial embedding. </p>

      <eg>&lt;xqx:xquery&gt;for $i in (1 to 5) let $j := 4 where $i &amp;lt; $j return
  &lt;x&gt;&lt;i&gt;{$i}&lt;/i&gt;&lt;/x&gt;&lt;/xqx:xquery&gt;

&lt;xqx:xquery&gt;&lt;![CDATA[for $i in (1 to 5) let $j := 4 where $i &lt; $j
  return &lt;x&gt;&lt;i&gt;{$i}&lt;/i&gt;&lt;/x&gt;]]&gt;&lt;/xqx:xquery&gt;</eg>

    </div1>
-->

    <div1 id="xqx_conformance">
      <head>Conformance</head>

      <p>This section defines the conformance criteria for an XQueryX processor
         (see Figure 1, "Processing Model Overview", in <phrase diff="chg"><bibref ref="xquery-31"/></phrase>,
         <xspecref diff="chg" spec="XQ31" ref="id-processing-model"/>. 
      </p>

      <p>In this section, the following terms are used to indicate the
         requirement levels defined in <bibref ref="RFC2119"/>. 
         [Definition: MUST means that the item is an absolute requirement of the specification.]
         [Definition: SHOULD means that there may exist valid reasons in particular
         circumstances to ignore a particular item, but the full implications
         must be understood and carefully weighed before choosing a different course.]
         [Definition: MAY means that an item is truly optional.] </p>

      <p>An XQueryX processor that claims to conform to this specification MUST
         implement the XQueryX syntax as defined in <specref ref="Schema"/> of this
         specification and include a claim of Minimal Conformance as defined in
         <phrase diff="chg"><bibref ref="xquery-31"/></phrase>,
         <xspecref diff="chg" spec="XQ31" ref="id-minimal-conformance"/>. 
         In addition to a claim of Minimal Conformance, it MAY claim conformance to
         one or more optional features defined in
         <phrase diff="chg"><bibref ref="xquery-31"/></phrase>,
         <xspecref diff="chg" spec="XQ31" ref="id-conform-optional-features"/>. </p>

    </div1>

  </body>


  <back>

    <div1 id="biblio">
      <head>References</head>

<!-- RFC refs changed per re-opened Bugzilla bug #1345 -->
      <blist>

        <bibl id="xqueryx-30" key="XQueryX 3.0"/>
        <bibl id="xquery-use-cases" key="XML Query Use Cases" diff="chg"/>
        <bibl id="xquery-31" key="XQuery 3.1: An XML Query Language"/>
        <bibl id="xpath-functions-31" key="XQuery and XPath Functions and Operators 3.1"/>
        <bibl id="xquery-semantics" key="XQuery 1.0 and XPath 2.0 Formal Semantics"/>
        <bibl id="RFC2119" key="RFC 2119">S. Bradner. 
          <emph>Key Words for use in RFCs to Indicate Requirement Levels.</emph> IETF RFC 2119. 
          See <loc href="http://www.ietf.org/rfc/rfc2119.txt">http://www.ietf.org/rfc/rfc2119.txt</loc>.</bibl>
        <bibl id="RFC3023" key="RFC 3023">M. Murata, S. St. Laurent, and D. Kohn. 
          <emph>XML Media Types</emph> IETF RFC 3023 or its successors. 
          See <loc href="http://www.ietf.org/rfc/rfc3023.txt">http://www.ietf.org/rfc/rfc3023.txt</loc>.</bibl>
<!--        <bibl id="RFC3986" key="RFC 3986">T. Berners-Lee, R. Fielding, and L. Masinter. 
		  <emph>Uniform Resource Identifiers (URI): Generic Syntax</emph>. IETF RFC 3986. 
		  See <loc href="http://www.ietf.org/rfc/rfc3986.txt">http://www.ietf.org/rfc/rfc3986.txt</loc>.</bibl> -->
      </blist>

    </div1>


    <div1 id="Stylesheet">

      <head>Transforming XQueryX to XQuery</head>

      <p>The following stylesheet converts from XQueryX syntax to XQuery syntax. 
         Note the intent of the stylesheet is to produce <emph>a</emph> valid XQuery with the
         same semantics (see <bibref ref="xquery-semantics"/>) as the input XQueryX.</p>

      <eg>&xqx2xq-stylesheet;</eg>

    </div1>

<!-- Insert the appendix for the MIME type for XQueryX here -->
    &mimetypeappendix;

    <inform-div1 id="changelog">
      <head>Change log</head>

      <p>This appendix lists the changes that have been made to this specification
         since the publication of the XQueryX 3.0 Recommendation on 24 April 2014. </p>

      <div2 id="changelog_incompatibilities">
        <head>Incompatibilities</head>

        <p diff="chg" at="2013-12-17">The
           &doc.w3c-doctype-full;
           of
           &date.day; &date.month; &date.year;,
           contains the following incompatibilities with XQueryX 3.0.
           The changes made to this document are described below. 
           The rationale for each change is explained in the corresponding Bugzilla database entry (if any). 
           The following table summarizes the changes that have been applied.
        </p>

<!-- Don't produce sections for documents that have not yet been published!

        <div3 id="changelog_incompat_PR" diff="add" at="2014-07-13">
          <head>Incompatibilities introduced during the Proposed Recommendation period</head>

        <ulist diff="chg" at="2014-07-13">

          <item diff="add" at="2014-07-13">
            <p>None.</p>
          </item>

        </ulist>

        </div3>

        <div3 id="changelog_incompat_CR" diff="add" at="2014-07-13">
          <head>Incompatibilities introduced during the Candidate Recommendation period</head>

        <ulist diff="chg" at="2014-07-13">

          <item diff="add" at="2014-07-13">
            <p>None.</p>
          </item>

        </ulist>

        </div3>

        <div3 id="changelog_incompat_LC" diff="add" at="2014-07-13">
          <head>Incompatibilities introduced during the Last Call period</head>

        <ulist diff="chg" at="2014-07-13">

          <item diff="add" at="2014-07-13">
            <p>None.</p>
          </item>

        </ulist>

        </div3>

Don't produce sections for documents that have not yet been published! -->


        <div3 id="changelog_incompat_WD" diff="add" at="2014-07-13">
          <head>Incompatibilities introduced during the Working Draft period</head>

        <ulist diff="chg" at="2014-07-13">

          <item diff="add" at="2014-07-13">
            <p>None.</p>
          </item>

        </ulist>

        </div3>

        <div3 id="changelog_incompat_preFPWD" diff="add" at="2014-07-13">
          <head>Incompatibilities introduced before publication of the First Public Working Draft</head>

        <ulist diff="chg" at="2014-07-13">

          <item diff="add" at="2014-07-13">
            <p>None.</p>
          </item>

        </ulist>

        </div3>

      </div2>

      <div2 id="changelog_substantive">
        <head>Substantive changes</head>

        <p>In the
           &doc.w3c-doctype-full;
           of
           &date.day; &date.month; &date.year;,
           the following substantive changes have been made relative to XQueryX 3.0.
           The changes made to this document are described below. 
           The rationale for each change is explained in the corresponding Bugzilla database entry (if any). 
           The following table summarizes the changes that have been applied.
        </p>

<!-- Don't produce sections for documents that have not yet been published!

        <div3 id="changelog_substantive_PR" diff="add" at="2014-07-13">
          <head>Substantive changes introduced during the Proposed Recommendation period</head>

        <ulist diff="chg" at="2014-07-13">

          <item diff="add" at="2014-07-13">
            <p>None.</p>
          </item>

        </ulist>

        </div3>

        <div3 id="changelog_substantive_CR" diff="add" at="2014-07-13">
          <head>Substantive changes introduced during the Candidate Recommendation period</head>

        <ulist diff="chg" at="2014-07-13">

          <item diff="add" at="2014-07-13">
            <p>None.</p>
          </item>

        </ulist>

        </div3>

Don't produce sections for documents that have not yet been published! -->

        <div3 id="changelog_substantive_LC" diff="add" at="2014-12-09">
          <head>Substantive changes introduced during the Last Call period</head>

        <ulist>

          <item>
            <p>None.</p>
          </item>

        </ulist>

        </div3>

        <div3 id="changelog_substantive_WD" diff="add" at="2014-07-13">
          <head>Substantive changes introduced during the Working Draft period</head>

        <ulist diff="chg" at="2014-07-13">

          <item diff="add" at="2014-07-11">
            <p>Added support for map tests (anyMapTest and typedMapTest) and array tests (anyArrayTest and typedArrayTest).
            (Affects <specref ref="Schema"/> and <specref ref="Stylesheet"/>.)</p>
          </item>

          <item diff="add" at="2014-07-13">
            <p>Modified definition of stepExpr to allow additional alternatives (besides "predicates") following the
            primaryExpr; the new alternatives include a mixed sequence of "predicate", "lookup", and "arrowPostfix".
            (Affects <specref ref="Schema"/> and <specref ref="Stylesheet"/>.)</p>
          </item>

          <item diff="add" at="2014-07-13">
            <p>Added support for XQuery 3.0 new features Lookup, UnaryLookup, and ArrowPostfix.
            This includes making UnaryLookup a new alternative of PrimaryExpr (in XQueryX, it becomes a new
            alternative of filterExpr).
            (Affects <specref ref="Schema"/> and <specref ref="Stylesheet"/>.)</p>
          </item>

          <item diff="add" at="2014-07-13">
            <p>Added support for XQuery 3.0 new features MapConstructor and ArrayConstructor
            (both SquareArrayConstructor and CurlyArrayConstructor).
            This includes making both of those new alternatives of PrimaryExpr
            (in XQueryX, they become new alternatives of filterExpr).
            (Affects <specref ref="Schema"/> and <specref ref="Stylesheet"/>.)</p>
          </item>

          <item diff="add" at="2014-07-16">
            <p>Added support for a new option ("*") to the alternatives for lookup (formerly mapLookup).
            (Affects <specref ref="Schema"/> and <specref ref="Stylesheet"/>.)</p>
          </item>

        </ulist>

        </div3>

        <div3 id="changelog_substantive_preFPWD" diff="add" at="2014-07-13">
          <head>Substantive changes introduced before publication of the First Public Working Draft</head>

        <ulist diff="chg" at="2014-07-13">

          <item diff="add" at="2014-07-13">
            <p>None.</p>
          </item>

        </ulist>

        </div3>

      </div2>


      <div2 id="changelog_editorial">
        <head>Minor and Editorial changes</head>

        <p diff="chg" at="2013-12-17">In the
           &doc.w3c-doctype-full;
           of
           &date.day; &date.month; &date.year;,
           the following minor and editorial changes have been made relative to XQueryX 3.0.
           The changes made to this document are described below. 
           The rationale for each change is explained in the corresponding Bugzilla database entry (if any). 
           The following table summarizes the changes that have been applied.
        </p>

<!-- Don't produce sections for documents that have not yet been published!

        <div3 id="changelog_minor-editorial_PR" diff="add" at="2014-07-13">
          <head>Minor and Editorial changes introduced during the Proposed Recommendation period</head>

        <ulist diff="chg" at="2014-07-13">

          <item diff="add" at="2014-07-13">
            <p>None.</p>
          </item>

        </ulist>

        </div3>

        <div3 id="changelog_minor-editorial_CR" diff="add" at="2014-07-13">
          <head>Minor and Editorial introduced during the Candidate Recommendation period</head>

        <ulist diff="chg" at="2014-07-13">

          <item diff="add" at="2014-07-13">
            <p>None.</p>
          </item>

        </ulist>

        </div3>

Don't produce sections for documents that have not yet been published! -->

        <div3 id="changelog_minor-editorial_LC" diff="add" at="2014-12-09">
          <head>Minor and Editorial introduced during the Last Call period</head>

        <ulist>

          <item>
            <p>None.</p>
          </item>

        </ulist>

        </div3>

        <div3 id="changelog_minor-editorial_WD" diff="add" at="2014-07-13">
          <head>Minor and Editorial introduced during the Working Draft period</head>

        <ulist diff="chg" at="2014-07-13">

          <item diff="add" at="2014-07-13">
            <p>Overhauled the manner in which <specref ref="changelog"/> is presented. </p>
          </item>

        </ulist>

        </div3>

        <div3 id="changelog_minor-editorial_preFPWD" diff="add" at="2014-07-13">
          <head>Minor and Editorial introduced before publication of the First Public Working Draft</head>

        <ulist diff="chg" at="2014-07-13">

          <item diff="add" at="2014-07-13">
            <p>Updated several references, including a change from referencing XQueryX 1.0 to referencing XQueryX 3.0,
            and a change from referencing XQuery 3.0 to referencing XQuery 3.1. </p>
          </item>

        </ulist>

        </div3>

      </div2>

    </inform-div1>

  </back>

</spec>
