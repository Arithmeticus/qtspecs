<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="EN" xmlns="http://www.w3.org/1999/xhtml" lang="EN"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<!--XSLT Processor: Apache Software Foundation-->
<!--This document was created at 20100713 1127-->



<meta name="generator" content="HTML Tidy for Linux/x86 (vers 25 March 
2009), see www.w3.org">
<title>XQuery 1.1: An XML Query Language ("Internal Last
Call")</title>

<style type="text/css">
/*<![CDATA[*/
code           { font-family: monospace; }

div.constraint,
div.issue,
div.note,
div.notice     { margin-left: 2em; }

div.issue
p.title        { margin-left: -2em; }

ol.enumar      { list-style-type: decimal; }
ol.enumla      { list-style-type: lower-alpha; }
ol.enumlr      { list-style-type: lower-roman; }
ol.enumua      { list-style-type: upper-alpha; }
ol.enumur      { list-style-type: upper-roman; }

li p           { margin-top: 0.3em;
                 margin-bottom: 0.3em; }

sup small      { font-style: italic;
                 color: #8F8F8F;
               }
    
div.exampleInner pre { margin-left: 1em;
                       margin-top: 0em; margin-bottom: 0em}
div.exampleOuter {border: 4px double gray;
                  margin: 0em; padding: 0em}
div.exampleInner { background-color: #d5dee3;
                   border-top-width: 4px;
                   border-top-style: double;
                   border-top-color: #d3d3d3;
                   border-bottom-width: 4px;
                   border-bottom-style: double;
                   border-bottom-color: #d3d3d3;
                   padding: 4px; margin: 0em }
div.exampleWrapper { margin: 4px }
div.exampleHeader { font-weight: bold;
                    margin: 4px}

div.issue { border-bottom-color: black;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            margin-bottom: 20pt;
}

th.issue-toc-head { border-bottom-color: black;
                    border-bottom-style: solid;
                    border-bottom-width: 1pt;
}

/*]]>*/
</style>
<link type="text/css" rel="stylesheet" 
href="xquery-11-diffs_files/W3C-WD.css">
<style type="text/css">
/*<![CDATA[*/
.diff-old-a {
  font-size: smaller;
  color: red;
}

.diff-new { background-color: yellow; }
.diff-chg { background-color: lime; }
.diff-new:before,
.diff-new:after
    { content: "\2191" }
.diff-chg:before, .diff-chg:after
    { content: "\2195" }
.diff-old { text-decoration: line-through; background-color: #FBB; }
.diff-old:before,
.diff-old:after
    { content: "\2193" }
:focus { border: thin red solid}
/*]]>*/
</style>
</head><body>
<div class="head">
<p><a href="http://www.w3.org/"><img alt="W3C" 
src="xquery-11-diffs_files/w3c_home.png" height="48" width="72"></a></p>
<h1><a id="title" name="title"></a> XQuery <del class="diff-old">1.0:</del>
 <ins class="diff-chg">1.1:</ins> An XML Query
Language <ins class="diff-new">("Internal Last Call")</ins></h1>
<h2><a id="w3c-doctype" name="w3c-doctype"></a> W3C <del 
class="diff-old">Recommendation 23 January 2007</del> <ins 
class="diff-chg">Working Draft 13 July 2010</ins></h2>
<dl>
<dt>This version:</dt>
<dd><del class="diff-old">http://www.w3.org/TR/2007/REC-xquery-20070123/</del>
<a href="http://www.w3.org/TR/2010/WD-xquery-11-20100713/"><ins 
class="diff-chg">http://www.w3.org/TR/2010/WD-xquery-11-20100713/</ins></a></dd>
<dt>Latest version:</dt>
<dd><del class="diff-old">http://www.w3.org/TR/xquery/</del>
<a href="http://www.w3.org/TR/xquery-11/"><ins class="diff-chg">http://www.w3.org/TR/xquery-11/</ins></a></dd>
<dt>Previous <del class="diff-old">version:</del> <ins class="diff-chg">versions:</ins></dt>
<dd><del class="diff-old">http://www.w3.org/TR/2006/PR-xquery-20061121/</del>
<a href="http://www.w3.org/TR/2008/WD-xquery-11-20080711/"><ins 
class="diff-chg">http://www.w3.org/TR/2008/WD-xquery-11-20080711/</ins></a>
<a href="http://www.w3.org/TR/2008/WD-xquery-11-20081203/"><ins 
class="diff-chg">http://www.w3.org/TR/2008/WD-xquery-11-20081203/</ins></a></dd>
<dt>Editors:</dt>
<dd><del class="diff-old">Scott Boag (XSL WG), IBM Research
&lt;scott_boag@us.ibm.com&gt;</del> <ins class="diff-chg">Jonathan
Robie,</ins> <span><a href="http://www.redhat.com/"><ins 
class="diff-chg">Red Hat</ins></a> <del class="diff-old">Don Chamberlin
(XML Query WG), IBM Almaden Research Center,</del></span>
<ins class="diff-chg">,</ins> via <del class="diff-old">http://www.almaden.ibm.com/cs/people/chamberlin/</del>
<a href="http://www.ibiblio.org/jwrobie/"><ins class="diff-chg">http://www.ibiblio.org/jwrobie/</ins></a></dd>
<dd><del class="diff-old">Mary F. Fernández (XML Query WG),
AT&amp;T Labs &lt;mff@research.att.com&gt;</del> <ins class="diff-chg">Don
 Chamberlin</ins> <a href="mailto:dchamber@us.ibm.com"><ins 
class="diff-chg">&lt;dchamber@us.ibm.com&gt;</ins></a></dd>
<dd><del class="diff-old">Daniela Florescu (XML Query WG), Oracle
&lt;dana.florescu@oracle.com&gt;</del></dd>
<dd><ins class="diff-chg">Michael Dyck, Invited Expert</ins>
<a href="mailto:jmdyck@ibiblio.org"><ins class="diff-chg">&lt;jmdyck@ibiblio.org&gt;</ins></a></dd>
<dd><del class="diff-old">Jonathan Robie (XML Query WG),</del>
<del class="diff-old">DataDirect Technologies</del>
<span><del class="diff-old">, via
http://www.ibiblio.org/jwrobie/</del> <a 
href="http://snelson.org.uk/john"><ins class="diff-chg">John
Snelson</ins></a> <del class="diff-old">Jérôme Siméon (XML Query
WG), IBM T.J. Watson Research Center
&lt;simeon@us.ibm.com&gt;</del></span> <ins class="diff-chg">,
Oracle Corporation</ins> <a href="mailto:john.snelson@oracle.com"><ins 
class="diff-chg">&lt;john.snelson@oracle.com&gt;</ins></a></dd>
</dl>
<p><del class="diff-old">Please refer to the errata for this
document, which may include some normative corrections.</del> See
also <a 
href="http://www.w3.org/2003/03/Translations/byTechnology?technology=xquery">
<strong>translations</strong></a> .</p>
<p>This document is also available in these non-normative formats:
<a href="http://www.w3.org/TR/2010/WD-xquery-11-20100713/xquery-11.xml">XML</a>
and&nbsp; <del class="diff-old">Recent revisions .</del> <a 
href="http://www.w3.org/TR/2010/WD-xquery-11-20100713/xquery-11-diff-from-20070123.html">
<ins class="diff-chg">Change markings relative to first
edition</ins></a> .</p>
<p class="copyright"><a 
href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
<del class="diff-old">&nbsp;©&nbsp;2007&nbsp;</del> <ins 
class="diff-chg">&nbsp;©&nbsp;2010&nbsp;</ins> <a 
href="http://www.w3.org/"><acronym title="World Wide Web Consortium">W3C</acronym></a>
 <sup>®</sup> (
<a href="http://www.csail.mit.edu/"><acronym title="Massachusetts 
Institute of Technology">MIT</acronym></a> ,
<a href="http://www.ercim.eu/"><acronym title="European Research 
Consortium for Informatics and Mathematics">ERCIM</acronym></a>
, <a href="http://www.keio.ac.jp/">Keio</a> ), All Rights Reserved.
W3C <a 
href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>
, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a>
and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document
use</a> rules apply.</p>
</div>
<hr>
<div>
<h2><a id="abstract" name="abstract"></a> Abstract</h2>
<p class="xquery">XML is a versatile markup language, capable of
labeling the information content of diverse data sources including
structured and semi-structured documents, relational databases, and
object repositories. A query language that uses the structure of
XML intelligently can express queries across all these kinds of
data, whether physically stored in XML or viewed as XML via
middleware. This specification describes a query language called
XQuery, which is designed to be broadly applicable across many
types of XML data sources.</p>
<p class="xquery"><ins class="diff-chg">XQuery 1.1 is an extended
version of the XQuery 1.0 Recommendation published on 23 January
2007. A list of changes made since XQuery 1.0 can be found in</ins>
<a href="#id-revision-log"><b><ins class="diff-chg">J Change
Log</ins></b></a> .<ins class="diff-chg">Here are some of the new
features in XQuery 1.1:</ins></p>
<ol class="enumar">
<li>
<p><code><ins class="diff-chg">group by</ins></code> <ins 
class="diff-chg">clause in FLWOR Expressions (</ins> <a 
href="#id-group-by"><b><ins class="diff-chg">3.9.7 Group By
Clause</ins></b></a> <ins class="diff-chg">).</ins></p>
</li>
<li>
<p><code><ins class="diff-chg">tumbling window</ins></code>
<ins class="diff-chg">and</ins> <code><ins class="diff-chg">sliding
window</ins></code> <ins class="diff-chg">in FLWOR Expressions
(</ins> <a href="#id-windows"><b><ins class="diff-chg">3.9.4 Window
Clause</ins></b></a> <ins class="diff-chg">).</ins></p>
</li>
<li>
<p><code><ins class="diff-chg">count</ins></code> <ins class="diff-chg">clause
 in FLWOR Expressions (</ins> <a href="#id-count"><b><ins 
class="diff-chg">3.9.6 Count
Clause</ins></b></a> <ins class="diff-chg">).</ins></p>
</li>
<li>
<p><code><ins class="diff-chg">allowing empty</ins></code>
<ins class="diff-chg">in</ins> <a href="#id-xquery-for-clause"><b><ins 
class="diff-chg">3.9.2 For
Clause</ins></b></a> ,<ins class="diff-chg">for functionality
similar to outer joins in SQL.</ins></p>
</li>
<li>
<p><code><ins class="diff-chg">try</ins></code> <ins class="diff-chg">/</ins>
 <code><ins class="diff-chg">catch</ins></code>
<ins class="diff-chg">expressions (</ins> <a href="#id-try-catch"><b><ins
 class="diff-chg">3.14 Try/Catch
Expressions</ins></b></a> <ins class="diff-chg">).</ins></p>
</li>
<li>
<p><ins class="diff-chg">Dynamic function invocation (</ins>
<a href="#id-dynamic-function-invocation"><b><ins class="diff-chg">3.2.2
 Dynamic Function Invocation</ins></b></a>
<ins class="diff-chg">).</ins></p>
</li>
<li>
<p><ins class="diff-chg">Inline functions (</ins> <a 
href="#id-inline-func"><b><ins class="diff-chg">3.1.7 Inline
Functions</ins></b></a> <ins class="diff-chg">).</ins></p>
</li>
<li>
<p><ins class="diff-chg">Private functions (</ins> <a 
href="#FunctionDeclns"><b><ins class="diff-chg">4.18 Function
Declaration</ins></b></a> <ins class="diff-chg">).</ins></p>
</li>
<li>
<p><ins class="diff-chg">Nondeterministic functions (</ins>
<a href="#FunctionDeclns"><b><ins class="diff-chg">4.18 Function
Declaration</ins></b></a> <ins class="diff-chg">)</ins></p>
</li>
<li>
<p><ins class="diff-chg">Switch expressions (</ins> <a href="#id-switch"><b><ins
 class="diff-chg">3.12 Switch
Expression</ins></b></a> <ins class="diff-chg">)</ins></p>
</li>
<li>
<p><ins class="diff-chg">Computed namespace constructors (</ins>
<a href="#id-computed-namespaces"><b><ins class="diff-chg">3.8.3.7
Computed Namespace Constructors</ins></b></a> <ins class="diff-chg">).</ins></p>
</li>
<li>
<p><ins class="diff-chg">Output declarations (</ins> <a 
href="#id-serialization"><b><ins class="diff-chg">2.2.4
Serialization</ins></b></a> <ins class="diff-chg">).</ins></p>
</li>
<li>
<p><ins class="diff-chg">Annotations (</ins> <a href="#id-annotations"><b><ins
 class="diff-chg">4.15
Annotations</ins></b></a> <ins class="diff-chg">).</ins></p>
</li>
<li>
<p><a title="annotation assertion" href="#dt-annotation-assertion"><ins 
class="diff-chg">Annotation
assertions</ins></a> <ins class="diff-chg">in</ins> <a 
href="#doc-xquery11-FunctionTest"><ins class="diff-chg">function
tests</ins></a> .</p>
</li>
</ol>
</div>
<div>
<h2><a id="status" name="status"></a> Status of this Document</h2>
<p><em>This section describes the status of this document at the
time of its publication. Other documents may supersede this
document. A list of current W3C publications and the latest
revision of this technical report can be found in the <a 
href="http://www.w3.org/TR/">W3C technical reports index</a> at
http://www.w3.org/TR/.</em></p>
<p>This is one document in a set of <del class="diff-old">eight</del> <ins
 class="diff-chg">seven</ins> documents
that <del class="diff-old">have</del> <ins class="diff-chg">are
being</ins> progressed to Recommendation together (XQuery
<del class="diff-old">1.0,</del> <ins class="diff-chg">1.1,</ins>
XQueryX <del class="diff-old">1.0,</del> <ins class="diff-chg">1.1,</ins>
 XSLT <del class="diff-old">2.0,</del>
<ins class="diff-chg">2.1,</ins> Data <del class="diff-old">Model,</del>
 <ins class="diff-chg">Model 1.1,</ins>
Functions and <del class="diff-old">Operators, Formal Semantics,
Serialization,</del> <ins class="diff-chg">Operators 1.1,
Serialization 1.1,</ins> XPath <del class="diff-old">2.0).</del>
<ins class="diff-chg">2.1).</ins></p>
<p>This is a <del class="diff-old">Recommendation</del> <a 
href="http://www.w3.org/2005/10/Process-20051014/tr.html#maturity-levels">
<ins class="diff-chg">Working Draft</ins></a> <del class="diff-old">of</del>
 <ins class="diff-chg">as described in</ins> the
<del class="diff-old">W3C.</del> <a 
href="http://www.w3.org/2005/10/Process-20051014/tr.html"><ins 
class="diff-chg">Process Document</ins></a> . It has been developed by
the W3C <a href="http://www.w3.org/XML/Query/">XML Query Working
Group</a> , which is part of the <a 
href="http://www.w3.org/XML/Activity">XML Activity</a> . <ins 
class="diff-chg">The Working Group expects to advance this specification
to</ins> <a 
href="http://www.w3.org/2005/10/Process-20051014/tr.html#RecsW3C"><ins 
class="diff-chg">
Recommendation</ins></a> <ins class="diff-chg">Status.</ins></p>
<p>This <del class="diff-old">document has been reviewed by W3C
Members, by software developers, and by other W3C groups</del>
<ins class="diff-chg">is an "internal last call working draft" of
XQuery 1.1. The purpose of this publication is for members of the
XML Query</ins> and <del class="diff-old">interested parties,</del>
<ins class="diff-chg">XSL WGs to review the content</ins> and
<del class="diff-old">is endorsed by</del> <ins class="diff-chg">identify
 all issues that they believe would inhibit
progression of</ins> the <del class="diff-old">Director as a W3C
Recommendation. It is a stable</del> document <del class="diff-old">and 
may be used as reference material or cited from
another document. W3C's role</del> <ins class="diff-chg">to
Proposed Recommendation status. Ideally, WG members will identify
all such issues</ins> in <del class="diff-old">making</del> the
<del class="diff-old">Recommendation</del> <ins class="diff-chg">document
 before it</ins> is <ins class="diff-new">progressed</ins> to <del 
class="diff-old">draw attention
to the specification</del> <ins class="diff-chg">Last Call Working
Draft status</ins> and <ins class="diff-new">will not submit large
numbers of issues during the (public) Last Call review period. WG
members' comments on this document should be submitted, using the
ordinary Bugzilla reporting mechanism, no later than Friday,
2010-07-09, so they may be considered by the Joint face-to-face
meeting scheduled</ins> to <del class="diff-old">promote its
widespread deployment. This enhances</del> <ins class="diff-chg">begin 
on 2010-07-12.</ins></p>
<p><ins class="diff-chg">The following items have been resolved,
but are not not completely implemented in this internal last call
document.</ins></p>
<ol class="enumar">
<li>
<p><ins class="diff-chg">A formal definition for resolving a URI
will be supplied, consistent with</ins> the <del class="diff-old">functionality
 and interoperability</del> <ins class="diff-chg">resolution</ins> of <a
 href="http://www.w3.org/Bugs/Public/show_bug.cgi?id=8810#c2"><ins 
class="diff-new">Bug 8810, Comment #2</ins></a> .</p>
</li>
</ol>
<p><ins class="diff-new">The following items are incompletely
implemented or likely to change before</ins> the <del class="diff-old">Web.</del>
 <ins class="diff-chg">Last Call
document:</ins></p>
<ol class="enumar">
<li>
<p><ins class="diff-new">Specification of serialization parameters
in a query is likely to change in resolution of</ins> <a 
href="http://www.w3.org/2007/10/%20http://www.w3.org/Bugs/Public/show_bug.cgi?id=9302"><ins
 class="diff-new">Bug 9302</ins></a></p>
</li>
<li>
<p><ins class="diff-chg">Discussion of determinism, stability, and
related concepts may be modified per</ins> <a 
href="http://lists.w3.org/Archives/Member/w3c-xsl-query/2010Jun/0077.html">
<ins class="diff-chg">w3c-xsl-query/2010Jun/0077.html</ins></a>
.</p>
</li>
<li>
<p><ins class="diff-chg">Handling of static errors in switch
expressions needs to be specified, as discussed in</ins> <a 
href="http://www.w3.org/Bugs/Public/show_bug.cgi?id=9252#c5"><ins 
class="diff-chg">Bug 9259, Comment #5</ins></a> .</p>
</li>
</ol>
<p><ins class="diff-chg">No implementation report currently exists.
However, a Test Suite for XQuery 1.1 is under
development.</ins></p>
<p>This document incorporates <del class="diff-old">minor</del>
changes made against the <del class="diff-old">Proposed
Recommendation</del> <ins class="diff-chg">previous
publication</ins> of <del class="diff-old">21 November 2006; please
see</del> the <del class="diff-old">public disposition</del>
<ins class="diff-chg">Working Draft</ins> of <del class="diff-old">comments
 for details.</del> <ins class="diff-chg">03
December 2008.</ins> Changes to this document since the <del 
class="diff-old">Proposed Recommendation</del> <ins class="diff-chg">previous
 publication of the Working Draft</ins> are
detailed in <del class="diff-old">the</del> <a href="#id-revision-log"><b>J
 <del class="diff-old">Revision</del>
<ins class="diff-chg">Change</ins> Log</b></a> .</p>
<p>Please report errors in this document using W3C's <a 
href="http://www.w3.org/Bugs/Public/">public Bugzilla system</a>
(instructions can be found at <a 
href="http://www.w3.org/XML/2005/04/qt-bugzilla">http://www.w3.org/XML/2005/04/qt-bugzilla</a>
). If access to that system is not feasible, you may send your
comments to the W3C XSLT/XPath/XQuery public comments mailing list,
<a href="mailto:public-qt-comments@w3.org">public-qt-comments@w3.org</a>
 .
It will be very helpful if you include the string <del class="diff-old">“[
 XQuery ]”</del> <ins class="diff-chg">“[XQuery11]”</ins> in the subject
 line of your report,
whether made in Bugzilla or in email. <del class="diff-old">Each</del> <ins
 class="diff-chg">Please use
multiple</ins> Bugzilla <del class="diff-old">entry and</del>
<ins class="diff-chg">entries (or, if necessary, multiple</ins>
email <del class="diff-old">message should contain only</del>
<ins class="diff-chg">messages) if you have more than</ins> one
<del class="diff-old">error report.</del> <ins class="diff-chg">comment 
to make.</ins> Archives of the comments and
responses are available at <a 
href="http://lists.w3.org/Archives/Public/public-qt-comments/">http://lists.w3.org/Archives/Public/public-qt-comments/</a>
.</p>
<p><ins class="diff-new">Publication as a Working Draft does not
imply endorsement by the W3C Membership. This is a draft document
and may be updated, replaced or obsoleted by other documents at any
time. It is inappropriate to cite this document as other than work
in progress.</ins></p>
<p>This document was produced by a group operating under the
<a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5
February 2004 W3C Patent Policy</a> . W3C maintains a <a 
href="http://www.w3.org/2004/01/pp-impl/18797/status#disclosures">public
list of any patent disclosures</a> made in connection with the
deliverables of the group; that page also includes instructions for
disclosing a patent. An individual who has actual knowledge of a
patent which the individual believes contains <a 
href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">
Essential Claim(s)</a> must disclose the information in accordance
with <a 
href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">
section 6 of the W3C Patent Policy</a> .</p>
</div>
<div class="toc">
<h2><a id="contents" name="contents"></a> Table of Contents</h2>
<p class="toc">1 <a href="#id-introduction">Introduction</a><br>
2 <a href="#id-basics">Basics</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;2.1 <a href="#context">Expression
Context</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.1.1 <a 
href="#static_context">Static Context</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.1.2 <a 
href="#eval_context">Dynamic Context</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;2.2 <a href="#id-processing-model">Processing 
Model</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.2.1 <a 
href="#id-data-model-generation">Data Model Generation</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.2.2 <a 
href="#id-schema-import-processing">Schema Import Processing</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.2.3 <a 
href="#id-expression-processing">Expression Processing</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.2.3.1
<a href="#id-static-analysis">Static Analysis Phase</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.2.3.2
<a href="#id-dynamic-evaluation">Dynamic Evaluation Phase</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.2.4 <a 
href="#id-serialization">Serialization</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.2.5 <a 
href="#id-consistency-constraints">Consistency Constraints</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;2.3 <a href="#errors">Error
Handling</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.3.1 <a 
href="#id-kinds-of-errors">Kinds of Errors</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.3.2 <a 
href="#id-identifying-errors">Identifying and Reporting Errors</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.3.3 <a 
href="#id-handling-dynamic">Handling Dynamic Errors</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.3.4 <a 
href="#id-errors-and-opt">Errors and Optimization</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;2.4 <a href="#id-important-concepts">Concepts</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.4.1 <a 
href="#id-document-order">Document Order</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.4.2 <a 
href="#id-atomization">Atomization</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.4.3 <a href="#id-ebv">Effective
 Boolean Value</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.4.4 <a 
href="#id-input-sources">Input Sources</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.4.5 <a 
href="#id-uri-literals">URI Literals</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;2.5 <a href="#id-types">Types</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.5.1 <a 
href="#id-predefined-types">Predefined Schema Types</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.5.2 <a 
href="#id-typed-value">Typed Value and String Value</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.5.3 <a 
href="#id-sequencetype-syntax">SequenceType Syntax</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.5.4 <a 
href="#id-sequencetype-matching">SequenceType Matching</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.5.4.1
<a href="#id-matching-value">Matching a SequenceType and a
Value</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.5.4.2
<a href="#id-matching-item">Matching an ItemType and an
Item</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.5.4.3
<a href="#id-element-test">Element Test</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.5.4.4
<a href="#id-schema-element-test">Schema Element Test</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.5.4.5
<a href="#id-attribute-test">Attribute Test</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.5.4.6
<a href="#id-schema-attribute-test">Schema Attribute Test</a><br>
<ins class="diff-new">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.5.5</ins>
<a href="#id-sequencetype-subtype"><ins class="diff-new">SequenceType 
Subtype Relationships</ins></a><br>
<ins class="diff-new">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.5.5.1</ins>
<a href="#id-seqtype-subtype"><ins class="diff-new">The
SequenceType Subtype Judgement</ins></a><br>
<ins class="diff-new">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.5.5.2</ins>
<a href="#id-itemtype-subtype"><ins class="diff-new">The ItemType
Subtype Judgement</ins></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;2.6 <a href="#comments">Comments</a><br>
3 <a href="#id-expressions">Expressions</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;3.1 <a href="#id-primary-expressions">Primary 
Expressions</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.1.1 <a 
href="#id-literals">Literals</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.1.2 <a 
href="#id-variables">Variable References</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.1.3 <a 
href="#id-paren-expressions">Parenthesized Expressions</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.1.4 <a 
href="#id-context-item-expression">Context Item Expression</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.1.5 <a 
href="#id-function-calls">Function Calls</a><br>
<ins class="diff-new">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.1.5.1</ins>
<a href="#id-eval-function-call"><ins class="diff-new">Evaluating
Function Calls</ins></a><br>
<ins class="diff-new">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.1.5.2</ins>
<a href="#id-function-conversion-rules"><ins class="diff-new">Function 
Conversion Rules</ins></a><br>
<ins class="diff-new">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.1.5.3</ins>
<a href="#id-function-coercion"><ins class="diff-new">Function Item
Coercion</ins></a><br>
<ins class="diff-new">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.1.5.4</ins>
<a href="#id-partial-function-application"><ins class="diff-new">Evaluating
 Partial Function Applications</ins></a><br>
<ins class="diff-new">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.1.6</ins>
<a href="#id-literal-func-ref"><ins class="diff-new">Literal
Function Items</ins></a><br>
<ins class="diff-new">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.1.7</ins>
<a href="#id-inline-func"><ins class="diff-new">Inline
Functions</ins></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;3.2 <a href="#id-postfix-expression"><ins 
class="diff-new">Postfix
Expressions</ins></a><br>
<ins class="diff-new">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.2.1</ins>
<a href="#id-filter-expression"><ins class="diff-new">Filter
Expressions</ins></a><br>
<ins class="diff-new">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.2.2</ins>
<a href="#id-dynamic-function-invocation"><ins class="diff-new">Dynamic 
Function Invocation</ins></a><br>
<ins class="diff-new">&nbsp;&nbsp;&nbsp;&nbsp;3.3</ins> <a 
href="#id-path-expressions">Path Expressions</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.2.1</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.3.1</ins>
<a href="#id-steps">Steps</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.2.1.1</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.3.1.1</ins>
<a href="#axes">Axes</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.2.1.2</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.3.1.2</ins>
<a href="#node-tests">Node Tests</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.2.2</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.3.2</ins>
<a href="#id-predicate">Predicates <ins class="diff-new">within
Steps</ins></a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.2.3</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.3.3</ins>
<a href="#unabbrev">Unabbreviated Syntax</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.2.4</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.3.4</ins>
<a href="#abbrev">Abbreviated Syntax</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;3.3</del> <ins 
class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;3.4</ins> <a 
href="#id-sequence-expressions">Sequence Expressions</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.3.1</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.4.1</ins>
<a href="#construct_seq">Constructing Sequences</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.3.2
Filter
 Expressions
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.3.3</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.4.2</ins>
<a href="#combining_seq">Combining Node Sequences</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;3.4</del> <ins 
class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;3.5</ins> <a 
href="#id-arithmetic">Arithmetic Expressions</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;3.5</del> <ins 
class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;3.6</ins> <a 
href="#id-comparisons">Comparison Expressions</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.5.1</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.6.1</ins>
<a href="#id-value-comparisons">Value Comparisons</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.5.2</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.6.2</ins>
<a href="#id-general-comparisons">General Comparisons</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.5.3</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.6.3</ins>
<a href="#id-node-comparisons">Node Comparisons</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;3.6</del> <ins 
class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;3.7</ins> <a 
href="#id-logical-expressions">Logical Expressions</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;3.7</del> <ins 
class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;3.8</ins> <a 
href="#id-constructors">Constructors</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.7.1</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.8.1</ins>
<a href="#id-element-constructor">Direct Element
Constructors</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.7.1.1</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.8.1.1</ins>
<a href="#id-attributes">Attributes</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.7.1.2</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.8.1.2</ins>
<a href="#id-namespaces">Namespace Declaration Attributes</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.7.1.3</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.8.1.3</ins>
<a href="#id-content">Content</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.7.1.4</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.8.1.4</ins>
<a href="#id-whitespace">Boundary Whitespace</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.7.2</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.8.2</ins>
<a href="#id-otherConstructors">Other Direct Constructors</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.7.3</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.8.3</ins>
<a href="#id-computedConstructors">Computed Constructors</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.7.3.1</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.8.3.1</ins>
<a href="#id-computedElements">Computed Element
Constructors</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.7.3.2</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.8.3.2</ins>
<a href="#id-computedAttributes">Computed Attribute
Constructors</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.7.3.3</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.8.3.3</ins>
<a href="#id-documentConstructors">Document Node
Constructors</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.7.3.4</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.8.3.4</ins>
<a href="#id-textConstructors">Text Node Constructors</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.7.3.5</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.8.3.5</ins>
<a href="#id-computed-pis">Computed Processing Instruction
Constructors</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.7.3.6</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.8.3.6</ins>
<a href="#id-computed-comments">Computed Comment
Constructors</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.7.4</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.8.3.7</ins>
<a href="#id-computed-namespaces"><ins class="diff-chg">Computed
Namespace Constructors</ins></a><br>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.8.4</ins>
<a href="#id-ns-nodes-on-elements">In-scope Namespaces of a
Constructed Element</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;3.8</del> <ins 
class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;3.9</ins> <a 
href="#id-flwor-expressions">FLWOR Expressions</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.8.1</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.9.1</ins>
<a href="#id-binding-rules"><ins class="diff-chg">Variable
Bindings</ins></a><br>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.9.2</ins>
<a href="#id-xquery-for-clause">For <del class="diff-old">and</del>
<ins class="diff-chg">Clause</ins></a><br>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.9.3</ins>
<a href="#id-xquery-let-clause">Let <ins class="diff-new">Clause</ins></a><br>
<ins class="diff-new">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.9.4</ins>
<a href="#id-windows"><ins class="diff-new">Window
Clause</ins></a><br>
<ins class="diff-new">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.9.4.1</ins>
<a href="#id-tumbling-windows"><ins class="diff-new">Tumbling
Windows</ins></a><br>
<ins class="diff-new">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.9.4.2</ins>
<a href="#id-sliding-windows"><ins class="diff-new">Sliding
Windows</ins></a><br>
<ins class="diff-new">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.9.4.3</ins>
<a href="#id-effects-of-window-clauses"><ins class="diff-new">Effects of
 Window</ins> Clauses <ins class="diff-new">on
the Tuple Stream</ins></a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.8.2</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.9.5</ins>
<a href="#id-where">Where Clause</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.8.3</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.9.6</ins>
<a href="#id-count"><ins class="diff-chg">Count
Clause</ins></a><br>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.9.7</ins>
<a href="#id-group-by"><ins class="diff-chg">Group By
Clause</ins></a><br>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.9.8</ins>
<a href="#id-order-by-clause">Order By <del class="diff-old">and
Return Clauses</del> <ins class="diff-chg">Clause</ins></a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.8.4
Example</del> <ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.9.9</ins>
<a href="#id-return-clause"><ins class="diff-chg">Return
Clause</ins></a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;3.9</del> <ins 
class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;3.10</ins> <a 
href="#id-unordered-expressions">Ordered and Unordered
Expressions</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;3.10</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;3.11</ins> <a 
href="#id-conditionals">Conditional Expressions</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;3.11</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;3.12</ins> <a 
href="#id-switch"><ins class="diff-chg">Switch
Expression</ins></a><br>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;3.13</ins> <a 
href="#id-quantified-expressions">Quantified Expressions</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;3.12</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;3.14</ins> <a 
href="#id-try-catch"><ins class="diff-chg">Try/Catch
Expressions</ins></a><br>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;3.15</ins> <a 
href="#id-expressions-on-datatypes">Expressions on
SequenceTypes</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.12.1</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.15.1</ins>
<a href="#id-instance-of">Instance Of</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.12.2</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.15.2</ins>
<a href="#id-typeswitch">Typeswitch</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.12.3</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.15.3</ins>
<a href="#id-cast">Cast</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.12.4</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.15.4</ins>
<a href="#id-castable">Castable</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.12.5</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.15.5</ins>
<a href="#id-constructor-functions">Constructor Functions</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.12.6</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.15.6</ins>
<a href="#id-treat">Treat</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;3.13</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;3.16</ins> <a 
href="#id-validate">Validate Expressions</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;3.14</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;3.17</ins> <a 
href="#id-extension-expressions">Extension Expressions</a><br>
4 <a href="#id-query-prolog">Modules and Prologs</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;4.1 <a href="#id-version-declaration">Version 
Declaration</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;4.2 <a href="#id-module-declaration">Module
Declaration</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;4.3 <a href="#id-boundary-space-decls">Boundary-space
 Declaration</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;4.4 <a href="#id-default-collation-declaration">Default
 Collation
Declaration</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;4.5 <a href="#id-base-uri-decl">Base URI
Declaration</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;4.6 <a href="#id-construction-declaration">Construction
 Declaration</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;4.7 <a href="#id-default-ordering-decl">Ordering
 Mode Declaration</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;4.8 <a href="#id-empty-order-decl">Empty
Order Declaration</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;4.9 <a href="#id-copy-namespaces-decl">Copy-Namespaces
 Declaration</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;4.10 <a href="#id-decimal-format-decl"><ins 
class="diff-new">Decimal-Format
Declaration</ins></a><br>
<ins class="diff-new">&nbsp;&nbsp;&nbsp;&nbsp;4.11</ins> <a 
href="#id-schema-import">Schema Import</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;4.11</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;4.12</ins> <a 
href="#id-module-import">Module Import</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;4.12</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4.12.1</ins>
<a href="#id-module-handling-module-uris"><ins class="diff-chg">Module 
URIs</ins></a><br>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4.12.2</ins>
<a href="#id-module-handling-multiple-same"><ins class="diff-chg">Multiple
 Modules with the same Module
URI</ins></a><br>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4.12.3</ins>
<a href="#id-module-handling-location-uris"><ins class="diff-chg">Location
 URIs</ins></a><br>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4.12.4</ins>
<a href="#id-module-handling-cycles"><ins class="diff-chg">Cycles</ins></a><br>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;4.13</ins> <a 
href="#id-namespace-declaration">Namespace Declaration</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;4.13</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;4.14</ins> <a 
href="#id-default-namespace">Default Namespace Declaration</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;4.14</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;4.15</ins> <a 
href="#id-annotations"><ins class="diff-chg">Annotations</ins></a><br>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;4.16</ins> <a 
href="#id-variable-declarations">Variable Declaration</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;4.15</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;4.17</ins> <a 
href="#id-context-item-declarations"><ins class="diff-chg">Context Item
Declaration</ins></a><br>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;4.18</ins> <a 
href="#FunctionDeclns">Function Declaration</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;4.16</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;4.19</ins> <a 
href="#id-option-declaration">Option Declaration</a><br>
5 <a href="#id-xquery-conformance">Conformance</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;5.1 <a href="#id-minimal-conformance">Minimal 
Conformance</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;5.2 <a href="#id-conform-optional-features">Optional
 Features</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.1 <a 
href="#id-schema-import-feature">Schema Import Feature</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.2 <a 
href="#id-schema-validation-feature">Schema Validation Feature</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.3 <a 
href="#id-static-typing-feature">Static Typing Feature</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.3.1
Static
 Typing Extensions</del>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.4 <del 
class="diff-old">Full Axis Feature
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.5</del>
<a href="#id-module-feature">Module Feature</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.6</del>
<ins class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.2.5</ins>
<a href="#id-serialization-feature">Serialization Feature</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;5.3 <a href="#id-data-model-conformance">Data 
Model Conformance</a><br>
<ins class="diff-new">&nbsp;&nbsp;&nbsp;&nbsp;5.4</ins> <a 
href="#id-syntax-extensions"><ins class="diff-new">Syntax
Extensions</ins></a><br></p>
<h3><a id="appendices" name="appendices"></a> Appendices</h3>
<p class="toc">A <a href="#nt-bnf">XQuery <ins class="diff-new">1.1</ins>
 Grammar</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;A.1 <a href="#id-grammar">EBNF</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A.1.1 <a 
href="#EBNFNotation">Notation</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A.1.2 <a 
href="#extra-grammatical-constraints">Extra-grammatical
Constraints</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A.1.3 <a 
href="#notes-on-parsing">Grammar Notes</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;A.2 <a href="#lexical-structure">Lexical
structure</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A.2.1 <a 
href="#terminal-symbols">Terminal Symbols</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A.2.2 <a 
href="#id-terminal-delimitation">Terminal Delimitation</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A.2.3 <a 
href="#id-eol-handling">End-of-Line Handling</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A.2.3.1
<a href="#id-xml10-eol-handling">XML 1.0 End-of-Line
Handling</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A.2.3.2
<a href="#id-xml11-eol-handling">XML 1.1 End-of-Line
Handling</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A.2.4 <a 
href="#whitespace-rules">Whitespace Rules</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A.2.4.1
<a href="#DefaultWhitespaceHandling">Default Whitespace
Handling</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A.2.4.2
<a href="#ExplicitWhitespaceHandling">Explicit Whitespace
Handling</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;A.3 <a href="#id-reserved-fn-names">Reserved 
Function Names</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;A.4 <a href="#id-precedence-order">Precedence 
Order <ins class="diff-new">(Non-Normative)</ins></a><br>
B <a href="#id-type-promotion-and-operator-mapping">Type Promotion
and Operator Mapping</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;B.1 <a href="#promotion">Type
Promotion</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;B.2 <a href="#mapping">Operator
Mapping</a><br>
C <a href="#id-xq-context-components">Context Components</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;C.1 <a href="#id-xq-static-context-components">Static
 Context
Components</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;C.2 <a 
href="#id-xq-evaluation-context-components">Dynamic Context
Components</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;C.3 <a href="#id-xq-serialization-parameters">Serialization
Parameters</a><br>
D <a href="#id-impl-defined-items">Implementation-Defined
Items</a><br>
E <a href="#id-references">References</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;E.1 <a href="#id-normative-references">Normative
 References</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;E.2 <a href="#id-non-normative-references">Non-normative
 References</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;E.3 <a href="#id-background-material">Background
 Material</a><br>
F <a href="#id-errors">Error Conditions</a><br>
G <a href="#id-mime-type">The application/xquery Media
Type</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;G.1 <a href="#id-mime-type-intro">Introduction</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;G.2 <a href="#id-registration-of-mime-type">Registration
 of MIME Media Type
application/xquery</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G.2.1 <a 
href="#id-interoperability-considerations">Interoperability
Considerations</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G.2.2 <a 
href="#id-applications-of-media-type">Applications Using this Media
Type</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G.2.3 <a 
href="#id-file-extensions">File Extensions</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G.2.4 <a 
href="#id-intended-usage">Intended Usage</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G.2.5 <a 
href="#id-author-change-controller">Author/Change Controller</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;G.3 <a href="#xquery-mime-encoding">Encoding 
Considerations</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;G.4 <a href="#xquery-mime-recognizing">Recognizing
 XQuery Files</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;G.5 <a href="#id-charset-default-rules">Charset 
Default Rules</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;G.6 <a href="#id-security-considerations">Security
 Considerations</a><br>
H <a href="#id-glossary">Glossary</a> (Non-Normative)<br>
I <a href="#id-example-applications">Example Applications</a>
(Non-Normative)<br>
&nbsp;&nbsp;&nbsp;&nbsp;I.1 <a href="#id-joins">Joins</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;I.2 <del class="diff-old">Grouping
&nbsp;&nbsp;&nbsp;&nbsp;I.3</del> <a href="#id-queries-on-sequence">Queries
 on Sequence</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;I.4</del> <ins 
class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;I.3</ins> <a 
href="#id-recursive-transformations">Recursive Transformations</a><br>
<del class="diff-old">&nbsp;&nbsp;&nbsp;&nbsp;I.5</del> <ins 
class="diff-chg">&nbsp;&nbsp;&nbsp;&nbsp;I.4</ins> <a 
href="#id-select-distinct">Selecting Distinct Combinations</a><br>
J <del class="diff-old">Revision</del> <a href="#id-revision-log"><ins 
class="diff-chg">Change</ins> Log</a>
(Non-Normative)<br>
<ins class="diff-new">&nbsp;&nbsp;&nbsp;&nbsp;J.1</ins> <a 
href="#N1B0CF"><ins class="diff-new">Substantive Changes</ins></a><br>
<ins class="diff-new">&nbsp;&nbsp;&nbsp;&nbsp;J.2</ins> <a 
href="#N1B1F4"><ins class="diff-new">Incompatibilities</ins></a><br>
<ins class="diff-new">&nbsp;&nbsp;&nbsp;&nbsp;J.3</ins> <a 
href="#N1B1F9"><ins class="diff-new">Editorial
Changes</ins></a><br></p>
</div>
<hr>
<div class="body">
<div class="div1">
<h2><a id="id-introduction" name="id-introduction"></a> 1
Introduction</h2>
<p class="xquery">As increasing amounts of information are stored,
exchanged, and presented using XML, the ability to intelligently
query XML data sources becomes increasingly important. One of the
great strengths of XML is its flexibility in representing many
different kinds of information from diverse sources. To exploit
this flexibility, an XML query language must provide features for
retrieving and interpreting information from these diverse
sources.</p>
<p class="xquery">XQuery is designed to meet the requirements
identified by the W3C XML Query Working Group <del class="diff-old">[XML
 Query 1.0</del> <a href="#xquery-11-requirements"><ins class="diff-chg">[XQuery
 1.1</ins>
Requirements]</a> and the use cases in <a href="#UseCases">[XML
Query Use Cases]</a> . It is designed to be a language in which
queries are concise and easily understood. It is also flexible
enough to query a broad spectrum of XML information sources,
including both databases and documents. The Query Working Group has
identified a requirement for both a non-XML query syntax and an
XML-based query syntax. XQuery is designed to meet the first of
these requirements. XQuery is derived from an XML query language
called Quilt <a href="#Quilt">[Quilt]</a> , which in turn borrowed
features from several other languages, including XPath 1.0
<del class="diff-old">[XPath</del> <a href="#xpath"><ins 
class="diff-chg">[XML Path Language (XPath) Version</ins> 1.0]</a> , XQL
<a href="#XQL">[XQL]</a> , XML-QL <a href="#XML-QL">[XML-QL]</a> ,
SQL <a href="#SQL">[SQL]</a> , and OQL <a href="#ODMG">[ODMG]</a>
.</p>
<p>[ <a title="data model" id="dt-datamodel" name="dt-datamodel">Definition</a>
 : XQuery <ins class="diff-new">1.1</ins> operates on the abstract, 
logical structure of
an XML document, rather than its surface syntax. This logical
structure, known as the <b>data model</b> , is defined in
<del class="diff-old">[XQuery/XPath</del> <a href="#xpath-datamodel-11"><ins
 class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> .]</p>
<p>XQuery Version <del class="diff-old">1.0</del> <ins class="diff-chg">1.1</ins>
 is an extension of XPath Version <del class="diff-old">2.0. Any</del> <ins
 class="diff-chg">2.1. In general,
any</ins> expression that is syntactically valid and executes
successfully in both XPath <del class="diff-old">2.0</del>
<ins class="diff-chg">2.1</ins> and XQuery <del class="diff-old">1.0</del>
 <ins class="diff-chg">1.1</ins> will return
the same result in both languages. <del class="diff-old">Since</del> <ins
 class="diff-chg">There are a few
exceptions to this rule:</ins></p>
<ul>
<li>
<p><ins class="diff-chg">Because XQuery expands</ins> <span 
class="xquery"><a title="predefined entity reference" 
href="#dt-predefined-entity-reference"><ins class="diff-chg">predefined
entity references</ins></a> <ins class="diff-chg">and</ins>
<a title="character reference" href="#dt-character-reference"><ins 
class="diff-chg">character
references</ins></a></span> <ins class="diff-chg">and XPath does
not, expressions containing these produce different results in the
two languages. For instance, the value of the string literal</ins>
<code><ins class="diff-chg">"&amp;amp;"</ins></code> <ins 
class="diff-chg">is</ins> <code><ins class="diff-chg">&amp;</ins></code>
<ins class="diff-chg">in XQuery, and</ins> <code><ins class="diff-chg">&amp;amp;</ins></code>
 <ins class="diff-chg">in XPath.
(XPath is often embedded in other languages, which may expand
predefined entity references or character references before the
XPath expression is evaluated.)</ins></p>
</li>
<li>
<p><ins class="diff-chg">If XPath 1.0 compatibility mode is
enabled, XPath behaves differently from XQuery in a number of
ways,</ins> <span class="xquery"><ins class="diff-chg">which are
discussed in</ins> <a href="#xpath-21"><ins class="diff-chg">[XML
Path Language (XPath) 2.1]</ins></a> .</span></p>
</li>
</ul>
<p><ins class="diff-chg">Because</ins> these languages are so
closely related, their grammars and language descriptions are
generated from a common source to ensure consistency, and the
editors of these specifications work together closely.</p>
<p>XQuery <ins class="diff-new">1.1</ins> also depends on and is
closely related to the following specifications:</p>
<ul>
<li>
<p><del class="diff-old">[XQuery/XPath</del> <a 
href="#xpath-datamodel-11"><ins class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> defines the data model that
underlies all XQuery <ins class="diff-new">1.1</ins>
expressions.</p>
</li>
<li>
<p><del class="diff-old">[XQuery 1.0 and XPath 2.0 Formal
Semantics] defines the static semantics of XQuery and also contains
a formal but non-normative description of the dynamic semantics
that may be useful for implementors and others who require a formal
definition.</del> The type system of XQuery <ins class="diff-new">1.1</ins>
 is based on <a href="#XMLSchema">[XML
Schema]</a> .</p>
</li>
<li>
<p>The built-in function library and the operators supported by
XQuery <ins class="diff-new">1.1</ins> are defined in <a 
href="#xpath-functions-11">[XQuery <del class="diff-old">1.0</del> and
XPath <del class="diff-old">2.0</del> Functions and <del 
class="diff-old">Operators]</del> <ins class="diff-chg">Operators
1.1]</ins></a> .</p>
</li>
<li>
<p>One requirement in <del class="diff-old">[XML Query 1.0</del>
<a href="#xquery-11-requirements"><ins class="diff-chg">[XQuery
1.1</ins> Requirements]</a> is that an XML query language have both
a human-readable syntax and an XML-based syntax. The XML-based
syntax for XQuery is described in <a href="#xqueryx-11">[XQueryX
<del class="diff-old">1.0]</del> <ins class="diff-chg">1.1]</ins></a> .</p>
</li>
</ul>
<p><ins class="diff-new">[</ins> <a title="XQuery 1.1 Processor" 
id="dt-xquery-11-processor" name="dt-xquery-11-processor"><ins 
class="diff-new">Definition</ins></a>
:<ins class="diff-new">An</ins> <b><ins class="diff-new">XQuery 1.1
Processor</ins></b> <ins class="diff-new">processes a query
according to the XQuery 1.1 specification.]</ins></p>
<p><ins class="diff-new">[</ins> <a title="XQuery 1.0 Processor" 
id="dt-xquery-10-processor" name="dt-xquery-10-processor"><ins 
class="diff-new">Definition</ins></a>
:<ins class="diff-new">An</ins> <b><ins class="diff-new">XQuery 1.0
Processor</ins></b> <ins class="diff-new">processes a query
according to the XQuery 1.0 specification.]</ins></p>
<p>This document specifies a grammar for <del class="diff-old">XQuery,</del>
 <ins class="diff-chg">XQuery 1.1,</ins>
using the same basic EBNF notation used in <a href="#XML">[XML
1.0]</a> . Unless otherwise noted (see <a href="#lexical-structure"><b>A.2
 Lexical structure</b></a> ), whitespace
is not significant in <span class="xquery">queries</span> . Grammar
productions are introduced together with the features that they
describe, and a complete grammar is also presented in the appendix
[ <a href="#nt-bnf"><b>A XQuery <ins class="diff-new">1.1</ins>
Grammar</b></a> ]. The appendix is the normative version.</p>
<p>In the grammar productions in this document, named symbols are
underlined and literal text is enclosed in double quotes. For
example, the following production describes the syntax of a
function call:</p>
<h5><a id="N102B5" name="N102B5"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="fakeid_doc-xquery11-FunctionCall" 
name="fakeid_doc-xquery11-FunctionCall"></a> <del class="diff-old">[93]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[134]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code>FunctionCall</code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">QName "(" ( ExprSingle</del>
<a href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a> <del
 class="diff-old">(","
ExprSingle</del> <a href="#doc-xquery11-ArgumentList"><ins 
class="diff-chg">ArgumentList</ins></a> <del class="diff-old">)*)?
")"</del></code></td>
</tr>
</tbody>
</table>
<p>The production should be read as follows: A function call
consists of <del class="diff-old">a QName</del> <ins class="diff-chg">an</ins>
 <a href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a> 
followed by an open-parenthesis. The
open-parenthesis is followed by an optional argument list. The
argument list (if present) consists of one or more expressions,
separated by commas. The optional argument list is followed by a
close-parenthesis.</p>
<p><ins class="diff-new">This document normatively defines the
static and dynamic semantics of XQuery 1.1. In this document,
examples and material labeled as "Note" are provided for
explanatory purposes and are not normative.</ins></p>
<p>Certain aspects of language processing are described in this
specification as <b>implementation-defined</b> or
<b>implementation-dependent</b> .</p>
<ul>
<li>
<p>[ <a title="implementation defined" id="dt-implementation-defined" 
name="dt-implementation-defined">Definition</a> :
<b>Implementation-defined</b> indicates an aspect that may differ
between implementations, but must be specified by the implementor
for each particular implementation.]</p>
</li>
<li>
<p>[ <a title="implementation dependent" 
id="dt-implementation-dependent" name="dt-implementation-dependent">Definition</a>
 :
<b>Implementation-dependent</b> indicates an aspect that may differ
between implementations, is not specified by this or any W3C
specification, and is not required to be specified by the
implementor for any particular implementation.]</p>
</li>
</ul>
<del class="diff-old">This document normatively defines the dynamic
semantics of XQuery. The static semantics of XQuery are normatively
defined in [XQuery 1.0 and XPath 2.0 Formal Semantics] . In this
document, examples and material labeled as "Note" are provided for
explanatory purposes and are not normative.</del></div>
<div class="div1">
<h2><a id="id-basics" name="id-basics"></a> 2 Basics</h2>
<p>The basic building block of XQuery <ins class="diff-new">1.1</ins> is
 the <b>expression</b> , which is a string
of <a href="#Unicode">[Unicode]</a> characters (the version of
Unicode to be used is <a title="implementation defined" 
href="#dt-implementation-defined">implementation-defined</a> .) The
language provides several kinds of expressions which may be
constructed from keywords, symbols, and operands. In general, the
operands of an expression are other expressions. XQuery <ins 
class="diff-new">1.1</ins> allows expressions to be nested with full
generality. <span class="xquery">(However, unlike a pure functional
language, it does not allow variable substitution if the variable
declaration contains construction of new nodes.)</span></p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>This specification contains no assumptions or requirements
regarding the character set encoding of strings of <a href="#Unicode">[Unicode]</a>
 characters.</p>
</div>
<p>Like XML, XQuery <ins class="diff-new">1.1</ins> is a
case-sensitive language. Keywords in XQuery <ins class="diff-new">1.1</ins>
 use lower-case characters and are not
reserved—that is, names in XQuery <ins class="diff-new">1.1</ins>
expressions are allowed to be the same as language keywords, except
for certain unprefixed function-names listed in <a 
href="#id-reserved-fn-names"><b>A.3 Reserved Function Names</b></a>
.</p>
<p>[ <a title="value" id="dt-value" name="dt-value">Definition</a>
: In the <a title="data model" href="#dt-datamodel">data model</a>
, a <b>value</b> is always a <a title="sequence" href="#dt-sequence">sequence</a>
 .] [ <a title="sequence" id="dt-sequence" name="dt-sequence">Definition</a>
 : A <b>sequence</b>
is an ordered collection of zero or more <a title="item" href="#dt-item">items</a>
 .] [ <a title="item" id="dt-item" name="dt-item">Definition</a> : An <b>item</b>
 is either an <a title="atomic value" href="#dt-atomic-value">atomic 
value</a> or a
<a title="node" href="#dt-node">node</a> .] [ <a title="atomic value" 
id="dt-atomic-value" name="dt-atomic-value">Definition</a> : An <b>atomic
 value</b> is a
value in the value space of an <b>atomic type</b> , as defined in
<a href="#XMLSchema">[XML Schema]</a> .] [ <a title="node" id="dt-node" 
name="dt-node">Definition</a> : A <b>node</b> is an
instance of one of the <b>node kinds</b> defined in <del 
class="diff-old">[XQuery/XPath</del> <a href="#xpath-datamodel-11"><ins 
class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> .] Each node has a unique <b>node
identity</b> , a <b>typed value</b> , and a <b>string value</b> .
In addition, some nodes have a <b>name</b> . The <b>typed value</b>
of a node is a sequence of zero or more atomic values. The
<b>string value</b> of a node is a value of type
<code>xs:string</code> . The <b>name</b> of a node is a value of
type <code>xs:QName</code> . <ins class="diff-new">[</ins>
<a title="undefined" id="dt-undefined" name="dt-undefined"><ins 
class="diff-new">Definition</ins></a>
:<ins class="diff-new">In certain situations a value is said to
be</ins> <b><ins class="diff-new">undefined</ins></b> <ins 
class="diff-new">(for example, the value of the context item, or the
typed value of an element node). This term indicates that the
property in question has no value and that any attempt to use its
value results in an error.]</ins></p>
<p>[ <a title="singleton" id="dt-singleton" name="dt-singleton">Definition</a>
 : A sequence containing exactly one
item is called a <b>singleton</b> .] An item is identical to a
singleton sequence containing that item. Sequences are never
nested—for example, combining the values 1, (2, 3), and ( ) into a
single sequence results in the sequence (1, 2, 3). [ <a title="empty 
sequence" id="dt-empty-sequence" name="dt-empty-sequence">Definition</a>
 : A sequence containing zero
items is called an <b>empty sequence</b> .]</p>
<p>[ <a title="XDM instance" id="dt-data-model-instance" 
name="dt-data-model-instance">Definition</a> : The term <b>XDM
instance</b> is used, synonymously with the term <b>value</b> , to
denote an unconstrained sequence of <a title="node" href="#dt-node">nodes</a>
 and/or <a title="atomic value" href="#dt-atomic-value">atomic values</a>
 in the <a title="data model" href="#dt-datamodel">data model</a> .]</p>
<p>Names in XQuery <del class="diff-old">are called QNames , and
conform</del> <ins class="diff-chg">1.1 can be bound</ins> to
<ins class="diff-new">namespaces, and are based on</ins> the syntax
<ins class="diff-new">and semantics defined</ins> in <a href="#XMLNAMES">[XML
 Names]</a> . [ <a title="lexical QName" id="dt-qname" name="dt-qname">Definition</a>
 : <del class="diff-old">Lexically, a</del> <ins class="diff-chg">A</ins>
<b><ins class="diff-new">lexical</ins> QName</b> <ins class="diff-new">is
 a name that conforms to the syntax of</ins> <a 
href="http://www.w3.org/TR/REC-xml-names/#NT-QName"><ins 
class="diff-new">[http://www.w3.org/TR/REC-xml-names/#NT-QName]</ins></a>
.]<ins class="diff-new">A</ins> <a title="lexical QName" 
href="#dt-qname"><ins class="diff-new">lexical QName</ins></a> consists
of an optional namespace prefix and a local name. If the namespace
prefix is present, it is separated from the local name by a
<del class="diff-old">colon.]</del> <ins class="diff-chg">colon.</ins> A
 <a title="lexical QName" href="#dt-qname">lexical QName</a> can be 
converted into an <a title="expanded QName" href="#dt-expanded-qname">expanded
 QName</a> by
resolving its namespace prefix to a namespace URI, using the
<a title="statically known namespaces" href="#dt-static-namespaces">statically
 known namespaces</a> [ <a title="err:XPST0081" href="#ERRXPST0081">err:XPST0081</a>
 ]. <ins class="diff-new">In the XQuery 1.1 grammar, most names are 
specified
using the</ins> <a href="#doc-xquery11-EQName"><ins class="diff-new">EQName</ins></a>
 <ins class="diff-new">production, which
allows</ins> <a title="lexical QName" href="#dt-qname"><ins 
class="diff-new">lexical QNames</ins></a> ,<ins class="diff-new">and 
also
allows a namespace URI to be specified as a literal:</ins></p>
<h5><a id="N103E0" name="N103E0"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-EQName" name="doc-xquery11-EQName"></a><ins 
class="diff-new">[196]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-EQName"><ins class="diff-new">EQName</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-QName"><ins class="diff-new">QName</ins></a>
 <ins class="diff-new">| (</ins> <a href="#doc-xquery11-URILiteral"><ins
 class="diff-new">URILiteral</ins></a> <ins class="diff-new">":"</ins>
<a href="#prod-xquery11-NCName"><ins class="diff-new">NCName</ins></a> <ins
 class="diff-new">)</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N104B1.doc-xquery11-QName" 
name="noid_N104B1.doc-xquery11-QName"></a><ins class="diff-new">[NaN]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">QName</ins></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="http://www.w3.org/TR/REC-xml-names/#NT-QName"><ins 
class="diff-new">[http://www.w3.org/TR/REC-xml-names/#NT-QName]</ins></a>
<sup><small><ins class="diff-new">Names</ins></small></sup></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N104B4.doc-xquery11-NCName" 
name="noid_N104B4.doc-xquery11-NCName"></a><ins class="diff-new">[NaN]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">NCName</ins></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="http://www.w3.org/TR/REC-xml-names/#NT-NCName"><ins 
class="diff-new">[http://www.w3.org/TR/REC-xml-names/#NT-NCName]</ins></a>
<sup><small><ins class="diff-new">Names</ins></small></sup></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N104B7.doc-xquery11-URILiteral" 
name="noid_N104B7.doc-xquery11-URILiteral"></a><ins class="diff-new">[195]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">URILiteral</ins></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-StringLiteral"><ins class="diff-new">StringLiteral</ins></a></code></td>
</tr>
</tbody>
</table>
<p>[ <a title="expanded QName" id="dt-expanded-qname" 
name="dt-expanded-qname">Definition</a> : An <b>expanded QName</b>
consists of an optional namespace URI and a local name. An expanded
QName also retains its original namespace prefix (if any), to
facilitate casting the expanded QName into a string.] The namespace
URI value is whitespace normalized according to the rules for the
<code>xs:anyURI</code> type in <a href="#XMLSchema">[XML
Schema]</a> . Two <a title="expanded QName" href="#dt-expanded-qname">expanded
 QNames</a> are equal if their
namespace URIs are equal and their local names are equal (even if
their namespace prefixes are not equal). Namespace URIs and local
names are compared on a codepoint basis, without further
normalization.</p>
<p class="xquery">Certain namespace prefixes are predeclared by
XQuery and bound to fixed namespace URIs. These namespace prefixes
are as follows:</p>
<ul>
<li>
<p><code>xml = http://www.w3.org/XML/1998/namespace</code></p>
</li>
<li>
<p><code>xs = http://www.w3.org/2001/XMLSchema</code></p>
</li>
<li>
<p><code>xsi = http://www.w3.org/2001/XMLSchema-instance</code></p>
</li>
<li>
<p><code>fn = http://www.w3.org/2005/xpath-functions</code></p>
</li>
<li>
<p><code>local =
http://www.w3.org/2005/xquery-local-functions</code> (see <a 
href="#FunctionDeclns"><b><del class="diff-old">4.15</del> <ins 
class="diff-chg">4.18</ins> Function Declaration</b></a> .)</p>
</li>
<li>
<p><code><ins class="diff-new">output =
http://www.w3.org/2009/xquery-serialization</ins></code>
<ins class="diff-new">(see</ins> <a href="#id-serialization"><b><ins 
class="diff-new">2.2.4
Serialization</ins></b></a> .)</p>
</li>
</ul>
<p class="xquery">In addition to the prefixes in the above list,
this document uses the prefix <code>err</code> to represent the
namespace URI <code>http://www.w3.org/2005/xqt-errors</code> (see
<a href="#id-identifying-errors"><b>2.3.2 Identifying and Reporting
Errors</b></a> ). This namespace prefix is not predeclared and its
use in this document is not normative.</p>
<p>Element nodes have a property called <b>in-scope namespaces</b>
. [ <a title="in-scope namespaces" id="dt-in-scope-namespaces" 
name="dt-in-scope-namespaces">Definition</a> : The <b>in-scope
namespaces</b> property of an element node is a set of <b>namespace
bindings</b> , each of which associates a namespace prefix with a
URI, thus defining the set of namespace prefixes that are available
for interpreting <a title="lexical QName" href="#dt-qname"><ins 
class="diff-new">lexical</ins> QNames</a> within
the scope of the element. For a given element, one namespace
binding may have an empty prefix; the URI of this namespace binding
is the default namespace within the scope of the element.]</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>In <del class="diff-old">[XPath</del> <a href="#xpath"><ins 
class="diff-chg">[XML Path Language (XPath)
Version</ins> 1.0]</a> , the in-scope namespaces of an element node
are represented by a collection of <b>namespace nodes</b> arranged
on a <b>namespace axis</b> , which is optional and deprecated in
<del class="diff-old">[XPath 2.0]</del> <a href="#xpath-21"><ins 
class="diff-chg">[XML Path Language (XPath)
2.1]</ins></a> . XQuery does not support the namespace axis and
does not represent namespace bindings in the form of nodes.
However, where other specifications such as <a 
href="#xslt-xquery-serialization-11">[XSLT <del class="diff-old">2.0</del>
 and XQuery <del class="diff-old">1.0
Serialization]</del> <ins class="diff-chg">Serialization
1.1]</ins></a> refer to namespace nodes, these nodes may be
synthesized from the in-scope namespaces of an element node by
interpreting each namespace binding as a namespace node.</p>
</div>
<p>[ <a title="URI" id="dt-URI" name="dt-URI">Definition</a> :
Within this specification, the term <b>URI</b> refers to a
Universal Resource Identifier as defined in <a href="#RFC3986">[RFC3986]</a>
 and extended in <a href="#RFC3987">[RFC3987]</a> with the new name <b>IRI</b>
 .] The term
URI has been retained in preference to IRI to avoid introducing new
names for concepts such as "Base URI" that are defined or
referenced across the whole family of XML specifications.</p>
<div class="div2">
<h3><a id="context" name="context"></a> 2.1 Expression Context</h3>
<p>[ <a title="expression context" id="dt-expression-context" 
name="dt-expression-context">Definition</a> : The <b>expression
context</b> for a given expression consists of all the information
that can affect the result of the expression.] This information is
organized into two categories called the <a title="static context" 
href="#dt-static-context">static context</a> and the <a title="dynamic 
context" href="#dt-dynamic-context">dynamic context</a>
.</p>
<div class="div3">
<h4><a id="static_context" name="static_context"></a> 2.1.1 Static
Context</h4>
<p>[ <a title="static context" id="dt-static-context" 
name="dt-static-context">Definition</a> : The <b>static context</b> of
an expression is the information that is available during static
analysis of the expression, prior to its evaluation.] This
information can be used to decide whether the expression contains a
<a title="static error" href="#dt-static-error">static error</a> .
If analysis of an expression relies on some component of the
<a title="static context" href="#dt-static-context">static
context</a> that has not been assigned a value, a <a title="static 
error" href="#dt-static-error">static error</a> is raised [
<a title="err:XPST0001" href="#ERRXPST0001">err:XPST0001</a> ].</p>
<p>The individual components of the <a title="static context" 
href="#dt-static-context">static context</a> are summarized below.
<span class="xquery">Rules governing the scope and initialization
of these components can be found in <a 
href="#id-xq-static-context-components"><b>C.1 Static Context
Components</b></a> .</span></p>
<ul>
<li>
<p>[ <a title="XPath 1.0 compatibility mode" id="dt-xpath-compat-mode" 
name="dt-xpath-compat-mode">Definition</a> :
<b>XPath 1.0 compatibility mode.</b> <span class="xquery">This
component must be set by all host languages that include XPath
<del class="diff-old">2.0</del> <ins class="diff-chg">2.1</ins> as
a subset, indicating whether rules for compatibility with XPath 1.0
are in effect. XQuery sets the value of this component to
<code>false</code> .</span> ]</p>
</li>
<li>
<p>[ <a title="statically known namespaces" id="dt-static-namespaces" 
name="dt-static-namespaces">Definition</a> :
<b>Statically known namespaces.</b> This is a set of (prefix, URI)
pairs that define all the namespaces that are known during static
processing of a given expression.] The URI value is whitespace
normalized according to the rules for the <code>xs:anyURI</code>
type in <a href="#XMLSchema">[XML Schema]</a> . Note the difference
between <a title="in-scope namespaces" href="#dt-in-scope-namespaces">in-scope
 namespaces</a> , which is a
dynamic property of an element node, and <a title="statically known 
namespaces" href="#dt-static-namespaces">statically known namespaces</a>
 , which is
a static property of an expression.</p>
<p class="xquery">Some namespaces are predefined; additional
namespaces can be added to the statically known namespaces by
<a title="namespace declaration" href="#dt-namespace-declaration">namespace
 declarations</a> in a
<a title="Prolog" href="#dt-prolog">Prolog</a> and by <a 
title="namespace declaration attribute" href="#dt-namespace-decl-attr">namespace
 declaration attributes</a> in
<a title="direct element constructor" href="#dt-direct-elem-const">direct
 element constructors</a> .</p>
</li>
<li>
<p>[ <a title="default element/type namespace" id="dt-def-elemtype-ns" 
name="dt-def-elemtype-ns">Definition</a> :
<b>Default element/type namespace.</b> This is a namespace URI or
"none". The namespace URI, if present, is used for any unprefixed
QName appearing in a position where an element or type name is
expected.] The URI value is whitespace normalized according to the
rules for the <code>xs:anyURI</code> type in <a href="#XMLSchema">[XML 
Schema]</a> .</p>
</li>
<li>
<p>[ <a title="default function namespace" id="dt-def-fn-ns" 
name="dt-def-fn-ns">Definition</a> : <b>Default function namespace.</b>
This is a namespace URI or "none". The namespace URI, if present,
is used for any unprefixed QName appearing in a position where a
function name is expected.] The URI value is whitespace normalized
according to the rules for the <code>xs:anyURI</code> type in
<a href="#XMLSchema">[XML Schema]</a> .</p>
</li>
<li>
<p>[ <a title="in-scope schema definitions" id="dt-issd" name="dt-issd">Definition</a>
 : <b>In-scope schema definitions.</b> This
is a generic term for all the element declarations, attribute
declarations, and schema type definitions that are in scope during
processing of an expression.] It includes the following three
parts:</p>
<ul>
<li>
<p>[ <a title="in-scope schema type" id="dt-is-types" name="dt-is-types">Definition</a>
 : <b>In-scope schema types.</b> Each
schema type definition is identified either by an <a title="expanded 
QName" href="#dt-expanded-qname">expanded QName</a> (for
a <b>named type</b> ) or by an <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a>
type identifier (for an <b>anonymous type</b> ). The in-scope
schema types include the predefined schema types described in
<a href="#id-predefined-types"><b>2.5.1 Predefined Schema
Types</b></a> . <span class="xquery">If the <a title="schema import 
feature" href="#dt-schema-import-feature">Schema
Import Feature</a> is supported, in-scope schema types also include
all type definitions found in imported schemas.</span> ]</p>
</li>
<li>
<p>[ <a title="in-scope element declarations" id="dt-is-elems" 
name="dt-is-elems">Definition</a> : <b>In-scope element
declarations.</b> Each element declaration is identified either by
an <a title="expanded QName" href="#dt-expanded-qname">expanded
QName</a> (for a top-level element declaration) or by an <a 
title="implementation dependent" href="#dt-implementation-dependent">implementation-dependent</a>
 element
identifier (for a local element declaration). <span class="xquery">If 
the <a title="schema import feature" href="#dt-schema-import-feature">Schema
 Import Feature</a> is supported,
in-scope element declarations include all element declarations
found in imported schemas.</span> ] An element declaration includes
information about the element's <a title="substitution group" 
href="#dt-substitution-group">substitution group</a> affiliation.</p>
<p>[ <a title="substitution group" id="dt-substitution-group" 
name="dt-substitution-group">Definition</a> : <b>Substitution groups</b>
are defined in <a href="#XMLSchema">[XML Schema]</a> Part 1,
Section 2.2.2.2. Informally, the substitution group headed by a
given element (called the <b>head element</b> ) consists of the set
of elements that can be substituted for the head element without
affecting the outcome of schema validation.]</p>
</li>
<li>
<p>[ <a title="in-scope attribute declarations" id="dt-is-attrs" 
name="dt-is-attrs">Definition</a> : <b>In-scope attribute
declarations.</b> Each attribute declaration is identified either
by an <a title="expanded QName" href="#dt-expanded-qname">expanded
QName</a> (for a top-level attribute declaration) or by an
<a title="implementation dependent" href="#dt-implementation-dependent">implementation-dependent</a>
attribute identifier (for a local attribute declaration).
<span class="xquery">If the <a title="schema import feature" 
href="#dt-schema-import-feature">Schema Import Feature</a> is supported,
in-scope attribute declarations include all attribute declarations
found in imported schemas.</span> ]</p>
</li>
</ul>
</li>
<li>
<p>[ <a title="in-scope variables" id="dt-in-scope-variables" 
name="dt-in-scope-variables">Definition</a> : <b>In-scope variables.</b>
This is a set of <del class="diff-old">(expanded QName,</del>
<ins class="diff-chg">(</ins> <a title="expanded QName" 
href="#dt-expanded-qname"><ins class="diff-chg">expanded QName</ins></a>
, type) pairs. It defines the set of variables that are available
for reference within an expression. The <a title="expanded QName" 
href="#dt-expanded-qname">expanded QName</a> is the name of the
variable, and the type is the <a title="static type" 
href="#dt-static-type">static type</a> of the variable.]</p>
<p><span class="xquery">Variable declarations in a <a title="Prolog" 
href="#dt-prolog">Prolog</a> are added to <a title="in-scope variables" 
href="#dt-in-scope-variables">in-scope
variables</a> .</span> An expression that binds a variable (such as
a <code>let</code> , <code>for</code> , <code>some</code> , or
<code>every</code> expression) extends the <a title="in-scope variables"
 href="#dt-in-scope-variables">in-scope
variables</a> of its subexpressions with the new bound variable and
its type. <span class="xquery">Within a <b>function declaration</b>
, the <a title="in-scope variables" href="#dt-in-scope-variables">in-scope
 variables</a> are extended by the
names and types of the <b>function parameters</b> .</span></p>
<p class="xquery">The static type of a variable may <del 
class="diff-old">be</del> either <ins class="diff-new">be</ins> declared
in a query or <del class="diff-old">(if the Static Typing Feature
is enabled)</del> inferred by static type inference <del 
class="diff-old">rules</del> as <del class="diff-old">described</del>
<ins class="diff-chg">discussed</ins> in <del class="diff-old">[XQuery 
1.0 and XPath 2.0 Formal Semantics]</del>
<a href="#id-static-typing-feature"><b><ins class="diff-chg">5.2.3
Static Typing Feature</ins></b></a> .</p>
</li>
<li>
<p>[ <a title="context item static type" 
id="dt-context-item-static-type" name="dt-context-item-static-type">Definition</a>
 : <b>Context item
static type.</b> This component defines the <a title="static type" 
href="#dt-static-type">static type</a> of the context item within
the scope of a given expression.]</p>
</li>
<li>
<p>[ <a title="function signature" id="dt-function-signature" 
name="dt-function-signature">Definition</a> : <b>Function
signatures.</b> This component defines the set of functions that
are available to be called from within an expression. Each function
is uniquely identified by its <a title="expanded QName" 
href="#dt-expanded-qname">expanded QName</a> and its arity (number of
parameters).] In addition to the name and arity, each function
signature specifies the <a title="static type" href="#dt-static-type">static
 types</a> of the function parameters and
result.</p>
<p>The <a title="function signature" href="#dt-function-signature">function
 signatures</a> include the
signatures of <a title="constructor function" 
href="#dt-constructor-function">constructor functions</a> , which are
discussed in <a href="#id-constructor-functions"><b><del 
class="diff-old">3.12.5</del> <ins class="diff-chg">3.15.5</ins>
Constructor Functions</b></a> .</p>
</li>
<li>
<p>[ <a title="statically known collations" id="dt-static-collations" 
name="dt-static-collations">Definition</a> :
<b>Statically known collations.</b> This is an <a title="implementation 
defined" href="#dt-implementation-defined">implementation-defined</a> 
set of
(URI, collation) pairs. It defines the names of the collations that
are available for use in processing <span class="xquery">queries
and</span> expressions.] [ <a title="collation" id="dt-collation" 
name="dt-collation">Definition</a> : A <b>collation</b> is a
specification of the manner in which strings and URIs are compared
and, by extension, ordered. For a more complete definition of
collation, see <a href="#xpath-functions-11">[XQuery <del 
class="diff-old">1.0</del> and XPath <del class="diff-old">2.0</del>
Functions and <del class="diff-old">Operators]</del> <ins 
class="diff-chg">Operators 1.1]</ins></a> .]</p>
</li>
<li>
<p>[ <a title="default collation" id="dt-def-collation" 
name="dt-def-collation">Definition</a> : <b>Default collation.</b> This
identifies one of the collations in <a title="statically known 
collations" href="#dt-static-collations">statically known collations</a>
 as the
collation to be used by functions and operators for comparing and
ordering values of type <code>xs:string</code> and
<code>xs:anyURI</code> (and types derived from them) when no
explicit collation is specified.]</p>
</li>
<li>
<p>[ <a title="construction mode" id="dt-construction-mode" 
name="dt-construction-mode">Definition</a> : <b>Construction mode.</b>
The construction mode governs the behavior of element and document
node constructors. If construction mode is <code>preserve</code> ,
the type of a constructed element node is <code>xs:anyType</code> ,
and all attribute and element nodes copied during node construction
retain their original types. If construction mode is
<code>strip</code> , the type of a constructed element node is
<code>xs:untyped</code> ; all element nodes copied during node
construction receive the type <code>xs:untyped</code> , and all
attribute nodes copied during node construction receive the type
<code>xs:untypedAtomic</code> .]</p>
</li>
<li>
<p>[ <a title="ordering mode" id="dt-ordering-mode" 
name="dt-ordering-mode">Definition</a> : <b>Ordering mode.</b> Ordering
mode, which has the value <code>ordered</code> or
<code>unordered</code> , affects the ordering of the result
sequence returned by certain <a title="path expression" 
href="#dt-path-expression">path expressions</a> , <ins class="diff-new">FLWOR
 expressions, and</ins> <code>union</code> ,
<code>intersect</code> , and <code>except</code> <del class="diff-old">expressions,
 and FLWOR expressions that have no order by
clause.]</del> <ins class="diff-chg">expressions.]</ins> Details
are provided in the descriptions of these expressions.</p>
</li>
<li>
<p>[ <a title="default order for empty sequences" 
id="dt-default-empty-order" name="dt-default-empty-order">Definition</a>
 : <b>Default order for
empty sequences.</b> This component controls the processing of
empty sequences and <code>NaN</code> values as ordering keys in an
<code>order by</code> clause in a FLWOR expression, as described in
<a href="#id-order-by-clause"><b><del class="diff-old">3.8.3</del>
<ins class="diff-chg">3.9.8</ins> Order By <del class="diff-old">and 
Return Clauses</del> <ins class="diff-chg">Clause</ins></b></a> .] Its 
value may be
<code>greatest</code> or <code>least</code> .</p>
</li>
<li>
<p>[ <a title="boundary-space policy" id="dt-boundary-space-policy" 
name="dt-boundary-space-policy">Definition</a> : <b>Boundary-space
policy.</b> This component controls the processing of <a title="boundary
 whitespace" href="#dt-boundary-whitespace">boundary
whitespace</a> by <a title="direct element constructor" 
href="#dt-direct-elem-const">direct element constructors</a> , as
described in <a href="#id-whitespace"><b><del class="diff-old">3.7.1.4</del>
 <ins class="diff-chg">3.8.1.4</ins>
Boundary Whitespace</b></a> .] Its value may be
<code>preserve</code> or <code>strip</code> .</p>
</li>
<li>
<p>[ <a title="copy-namespaces mode" id="dt-copy-namespaces-mode" 
name="dt-copy-namespaces-mode">Definition</a> : <b>Copy-namespaces
mode.</b> This component controls the namespace bindings that are
assigned when an existing element node is copied by an element
constructor, as described in <a href="#id-element-constructor"><b><del 
class="diff-old">3.7.1</del>
<ins class="diff-chg">3.8.1</ins> Direct Element
Constructors</b></a> . Its value consists of two parts:
<code>preserve</code> or <code>no-preserve</code> , and
<code>inherit</code> or <code>no-inherit</code> .]</p>
</li>
<li>
<p>[ <a title="base URI" id="dt-base-uri" name="dt-base-uri">Definition</a>
 : <b>Base URI.</b> This is an absolute
URI, used when necessary in the resolution of relative URIs (for
example, by the <code>fn:resolve-uri</code> function.)] The URI
value is whitespace normalized according to the rules for the
<code>xs:anyURI</code> type in <a href="#XMLSchema">[XML
Schema]</a> .</p>
</li>
<li>
<p>[ <a title="statically known documents" id="dt-known-docs" 
name="dt-known-docs">Definition</a> : <b>Statically known documents.</b>
This is a mapping from strings onto types. The string represents
the absolute URI of a resource that is potentially available using
the <code>fn:doc</code> function. The type is the <a title="static type"
 href="#dt-static-type">static type</a> of a call to
<code>fn:doc</code> with the given URI as its literal argument. ]
If the argument to <code>fn:doc</code> is a string literal that is
not present in <b>statically known documents</b> , then the
<a title="static type" href="#dt-static-type">static type</a> of
<code>fn:doc</code> is <code>document-node()?</code> .</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The purpose of the <b>statically known documents</b> is to
provide static type information, not to determine which documents
are available. A URI need not be found in the <b>statically known
documents</b> to be accessed using <code>fn:doc</code> .</p>
</div>
</li>
<li>
<p>[ <a title="statically known collections" id="dt-known-collections" 
name="dt-known-collections">Definition</a> :
<b>Statically known collections.</b> This is a mapping from strings
onto types. The string represents the absolute URI of a resource
that is potentially available using the <code>fn:collection</code>
function. The type is the type of the sequence of nodes that would
result from calling the <code>fn:collection</code> function with
this URI as its argument.] If the argument to
<code>fn:collection</code> is a string literal that is not present
in <b>statically known collections</b> , then the <a title="static type"
 href="#dt-static-type">static type</a> of
<code>fn:collection</code> is <code>node()*</code> .</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The purpose of the <b>statically known collections</b> is to
provide static type information, not to determine which collections
are available. A URI need not be found in the <b>statically known
collections</b> to be accessed using <code>fn:collection</code>
.</p>
</div>
</li>
<li>
<p>[ <a title="statically known default collection type" 
id="dt-known-default-collection" name="dt-known-default-collection">Definition</a>
 : <b>Statically known
default collection type.</b> This is the type of the sequence of
nodes that would result from calling the <code>fn:collection</code>
function with no arguments.] Unless initialized to some other value
by an implementation, the value of <b>statically known default
collection type</b> is <code>node()*</code> .</p>
</li>
<li>
<p><ins class="diff-new">[</ins> <a title="statically known decimal 
formats" id="dt-static-decimal-formats" name="dt-static-decimal-formats"><ins
 class="diff-new">Definition</ins></a> :<b><ins class="diff-new">Statically
 known decimal formats.</ins></b> <ins class="diff-new">This is the set 
of known decimal formats. Each format is
used for serializing decimal numbers using</ins> <code><ins 
class="diff-new">fn:format-number()</ins></code> .]<ins class="diff-new">Each
 format is identified by an</ins> <a href="#doc-xquery11-EQName"><ins 
class="diff-new">EQName</ins></a>
,<ins class="diff-new">except for the default format, which has no
visible name. Each format contains the properties described in the
following paragraphs.</ins></p>
<p><ins class="diff-new">The following properties control the
interpretation of characters in the picture string supplied to
the</ins> <code><ins class="diff-new">fn:format-number</ins></code>
<ins class="diff-new">function, and also specify characters that
may appear in the result of formatting the number. In each case the
value must be a single character (see [</ins> <a title="err:XQST0100" 
href="#ERRXQST0100"><ins class="diff-new">err:XQST0100</ins></a> <ins 
class="diff-new">]):</ins></p>
<ul>
<li>
<p><ins class="diff-new">[</ins> <a title="decimal-separator" 
id="id-static-decimal-separator" name="id-static-decimal-separator"><ins
 class="diff-new">Definition</ins></a> :<b><ins class="diff-new">decimal-separator</ins></b>
 <ins class="diff-new">specifies the character used for the
decimal-separator-sign; the default value is the period character
(.)]</ins></p>
</li>
<li>
<p><ins class="diff-new">[</ins> <a title="grouping-separator" 
id="id-static-decimal-format-grouping-separator" 
name="id-static-decimal-format-grouping-separator"><ins class="diff-new">Definition</ins></a>
 :<b><ins class="diff-new">grouping-separator</ins></b> <ins 
class="diff-new">specifies the character used for the grouping-sign,
which is typically used as a thousands separator; the default value
is the comma character (,)]</ins></p>
</li>
<li>
<p><ins class="diff-new">[</ins> <a title="percent-sign" 
id="id-static-decimal-format-percent-sign" 
name="id-static-decimal-format-percent-sign"><ins class="diff-new">Definition</ins></a>
 :<b><ins class="diff-new">percent-sign</ins></b> <ins class="diff-new">specifies
the
 character used for the percent-sign; the default value is the
percent character (%)]</ins></p>
</li>
<li>
<p><ins class="diff-new">[</ins> <a title="per-mille-sign" 
id="id-static-decimal-format-per-mille-sign" 
name="id-static-decimal-format-per-mille-sign"><ins class="diff-new">Definition</ins></a>
 :<b><ins class="diff-new">per-mille-sign</ins></b> <ins 
class="diff-new">specifies
the character used for the per-mille-sign; the default value is the
Unicode per-mille character (#x2030)]</ins></p>
</li>
<li>
<p><ins class="diff-new">[</ins> <a title="zero-digit" 
id="id-static-decimal-format-zero-digit" 
name="id-static-decimal-format-zero-digit"><ins class="diff-new">Definition</ins></a>
 :<b><ins class="diff-new">zero-digit</ins></b> <ins class="diff-new">specifies
 the
character used for the digit-zero-sign; the default value is the
digit zero (0). This character must be a digit (category Nd in the
Unicode property database), and it must have the numeric value
zero. This attribute implicitly defines the Unicode character that
is used to represent each of the values 0 to 9 in the final result
string: Unicode is organized so that each set of decimal digits
forms a contiguous block of characters in numerical
sequence.]</ins></p>
</li>
</ul>
<p><ins class="diff-new">The following attributes control the
interpretation of characters in the picture string supplied to the
format-number function. In each case the value must be a single
character (see [</ins> <a title="err:XQST0100" href="#ERRXQST0100"><ins 
class="diff-new">err:XQST0100</ins></a>
<ins class="diff-new">]).</ins></p>
<ul>
<li>
<p><ins class="diff-new">[</ins> <a title="digit-sign" 
id="id-static-decimal-format-digit-sign" 
name="id-static-decimal-format-digit-sign"><ins class="diff-new">Definition</ins></a>
 :<b><ins class="diff-new">digit-sign</ins></b> <ins class="diff-new">specifies
 the
character used for the digit-sign in the picture string; the
default value is the number sign character (#)]</ins></p>
</li>
<li>
<p><ins class="diff-new">[</ins> <a title="pattern-separator-sign" 
id="id-static-decimal-format-pattern-separator-sign" 
name="id-static-decimal-format-pattern-separator-sign"><ins 
class="diff-new">Definition</ins></a> :<b><ins class="diff-new">pattern-separator-sign</ins></b>
 <ins class="diff-new">specifies the character used for the
pattern-separator-sign, which separates positive and negative
sub-pictures in a picture string; the default value is the
semi-colon character (;)]</ins></p>
</li>
</ul>
<p><ins class="diff-new">The following attributes specify
characters or strings that may appear in the result of formatting
the number:</ins></p>
<ul>
<li>
<p><ins class="diff-new">[</ins> <a title="infinity" 
id="id-static-decimal-format-infinity" 
name="id-static-decimal-format-infinity"><ins class="diff-new">Definition</ins></a>
 :<b><ins class="diff-new">infinity</ins></b> <ins class="diff-new">specifies
 the
string used for the infinity-symbol; the default value is the
string Infinity]</ins></p>
</li>
<li>
<p><ins class="diff-new">[</ins> <a title="NaN" 
id="id-static-decimal-format-NaN" name="id-static-decimal-format-NaN"><ins
 class="diff-new">Definition</ins></a> :<b><ins class="diff-new">NaN</ins></b>
 <ins class="diff-new">specifies the string
used for the NaN-symbol, which is used to represent the value NaN
(not-a-number); the default value is the string NaN]</ins></p>
</li>
<li>
<p><ins class="diff-new">[</ins> <a title="minus-sign" 
id="id-static-decimal-format-minus-sign" 
name="id-static-decimal-format-minus-sign"><ins class="diff-new">Definition</ins></a>
 :<b><ins class="diff-new">minus-sign</ins></b> <ins class="diff-new">specifies
 the
character used for the minus-symbol; the default value is the
hyphen-minus character (-, #x2D). The value must be a single
character.]</ins></p>
</li>
</ul>
</li>
</ul>
</div>
<div class="div3">
<h4><a id="eval_context" name="eval_context"></a> 2.1.2 Dynamic
Context</h4>
<p>[ <a title="dynamic context" id="dt-dynamic-context" 
name="dt-dynamic-context">Definition</a> : The <b>dynamic context</b> of
an expression is defined as information that is available at the
time the expression is evaluated.] If evaluation of an expression
relies on some part of the <a title="dynamic context" 
href="#dt-dynamic-context">dynamic context</a> that has not been
assigned a value, a <a title="dynamic error" href="#dt-dynamic-error">dynamic
 error</a> is raised [ <a title="err:XPDY0002" href="#ERRXPDY0002">err:XPDY0002</a>
 ].</p>
<p>The individual components of the <a title="dynamic context" 
href="#dt-dynamic-context">dynamic context</a> are summarized
below. Further rules governing the semantics of these components
can be found in <a href="#id-xq-evaluation-context-components"><b>C.2 
Dynamic Context
Components</b></a> .</p>
<p>The <a title="dynamic context" href="#dt-dynamic-context">dynamic 
context</a> consists of all the
components of the <a title="static context" href="#dt-static-context">static
 context</a> , and the additional
components listed below.</p>
<p>[ <a title="focus" id="dt-focus" name="dt-focus">Definition</a>
: The first three components of the <a title="dynamic context" 
href="#dt-dynamic-context">dynamic context</a> (context item,
context position, and context size) are called the <b>focus</b> of
the expression. ] The focus enables the processor to keep track of
which items are being processed by the expression.</p>
<p>Certain language constructs, notably the <a title="path expression" 
href="#dt-path-expression">path expression</a>
<code>E1/E2</code> and the <a title="" href="#dt-predicate">predicate</a>
 <code>E1[E2]</code> , create a new
focus for the evaluation of a sub-expression. In these constructs,
<code>E2</code> is evaluated once for each item in the sequence
that results from evaluating <code>E1</code> . Each time
<code>E2</code> is evaluated, it is evaluated with a different
focus. The focus for evaluating <code>E2</code> is referred to
below as the <b>inner focus</b> , while the focus for evaluating
<code>E1</code> is referred to as the <b>outer focus</b> . The
inner focus exists only while <code>E2</code> is being evaluated.
When this evaluation is complete, evaluation of the containing
expression continues with its original focus unchanged.</p>
<ul>
<li>
<p>[ <a title="context item" id="dt-context-item" name="dt-context-item">Definition</a>
 : The <b>context item</b> is the
item currently being processed. An item is either an atomic value
or a <del class="diff-old">node.][</del> <ins class="diff-chg">node.] [</ins>
 <a title="context node" id="dt-context-node" name="dt-context-node">Definition</a>
 : When the
context item is a node, it can also be referred to as the
<b>context node</b> .] The context item is returned by an
expression consisting of a single dot ( <code>.</code> ). When an
expression <code>E1/E2</code> or <code>E1[E2]</code> is evaluated,
each item in the sequence obtained by evaluating <code>E1</code>
becomes the context item in the inner focus for an evaluation of
<code>E2</code> .</p>
</li>
<li>
<p>[ <a title="context position" id="dt-context-position" 
name="dt-context-position">Definition</a> : The <b>context position</b>
is the position of the context item within the sequence of items
currently being processed.] It changes whenever the context item
changes. When the focus is defined, the value of the context
position is an integer greater than zero. The context position is
returned by the expression <code>fn:position()</code> . When an
expression <code>E1/E2</code> or <code>E1[E2]</code> is evaluated,
the context position in the inner focus for an evaluation of
<code>E2</code> is the position of the context item in the sequence
obtained by evaluating <code>E1</code> . The position of the first
item in a sequence is always 1 (one). The context position is
always less than or equal to the context size.</p>
</li>
<li>
<p>[ <a title="context size" id="dt-context-size" name="dt-context-size">Definition</a>
 : The <b>context size</b> is the
number of items in the sequence of items currently being
processed.] Its value is always an integer greater than zero. The
context size is returned by the expression <code>fn:last()</code> .
When an expression <code>E1/E2</code> or <code>E1[E2]</code> is
evaluated, the context size in the inner focus for an evaluation of
<code>E2</code> is the number of items in the sequence obtained by
evaluating <code>E1</code> .</p>
</li>
<li>
<p>[ <a title="variable values" id="dt-variable-values" 
name="dt-variable-values">Definition</a> : <b>Variable values</b> . This
is a set of <del class="diff-old">(expanded QName,</del>
<ins class="diff-chg">(</ins> <a title="expanded QName" 
href="#dt-expanded-qname"><ins class="diff-chg">expanded QName</ins></a>
, value) pairs. It contains the same <a title="expanded QName" 
href="#dt-expanded-qname">expanded QNames</a> as the <a title="in-scope 
variables" href="#dt-in-scope-variables">in-scope
variables</a> in the <a title="static context" href="#dt-static-context">static
 context</a> for the expression. The
<a title="expanded QName" href="#dt-expanded-qname">expanded
QName</a> is the name of the variable and the value is the dynamic
value of the variable, which includes its <a title="dynamic type" 
href="#dt-dynamic-type">dynamic type</a> .]</p>
</li>
<li>
<p>[ <a title="function implementation" id="dt-function-implementation" 
name="dt-function-implementation">Definition</a> : <b>Function
implementations</b> . Each function in <a title="function signature" 
href="#dt-function-signature">function
signatures</a> has a function implementation that enables the
function to map instances of its parameter types into an instance
of its result type. <span class="xquery">For a <a title="user-defined 
function" href="#dt-udf">user-defined function</a> ,
the function implementation is an XQuery expression. For a
<a title="built-in function" href="#dt-built-in-function">built-in
function</a> or <a title="external function" 
href="#dt-external-function">external function</a> , the function
implementation is <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a>
.</span> ]</p>
</li>
<li>
<p>[ <a title="current dateTime" id="dt-date-time" name="dt-date-time">Definition</a>
 : <b>Current dateTime.</b> This
information represents an <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a> point
in time during the processing of <span class="xquery">a
query</span> , and includes an explicit timezone. It can be
retrieved by the <code>fn:current-dateTime</code> function. If
invoked multiple times during the execution of <span class="xquery">a 
query</span> , this function always returns the same
result.]</p>
</li>
<li>
<p>[ <a title="implicit timezone" id="dt-timezone" name="dt-timezone">Definition</a>
 : <b>Implicit timezone.</b> This is
the timezone to be used when a date, time, or dateTime value that
does not have a timezone is used in a comparison or arithmetic
operation. The implicit timezone is an <a title="implementation defined"
 href="#dt-implementation-defined">implementation-defined</a> value of
type <code>xs:dayTimeDuration</code> . See <a href="#XMLSchema">[XML 
Schema]</a> for the range of legal values of a
timezone.]</p>
</li>
<li>
<p>[ <a title="available documents" id="dt-available-docs" 
name="dt-available-docs">Definition</a> : <b>Available documents.</b>
This is a mapping of strings onto document nodes. The string
represents the absolute URI of a resource. The document node is the
root of a tree that represents that resource using the <a title="data 
model" href="#dt-datamodel">data model</a> . The document
node is returned by the <code>fn:doc</code> function when applied
to that URI.] The set of available documents is not limited to the
set of <a title="statically known documents" href="#dt-known-docs">statically
 known documents</a> , and it may be
empty.</p>
<p>If there are one or more URIs in <a title="available documents" 
href="#dt-available-docs">available documents</a> that map to a
document node <code>D</code> , then the document-uri property of
<code>D</code> must either be absent, or must be one of these
URIs.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>This means that given a document node <code>$N</code> , the
result of <code>fn:doc(fn:document-uri($N)) is $N</code> will
always be True, unless <code>fn:document-uri($N)</code> is an empty
sequence.</p>
</div>
</li>
<li>
<p>[ <a title="available collections" id="dt-available-collections" 
name="dt-available-collections">Definition</a> : <b>Available
collections.</b> This is a mapping of strings onto sequences of
nodes. The string represents the absolute URI of a resource. The
sequence of nodes represents the result of the
<code>fn:collection</code> function when that URI is supplied as
the argument. ] The set of available collections is not limited to
the set of <a title="statically known collections" 
href="#dt-known-collections">statically known collections</a> , and it
may be empty.</p>
<p>For every document node <code>D</code> that is in the target of
a mapping in <a title="available collections" 
href="#dt-available-collections">available collections</a> , or that is
the root of a tree containing such a node, the document-uri
property of <code>D</code> must either be absent, or must be a URI
<code>U</code> such that <a title="available documents" 
href="#dt-available-docs">available documents</a> contains a mapping
from <code>U</code> to <code>D</code> ."</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>This means that for any document node <code>$N</code> retrieved
using the <code>fn:collection</code> function, either directly or
by navigating to the root of a node that was returned, the result
of <code>fn:doc(fn:document-uri($N)) is $N</code> will always be
True, unless <code>fn:document-uri($N)</code> is an empty sequence.
This implies a requirement for the <code>fn:doc</code> and
<code>fn:collection</code> functions to be consistent in their
effect. If the implementation uses catalogs or user-supplied URI
resolvers to dereference URIs supplied to the <code>fn:doc</code>
function, the implementation of the <code>fn:collection</code>
function must take these mechanisms into account. For example, an
implementation might achieve this by mapping the collection URI to
a set of document URIs, which are then resolved using the same
catalog or URI resolver that is used by the <code>fn:doc</code>
function.</p>
</div>
</li>
<li>
<p>[ <a title="default collection" id="dt-default-collection" 
name="dt-default-collection">Definition</a> : <b>Default collection.</b>
This is the sequence of nodes that would result from calling the
<code>fn:collection</code> function with no arguments.] The value
of <b>default collection</b> may be initialized by the
implementation.</p>
</li>
</ul>
</div>
</div>
<div class="div2">
<h3><a id="id-processing-model" name="id-processing-model"></a> 2.2
Processing Model</h3>
<p>XQuery <ins class="diff-new">1.1</ins> is defined in terms of
the <a title="data model" href="#dt-datamodel">data model</a> and
the <a title="expression context" href="#dt-expression-context">expression
 context</a> .</p>
<img src="xquery-11-diffs_files/ProcMod-XQuery.html" alt="Processing 
Model Overview">
<p>Figure 1: Processing Model Overview</p>
<p>Figure 1 provides a schematic overview of the processing steps
that are discussed in detail below. Some of these steps are
completely outside the domain of <del class="diff-old">XQuery;</del> <ins
 class="diff-chg">XQuery 1.1;</ins> in
Figure 1, these are depicted outside the line that represents the
boundaries of the language, an area labeled <b>external
processing</b> . The external processing domain includes generation
of an <a title="XDM instance" href="#dt-data-model-instance">XDM
instance</a> that represents the data to be queried (see <a 
href="#id-data-model-generation"><b>2.2.1 Data Model Generation</b></a>
), schema import processing (see <a href="#id-schema-import-processing"><b>2.2.2
 Schema Import
Processing</b></a> ) and serialization (see <a href="#id-serialization"><b>2.2.4
 Serialization</b></a> ). The area
inside the boundaries of the language is known as the <span 
class="xquery"><b>query processing domain</b></span> <del 
class="diff-old">,</del> <ins class="diff-chg">,</ins> which includes 
the
static analysis and dynamic evaluation phases (see <a 
href="#id-expression-processing"><b>2.2.3 Expression Processing</b></a>
). Consistency constraints on the <span class="xquery">query</span>
processing domain are defined in <a href="#id-consistency-constraints"><b>2.2.5
 Consistency
Constraints</b></a> .</p>
<div class="div3">
<h4><a id="id-data-model-generation" name="id-data-model-generation"></a>
 2.2.1 Data Model Generation</h4>
<p>Before <span class="xquery">a query</span> can be processed, its
input data must be represented as an <a title="XDM instance" 
href="#dt-data-model-instance">XDM instance</a> . This process occurs
outside the domain of <del class="diff-old">XQuery,</del>
<ins class="diff-chg">XQuery 1.1,</ins> which is why Figure 1
represents it in the external processing domain. Here are some
steps by which an XML document might be converted to an <a title="XDM 
instance" href="#dt-data-model-instance">XDM instance</a>
:</p>
<ol class="enumar">
<li>
<p>A document may be parsed using an XML parser that generates an
<b>XML Information Set</b> (see <a href="#XINFO">[XML Infoset]</a>
). The parsed document may then be validated against one or more
schemas. This process, which is described in <a href="#XMLSchema">[XML 
Schema]</a> , results in an abstract information
structure called the <b>Post-Schema Validation Infoset</b> (PSVI).
If a document has no associated schema, its Information Set is
preserved. (See DM1 in Fig. 1.)</p>
</li>
<li>
<p>The Information Set or PSVI may be transformed into an <a title="XDM 
instance" href="#dt-data-model-instance">XDM instance</a> by a
process described in <del class="diff-old">[XQuery/XPath</del>
<a href="#xpath-datamodel-11"><ins class="diff-chg">[XQuery and
XPath</ins> Data Model <del class="diff-old">(XDM)]</del>
<ins class="diff-chg">(XDM) 1.1]</ins></a> . (See DM2 in Fig.
1.)</p>
</li>
</ol>
<p>The above steps provide an example of how an <a title="XDM instance" 
href="#dt-data-model-instance">XDM instance</a>
might be constructed. An XDM instance might also be synthesized
directly from a relational database, or constructed in some other
way (see DM3 in Fig. 1.) XQuery <ins class="diff-new">1.1</ins> is
defined in terms of the <a title="data model" href="#dt-datamodel">data 
model</a> , but it does not place any
constraints on how XDM instances are constructed.</p>
<p>[ <a title="type annotation" id="dt-type-annotation" 
name="dt-type-annotation">Definition</a> : Each element node and
attribute node in an <a title="XDM instance" 
href="#dt-data-model-instance">XDM instance</a> has a <b>type
annotation</b> (referred to in <del class="diff-old">[XQuery/XPath</del>
 <a href="#xpath-datamodel-11"><ins class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> as its <code>type-name</code>
property.) The type annotation of a node is a <a title="schema type" 
href="#dt-schema-type">schema type</a> that describes
the relationship between the <a title="string value" 
href="#dt-string-value">string value</a> of the node and its <a 
title="typed value" href="#dt-typed-value">typed value</a> .] If the
<a title="XDM instance" href="#dt-data-model-instance">XDM
instance</a> was derived from a validated XML document as described
in <a href="http://www.w3.org/TR/xpath-datamodel/#const-psvi">Section 
3.3
Construction from a PSVI</a> <sup><small>DM</small></sup> , the
type annotations of the element and attribute nodes are derived
from schema validation. XQuery <ins class="diff-new">1.1</ins> does
not provide a way to directly access the type annotation of an
element or attribute node.</p>
<p>The value of an attribute is represented directly within the
attribute node. An attribute node whose type is unknown (such as
might occur in a schemaless document) is given the <a title="type 
annotation" href="#dt-type-annotation">type annotation</a>
<code>xs:untypedAtomic</code> .</p>
<p>The value of an element is represented by the children of the
element node, which may include text nodes and other element nodes.
The <a title="type annotation" href="#dt-type-annotation">type
annotation</a> of an element node indicates how the values in its
child text nodes are to be interpreted. An element that has not
been validated (such as might occur in a schemaless document) is
annotated with the schema type <code>xs:untyped</code> . An element
that has been validated and found to be partially valid is
annotated with the schema type <code>xs:anyType</code> . If an
element node is annotated as <code>xs:untyped</code> , all its
descendant element nodes are also annotated as
<code>xs:untyped</code> . However, if an element node is annotated
as <code>xs:anyType</code> , some of its descendant element nodes
may have a more specific <a title="type annotation" 
href="#dt-type-annotation">type annotation</a> .</p>
</div>
<div class="div3">
<h4><a id="id-schema-import-processing" 
name="id-schema-import-processing"></a> 2.2.2 Schema Import
Processing</h4>
<p class="xquery">The <a title="in-scope schema definitions" 
href="#dt-issd">in-scope schema definitions</a> in the <a title="static 
context" href="#dt-static-context">static context</a> may
be extracted from actual XML schemas <del class="diff-old">as
described in [XQuery 1.0 and XPath 2.0 Formal Semantics]</del> (see
step SI1 in Figure 1) or may be generated by some other mechanism
(see step SI2 in Figure 1). In either case, the result must satisfy
the consistency constraints defined in <a 
href="#id-consistency-constraints"><b>2.2.5 Consistency
Constraints</b></a> .</p>
</div>
<div class="div3">
<h4><a id="id-expression-processing" name="id-expression-processing"></a>
 2.2.3 Expression Processing</h4>
<p>XQuery <ins class="diff-new">1.1</ins> defines two phases of
processing called the <a title="static analysis phase" 
href="#dt-static-analysis">static analysis phase</a> and the <a 
title="dynamic evaluation phase" href="#dt-dynamic-evaluation">dynamic
evaluation phase</a> (see Fig. 1). During the static analysis
phase, <a title="static error" href="#dt-static-error">static
errors</a> , <a title="dynamic error" href="#dt-dynamic-error">dynamic 
errors</a> , or <a title="type error" href="#dt-type-error">type errors</a>
 may be raised. During the
dynamic evaluation phase, only <a title="dynamic error" 
href="#dt-dynamic-error">dynamic errors</a> or <a title="type error" 
href="#dt-type-error">type errors</a> may be raised. These kinds of
errors are defined in <a href="#id-kinds-of-errors"><b>2.3.1 Kinds
of Errors</b></a> .</p>
<p>Within each phase, an implementation is free to use any strategy
or algorithm whose result conforms to the specifications in this
document.</p>
<div class="div4">
<h5><a id="id-static-analysis" name="id-static-analysis"></a>
2.2.3.1 Static Analysis Phase</h5>
<p>[ <a title="static analysis phase" id="dt-static-analysis" 
name="dt-static-analysis">Definition</a> : The <b>static analysis
phase</b> depends on the expression itself and on the <a title="static 
context" href="#dt-static-context">static context</a> . The
<b>static analysis phase</b> does not depend on input data (other
than schemas).]</p>
<p>During the static analysis phase, the <span class="xquery">query</span>
 is parsed into an internal representation
called the <b>operation tree</b> (step SQ1 in Figure 1). A parse
error is raised as a <a title="static error" href="#dt-static-error">static
 error</a> [ <a title="err:XPST0003" href="#ERRXPST0003">err:XPST0003</a>
 ]. The <a title="static context" href="#dt-static-context">static 
context</a> is initialized by the
implementation (step SQ2). <span class="xquery">The <a title="static 
context" href="#dt-static-context">static context</a> is
then changed and augmented based on information in the
<b>prolog</b> (step SQ3). If the <a title="schema import feature" 
href="#dt-schema-import-feature">Schema Import Feature</a> is
supported, the <a title="in-scope schema definitions" href="#dt-issd">in-scope
 schema definitions</a> are populated with
information from imported schemas. If the <a title="module feature" 
href="#dt-module-feature">Module Feature</a> is supported, the
static context is extended with function declarations and variable
declarations from imported modules.</span> The <a title="static context"
 href="#dt-static-context">static context</a> is
used to resolve schema type names, function names, namespace
prefixes, and variable names (step SQ4). If a name of one of these
kinds in the <b>operation tree</b> is not found in the <a title="static 
context" href="#dt-static-context">static context</a> , a
<a title="static error" href="#dt-static-error">static error</a> ([
<a title="err:XPST0008" href="#ERRXPST0008">err:XPST0008</a> ] or [
<a title="err:XPST0017" href="#ERRXPST0017">err:XPST0017</a> ]) is
raised (however, see exceptions to this rule in <a 
href="#id-element-test"><b>2.5.4.3 Element Test</b></a> and <a 
href="#id-attribute-test"><b>2.5.4.5 Attribute Test</b></a> .)</p>
<p>The <b>operation tree</b> is then <b>normalized</b> by making
explicit the implicit operations such as <a title="atomization" 
href="#dt-atomization">atomization</a> and extraction of <a 
title="effective boolean value" href="#dt-ebv">Effective Boolean
Values</a> (step SQ5). <del class="diff-old">The normalization
process is described in [XQuery 1.0 and XPath 2.0 Formal Semantics]
.</del></p>
<p><del class="diff-old">Each expression</del> <ins class="diff-chg">During
 the</ins> <a title="static analysis phase" href="#dt-static-analysis"><ins
 class="diff-chg">static analysis
phase</ins></a> ,<ins class="diff-chg">an XQuery processor may
perform type analysis. The effect of type analysis</ins> is
<del class="diff-old">then assigned</del> <ins class="diff-chg">to
assign</ins> a <a title="static type" href="#dt-static-type">static
type</a> <del class="diff-old">(step SQ6).</del> <ins class="diff-chg">to
 each expression in the operation tree.</ins> [
<a title="static type" id="dt-static-type" name="dt-static-type">Definition</a>
 : The <b>static type</b> of an
expression is <del class="diff-old">a</del> <ins class="diff-chg">the 
best inference that the processor is able to make
statically about the</ins> type <del class="diff-old">such that,
when</del> <ins class="diff-chg">of the result of the expression.]
This specification does not define the rules for type analysis nor
the static types that are assigned to particular expressions: the
only constraint is that the inferred type must match all possible
values that</ins> the expression is <del class="diff-old">evaluated,</del>
 <ins class="diff-chg">capable of
returning.</ins></p>
<p><ins class="diff-chg">Examples of inferred static types might
be:</ins></p>
<ul>
<li>
<p><ins class="diff-chg">For</ins> the <del class="diff-old">resulting 
value will always conform to</del> <ins class="diff-chg">expression</ins>
 <code><ins class="diff-chg">concat(a,b)</ins></code> the <ins 
class="diff-new">inferred</ins> static <del class="diff-old">type.]
If</del> <ins class="diff-chg">type is</ins> <code><ins class="diff-chg">xs:string</ins></code></p>
</li>
<li>
<p><ins class="diff-chg">For</ins> the <del class="diff-old">Static
Typing Feature</del> <ins class="diff-chg">expression</ins>
<code><ins class="diff-chg">$a = $v</ins></code> <ins class="diff-chg">the
 inferred static type</ins> is <del class="diff-old">supported,</del> <code><ins
 class="diff-chg">xs:boolean</ins></code></p>
</li>
<li>
<p><ins class="diff-chg">For</ins> the <ins class="diff-chg">expression</ins>
 <code><ins class="diff-chg">$s[exp]</ins></code> <ins class="diff-chg">the
inferred</ins> static <del class="diff-old">types</del> <ins 
class="diff-chg">type has the same item type as the static type</ins> of
<del class="diff-old">various expressions are</del>
<code><ins class="diff-chg">$s</ins></code> ,<ins class="diff-chg">but a
 cardinality that allows the empty sequence even if
the static type of</ins> <code><ins class="diff-chg">$s</ins></code> <ins
 class="diff-chg">does not allow an
empty sequence.</ins></p>
</li>
<li>
<p><ins class="diff-chg">The</ins> inferred <del class="diff-old">according
 to</del> <ins class="diff-chg">static type
of</ins> the <ins class="diff-new">expression</ins>
<code><ins class="diff-new">data($x)</ins></code> <ins class="diff-new">(whether
 written explicitly or inserted into the
operation tree in places where atomization is implicit) depends on
the inferred static type of</ins> <code><ins class="diff-new">$x</ins></code>
 :<ins class="diff-new">for example,
if</ins> <code><ins class="diff-new">$x</ins></code> <ins 
class="diff-new">has type</ins> <code><ins class="diff-new">element(*,
xs:integer)</ins></code> <ins class="diff-new">then</ins>
<code><ins class="diff-new">data($x)</ins></code> <ins class="diff-new">has
 static type</ins> <code><ins class="diff-new">xs:integer</ins></code> .</p>
</li>
</ul>
<p><ins class="diff-new">In XQuery 1.0,</ins> rules <del 
class="diff-old">described</del> <ins class="diff-chg">for static type
inferencing were published normatively</ins> in <a 
href="#xquery-semantics">[XQuery 1.0 and XPath 2.0 Formal Semantics]
<del class="diff-old">. If the Static Typing Feature is not
supported,</del></a> , <ins class="diff-chg">but implementations
were allowed to refine these rules to infer a more precise type
where possible. With XQuery 1.1,</ins> the <del class="diff-old">static 
types that are assigned</del> <ins class="diff-chg">rules</ins> are <del
 class="diff-old">implementation-dependent .</del> <ins class="diff-chg">entirely
 implementation-defined.</ins></p>
<p><del class="diff-old">During</del> <ins class="diff-chg">Every
kind of expression also imposes requirements on</ins> the
<del class="diff-old">static analysis phase , if</del> <ins 
class="diff-chg">type of its operands. For example, with the
expression</ins> <code><ins class="diff-chg">substring($a, $b,
$c)</ins></code> ,<code><ins class="diff-chg">$a</ins></code>
<ins class="diff-chg">must be of type</ins> <code><ins class="diff-chg">xs:string</ins></code>
 <ins class="diff-chg">(or
something that can be converted to</ins> <code><ins class="diff-chg">xs:string</ins></code>
 <ins class="diff-chg">by the
function calling rules), while</ins> <code><ins class="diff-chg">$b</ins></code>
 <ins class="diff-chg">and</ins>
<code><ins class="diff-chg">$c</ins></code> <ins class="diff-chg">must 
be of type</ins> <code><ins class="diff-chg">xs:double</ins></code> .</p>
<p><ins class="diff-chg">If</ins> the Static Typing Feature is in
<del class="diff-old">effect and</del> <ins class="diff-chg">effect,</ins>
 an <del class="diff-old">operand</del>
<ins class="diff-chg">XQuery processor must signal a type error
during static analysis if the inferred static type</ins> of an
expression is <del class="diff-old">found to have a static</del>
<ins class="diff-chg">not subsumed by the required</ins> type
<del class="diff-old">that</del> <ins class="diff-chg">of the
context where the expression</ins> is <del class="diff-old">not
appropriate for that operand,</del> <ins class="diff-chg">used. For
example, the call of substring above would cause</ins> a type error
<del class="diff-old">is raised [ err:XPTY0004 ]. If static type
checking raises no errors and assigns a</del> <ins class="diff-chg">if 
the inferred</ins> static type <del class="diff-old">T to an expression,
 then execution</del> of <del class="diff-old">the expression on valid 
input data</del>
<code><ins class="diff-chg">$a</ins></code> is <del class="diff-old">guaranteed
 either to produce</del> <code><ins class="diff-chg">xs:integer</ins></code>
 <ins class="diff-chg">;
equally,</ins> a <del class="diff-old">value of</del> type
<del class="diff-old">T or to raise a dynamic</del> error
<del class="diff-old">.</del> <ins class="diff-chg">would be
reported during static analysis if the inferred static type
is</ins> <code><ins class="diff-chg">xs:anyAtomicType</ins></code>
.</p>
<p><del class="diff-old">The purpose of</del> <ins class="diff-chg">If</ins>
 the Static Typing Feature is <del class="diff-old">to provide early 
detection of</del> <ins class="diff-chg">not in effect, a processor may 
signal a</ins> type
<del class="diff-old">errors and to infer</del> <ins class="diff-chg">error
 during static analysis only if the inferred
static</ins> type <del class="diff-old">information that</del>
<ins class="diff-chg">of an expression has no overlap
(intersection) with the required type: so for the first argument of
substring, the processor</ins> may <del class="diff-old">be
useful</del> <ins class="diff-chg">report an error if the inferred
type is</ins> <code><ins class="diff-chg">xs:integer</ins></code>
,<ins class="diff-chg">but not if it is</ins> <code><ins 
class="diff-chg">xs:anyAtomicType</ins></code> .<ins class="diff-chg">Alternatively,
 if the Static Typing Feature is not</ins>
in <del class="diff-old">optimizing</del> <ins class="diff-chg">effect,</ins>
 the <ins class="diff-new">processor may
defer all type checking until the dynamic</ins> evaluation
<del class="diff-old">of an expression.</del> <ins class="diff-chg">phase.</ins></p>
</div>
<div class="div4">
<h5><a id="id-dynamic-evaluation" name="id-dynamic-evaluation"></a>
2.2.3.2 Dynamic Evaluation Phase</h5>
<p>[ <a title="dynamic evaluation phase" id="dt-dynamic-evaluation" 
name="dt-dynamic-evaluation">Definition</a> : The <b>dynamic
evaluation phase</b> is the phase during which the value of an
expression is computed.] It occurs after completion of the
<a title="static analysis phase" href="#dt-static-analysis">static
analysis phase</a> .</p>
<p>The dynamic evaluation phase can occur only if no errors were
detected during the <a title="static analysis phase" 
href="#dt-static-analysis">static analysis phase</a> . If the <a 
title="static typing feature" href="#dt-static-typing-feature">Static
Typing Feature</a> is in effect, all <a title="type error" 
href="#dt-type-error">type errors</a> are detected during static
analysis and serve to inhibit the dynamic evaluation phase.</p>
<p>The dynamic evaluation phase depends on the <b>operation
tree</b> of the expression being evaluated (step DQ1), on the input
data (step DQ4), and on the <a title="dynamic context" 
href="#dt-dynamic-context">dynamic context</a> (step DQ5), which in turn
draws information from the external environment (step DQ3) and the
<a title="static context" href="#dt-static-context">static
context</a> (step DQ2). The dynamic evaluation phase may create new
data-model values (step DQ4) and it may extend the <a title="dynamic 
context" href="#dt-dynamic-context">dynamic context</a>
(step DQ5)—for example, by binding values to variables.</p>
<p>[ <a title="dynamic type" id="dt-dynamic-type" name="dt-dynamic-type">Definition</a>
 : A <b>dynamic type</b> is
associated with each value as it is computed. The dynamic type of a
value may be more specific than the <a title="static type" 
href="#dt-static-type">static type</a> of the expression that computed
it (for example, the static type of an expression might be
<code>xs:integer*</code> , denoting a sequence of zero or more
integers, but at evaluation time its value may have the dynamic
type <code>xs:integer</code> , denoting exactly one integer.)]</p>
<p>If an operand of an expression is found to have a <a title="dynamic 
type" href="#dt-dynamic-type">dynamic type</a> that is not
appropriate for that operand, a <a title="type error" 
href="#dt-type-error">type error</a> is raised [ <a title="err:XPTY0004"
 href="#ERRXPTY0004">err:XPTY0004</a> ].</p>
<p>Even though static typing can catch many <a title="type error" 
href="#dt-type-error">type errors</a> before an expression is
executed, it is possible for an expression to raise an error during
evaluation that was not detected by static analysis. For example,
an expression may contain a cast of a string into an integer, which
is statically valid. However, if the actual value of the string at
run time cannot be cast into an integer, a <a title="dynamic error" 
href="#dt-dynamic-error">dynamic error</a> will result. Similarly,
an expression may apply an arithmetic operator to a value whose
<a title="static type" href="#dt-static-type">static type</a> is
<code>xs:untypedAtomic</code> . This is not a <a title="static error" 
href="#dt-static-error">static error</a> , but at
run time, if the value cannot be successfully cast to a <a 
title="numeric" href="#dt-numeric">numeric</a> type, a <a title="dynamic
 error" href="#dt-dynamic-error">dynamic error</a> will be
raised.</p>
<p>When the <a title="static typing feature" 
href="#dt-static-typing-feature">Static Typing Feature</a> is in effect,
it is also possible for static analysis of an expression to raise a
<a title="type error" href="#dt-type-error">type error</a> , even
though execution of the expression on certain inputs would be
successful. For example, an expression might contain a function
that requires an element as its parameter, and the static analysis
phase might infer the <a title="static type" href="#dt-static-type">static
 type</a> of the function parameter to be
an optional element. This case is treated as a <a title="type error" 
href="#dt-type-error">type error</a> and inhibits
evaluation, even though the function call would have been
successful for input data in which the optional element is
present.</p>
</div>
</div>
<div class="div3">
<h4><a id="id-serialization" name="id-serialization"></a> 2.2.4
Serialization</h4>
<p>[ <a title="serialization" id="dt-serialization" 
name="dt-serialization">Definition</a> : <b>Serialization</b> is the
process of converting an <a title="XDM instance" 
href="#dt-data-model-instance">XDM instance</a> into a sequence of
octets (step DM4 in Figure 1.) ] The general framework for
serialization is described in <a href="#xslt-xquery-serialization-11">[XSLT
 <del class="diff-old">2.0</del> and XQuery <del class="diff-old">1.0
Serialization]</del> <ins class="diff-chg">Serialization
1.1]</ins></a> .</p>
<p class="xquery">An XQuery implementation is not required to
provide a serialization interface. For example, an implementation
may only provide a DOM interface (see <a href="#DOM">[Document
Object Model]</a> ) or an interface based on an event stream. In
these cases, serialization would be outside of the scope of this
specification.</p>
<p class="xquery"><a href="#xslt-xquery-serialization-11">[XSLT
<del class="diff-old">2.0</del> and XQuery <del class="diff-old">1.0 
Serialization]</del> <ins class="diff-chg">Serialization 1.1]</ins></a> 
defines a set of
<b>serialization parameters</b> that govern the serialization
process. If an XQuery implementation provides a serialization
interface, it may support (and may expose to users) any of the
serialization parameters listed (with default values) in <a 
href="#id-xq-serialization-parameters"><b>C.3 Serialization
Parameters</b></a> .</p>
<p class="xquery"><ins class="diff-new">[</ins> <a title="output 
declaration" id="dt-output-declaration" name="dt-output-declaration"><ins
 class="diff-new">Definition</ins></a>
:<ins class="diff-new">An</ins> <b><ins class="diff-new">output
declaration</ins></b> <ins class="diff-new">is an option
declaration in the predeclared namespace associated with the</ins>
<code><ins class="diff-new">output</ins></code> <ins class="diff-new">prefix;
 it is used to declare an output parameter for
serializing the output of the query.] When the application requests
serialization of the output, the processor may use these parameters
to control the way in which the serialization takes place.
Processors may also allow external mechanisms for specifying
serialization parameters, which may or may not override
serialization parameters specified in the query prolog.</ins></p>
<div class="exampleOuter">
<div class="exampleInner">
<pre><ins class="diff-new">
declare option output:method   "xml"; 
declare option output:encoding "iso-8859-1"; 
declare option output:indent   "yes"; 
</ins>
</pre></div>
</div>
<p class="xquery"><ins class="diff-new">An</ins> <b><ins 
class="diff-new">output declaration</ins></b> <ins class="diff-new">may
appear only in a main module; it is a static error [</ins>
<a title="err:XQST0108" href="#ERRXQST0108"><ins class="diff-new">err:XQST0108</ins></a>
 <ins class="diff-new">] if an
output declaration appears in a</ins> <a title="library module" 
href="#dt-library-module"><ins class="diff-new">library
module</ins></a> .<ins class="diff-new">It is a static error
[</ins> <a title="err:XQST0110" href="#ERRXQST0110"><ins 
class="diff-new">err:XQST0110</ins></a> <ins class="diff-new">] if the
same serialization parameter is declared more than once. It is
a</ins> <a title="static error" href="#dt-static-error"><ins 
class="diff-new">static error</ins></a> <ins class="diff-new">[</ins>
<a title="err:XQST0109" href="#ERRXQST0109"><ins class="diff-new">err:XQST0109</ins></a>
 <ins class="diff-new">] if the
local name of an output declaration in the</ins> <code><ins 
class="diff-new">http://www.w3.org/2009/xquery-serialization</ins></code>
<ins class="diff-new">namespace is not one of the serialization
parameter names listed in</ins> <a 
href="#id-xq-serialization-parameters"><b><ins class="diff-new">C.3
Serialization Parameters</ins></b></a> .<ins class="diff-new">The
default value for the method parameter is "xml".</ins> An
<del class="diff-old">XQuery</del> implementation <ins class="diff-new">may
 define additional</ins> <a title="implementation defined" 
href="#dt-implementation-defined"><ins class="diff-new">implementation-defined</ins></a>
 <ins class="diff-new">serialization parameters in its own
namespaces.</ins></p>
<p class="xquery"><ins class="diff-new">A serialization
parameter</ins> that <del class="diff-old">provides</del>
<ins class="diff-chg">is not applicable to the chosen output method
must be ignored, except that if its value is not</ins> a
<ins class="diff-new">valid value for that parameter, the error may
be reported.</ins></p>
<p class="xquery"><ins class="diff-new">A processor that is
performing</ins> serialization <del class="diff-old">interface</del> 
must <del class="diff-old">support some
combination</del> <ins class="diff-chg">report a serialization
error if the values</ins> of <ins class="diff-new">any
serialization parameters (other than any that are ignored under the
previous paragraph) are incorrect.</ins></p>
<p class="xquery"><ins class="diff-new">A processor that is not
performing serialization may report errors if any serialization
parameters are incorrect, or may ignore such parameters.</ins></p>
<p class="xquery"><ins class="diff-new">Specifying</ins>
serialization parameters in <del class="diff-old">which method =
"xml" and version = "1.0" .</del> <ins class="diff-chg">a query
does not by itself demand that the output be serialized. It merely
defines the desired form of the serialized output for use in
situations where the processor has been asked to perform
serialization.</ins></p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The <a title="data model" href="#dt-datamodel">data model</a>
permits an element node to have fewer <a title="in-scope namespaces" 
href="#dt-in-scope-namespaces">in-scope
namespaces</a> than its parent. Correct serialization of such an
element node would require "undeclaration" of namespaces, which is
a feature of <a href="#XMLNAMES11">[XML Names 1.1]</a> . An
implementation that does not support <a href="#XMLNAMES11">[XML
Names 1.1]</a> is permitted to serialize such an element without
"undeclaration" of namespaces, which effectively causes the element
to inherit the in-scope namespaces of its parent.</p>
</div>
</div>
<div class="div3">
<h4><a id="id-consistency-constraints" name="id-consistency-constraints"></a>
 2.2.5 Consistency
Constraints</h4>
<p>In order for XQuery <ins class="diff-new">1.1</ins> to be well
defined, the input <a title="XDM instance" 
href="#dt-data-model-instance">XDM instance</a> , the <a title="static 
context" href="#dt-static-context">static context</a> , and
the <a title="dynamic context" href="#dt-dynamic-context">dynamic
context</a> must be mutually consistent. The consistency
constraints listed below are prerequisites for correct functioning
of an XQuery <ins class="diff-new">1.1</ins> implementation.
Enforcement of these consistency constraints is beyond the scope of
this specification. This specification does not define the result
of <span class="xquery">a query</span> under any condition in which
one or more of these constraints is not satisfied.</p>
<p>Some of the consistency constraints use the term <b>data model
schema</b> . [ <a title="data model schema" id="dt-data-model-schema" 
name="dt-data-model-schema">Definition</a> :
For a given node in an <a title="XDM instance" 
href="#dt-data-model-instance">XDM instance</a> , the <b>data model
schema</b> is defined as the schema from which the <a title="type 
annotation" href="#dt-type-annotation">type annotation</a> of
that node was derived.] For a node that was constructed by some
process other than schema validation, the <b>data model schema</b>
consists simply of the schema type definition that is represented
by the <a title="type annotation" href="#dt-type-annotation">type
annotation</a> of the node.</p>
<ul>
<li>
<p>For every node that has a type annotation, if that type
annotation is found in the <a title="in-scope schema definitions" 
href="#dt-issd">in-scope schema definitions</a> (ISSD), then its
definition in the ISSD must be equivalent to its definition in the
<a title="data model schema" href="#dt-data-model-schema">data
model schema</a> . Furthermore, all types that are derived by
extension from the given type in the <a title="data model schema" 
href="#dt-data-model-schema">data model schema</a> must also be
known by equivalent definitions in the ISSD.</p>
</li>
<li>
<p>For every element name <em>EN</em> that is found both in an
<a title="XDM instance" href="#dt-data-model-instance">XDM
instance</a> and in the <a title="in-scope schema definitions" 
href="#dt-issd">in-scope schema definitions</a> (ISSD), all
elements that are known in the <a title="data model schema" 
href="#dt-data-model-schema">data model schema</a> to be in the
<a title="substitution group" href="#dt-substitution-group">substitution
 group</a> headed by
<em>EN</em> must also be known in the ISSD to be in the <a 
title="substitution group" href="#dt-substitution-group">substitution
group</a> headed by <em>EN</em> .</p>
</li>
<li>
<p>Every element name, attribute name, or schema type name
referenced in <a title="in-scope variables" 
href="#dt-in-scope-variables">in-scope variables</a> or <a 
title="function signature" href="#dt-function-signature">function
signatures</a> must be in the <a title="in-scope schema definitions" 
href="#dt-issd">in-scope schema
definitions</a> , unless it is an element name referenced as part
of an <a href="#doc-xquery11-ElementTest">ElementTest</a> or an
attribute name referenced as part of an <a 
href="#doc-xquery11-AttributeTest">AttributeTest</a> .</p>
</li>
<li>
<p>Any reference to a global element, attribute, or type name in
the <a title="in-scope schema definitions" href="#dt-issd">in-scope
schema definitions</a> must have a corresponding element, attribute
or type definition in the <a title="in-scope schema definitions" 
href="#dt-issd">in-scope schema definitions</a> .</p>
</li>
<li>
<p>For each mapping of a string to a document node in <a 
title="available documents" href="#dt-available-docs">available
documents</a> , if there exists a mapping of the same string to a
document type in <a title="statically known documents" 
href="#dt-known-docs">statically known documents</a> , the document node
must match the document type, using the matching rules in <a 
href="#id-sequencetype-matching"><b>2.5.4 SequenceType Matching</b></a>
.</p>
</li>
<li>
<p>For each mapping of a string to a sequence of nodes in <a 
title="available collections" href="#dt-available-collections">available
collections</a> , if there exists a mapping of the same string to a
type in <a title="statically known collections" 
href="#dt-known-collections">statically known collections</a> , the
sequence of nodes must match the type, using the matching rules in
<a href="#id-sequencetype-matching"><b>2.5.4 SequenceType
Matching</b></a> .</p>
</li>
<li>
<p>The sequence of nodes in the <a title="default collection" 
href="#dt-default-collection">default collection</a> must match the
<a title="statically known default collection type" 
href="#dt-known-default-collection">statically known default collection
type</a> , using the matching rules in <a 
href="#id-sequencetype-matching"><b>2.5.4 SequenceType Matching</b></a>
.</p>
</li>
<li>
<p>The value of the <a title="context item" href="#dt-context-item">context
 item</a> must match the <a title="context item static type" 
href="#dt-context-item-static-type">context item static type</a> , using
the matching rules in <a href="#id-sequencetype-matching"><b>2.5.4
SequenceType Matching</b></a> .</p>
</li>
<li>
<p>For each (variable, type) pair in <a title="in-scope variables" 
href="#dt-in-scope-variables">in-scope variables</a> and the
corresponding (variable, value) pair in <a title="variable values" 
href="#dt-variable-values">variable values</a> such that the
variable names are equal, the value must match the type, using the
matching rules in <a href="#id-sequencetype-matching"><b>2.5.4
SequenceType Matching</b></a> .</p>
</li>
<li>
<p>For each variable declared as <code>external</code> : If the
variable declaration includes a declared type, the external
environment must provide a value for the variable that matches the
declared type, using the matching rules in <a 
href="#id-sequencetype-matching"><b>2.5.4 SequenceType Matching</b></a>
. If the variable declaration does not include a declared type, the
external environment must provide a type and a matching value,
using the same matching rules.</p>
</li>
<li>
<p>For each function declared as external: the <a title="function 
implementation" href="#dt-function-implementation">function 
implementation</a> must
either return a value that matches the declared result type, using
the matching rules in <a href="#id-sequencetype-matching"><b>2.5.4
SequenceType Matching</b></a> , or raise an <a title="implementation 
defined" href="#dt-implementation-defined">implementation-defined</a> 
error.</p>
</li>
<li>
<p>For a given query, define a <b>participating ISSD</b> as the
<a title="in-scope schema definitions" href="#dt-issd">in-scope
schema definitions</a> of a module that is used in evaluating the
query. If two participating ISSDs contain a definition for the same
schema type, element name, or attribute name, the definitions must
be equivalent in both ISSDs. Furthermore, if two participating
ISSDs each contain a definition of a schema type <em>T</em> , the
set of types derived by extension from <em>T</em> must be
equivalent in both ISSDs. Also, if two participating ISSDs each
contain a definition of an element name <em>E</em> , the
substitution group headed by <em>E</em> must be equivalent in both
ISSDs.</p>
</li>
<li>
<p>In the <a title="statically known namespaces" 
href="#dt-static-namespaces">statically known namespaces</a> , the
prefix <code>xml</code> must not be bound to any namespace URI
other than <code>http://www.w3.org/XML/1998/namespace</code> , and
no prefix other than <code>xml</code> may be bound to this
namespace URI.</p>
</li>
</ul>
</div>
</div>
<div class="div2">
<h3><a id="errors" name="errors"></a> 2.3 Error Handling</h3>
<div class="div3">
<h4><a id="id-kinds-of-errors" name="id-kinds-of-errors"></a> 2.3.1
Kinds of Errors</h4>
<p>As described in <a href="#id-expression-processing"><b>2.2.3
Expression Processing</b></a> , XQuery <ins class="diff-new">1.1</ins> 
defines a <a title="static analysis phase" href="#dt-static-analysis">static
 analysis phase</a> , which does
not depend on input data, and a <a title="dynamic evaluation phase" 
href="#dt-dynamic-evaluation">dynamic evaluation phase</a> , which
does depend on input data. Errors may be raised during each
phase.</p>
<p>[ <a title="static error" id="dt-static-error" name="dt-static-error">Definition</a>
 : A <b>static error</b> is an
error that must be detected during the static analysis phase. A
syntax error is an example of a <a title="static error" 
href="#dt-static-error">static error</a> .]</p>
<p>[ <a title="dynamic error" id="dt-dynamic-error" 
name="dt-dynamic-error">Definition</a> : A <b>dynamic error</b> is an
error that must be detected during the dynamic evaluation phase and
may be detected during the static analysis phase. Numeric overflow
is an example of a dynamic error. ]</p>
<p>[ <a title="type error" id="dt-type-error" name="dt-type-error">Definition</a>
 : A <b>type error</b> may be raised
during the static analysis phase or the dynamic evaluation phase.
During the static analysis phase, a <a title="type error" 
href="#dt-type-error">type error</a> occurs when the <a title="static 
type" href="#dt-static-type">static type</a> of an
expression does not match the expected type of the context in which
the expression occurs. During the dynamic evaluation phase, a
<a title="type error" href="#dt-type-error">type error</a> occurs
when the <a title="dynamic type" href="#dt-dynamic-type">dynamic
type</a> of a value does not match the expected type of the context
in which the value occurs.]</p>
<p>The outcome of the <a title="static analysis phase" 
href="#dt-static-analysis">static analysis phase</a> is either success
or one or more <a title="type error" href="#dt-type-error">type
errors</a> , <a title="static error" href="#dt-static-error">static
errors</a> , or statically-detected <a title="dynamic error" 
href="#dt-dynamic-error">dynamic errors</a> . The result of the
<a title="dynamic evaluation phase" href="#dt-dynamic-evaluation">dynamic
 evaluation phase</a> is either a
result value, a <a title="type error" href="#dt-type-error">type
error</a> , or a <a title="dynamic error" href="#dt-dynamic-error">dynamic
 error</a> .</p>
<p>If more than one error is present, or if an error condition
comes within the scope of more than one error defined in this
specification, then any non-empty subset of these errors may be
reported.</p>
<p>During the <a title="static analysis phase" 
href="#dt-static-analysis">static analysis phase</a> , if the <a 
title="static typing feature" href="#dt-static-typing-feature">Static
Typing Feature</a> is in effect and the <a title="static type" 
href="#dt-static-type">static type</a> assigned to an expression
other than <code>()</code> or <code>data(())</code> is
<code>empty-sequence()</code> , a <a title="static error" 
href="#dt-static-error">static error</a> is raised [ <a 
title="err:XPST0005" href="#ERRXPST0005">err:XPST0005</a> ]. This 
catches
cases in which a query refers to an element or attribute that is
not present in the <a title="in-scope schema definitions" 
href="#dt-issd">in-scope schema definitions</a> , possibly because of a
spelling error.</p>
<p>Independently of whether the <a title="static typing feature" 
href="#dt-static-typing-feature">Static Typing Feature</a> is in
effect, if an implementation can determine during the <a title="static 
analysis phase" href="#dt-static-analysis">static analysis
phase</a> that an expression, if evaluated, would necessarily raise
a <a title="type error" href="#dt-type-error">type error</a> or a
<a title="dynamic error" href="#dt-dynamic-error">dynamic error</a>
, the implementation may (but is not required to) report that error
during the <a title="static analysis phase" href="#dt-static-analysis">static
 analysis phase</a> . However, the
<code>fn:error()</code> function must not be evaluated during the
<a title="static analysis phase" href="#dt-static-analysis">static
analysis phase</a> .</p>
<p>[ <a title="warning" id="dt-warning" name="dt-warning">Definition</a>
 : In addition to <a title="static error" href="#dt-static-error">static
 errors</a> ,
<a title="dynamic error" href="#dt-dynamic-error">dynamic
errors</a> , and <a title="type error" href="#dt-type-error">type
errors</a> , an XQuery <ins class="diff-new">1.1</ins>
implementation may raise <b>warnings</b> , either during the
<a title="static analysis phase" href="#dt-static-analysis">static
analysis phase</a> or the <a title="dynamic evaluation phase" 
href="#dt-dynamic-evaluation">dynamic evaluation phase</a> . The
circumstances in which warnings are raised, and the ways in which
warnings are handled, are <a title="implementation defined" 
href="#dt-implementation-defined">implementation-defined</a> .]</p>
<p>In addition to the errors defined in this specification, an
implementation may raise a <a title="dynamic error" 
href="#dt-dynamic-error">dynamic error</a> for a reason beyond the scope
of this specification. For example, limitations may exist on the
maximum numbers or sizes of various objects. Any such limitations,
and the consequences of exceeding them, are <a title="implementation 
dependent" href="#dt-implementation-dependent">implementation-dependent</a>
 .</p>
</div>
<div class="div3">
<h4><a id="id-identifying-errors" name="id-identifying-errors"></a>
2.3.2 Identifying and Reporting Errors</h4>
<p>The errors defined in this specification are identified by
QNames that have the form <code>err:XXYYnnnn</code> , where:</p>
<ul>
<li>
<p><code>err</code> denotes the namespace for XPath and XQuery
errors, <code>http://www.w3.org/2005/xqt-errors</code> . This
binding of the namespace prefix <code>err</code> is used for
convenience in this document, and is not normative.</p>
</li>
<li>
<p><code>XX</code> denotes the language in which the error is
defined, using the following encoding:</p>
<ul>
<li>
<p><code>XP</code> denotes an error defined by XPath. Such an error
may also occur XQuery since XQuery includes XPath as a subset.</p>
</li>
<li>
<p><code>XQ</code> denotes an error defined by XQuery.</p>
</li>
</ul>
</li>
<li>
<p><code>YY</code> denotes the error category, using the following
encoding:</p>
<ul>
<li>
<p><code>ST</code> denotes a static error.</p>
</li>
<li>
<p><code>DY</code> denotes a dynamic error.</p>
</li>
<li>
<p><code>TY</code> denotes a type error.</p>
</li>
</ul>
</li>
<li>
<p><code>nnnn</code> is a unique numeric code.</p>
</li>
</ul>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The namespace URI for XPath and XQuery errors is not expected to
change from one version of XQuery <ins class="diff-new">1.1</ins>
to another. However, the contents of this namespace may be extended
to include additional error definitions.</p>
</div>
<p>The method by which an XQuery <ins class="diff-new">1.1</ins>
processor reports error information to the external environment is
<a title="implementation defined" href="#dt-implementation-defined">implementation-defined</a>
 .</p>
<p>An error can be represented by a URI reference that is derived
from the error QName as follows: an error with namespace URI
<em><code>NS</code></em> and local part <em><code>LP</code></em>
can be represented as the URI reference <em><code>NS</code></em>
<code>#</code> <em><code>LP</code> <del class="diff-old">.</del></em> <ins
 class="diff-chg">.</ins> For example,
an error whose QName is <code>err:XPST0017</code> could be
represented as
<code>http://www.w3.org/2005/xqt-errors#XPST0017</code> .</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>Along with a code identifying an error, implementations may wish
to return additional information, such as the location of the error
or the processing phase in which it was detected. If an
implementation chooses to do so, then the mechanism that it uses to
return this information is <a title="implementation defined" 
href="#dt-implementation-defined">implementation-defined</a> .</p>
</div>
</div>
<div class="div3">
<h4><a id="id-handling-dynamic" name="id-handling-dynamic"></a>
2.3.3 Handling Dynamic Errors</h4>
<p>Except as noted in this document, if any operand of an
expression raises a <a title="dynamic error" href="#dt-dynamic-error">dynamic
 error</a> , the expression also raises
a <a title="dynamic error" href="#dt-dynamic-error">dynamic
error</a> . If an expression can validly return a value or raise a
dynamic error, the implementation may choose to return the value or
raise the dynamic error. For example, the logical expression
<code>expr1 and expr2</code> may return the value
<code>false</code> if either operand returns <code>false</code> ,
or may raise a dynamic error if either operand raises a dynamic
error.</p>
<p>If more than one operand of an expression raises an error, the
implementation may choose which error is raised by the expression.
For example, in this expression:</p>
<div class="exampleInner">
<pre>($x div $y) + xs:decimal($z)
</pre></div>
<p>both the sub-expressions <code>($x div $y)</code> and
<code>xs:decimal($z)</code> may raise an error. The implementation
may choose which error is raised by the " <code>+</code> "
expression. Once one operand raises an error, the implementation is
not required, but is permitted, to evaluate any other operands.</p>
<p>[ <a title="error value" id="dt-error-value" name="dt-error-value">Definition</a>
 : In addition to its identifying
QName, a dynamic error may also carry a descriptive string and one
or more additional values called <b>error values</b> .] An
implementation may provide a mechanism whereby an
application-defined error handler can process error values and
produce diagnostic messages.</p>
<p>A dynamic error may be raised by a <a title="built-in function" 
href="#dt-built-in-function">built-in function</a> or operator. For
example, the <code>div</code> operator raises an error if its
operands are <code>xs:decimal</code> values and its second operand
is equal to zero. Errors raised by built-in functions and operators
are defined in <a href="#xpath-functions-11">[XQuery <del 
class="diff-old">1.0</del> and XPath <del class="diff-old">2.0</del>
Functions and <del class="diff-old">Operators]</del> <ins 
class="diff-chg">Operators 1.1]</ins></a> .</p>
<p>A dynamic error can also be raised explicitly by calling the
<code>fn:error</code> function, which only raises an error and
never returns a value. This function is defined in <a 
href="#xpath-functions-11">[XQuery <del class="diff-old">1.0</del> and
XPath <del class="diff-old">2.0</del> Functions and <del 
class="diff-old">Operators]</del> <ins class="diff-chg">Operators
1.1]</ins></a> . For example, the following function call raises a
dynamic error, providing a QName that identifies the error, a
descriptive string, and a diagnostic value (assuming that the
prefix <code>app</code> is bound to a namespace containing
application-defined error codes):</p>
<div class="exampleInner">
<pre>fn:error(xs:QName("app:err057"), "Unexpected value", fn:string($v))
</pre></div>
</div>
<div class="div3">
<h4><a id="id-errors-and-opt" name="id-errors-and-opt"></a> 2.3.4
Errors and Optimization</h4>
<p>Because different implementations may choose to evaluate or
optimize an expression in different ways, certain aspects of the
detection and reporting of <a title="dynamic error" 
href="#dt-dynamic-error">dynamic errors</a> are <a title="implementation
 dependent" href="#dt-implementation-dependent">implementation-dependent</a>
 , as
described in this section.</p>
<p>An implementation is always free to evaluate the operands of an
operator in any order.</p>
<p>In some cases, a processor can determine the result of an
expression without accessing all the data that would be implied by
the formal expression semantics. For example, the formal
description of <a title="filter expression" href="#dt-filter-expression">filter
 expressions</a> suggests that
<code>$s[1]</code> should be evaluated by examining all the items
in sequence <code>$s</code> , and selecting all those that satisfy
the predicate <code>position()=1</code> . In practice, many
implementations will recognize that they can evaluate this
expression by taking the first item in the sequence and then
exiting. If <code>$s</code> is defined by an expression such as
<code>//book[author eq 'Berners-Lee']</code> , then this strategy
may avoid a complete scan of a large document and may therefore
greatly improve performance. However, a consequence of this
strategy is that a dynamic error or type error that would be
detected if the expression semantics were followed literally might
not be detected at all if the evaluation exits early. In this
example, such an error might occur if there is a <code>book</code>
element in the input data with more than one <code>author</code>
subelement.</p>
<p>The extent to which a processor may optimize its access to data,
at the cost of not detecting errors, is defined by the following
rules.</p>
<p>Consider an expression <em>Q</em> that has an operand
(sub-expression) <em>E</em> . In general the value of <em>E</em> is
a sequence. At an intermediate stage during evaluation of the
sequence, some of its items will be known and others will be
unknown. If, at such an intermediate stage of evaluation, a
processor is able to establish that there are only two possible
outcomes of evaluating <em>Q</em> , namely the value <em>V</em> or
an error, then the processor may deliver the result <em>V</em>
without evaluating further items in the operand <em>E</em> . For
this purpose, two values are considered to represent the same
outcome if their items are pairwise the same, where nodes are the
same if they have the same identity, and values are the same if
they are equal and have exactly the same type.</p>
<p>There is an exception to this rule: If a processor evaluates an
operand <em>E</em> (wholly or in part), then it is required to
establish that the actual value of the operand <em>E</em> does not
violate any constraints on its cardinality. For example, the
expression <code>$e eq 0</code> results in a type error if the
value of <code>$e</code> contains two or more items. A processor is
not allowed to decide, after evaluating the first item in the value
of <code>$e</code> and finding it equal to zero, that the only
possible outcomes are the value <code>true</code> or a type error
caused by the cardinality violation. It must establish that the
value of <code>$e</code> contains no more than one item.</p>
<p>These rules apply to all the operands of an expression
considered in combination: thus if an expression has two operands
<em>E1</em> and <em>E2</em> , it may be evaluated using any samples
of the respective sequences that satisfy the above rules.</p>
<p>The rules cascade: if <em>A</em> is an operand of <em>B</em> and
<em>B</em> is an operand of <em>C</em> , then the processor needs
to evaluate only a sufficient sample of <em>B</em> to determine the
value of <em>C</em> , and needs to evaluate only a sufficient
sample of <em>A</em> to determine this sample of <em>B</em> .</p>
<p>The effect of these rules is that the processor is free to stop
examining further items in a sequence as soon as it can establish
that further items would not affect the result except possibly by
causing an error. For example, the processor may return
<code>true</code> as the result of the expression <code>S1 =
S2</code> as soon as it finds a pair of equal values from the two
sequences.</p>
<p>Another consequence of these rules is that where none of the
items in a sequence contributes to the result of an expression, the
processor is not obliged to evaluate any part of the sequence.
Again, however, the processor cannot dispense with a required
cardinality check: if an empty sequence is not permitted in the
relevant context, then the processor must ensure that the operand
is not an empty sequence.</p>
<p>Examples:</p>
<ul>
<li>
<p>If an implementation can find (for example, by using an index)
that at least one item returned by <code>$expr1</code> in the
following example has the value <code>47</code> , it is allowed to
return <code>true</code> as the result of the <code>some</code>
expression, without searching for another item returned by
<code>$expr1</code> that would raise an error if it were
evaluated.</p>
<div class="exampleInner">
<pre>some $x in $expr1 satisfies $x = 47
</pre></div>
</li>
<li>
<p>In the following example, if an implementation can find (for
example, by using an index) the <code>product</code> element-nodes
that have an <code>id</code> child with the value <code>47</code> ,
it is allowed to return these nodes as the result of the <a title="path 
expression" href="#dt-path-expression">path expression</a> ,
without searching for another <code>product</code> node that would
raise an error because it has an <code>id</code> child whose value
is not an integer.</p>
<div class="exampleInner">
<pre>//product[id = 47]
</pre></div>
</li>
</ul>
<p>For a variety of reasons, including optimization,
implementations <del class="diff-old">are free to</del> <ins 
class="diff-chg">may</ins> rewrite expressions into <del 
class="diff-old">equivalent expressions.</del> <ins class="diff-chg">a
different form. There are a number of rules that limit the extent
of this freedom:</ins></p>
<ul>
<li>
<p>Other than the raising or not raising of errors, the result of
evaluating <del class="diff-old">an equivalent</del> <ins 
class="diff-chg">a rewritten</ins> expression must <ins class="diff-new">conform
 to the semantics defined in this specification
for the original expression.</ins></p>
<div class="note">
<p class="prefix"><b><ins class="diff-new">Note:</ins></b></p>
<p><ins class="diff-new">This allows an implementation to return a
result in cases where the original expression would have raised an
error, or to raise an error in cases where the original expression
would have returned a result. The main cases where this is likely
to arise in practice are (a) where a rewrite changes the order of
evaluation, such that a subexpression causing an error is evaluated
when the expression is written one way and is not evaluated when
the expression is written a different way, and (b) where
intermediate results of the evaluation cause overflow or other
out-of-range conditions.</ins></p>
</div>
<div class="note">
<p class="prefix"><b><ins class="diff-new">Note:</ins></b></p>
<p><ins class="diff-new">This rule does not mean that the result of
the expression will always</ins> be the same <ins class="diff-new">in 
non-error cases</ins> as <ins class="diff-new">if it
had not been rewritten, because there are many cases where</ins>
the result of <del class="diff-old">evaluating</del> <ins 
class="diff-chg">an expression is to some degree</ins> <a 
title="implementation dependent" href="#dt-implementation-dependent"><ins
 class="diff-chg">implementation-dependent</ins></a> <ins 
class="diff-chg">or</ins> <a title="implementation defined" 
href="#dt-implementation-defined"><ins class="diff-chg">implementation-defined</ins></a>
 .</p>
</div>
</li>
<li>
<p><ins class="diff-chg">Conditional and typeswitch expressions
must not raise a dynamic error in respect of subexpressions
occurring in a branch that is not selected, and must not return the
value delivered by a branch unless that branch is selected. Thus,
the following example must not raise a dynamic error if the
document</ins> <code><ins class="diff-chg">abc.xml</ins></code>
<ins class="diff-chg">does not exist:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
if (doc-available('abc.xml')) then doc('abc.xml') else ()
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-chg">As stated earlier, an expression must not
be rewritten to dispense with a required cardinality check: for
example,</ins> <code><ins class="diff-chg">string-length(//title)</ins></code>
 <ins class="diff-chg">must raise an error if the document contains more
 than
one title element.</ins></p>
</li>
<li>
<p><ins class="diff-chg">Expressions must not be rewritten in such
a way as to create or remove static errors. For example, there is a
rule that in casting a string to a QName the operand must be a
string literal. This rule applies to</ins> the original <ins 
class="diff-new">expression and not to any rewritten form of the</ins>
expression.</p>
</li>
</ul>
<p>Expression rewrite is illustrated by the following examples.</p>
<ul>
<li>
<p>Consider the expression <code>//part[color eq "Red"]</code> . An
implementation might choose to rewrite this expression as
<code>//part[color = "Red"][color eq "Red"]</code> . The
implementation might then process the expression as follows: First
process the " <code>=</code> " predicate by probing an index on
parts by color to quickly find all the parts that have a Red color;
then process the " <code>eq</code> " predicate by checking each of
these parts to make sure it has only a single color. The result
would be as follows:</p>
<ul>
<li>
<p>Parts that have exactly one color that is Red are returned.</p>
</li>
<li>
<p>If some part has color Red together with some other color, an
error is raised.</p>
</li>
<li>
<p>The existence of some part that has no color Red but has
multiple non-Red colors does not trigger an error.</p>
</li>
</ul>
</li>
<li>
<p>The expression in the following example cannot raise a casting
error if it is evaluated exactly as written (i.e., left to right).
Since neither predicate depends on the context position, an
implementation might choose to reorder the predicates to achieve
better performance (for example, by taking advantage of an index).
This reordering could cause the expression to raise an error.</p>
<div class="exampleInner">
<pre>$N[@x castable as xs:date][xs:date(@x) gt xs:date("2000-01-01")]
</pre></div>
<p>To avoid unexpected errors caused by expression rewrite, tests
that are designed to prevent dynamic errors should be expressed
using conditional <span class="xquery">or
<code>typeswitch</code></span> expressions. <del class="diff-old">Conditional
 and typeswitch expressions raise only
dynamic errors that occur in the branch that is actually selected.
Thus, unlike the previous</del> <ins class="diff-chg">For</ins>
example, the <del class="diff-old">following example cannot raise a
dynamic error if @x is not castable into an xs:date :</del>
<ins class="diff-chg">above expression can be written as
follows:</ins></p>
<div class="exampleInner">
<pre>$N[if (@x castable as xs:date)
   then xs:date(@x) gt xs:date("2000-01-01")
   else false()]
</pre></div>
</li>
</ul>
</div>
</div>
<div class="div2">
<h3><a id="id-important-concepts" name="id-important-concepts"></a>
2.4 Concepts</h3>
<p>This section explains some concepts that are important to the
processing of XQuery <ins class="diff-new">1.1</ins>
expressions.</p>
<div class="div3">
<h4><a id="id-document-order" name="id-document-order"></a> 2.4.1
Document Order</h4>
<p>An ordering called <b>document order</b> is defined among all
the nodes accessible during processing of a given <span class="xquery">query</span>
 , which may consist of one or more
<b>trees</b> (documents or fragments). Document order is defined in
<del class="diff-old">[XQuery/XPath</del> <a href="#xpath-datamodel-11"><ins
 class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> , and its definition is repeated
here for convenience. [ <a title="reverse document order" 
id="dt-reverse-document-order" name="dt-reverse-document-order">Definition</a>
 : The node ordering that
is the reverse of document order is called <b>reverse document
order</b> .]</p>
<p>Document order is a total ordering, although the relative order
of some nodes is <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a> . [
<a title="document order" id="dt-document-order" 
name="dt-document-order">Definition</a> : Informally, <b>document
order</b> is the order in which nodes appear in the XML
serialization of a document.] [ <a title="stable" id="stable" 
name="stable">Definition</a> : Document order is <b>stable</b> , which
means that the relative order of two nodes will not change during
the processing of a given <span class="xquery">query</span> , even
if this order is <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a> .]</p>
<p>Within a tree, document order satisfies the following
constraints:</p>
<ol class="enumar">
<li>
<p>The root node is the first node.</p>
</li>
<li>
<p>Every node occurs before all of its children and
descendants.</p>
</li>
<li>
<p>Attribute nodes immediately follow the element node with which
they are associated. The relative order of attribute nodes is
stable but <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a> .</p>
</li>
<li>
<p>The relative order of siblings is the order in which they occur
in the <code>children</code> property of their parent node.</p>
</li>
<li>
<p>Children and descendants occur before following siblings.</p>
</li>
</ol>
<p>The relative order of nodes in distinct trees is stable but
<a title="implementation dependent" href="#dt-implementation-dependent">implementation-dependent</a>
 ,
subject to the following constraint: If any node in a given tree T1
is before any node in a different tree T2, then all nodes in tree
T1 are before all nodes in tree T2.</p>
</div>
<div class="div3">
<h4><a id="id-atomization" name="id-atomization"></a> 2.4.2
Atomization</h4>
<p>The semantics of some XQuery <ins class="diff-new">1.1</ins>
operators depend on a process called <a title="atomization" 
href="#dt-atomization">atomization</a> . Atomization is applied to a
value when the value is used in a context in which a sequence of
atomic values is required. The result of atomization is either a
sequence of atomic values or a <a title="type error" 
href="#dt-type-error">type error</a> [err:FOTY0012]. [ <a 
title="atomization" id="dt-atomization" name="dt-atomization">Definition</a>
 : <b>Atomization</b> of a sequence
is defined as the result of invoking the <code>fn:data</code>
function on the sequence, as defined in <a href="#xpath-functions-11">[XQuery
 <del class="diff-old">1.0</del> and
XPath <del class="diff-old">2.0</del> Functions and <del 
class="diff-old">Operators]</del> <ins class="diff-chg">Operators
1.1]</ins></a> .]</p>
<p>The semantics of <code>fn:data</code> are repeated here for
convenience. The result of <code>fn:data</code> is the sequence of
atomic values produced by applying the following rules to each item
in the input sequence:</p>
<ul>
<li>
<p>If the item is an atomic value, it is returned.</p>
</li>
<li>
<p>If the item is a node, its <a title="typed value" 
href="#dt-typed-value">typed value</a> is returned (err:FOTY0012 is
raised if the node has no typed value.)</p>
</li>
<li>
<p><ins class="diff-new">If the item is a</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#dt-function-item"><ins 
class="diff-new">
function item</ins></a> <sup><small><ins class="diff-new">DM11</ins></small></sup>
 <ins class="diff-new">[err:FOTY0012] is raised.</ins></p>
</li>
</ul>
<p>Atomization is used in processing the following types of
expressions:</p>
<ul>
<li>
<p>Arithmetic expressions</p>
</li>
<li>
<p>Comparison expressions</p>
</li>
<li>
<p>Function calls and returns</p>
</li>
<li>
<p>Cast expressions</p>
</li>
<li>
<p>Constructor expressions for various kinds of nodes</p>
</li>
<li>
<p><code>order by</code> clauses in FLWOR expressions</p>
</li>
<li>
<p><code><ins class="diff-new">group by</ins></code> <ins 
class="diff-new">clauses in FLWOR expressions</ins></p>
</li>
<li>
<p><ins class="diff-new">Switch expressions</ins></p>
</li>
</ul>
</div>
<div class="div3">
<h4><a id="id-ebv" name="id-ebv"></a> 2.4.3 Effective Boolean
Value</h4>
<p>Under certain circumstances (listed below), it is necessary to
find the <a title="effective boolean value" href="#dt-ebv">effective 
boolean value</a> of a value. [ <a title="effective boolean value" 
id="dt-ebv" name="dt-ebv">Definition</a>
: The <b>effective boolean value</b> of a value is defined as the
result of applying the <code>fn:boolean</code> function to the
value, as defined in <a href="#xpath-functions-11">[XQuery
<del class="diff-old">1.0</del> and XPath <del class="diff-old">2.0</del>
 Functions and <del class="diff-old">Operators]</del> <ins 
class="diff-chg">Operators
1.1]</ins></a> .]</p>
<p>The dynamic semantics of <code>fn:boolean</code> are repeated
here for convenience:</p>
<ol class="enumar">
<li>
<p>If its operand is an empty sequence, <code>fn:boolean</code>
returns <code>false</code> .</p>
</li>
<li>
<p>If its operand is a sequence whose first item is a node,
<code>fn:boolean</code> returns <code>true</code> .</p>
</li>
<li>
<p>If its operand is a <a title="singleton" href="#dt-singleton">singleton</a>
 value of type <code>xs:boolean</code>
or derived from <code>xs:boolean</code> , <code>fn:boolean</code>
returns the value of its operand unchanged.</p>
</li>
<li>
<p>If its operand is a <a title="singleton" href="#dt-singleton">singleton</a>
 value of type <code>xs:string</code>
, <code>xs:anyURI</code> , <code>xs:untypedAtomic</code> , or a
type derived from one of these, <code>fn:boolean</code> returns
<code>false</code> if the operand value has zero length; otherwise
it returns <code>true</code> .</p>
</li>
<li>
<p>If its operand is a <a title="singleton" href="#dt-singleton">singleton</a>
 value of any <a title="numeric" href="#dt-numeric">numeric</a> type or 
derived from a numeric type,
<code>fn:boolean</code> returns <code>false</code> if the operand
value is <code>NaN</code> or is numerically equal to zero;
otherwise it returns <code>true</code> .</p>
</li>
<li>
<p>In all other cases, <code>fn:boolean</code> raises a type error
[err:FORG0006].</p>
</li>
</ol>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The <del class="diff-old">static semantics of fn:boolean are
defined in Section 7.2.4 The fn:boolean function FS . Note:
The</del> <a title="effective boolean value" href="#dt-ebv">effective 
boolean value</a> of a sequence that contains
at least one node and at least one atomic value may be
nondeterministic in regions of a query where <a title="ordering mode" 
href="#dt-ordering-mode">ordering mode</a> is
<code>unordered</code> .</p>
</div>
<p>The <a title="effective boolean value" href="#dt-ebv">effective
boolean value</a> of a sequence is computed implicitly during
processing of the following types of expressions:</p>
<ul>
<li>
<p>Logical expressions ( <code>and</code> , <code>or</code> )</p>
</li>
<li>
<p>The <code>fn:not</code> function</p>
</li>
<li>
<p>The <code>where</code> clause of a FLWOR expression</p>
</li>
<li>
<p>Certain types of <a title="" href="#dt-predicate">predicates</a>
, such as <code>a[b]</code></p>
</li>
<li>
<p>Conditional expressions ( <code>if</code> )</p>
</li>
<li>
<p>Quantified expressions ( <code>some</code> , <code>every</code>
)</p>
</li>
</ul>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The definition of <a title="effective boolean value" href="#dt-ebv">effective
 boolean value</a> is <em>not</em> used when
casting a value to the type <code>xs:boolean</code> , for example
in a <code>cast</code> expression or when passing a value to a
function whose expected parameter is of type
<code>xs:boolean</code> .</p>
</div>
</div>
<div class="div3">
<h4><a id="id-input-sources" name="id-input-sources"></a> 2.4.4
Input Sources</h4>
<p>XQuery <ins class="diff-new">1.1</ins> has a set of functions
that provide access to input data. These functions are of
particular importance because they provide a way in which an
expression can reference a document or a collection of documents.
The input functions are described informally here; they are defined
in <a href="#xpath-functions-11">[XQuery <del class="diff-old">1.0</del>
 and XPath <del class="diff-old">2.0</del>
Functions and <del class="diff-old">Operators]</del> <ins 
class="diff-chg">Operators 1.1]</ins></a> .</p>
<p>An expression can access input data either by calling one of the
input functions or by referencing some part of the <a title="dynamic 
context" href="#dt-dynamic-context">dynamic context</a>
that is initialized by the external environment, such as a
<a title="variable values" href="#dt-variable-values">variable</a>
or <a title="context item" href="#dt-context-item">context item</a>
.</p>
<p>The input functions supported by XQuery <ins class="diff-new">1.1</ins>
 are as follows:</p>
<ul>
<li>
<p>The <code>fn:doc</code> function takes a string containing a
URI. If that URI is associated with a document in <a title="available 
documents" href="#dt-available-docs">available
documents</a> , <code>fn:doc</code> returns a document node whose
content is the <a title="data model" href="#dt-datamodel">data
model</a> representation of the given document; otherwise it raises
a <a title="dynamic error" href="#dt-dynamic-error">dynamic
error</a> (see <a href="#xpath-functions-11">[XQuery <del 
class="diff-old">1.0</del> and XPath <del class="diff-old">2.0</del>
Functions and <del class="diff-old">Operators]</del> <ins 
class="diff-chg">Operators 1.1]</ins></a> for details).</p>
</li>
<li>
<p>The <code>fn:collection</code> function with one argument takes
a string containing a URI. If that URI is associated with a
collection in <a title="available collections" 
href="#dt-available-collections">available collections</a> ,
<code>fn:collection</code> returns the data model representation of
that collection; otherwise it raises a <a title="dynamic error" 
href="#dt-dynamic-error">dynamic error</a> (see <a 
href="#xpath-functions-11">[XQuery <del class="diff-old">1.0</del> and
XPath <del class="diff-old">2.0</del> Functions and <del 
class="diff-old">Operators]</del> <ins class="diff-chg">Operators
1.1]</ins></a> for details). A collection may be any sequence of
nodes. For example, the expression
<code>fn:collection("http://example.org")//customer</code>
identifies all the <code>customer</code> elements that are
descendants of nodes found in the collection whose URI is
<code>http://example.org</code> .</p>
</li>
<li>
<p>The <code>fn:collection</code> function with zero arguments
returns the <a title="default collection" href="#dt-default-collection">default
 collection</a> , an <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a>
sequence of nodes.</p>
</li>
</ul>
</div>
<div class="div3">
<h4><a id="id-uri-literals" name="id-uri-literals"></a> 2.4.5 URI
Literals</h4>
<p>In certain places in the XQuery grammar, a statically known
valid URI is required. These places are denoted by the grammatical
symbol <a href="#doc-xquery11-URILiteral">URILiteral</a> . For
example, URILiterals are used to specify namespaces and collations,
both of which must be statically known.</p>
<h5><a id="N11297" name="N11297"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-URILiteral" name="doc-xquery11-URILiteral"></a> <del
 class="diff-old">[140]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[195]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-URILiteral">URILiteral</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-StringLiteral">StringLiteral</a></code></td>
</tr>
</tbody>
</table>
<p>Syntactically, a URILiteral is identical to a <a 
href="#doc-xquery11-StringLiteral">StringLiteral</a> : a sequence of
zero or more characters enclosed in single or double quotes.
However, an implementation <del class="diff-old">MAY</del>
<ins class="diff-chg">may</ins> raise a <a title="static error" 
href="#dt-static-error">static error</a> [ <a title="err:XQST0046" 
href="#ERRXQST0046">err:XQST0046</a> ] if the value of a URILiteral
is of nonzero length and is not in the lexical space of
<code>xs:anyURI</code> .</p>
<p>As in a string literal, any <a title="predefined entity reference" 
href="#dt-predefined-entity-reference">predefined entity reference</a>
(such as <code>&amp;amp;</code> ), <a title="character reference" 
href="#dt-character-reference">character reference</a> (such as
<code>&amp;#x2022;</code> ), or <a href="#doc-xquery11-EscapeQuot">EscapeQuot</a>
 or <a href="#doc-xquery11-EscapeApos">EscapeApos</a> (for example,
<code>""</code> ) is replaced by its appropriate expansion. Certain
characters, notably the ampersand, can only be represented using a
<a title="predefined entity reference" 
href="#dt-predefined-entity-reference">predefined entity reference</a>
or a <a title="character reference" href="#dt-character-reference">character
 reference</a> .</p>
<p>The URILiteral is subjected to whitespace normalization as
defined for the <code>xs:anyURI</code> type in <a href="#XMLSchema">[XML
 Schema]</a> : this means that leading and
trailing whitespace is removed, and any other sequence of
whitespace characters is replaced by a single space (#x20)
character. Whitespace normalization is done after the expansion of
<a title="character reference" href="#dt-character-reference">character 
references</a> , so writing a
newline (for example) as <code>&amp;#xA;</code> does not prevent
its being normalized to a space character.</p>
<p>The URILiteral is not automatically subjected to
percent-encoding or decoding as defined in <a href="#RFC3986">[RFC3986]</a>
 . Any process that attempts to resolve the
URI against a base URI, or to dereference the URI, may however
apply percent-encoding or decoding as defined in the relevant
RFCs.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The <code>xs:anyURI</code> type is designed to anticipate the
introduction of Internationalized Resource Identifiers (IRI's) as
defined in <a href="#RFC3987">[RFC3987]</a> .</p>
</div>
<p>The following is an example of a valid URILiteral:</p>
<div class="exampleInner">
<pre>"http://www.w3.org/2005/xpath-functions/collation/codepoint"
</pre></div>
</div>
</div>
<div class="div2">
<h3><a id="id-types" name="id-types"></a> 2.5 Types</h3>
<p>The type system of XQuery <ins class="diff-new">1.1</ins> is
based on <a href="#XMLSchema">[XML Schema] <del class="diff-old">,
and is formally defined in [XQuery 1.0 and XPath 2.0 Formal
Semantics]</del></a> .</p>
<p>[ <a title="sequence type" id="dt-sequence-type" 
name="dt-sequence-type">Definition</a> : A <b>sequence type</b> is a
type that can be expressed using the <a 
href="#doc-xquery11-SequenceType">SequenceType</a> syntax. Sequence
types are used whenever it is necessary to refer to a type in an
XQuery <ins class="diff-new">1.1</ins> expression. The term
<b>sequence type</b> suggests that this syntax is used to describe
the type of an XQuery <ins class="diff-new">1.1</ins> value, which
is always a sequence.]</p>
<p>[ <a title="schema type" id="dt-schema-type" name="dt-schema-type">Definition</a>
 : A <b>schema type</b> is a type
that is (or could be) defined using the facilities of <a 
href="#XMLSchema">[XML Schema]</a> (including the built-in types of
<a href="#XMLSchema">[XML Schema]</a> ).] A schema type can be used
as a type annotation on an element or attribute node (unless it is
a non-instantiable type such as <code>xs:NOTATION</code> or
<code>xs:anyAtomicType</code> , in which case its derived types can
be so used). Every schema type is either a <b>complex type</b> or a
<b>simple type</b> ; simple types are further subdivided into
<b>list types</b> , <b>union types</b> , and <b>atomic types</b>
(see <a href="#XMLSchema">[XML Schema]</a> for definitions and
explanations of these terms.)</p>
<p>Atomic types represent the intersection between the categories
of <a title="sequence type" href="#dt-sequence-type">sequence
type</a> and <a title="schema type" href="#dt-schema-type">schema
type</a> . An atomic type, such as <code>xs:integer</code> or
<code>my:hatsize</code> , is both a <a title="sequence type" 
href="#dt-sequence-type">sequence type</a> and a <a title="schema type" 
href="#dt-schema-type">schema type</a> .</p>
<div class="div3">
<h4><a id="id-predefined-types" name="id-predefined-types"></a>
2.5.1 Predefined Schema Types</h4>
<p class="xquery">The <a title="in-scope schema type" 
href="#dt-is-types">in-scope schema types</a> in the <a title="static 
context" href="#dt-static-context">static context</a> are
initialized with certain predefined schema types, including the
built-in schema types in the namespace
<code>http://www.w3.org/2001/XMLSchema</code> , which has the
predefined namespace prefix <code>xs</code> . The schema types in
this namespace are defined in <a href="#XMLSchema">[XML Schema]</a>
and augmented by additional types defined in <del class="diff-old">[XQuery/XPath</del>
 <a href="#xpath-datamodel-11"><ins class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> . Element and attribute
declarations in the <code>xs</code> namespace are not implicitly
included in the static context. The schema types defined in
<del class="diff-old">[XQuery/XPath</del> <a href="#xpath-datamodel-11"><ins
 class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> are summarized below.</p>
<ol class="enumar">
<li>
<p>[ <a title="xs:untyped" id="dt-untyped" name="dt-untyped">Definition</a>
 : <code>xs:untyped</code> is used as
the <a title="type annotation" href="#dt-type-annotation">type
annotation</a> of an element node that has not been validated, or
has been validated in <code>skip</code> mode.] No predefined schema
types are derived from <code>xs:untyped</code> .</p>
</li>
<li>
<p>[ <a title="xs:untypedAtomic" id="dt-untypedAtomic" 
name="dt-untypedAtomic">Definition</a> : <code>xs:untypedAtomic</code>
is an atomic type that is used to denote untyped atomic data, such
as text that has not been assigned a more specific type.] An
attribute that has been validated in <code>skip</code> mode is
represented in the <a title="data model" href="#dt-datamodel">data
model</a> by an attribute node with the <a title="type annotation" 
href="#dt-type-annotation">type annotation</a>
<code>xs:untypedAtomic</code> . No predefined schema types are
derived from <code>xs:untypedAtomic</code> .</p>
</li>
<li>
<p>[ <a title="xs:dayTimeDuration" id="dt-dayTimeDuration" 
name="dt-dayTimeDuration">Definition</a> :
<code>xs:dayTimeDuration</code> is derived by restriction from
<code>xs:duration</code> . The lexical representation of
<code>xs:dayTimeDuration</code> is restricted to contain only day,
hour, minute, and second components.]</p>
</li>
<li>
<p>[ <a title="xs:yearMonthDuration" id="dt-yearMonthDuration" 
name="dt-yearMonthDuration">Definition</a> :
<code>xs:yearMonthDuration</code> is derived by restriction from
<code>xs:duration</code> . The lexical representation of
<code>xs:yearMonthDuration</code> is restricted to contain only
year and month components.]</p>
</li>
<li>
<p>[ <a title="xs:anyAtomicType" id="dt-anyAtomicType" 
name="dt-anyAtomicType">Definition</a> : <code>xs:anyAtomicType</code>
is an atomic type that includes all atomic values (and no values
that are not atomic). Its base type is
<code>xs:anySimpleType</code> from which all simple types,
including atomic, list, and union types, are derived. All primitive
atomic types, such as <code><del class="diff-old">xs:integer ,
xs:string ,</del> <ins class="diff-chg">xs:decimal</ins></code> and
<code><del class="diff-old">xs:untypedAtomic</del> <ins class="diff-chg">xs:string</ins></code>
 , have
<code>xs:anyAtomicType</code> as their base type.]</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p><code>xs:anyAtomicType</code> will not appear as the type of an
actual value in an <a title="XDM instance" 
href="#dt-data-model-instance">XDM instance</a> .</p>
</div>
</li>
</ol>
<p>The relationships among the schema types in the <code>xs</code>
namespace are illustrated in Figure 2. A more complete description
of the XQuery <ins class="diff-new">1.1</ins> type hierarchy can be
found in <a href="#xpath-functions-11">[XQuery <del class="diff-old">1.0</del>
 and XPath <del class="diff-old">2.0</del>
Functions and <del class="diff-old">Operators]</del> <ins 
class="diff-chg">Operators 1.1]</ins></a> .</p>
<img src="xquery-11-diffs_files/types.html" alt="Type Hierarchy Diagram">
<p>Figure 2: Hierarchy of Schema Types used in XQuery <ins 
class="diff-new">1.1.</ins></p>
</div>
<div class="div3">
<h4><a id="id-typed-value" name="id-typed-value"></a> 2.5.2 Typed
Value and String Value</h4>
<p>Every node has a <b>typed value</b> and a <b>string value</b> .
[ <a title="typed value" id="dt-typed-value" name="dt-typed-value">Definition</a>
 : The <b>typed value</b> of a node
is a sequence of atomic values and can be extracted by applying the
<code>fn:data</code> function to the node.] [ <a title="string value" 
id="dt-string-value" name="dt-string-value">Definition</a> : The <b>string
 value</b> of a
node is a string and can be extracted by applying the
<code>fn:string</code> function to the node.] Definitions of
<code>fn:data</code> and <code>fn:string</code> can be found in
<a href="#xpath-functions-11">[XQuery <del class="diff-old">1.0</del> 
and XPath <del class="diff-old">2.0</del>
Functions and <del class="diff-old">Operators]</del> <ins 
class="diff-chg">Operators 1.1]</ins></a> .</p>
<p>An implementation may store both the <a title="typed value" 
href="#dt-typed-value">typed value</a> and the <a title="string value" 
href="#dt-string-value">string value</a> of a node,
or it may store only one of these and derive the other as needed.
The string value of a node must be a valid lexical representation
of the typed value of the node, but the node is not required to
preserve the string representation from the original source
document. For example, if the typed value of a node is the
<code>xs:integer</code> value <code>30</code> , its string value
might be " <code>30</code> " or " <code>0030</code> ".</p>
<p class="xquery">The <a title="typed value" href="#dt-typed-value">typed
 value</a> , <a title="string value" href="#dt-string-value">string 
value</a> , and <a title="type annotation" href="#dt-type-annotation">type
 annotation</a> of
a node are closely related, and are defined by rules found in the
following locations:</p>
<ul>
<li>
<p>If the node was created by mapping from an Infoset or PSVI, see
rules in <del class="diff-old">[XQuery/XPath</del> <a 
href="#xpath-datamodel-11"><ins class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> .</p>
</li>
<li>
<p>If the node was created by an XQuery node constructor, see rules
in <a href="#id-element-constructor"><b><del class="diff-old">3.7.1</del>
 <ins class="diff-chg">3.8.1</ins> Direct
Element Constructors</b></a> , <a href="#id-computedElements"><b><del 
class="diff-old">3.7.3.1</del>
<ins class="diff-chg">3.8.3.1</ins> Computed Element
Constructors</b></a> , or <a href="#id-computedAttributes"><b><del 
class="diff-old">3.7.3.2</del>
<ins class="diff-chg">3.8.3.2</ins> Computed Attribute
Constructors</b></a> .</p>
</li>
<li>
<p>If the node was created by a <code>validate</code> expression,
see rules in <a href="#id-validate"><b><del class="diff-old">3.13</del> <ins
 class="diff-chg">3.16</ins> Validate
Expressions</b></a> .</p>
</li>
</ul>
<p>As a convenience to the reader, the relationship between
<a title="typed value" href="#dt-typed-value">typed value</a> and
<a title="string value" href="#dt-string-value">string value</a>
for various kinds of nodes is summarized and illustrated by
examples below.</p>
<ol class="enumar">
<li>
<p>For text and document nodes, the typed value of the node is the
same as its string value, as an instance of the type
<code>xs:untypedAtomic</code> . The string value of a document node
is formed by concatenating the string values of all its descendant
text nodes, in <a title="document order" href="#dt-document-order">document
 order</a> .</p>
</li>
<li>
<p>The typed value of a comment or processing instruction node is
the same as its string value. It is an instance of the type
<code>xs:string</code> .</p>
</li>
<li>
<p>The typed value of an attribute node with the <a title="type 
annotation" href="#dt-type-annotation">type annotation</a>
<code>xs:anySimpleType</code> or <code>xs:untypedAtomic</code> is
the same as its string value, as an instance of
<code>xs:untypedAtomic</code> . The typed value of an attribute
node with any other type annotation is derived from its string
value and type annotation using the lexical-to-value-space mapping
defined in <a href="#XMLSchema">[XML Schema]</a> Part 2 for the
relevant type.</p>
<p>Example: A1 is an attribute having string value
<code>"3.14E-2"</code> and type annotation <code>xs:double</code> .
The typed value of A1 is the <code>xs:double</code> value whose
lexical representation is <code>3.14E-2</code> .</p>
<p>Example: A2 is an attribute with type annotation
<code>xs:IDREFS</code> , which is a list datatype whose item type
is the atomic datatype <code>xs:IDREF</code> . Its string value is
" <code>bar baz faz</code> ". The typed value of A2 is a sequence
of three atomic values (" <code>bar</code> ", " <code>baz</code> ",
" <code>faz</code> "), each of type <code>xs:IDREF</code> . The
typed value of a node is never treated as an instance of a named
list type. Instead, if the type annotation of a node is a list type
(such as <code>xs:IDREFS</code> ), its typed value is treated as a
sequence of the atomic type from which it is derived (such as
<code>xs:IDREF</code> ).</p>
</li>
<li>
<p>For an element node, the relationship between typed value and
string value depends on the node's <a title="type annotation" 
href="#dt-type-annotation">type annotation</a> , as follows:</p>
<ol class="enumla">
<li>
<p>If the type annotation is <code>xs:untyped</code> or
<code>xs:anySimpleType</code> or denotes a complex type with mixed
content (including <code>xs:anyType</code> ), then the typed value
of the node is equal to its string value, as an instance of
<code>xs:untypedAtomic</code> . However, if the <code>nilled</code>
property of the node is <code>true</code> , then its typed value is
the empty sequence.</p>
<p>Example: E1 is an element node having type annotation
<code>xs:untyped</code> and string value " <code>1999-05-31</code>
". The typed value of E1 is " <code>1999-05-31</code> ", as an
instance of <code>xs:untypedAtomic</code> .</p>
<p>Example: E2 is an element node with the type annotation
<code>formula</code> , which is a complex type with mixed content.
The content of E2 consists of the character " <code>H</code> ", a
child element named <code>subscript</code> with string value "
<code>2</code> ", and the character " <code>O</code> ". The typed
value of E2 is " <code>H2O</code> " as an instance of
<code>xs:untypedAtomic</code> .</p>
</li>
<li>
<p>If the type annotation denotes a simple type or a complex type
with simple content, then the typed value of the node is derived
from its string value and its type annotation in a way that is
consistent with schema validation. However, if the
<code>nilled</code> property of the node is <code>true</code> ,
then its typed value is the empty sequence.</p>
<p>Example: E3 is an element node with the type annotation
<code>cost</code> , which is a complex type that has several
attributes and a simple content type of <code>xs:decimal</code> .
The string value of E3 is " <code>74.95</code> ". The typed value
of E3 is <code>74.95</code> , as an instance of
<code>xs:decimal</code> .</p>
<p>Example: E4 is an element node with the type annotation
<code>hatsizelist</code> , which is a simple type derived from the
atomic type <code>hatsize</code> , which in turn is derived from
<code>xs:integer</code> . The string value of E4 is " <code>7 8
9</code> ". The typed value of E4 is a sequence of three values (
<code>7</code> , <code>8</code> , <code>9</code> ), each of type
<code>hatsize</code> .</p>
<p>Example: E5 is an element node with the type annotation
<code>my:integer-or-string</code> which is a union type with member
types <code>xs:integer</code> and <code>xs:string</code> . The
string value of E5 is " <code>47</code> ". The typed value of E5 is
<code>47</code> as an <code>xs:integer</code> , since
<code>xs:integer</code> is the member type that validated the
content of E5. In general, when the type annotation of a node is a
union type, the typed value of the node will be an instance of one
of the member types of the union.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>If an implementation stores only the string value of a node, and
the type annotation of the node is a union type, the implementation
must be able to deliver the typed value of the node as an instance
of the appropriate member type.</p>
</div>
</li>
<li>
<p>If the type annotation denotes a complex type with empty
content, then the typed value of the node is the empty sequence and
its string value is the zero-length string.</p>
</li>
<li>
<p>If the type annotation denotes a complex type with element-only
content, then the typed value of the node is undefined. The
<code>fn:data</code> function raises a <a title="type error" 
href="#dt-type-error">type error</a> [err:FOTY0012] when applied to such
a node. The string value of such a node is equal to the
concatenated string values of all its text node descendants, in
document order.</p>
<p>Example: E6 is an element node with the type annotation
<code>weather</code> , which is a complex type whose content type
specifies <code>element-only</code> . E6 has two child elements
named <code>temperature</code> and <code>precipitation</code> . The
typed value of E6 is undefined, and the <code>fn:data</code>
function applied to E6 raises an error.</p>
</li>
</ol>
</li>
</ol>
</div>
<div class="div3">
<h4><a id="id-sequencetype-syntax" name="id-sequencetype-syntax"></a> 
2.5.3 SequenceType Syntax</h4>
<p>Whenever it is necessary to refer to a type in an XQuery
<ins class="diff-new">1.1</ins> expression, the <a 
href="#doc-xquery11-SequenceType">SequenceType</a> syntax is used.</p>
<h5><a id="N11588" name="N11588"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-SequenceType" name="doc-xquery11-SequenceType"></a>
 <del class="diff-old">[119]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[169]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-SequenceType">SequenceType</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>("empty-sequence" "(" ")")<br>
| ( <a href="#doc-xquery11-ItemType">ItemType</a> <a 
href="#doc-xquery11-OccurrenceIndicator">OccurrenceIndicator</a>
?)</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ItemType" name="doc-xquery11-ItemType"></a>
<del class="diff-old">[121]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[171]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ItemType">ItemType</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-KindTest">KindTest</a> | ("item"
"(" ")") | <a href="#doc-xquery11-FunctionTest"><ins class="diff-chg">FunctionTest</ins></a>
 <ins class="diff-chg">|</ins>
<a href="#doc-xquery11-AtomicType">AtomicType</a> <ins class="diff-new">|</ins>
 <a href="#doc-xquery11-ParenthesizedItemType"><ins class="diff-new">ParenthesizedItemType</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-OccurrenceIndicator" 
name="doc-xquery11-OccurrenceIndicator"></a> <del class="diff-old">[120]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[170]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-OccurrenceIndicator">OccurrenceIndicator</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"?" | "*" | "+"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-AtomicType" name="doc-xquery11-AtomicType"></a> <del
 class="diff-old">[122]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[172]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-AtomicType">AtomicType</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">QName</del> <a 
href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-KindTest" name="doc-xquery11-KindTest"></a>
<del class="diff-old">[123]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[173]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-KindTest">KindTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-DocumentTest">DocumentTest</a><br>
| <a href="#doc-xquery11-ElementTest">ElementTest</a><br>
| <a href="#doc-xquery11-AttributeTest">AttributeTest</a><br>
| <a href="#doc-xquery11-SchemaElementTest">SchemaElementTest</a><br>
| <a href="#doc-xquery11-SchemaAttributeTest">SchemaAttributeTest</a><br>
| <a href="#doc-xquery11-PITest">PITest</a><br>
| <a href="#doc-xquery11-CommentTest">CommentTest</a><br>
| <a href="#doc-xquery11-TextTest">TextTest</a><br>
| <a href="#prod-xquery11-NamespaceNodeTest"><ins class="diff-chg">NamespaceNodeTest</ins></a><br>
<ins class="diff-chg">|</ins> <a href="#doc-xquery11-AnyKindTest">AnyKindTest</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-DocumentTest" name="doc-xquery11-DocumentTest"></a>
 <del class="diff-old">[125]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[175]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-DocumentTest">DocumentTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"document-node" "(" ( <a href="#doc-xquery11-ElementTest">ElementTest</a>
 | <a href="#doc-xquery11-SchemaElementTest">SchemaElementTest</a> )?
")"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ElementTest" name="doc-xquery11-ElementTest"></a>
 <del class="diff-old">[133]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[184]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ElementTest">ElementTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"element" "(" ( <a href="#doc-xquery11-ElementNameOrWildcard">ElementNameOrWildcard</a>
("," <a href="#doc-xquery11-TypeName">TypeName</a> "?"?)?)?
")"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-SchemaElementTest" 
name="doc-xquery11-SchemaElementTest"></a> <del class="diff-old">[135]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[186]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-SchemaElementTest">SchemaElementTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"schema-element" "(" <a 
href="#doc-xquery11-ElementDeclaration">ElementDeclaration</a>
")"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ElementDeclaration" 
name="doc-xquery11-ElementDeclaration"></a> <del class="diff-old">[136]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[187]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ElementDeclaration">ElementDeclaration</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-ElementName">ElementName</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-AttributeTest" name="doc-xquery11-AttributeTest"></a>
 <del class="diff-old">[129]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[180]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-AttributeTest">AttributeTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"attribute" "(" ( <a href="#doc-xquery11-AttribNameOrWildcard">AttribNameOrWildcard</a>
 (","
<a href="#doc-xquery11-TypeName">TypeName</a> )?)? ")"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-SchemaAttributeTest" 
name="doc-xquery11-SchemaAttributeTest"></a> <del class="diff-old">[131]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[182]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-SchemaAttributeTest">SchemaAttributeTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"schema-attribute" "(" <a 
href="#doc-xquery11-AttributeDeclaration">AttributeDeclaration</a>
")"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-AttributeDeclaration" 
name="doc-xquery11-AttributeDeclaration"></a> <del class="diff-old">[132]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[183]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-AttributeDeclaration">AttributeDeclaration</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-AttributeName">AttributeName</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ElementNameOrWildcard" 
name="doc-xquery11-ElementNameOrWildcard"></a> <del class="diff-old">[134]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[185]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ElementNameOrWildcard">ElementNameOrWildcard</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-ElementName">ElementName</a> |
"*"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ElementName" name="doc-xquery11-ElementName"></a>
 <del class="diff-old">[138]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[189]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ElementName">ElementName</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">QName</del> <a 
href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-AttribNameOrWildcard" 
name="doc-xquery11-AttribNameOrWildcard"></a> <del class="diff-old">[130]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[181]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-AttribNameOrWildcard">AttribNameOrWildcard</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-AttributeName">AttributeName</a> |
"*"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-AttributeName" name="doc-xquery11-AttributeName"></a>
 <del class="diff-old">[137]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[188]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-AttributeName">AttributeName</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">QName</del> <a 
href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-TypeName" name="doc-xquery11-TypeName"></a>
<del class="diff-old">[139]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[190]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-TypeName">TypeName</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">QName</del> <a 
href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-PITest" name="doc-xquery11-PITest"></a>
<del class="diff-old">[128]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[179]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-PITest">PITest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"processing-instruction" "(" ( <a href="#prod-xquery11-NCName">NCName</a>
 | <a href="#doc-xquery11-StringLiteral">StringLiteral</a> )? ")"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CommentTest" name="doc-xquery11-CommentTest"></a>
 <del class="diff-old">[127]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[177]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CommentTest">CommentTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"comment" "(" ")"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-TextTest" name="doc-xquery11-TextTest"></a>
<del class="diff-old">[126]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[176]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-TextTest">TextTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"text" "(" ")"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-AnyKindTest" name="doc-xquery11-AnyKindTest"></a>
 <del class="diff-old">[124]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[174]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-AnyKindTest">AnyKindTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"node" "(" ")"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-FunctionTest" name="doc-xquery11-FunctionTest"></a>
 <ins class="diff-new">[191]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-FunctionTest"><ins class="diff-new">FunctionTest</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-Annotation"><ins class="diff-new">Annotation</ins></a>
 <ins class="diff-new">* (</ins>
<a href="#doc-xquery11-AnyFunctionTest"><ins class="diff-new">AnyFunctionTest</ins></a><br>
<ins class="diff-new">|</ins> <a href="#doc-xquery11-TypedFunctionTest"><ins
 class="diff-new">TypedFunctionTest</ins></a> <ins class="diff-new">)</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-AnyFunctionTest" 
name="doc-xquery11-AnyFunctionTest"></a><ins class="diff-new">[192]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-AnyFunctionTest"><ins class="diff-new">AnyFunctionTest</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"function" "(" "*"
")"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-TypedFunctionTest" 
name="doc-xquery11-TypedFunctionTest"></a><ins class="diff-new">[193]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-TypedFunctionTest"><ins 
class="diff-new">TypedFunctionTest</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"function" "(" (</ins> <a 
href="#doc-xquery11-SequenceType"><ins class="diff-new">SequenceType</ins></a>
 <ins class="diff-new">(","</ins>
<a href="#doc-xquery11-SequenceType"><ins class="diff-new">SequenceType</ins></a>
 <ins class="diff-new">)*)? ")"
"as"</ins> <a href="#doc-xquery11-SequenceType"><ins class="diff-new">SequenceType</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ParenthesizedItemType" 
name="doc-xquery11-ParenthesizedItemType"></a><ins class="diff-new">[194]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ParenthesizedItemType"><ins 
class="diff-new">ParenthesizedItemType</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"("</ins> <a 
href="#doc-xquery11-ItemType"><ins class="diff-new">ItemType</ins></a>
<ins class="diff-new">")"</ins></code></td>
</tr>
</tbody>
</table>
<p>With the exception of the special type
<code>empty-sequence()</code> , a <a title="sequence type" 
href="#dt-sequence-type">sequence type</a> consists of an <b>item
type</b> that constrains the type of each item in the sequence, and
a <b>cardinality</b> that constrains the number of items in the
sequence. Apart from the item type <code>item()</code> , which
permits any kind of item, item types divide into <b>node types</b>
(such as <code>element()</code> <del class="diff-old">) and</del>
<ins class="diff-chg">),</ins> <b>atomic types</b> (such as
<code>xs:integer</code> <del class="diff-old">).</del> <ins 
class="diff-chg">) and function types (such as function() as
item()*).</ins></p>
<p>Item types representing element and attribute nodes may specify
the required <a title="type annotation" href="#dt-type-annotation">type 
annotations</a> of those nodes, in the
form of a <a title="schema type" href="#dt-schema-type">schema
type</a> . Thus the item type <code>element(*, us:address)</code>
denotes any element node whose type annotation is (or is derived
from) the schema type named <code>us:address</code> .</p>
<p><ins class="diff-new">Any occurrence of '+' and '*', as well as
'?' immediately following a sequence type is assumed to be an
occurrence indicator, which binds to the last</ins> <a 
href="#doc-xquery11-ItemType"><ins class="diff-new">ItemType</ins></a>
<ins class="diff-new">in the</ins> <a href="#doc-xquery11-SequenceType"><ins
 class="diff-new">SequenceType</ins></a> ,<ins class="diff-new">as
described in</ins> <b><a href="#parse-note-occurrence-indicators"><ins 
class="diff-new">???</ins></a></b> .</p>
<p>Here are some examples of <a title="sequence type" 
href="#dt-sequence-type">sequence types</a> that might be used in XQuery
<ins class="diff-new">1.1</ins> expressions:</p>
<ul>
<li>
<p><code>xs:date</code> refers to the built-in atomic schema type
named <code>xs:date</code></p>
</li>
<li>
<p><code>attribute()?</code> refers to an optional attribute
node</p>
</li>
<li>
<p><code>element()</code> refers to any element node</p>
</li>
<li>
<p><code>element(po:shipto, po:address)</code> refers to an element
node that has the name <code>po:shipto</code> and has the type
annotation <code>po:address</code> (or a schema type derived from
<code>po:address</code> )</p>
</li>
<li>
<p><code>element(*, po:address)</code> refers to an element node of
any name that has the type annotation <code>po:address</code> (or a
type derived from <code>po:address</code> )</p>
</li>
<li>
<p><code>element(customer)</code> refers to an element node named
<code>customer</code> with any type annotation</p>
</li>
<li>
<p><code>schema-element(customer)</code> refers to an element node
whose name is <code>customer</code> (or is in the substitution
group headed by <code>customer</code> ) and whose type annotation
matches the schema type declared for a <code>customer</code>
element in the <a title="in-scope element declarations" 
href="#dt-is-elems">in-scope element declarations</a></p>
</li>
<li>
<p><code>node()*</code> refers to a sequence of zero or more nodes
of any kind</p>
</li>
<li>
<p><code>item()+</code> refers to a sequence of one or more nodes
or atomic values</p>
</li>
</ul>
<p><ins class="diff-new">Sequence types can also specify the type
of a</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#dt-function-item"><ins 
class="diff-new">
function item</ins></a> <sup><small><ins class="diff-new">DM11</ins></small></sup>
 ,<ins class="diff-new">including function annotations.</ins></p>
<ul>
<li>
<p><code><ins class="diff-new">function(*)</ins></code> <ins 
class="diff-new">refers to any</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#dt-function-item"><ins 
class="diff-new">
function item</ins></a> <sup><small><ins class="diff-new">DM11</ins></small></sup>
 ,<ins class="diff-new">regardless of arity or type</ins></p>
</li>
<li>
<p><code><ins class="diff-new">function(node()) as
xs:string*</ins></code> <ins class="diff-new">refers to a</ins>
<a href="http://www.w3.org/TR/xpath-datamodel-11/#dt-function-item"><ins
 class="diff-new">
function item</ins></a> <sup><small><ins class="diff-new">DM11</ins></small></sup>
 <ins class="diff-new">that
takes a single argument whose value is a single node, and returns a
sequence of zero or more xs:string values</ins></p>
</li>
<li>
<p><code><ins class="diff-new">(function(node()) as
xs:string)*</ins></code> <ins class="diff-new">refers to a sequence
of zero or more</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#dt-function-item"><ins 
class="diff-new">
function items</ins></a> <sup><small><ins class="diff-new">DM11</ins></small></sup>
 ,<ins class="diff-new">each of
which takes a single argument whose value is a single node, and
returns as its result a single xs:string value</ins></p>
</li>
</ul>
<p id="id-annotation-assertion"><ins class="diff-new">[</ins>
<a title="annotation assertion" id="dt-annotation-assertion" 
name="dt-annotation-assertion"><ins class="diff-new">Definition</ins></a>
 :<ins class="diff-new">If an
annotation is present in a FunctionTest, it is called an</ins>
<b><ins class="diff-new">annotation assertion</ins></b>
.]<ins class="diff-new">Annotation assertions further restrict the
set of function items that are matched by a</ins> <a 
href="#doc-xquery11-FunctionTest"><ins class="diff-new">FunctionTest</ins></a>
 .<ins class="diff-new">XQuery 1.1
defines two annotation assertions:</ins> <code><ins class="diff-new">%fn:deterministic</ins></code>
 <ins class="diff-new">matches function items that are deterministic.</ins>
<code><ins class="diff-new">%fn:nondeterministic</ins></code>
<ins class="diff-new">matches both function items that are
deterministic and function items that are not deterministic.
Implementations can define further annotation assertions, which are
implementation-defined. There are no annotation assertions that
correspond to the</ins> <code><ins class="diff-new">%public</ins></code>
 <ins class="diff-new">and</ins>
<code><ins class="diff-new">%private</ins></code> <ins class="diff-new">annotations.
 Annotation assertions are not automatically
defined as a side effect of creating an annotation.</ins></p>
<div class="note">
<p class="prefix"><b><ins class="diff-new">Note:</ins></b></p>
<p><ins class="diff-new">Other specifications in the XQuery family
will also use annotation assertions. For instance, in the XQuery
Update Facility,</ins> <code><ins class="diff-new">%fn:updating</ins></code>
 <ins class="diff-new">matches
function items with a</ins> <code><ins class="diff-new">%fn:simple</ins></code>
 <ins class="diff-new">or</ins>
<code><ins class="diff-new">%fn:updating</ins></code> <ins 
class="diff-new">annotation. In the XQuery Scripting Extension,</ins>
<code><ins class="diff-new">%fn:sequential</ins></code> <ins 
class="diff-new">matches function items with a</ins> <code><ins 
class="diff-new">%fn:simple</ins></code> <ins class="diff-new">or</ins>
<code><ins class="diff-new">%fn:sequential</ins></code> <ins 
class="diff-new">annotation, and</ins> <code><ins class="diff-new">%fn:simple</ins></code>
 <ins class="diff-new">matches
function items with a</ins> <code><ins class="diff-new">%fn:simple
annotation</ins></code> .<ins class="diff-new">If no</ins>
<code><ins class="diff-new">%fn:updating</ins></code> <ins 
class="diff-new">or</ins> <code><ins class="diff-new">%fn:sequential</ins></code>
 <ins class="diff-new">annotation assertion is present, this is the 
default
matching behaviour.</ins></p>
</div>
<p><ins class="diff-new">Implementations can provide a way for
XQuery users to create their own annotation assertions. Users
should avoid creating annotation assertions in the</ins>
<code><ins class="diff-new">fn</ins></code> <ins class="diff-new">namespace,
 since this namespace is reserved for future
language extensions.</ins></p>
</div>
<div class="div3">
<h4><a id="id-sequencetype-matching" name="id-sequencetype-matching"></a>
 2.5.4 SequenceType Matching</h4>
<p>[ <a title="SequenceType matching" id="dt-sequencetype-matching" 
name="dt-sequencetype-matching">Definition</a> : During evaluation
of an expression, it is sometimes necessary to determine whether a
value with a known <a title="dynamic type" href="#dt-dynamic-type">dynamic
 type</a> "matches" an expected <a title="sequence type" 
href="#dt-sequence-type">sequence type</a> . This
process is known as <b>SequenceType matching</b> .] For example, an
<code>instance of</code> expression returns <code>true</code> if
the <a title="dynamic type" href="#dt-dynamic-type">dynamic
type</a> of a given value matches a given <a title="sequence type" 
href="#dt-sequence-type">sequence type</a> , or <code>false</code>
if it does not.</p>
<p><a title="lexical QName" href="#dt-qname"><ins class="diff-new">Lexical</ins>
 QNames</a> appearing in a <a title="sequence type" 
href="#dt-sequence-type">sequence type</a> have
their prefixes expanded to namespace URIs by means of the <a 
title="statically known namespaces" href="#dt-static-namespaces">statically
 known namespaces</a> and (where
applicable) the <a title="default element/type namespace" 
href="#dt-def-elemtype-ns">default element/type namespace</a> . An
unprefixed attribute QName is in no namespace. Equality of QNames
is defined by the <code>eq</code> operator.</p>
<p>The rules for <a title="SequenceType matching" 
href="#dt-sequencetype-matching">SequenceType matching</a> compare the
<a title="dynamic type" href="#dt-dynamic-type">dynamic type</a> of
a value with an expected <a title="sequence type" 
href="#dt-sequence-type">sequence type</a> . <del class="diff-old">These
rules are a subset of the formal rules that match a value with an
expected type defined in [XQuery 1.0 and XPath 2.0 Formal
Semantics] , because the Formal Semantics must be able to match
values against types that are not expressible using the
SequenceType syntax.</del></p>
<p>Some of the rules for <a title="SequenceType matching" 
href="#dt-sequencetype-matching">SequenceType matching</a> require
determining whether a given schema type <ins class="diff-new">encountered
 as a type annotation in an instance
document</ins> is the same as or derived from an expected schema
type. <del class="diff-old">The given</del> <ins class="diff-chg">This 
determination is done by reference to a</ins>
schema <del class="diff-old">type may be "known" (defined in</del>
<em><ins class="diff-chg">S</ins></em> <ins class="diff-chg">(that
is, a set of schema components). This schema</ins> <em><ins 
class="diff-chg">S</ins></em> <ins class="diff-chg">is the union
of:</ins></p>
<ol class="enumar">
<li>
<p>the in-scope schema definitions <del class="diff-old">), or
"unknown" (not defined</del> in the <del class="diff-old">in-scope</del>
 <ins class="diff-chg">static context of
the query module</ins></p>
</li>
<li>
<p><ins class="diff-chg">potentially, the</ins> schema <del 
class="diff-old">definitions ). An unknown</del> <ins class="diff-chg">used
 for validating the instance document; whether a
processor adds this</ins> schema <ins class="diff-new">to</ins>
<em><ins class="diff-new">S</ins></em> <ins class="diff-new">is</ins> <a
 title="implementation defined" href="#dt-implementation-defined"><ins 
class="diff-new">implementation-defined</ins></a> .</p>
</li>
<li>
<p><ins class="diff-new">potentially, further schema components
that have been made available to the processor in an</ins>
<a title="implementation defined" href="#dt-implementation-defined"><ins
 class="diff-new">implementation-defined</ins></a> <ins class="diff-new">way.</ins></p>
</li>
</ol>
<p><ins class="diff-new">A</ins> type <del class="diff-old">might</del> <ins
 class="diff-chg">error [</ins>
<a title="err:XPTY0004" href="#ERRXPTY0004"><ins class="diff-chg">err:XPTY0004</ins></a>
 <ins class="diff-chg">] may</ins>
be <del class="diff-old">encountered, for example,</del>
<ins class="diff-chg">raised</ins> if <ins class="diff-new">this
union does not constitute</ins> a <del class="diff-old">source
document has been validated using a</del> <ins class="diff-chg">valid</ins>
 schema <del class="diff-old">that was not
imported into</del> <ins class="diff-chg">(for example, if there
are conflicts between types present in</ins> the static context
<del class="diff-old">. In this case, an implementation is allowed
(but is not required) to provide an implementation-dependent
mechanism</del> <ins class="diff-chg">and types used
dynamically</ins> for <del class="diff-old">determining
whether</del> <ins class="diff-chg">validating
instances.)</ins></p>
<p><ins class="diff-chg">Whether</ins> the <del class="diff-old">unknown</del>
 schema <del class="diff-old">type</del>
<ins class="diff-chg">used to validate the instance document</ins>
is <del class="diff-old">derived from</del> <ins class="diff-chg">in</ins>
 <em><ins class="diff-chg">S</ins></em>
<ins class="diff-chg">is implementation-defined. Whether</ins> the
<del class="diff-old">expected schema type. For example, an</del>
implementation <del class="diff-old">might maintain a data
dictionary containing information about type hierarchies.</del>
<ins class="diff-chg">provides further schema components in</ins>
<em><ins class="diff-chg">S</ins></em> <ins class="diff-chg">is
also implementation-defined.</ins></p>
<p>[ <a title="subtype substitution" id="dt-subtype-substitution" 
name="dt-subtype-substitution">Definition</a> : The use of a value
whose <a title="dynamic type" href="#dt-dynamic-type">dynamic
type</a> is derived from an expected type is known as <b>subtype
substitution</b> .] Subtype substitution does not change the actual
type of a value. For example, if an <code>xs:integer</code> value
is used where an <code>xs:decimal</code> value is expected, the
value retains its type as <code>xs:integer</code> .</p>
<p>The definition of <a title="SequenceType matching" 
href="#dt-sequencetype-matching">SequenceType matching</a> relies on a
pseudo-function named <code>derives-from(</code> <em><ins 
class="diff-new">AT</ins></em> ,<em><em><del class="diff-old">AT,</del>
ET</em></em> <code>)</code> , which takes an actual simple or
complex schema type <em>AT</em> and an expected simple or complex
schema type <em><em>ET <del class="diff-old">,</del></em></em>
<ins class="diff-chg">,</ins> and either returns a boolean value or
raises a <a title="type error" href="#dt-type-error">type error</a>
[ <a title="err:XPTY0004" href="#ERRXPTY0004">err:XPTY0004</a> ].
<del class="diff-old">The pseudo-function derives-from is defined
below and</del> <span><ins class="diff-chg">This function</ins> is
defined <del class="diff-old">formally in [XQuery 1.0 and XPath 2.0
Formal Semantics] .</del> <ins class="diff-chg">as
follows:</ins></span></p>
<ul>
<li>
<p><code>derives-from(</code> <em>AT</em> , <em>ET</em>
<code>)</code> <del class="diff-old">returns true if ET is</del>
<ins class="diff-chg">raises</ins> a <del class="diff-old">known</del> 
type <del class="diff-old">and any of the
following three conditions is true:</del> <ins class="diff-chg">error [</ins>
 <a title="err:XPTY0004" href="#ERRXPTY0004"><ins class="diff-chg">err:XPTY0004</ins></a>
<ins class="diff-chg">] if either</ins> <em>AT</em> <del 
class="diff-old">is a schema type found in the in-scope schema
definitions , and is the same as ET or is derived by
restriction</del> or <del class="diff-old">extension from</del>
<em>ET</em> <del class="diff-old">AT</del> is <del class="diff-old">a 
schema type</del> not <del class="diff-old">found</del> <ins 
class="diff-chg">present</ins> in
<del class="diff-old">the in-scope schema definitions , and an
implementation-dependent mechanism is able to determine that AT is
derived by restriction from ET There exists some schema type IT
such that derives-from( IT, ET ) and derives-from(</del>
<em><del class="diff-old">AT, IT</del> <ins class="diff-chg">S</ins></em>
 <del class="diff-old">) are true.</del></p>
</li>
<li>
<p><code>derives-from(</code> <em>AT</em> , <em>ET</em>
<code>)</code> returns <del class="diff-old">false</del>
<ins class="diff-chg">true</ins> if <em><del class="diff-old">ET is
a known type and either the first and third or the second and third
of the following conditions are true:</del> AT</em> is <del 
class="diff-old">a schema type found in the in-scope schema definitions ,
and is not the same as</del> <ins class="diff-chg">derived
from</ins> <em>ET <del class="diff-old">, and is not
derived</del></em> by restriction or <del class="diff-old">extension 
from</del> <ins class="diff-chg">extension, or
if</ins> <em>ET</em> <del class="diff-old">AT</del> is a
<del class="diff-old">schema</del> <ins class="diff-chg">union</ins> 
type <del class="diff-old">not found in the
in-scope schema definitions , and an implementation-dependent
mechanism is able to determine that</del> <ins class="diff-chg">of
which</ins> <em>AT</em> is <del class="diff-old">not derived by
restriction from ET</del> <ins class="diff-chg">a member
type.</ins></p>
<p><del class="diff-old">No schema type</del> <ins class="diff-chg">Formally,
 it returns true if</ins> <em><del class="diff-old">IT</del> <ins 
class="diff-chg">AT</ins></em> <del class="diff-old">exists such that 
derives-from(</del> <ins class="diff-chg">and</ins> <em><del 
class="diff-old">IT,</del> ET</em>
<del class="diff-old">) and derives-from(</del> <ins class="diff-chg">are
 both present in</ins> <em><del class="diff-old">AT,
IT</del> <ins class="diff-chg">S</ins></em> <del class="diff-old">)
are true. derives-from(</del> <ins class="diff-chg">and</ins>
<em>AT <del class="diff-old">,</del></em> <ins class="diff-chg">is
validly derived from</ins> <em>ET</em> <del class="diff-old">)
raises a type error [ err:XPTY0004</del> <ins class="diff-chg">given the
 empty set, as defined in</ins> <a href="#XMLSchema"><ins 
class="diff-chg">[XML Schema]</ins></a>
<del class="diff-old">] if:</del> <ins class="diff-chg">Part 1
constraints Type Derivation OK (Complex) (§3.4.6) (if</ins>
<em><del class="diff-old">ET</del> <ins class="diff-chg">AT</ins></em> 
is <del class="diff-old">an unknown
type,</del> <ins class="diff-chg">a complex type),</ins> or
<ins class="diff-chg">Type Derivation OK (Simple) (§3.14.6)
(if</ins> <em>AT</em> is <del class="diff-old">an unknown type,
and</del> <ins class="diff-chg">a simple type). The phrase
"given</ins> the <del class="diff-old">implementation</del>
<ins class="diff-chg">empty set"</ins> is <ins class="diff-new">used 
because the rules in the XML Schema specification
are parameterized: the parameter is a list of the kinds of
derivation that are</ins> not <del class="diff-old">able to
determine whether AT</del> <ins class="diff-chg">allowed, and in
this case the list</ins> is <del class="diff-old">derived by
restriction from ET .</del> <ins class="diff-chg">always
empty.</ins></p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The <del class="diff-old">derives-from pseudo-function cannot be
written as</del> <ins class="diff-chg">current (second) edition of
XML Schema 1.0 contains an error in respect of the substitutability
of</ins> a <del class="diff-old">real XQuery function, because
types</del> <ins class="diff-chg">union type by one of its members:
it fails to recognize that this is unsafe if the union is derived
by restriction from another union. This problem is fixed in the
current working draft of XML Schema 1.1, and implementers</ins> are
<del class="diff-old">not valid function parameters.</del>
<ins class="diff-chg">advised to adopt the solution given there. It
is likely that this specification will be updated to refer
normatively to XML Schema 1.1 when that specification reaches
Recommendation status.</ins></p>
</div>
</li>
<li>
<p><ins class="diff-new">Otherwise,</ins> <code><ins class="diff-new">derives-from(</ins></code>
 <em><ins class="diff-new">AT</ins></em> ,<em><ins class="diff-new">ET</ins></em>
<code><ins class="diff-new">)</ins></code> <ins class="diff-new">returns
 false</ins></p>
</li>
</ul>
<p>The rules for <a title="SequenceType matching" 
href="#dt-sequencetype-matching">SequenceType matching</a> are given
below, with examples (the examples are for purposes of
illustration, and do not cover all possible cases).</p>
<div class="div4">
<h5><a id="id-matching-value" name="id-matching-value"></a> 2.5.4.1
Matching a SequenceType and a Value</h5>
<ul>
<li>
<p>The <a title="sequence type" href="#dt-sequence-type">sequence
type</a> <code>empty-sequence()</code> matches a value that is the
empty sequence.</p>
</li>
<li>
<p>An <a href="#doc-xquery11-ItemType">ItemType</a> with no
<a href="#doc-xquery11-OccurrenceIndicator">OccurrenceIndicator</a>
matches any value that contains exactly one item if the <a 
href="#doc-xquery11-ItemType">ItemType</a> matches that item (see
<a href="#id-matching-item"><b>2.5.4.2 Matching an ItemType and an
Item</b></a> ).</p>
</li>
<li>
<p>An <a href="#doc-xquery11-ItemType">ItemType</a> with an
<a href="#doc-xquery11-OccurrenceIndicator">OccurrenceIndicator</a>
matches a value if the number of items in the value matches the
<a href="#doc-xquery11-OccurrenceIndicator">OccurrenceIndicator</a>
and the <a href="#doc-xquery11-ItemType">ItemType</a> matches each
of the items in the value.</p>
</li>
</ul>
<p>An <a href="#doc-xquery11-OccurrenceIndicator">OccurrenceIndicator</a>
specifies the number of items in a sequence, as follows:</p>
<ul>
<li>
<p><code>?</code> matches zero or one items</p>
</li>
<li>
<p><code>*</code> matches zero or more items</p>
</li>
<li>
<p><code>+</code> matches one or more items</p>
</li>
</ul>
<p>As a consequence of these rules, any <a title="sequence type" 
href="#dt-sequence-type">sequence type</a> whose <a 
href="#doc-xquery11-OccurrenceIndicator">OccurrenceIndicator</a> is
<code>*</code> or <code>?</code> matches a value that is an empty
sequence.</p>
</div>
<div class="div4">
<h5><a id="id-matching-item" name="id-matching-item"></a> 2.5.4.2
Matching an ItemType and an Item</h5>
<ul>
<li>
<p>An <a href="#doc-xquery11-ItemType">ItemType</a> consisting
simply of <del class="diff-old">a QName</del> <ins class="diff-chg">an 
EQName</ins> is interpreted as an <a href="#doc-xquery11-AtomicType">AtomicType</a>
 . An AtomicType
<em>AtomicType</em> matches an atomic value whose actual type is
<em>AT</em> if <code>derives-from(</code> <em>AT, AtomicType</em>
<code>)</code> is <code>true</code> . If <del class="diff-old">a</del> <ins
 class="diff-chg">the</ins> <a title="expanded QName" 
href="#dt-expanded-qname"><ins class="diff-chg">expanded</ins> QName <del
 class="diff-old">that is used
as</del></a> <ins class="diff-chg">of</ins> an <a 
href="#doc-xquery11-AtomicType">AtomicType</a> is not defined as an
atomic type in the <a title="in-scope schema type" href="#dt-is-types">in-scope
 schema types</a> , a <a title="static error" href="#dt-static-error">static
 error</a> is raised [
<a title="err:XPST0051" href="#ERRXPST0051">err:XPST0051</a> ].</p>
<p>Example: The <a href="#doc-xquery11-AtomicType">AtomicType</a>
<code>xs:decimal</code> matches the value <code>12.34</code> (a
decimal literal). <code>xs:decimal</code> also matches a value
whose type is <code>shoesize</code> , if <code>shoesize</code> is
an atomic type derived by restriction from <code>xs:decimal</code>
.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The names of non-atomic types such as <code>xs:IDREFS</code> are
not accepted in this context, but can often be replaced by an
atomic type with an occurrence indicator, such as
<code>xs:IDREF+</code> .</p>
</div>
</li>
<li>
<p><code>item()</code> matches any single item.</p>
<p>Example: <code>item()</code> matches the atomic value
<code>1</code> or the element <code>&lt;a/&gt;</code> .</p>
</li>
<li>
<p><code>node()</code> matches any node.</p>
</li>
<li>
<p><code><ins class="diff-new">function(*)</ins></code> <ins 
class="diff-new">matches any</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#dt-function-item"><ins 
class="diff-new">
function item</ins></a> <sup><small><ins class="diff-new">DM11</ins></small></sup>
 .</p>
</li>
<li>
<p><code>text()</code> matches any text node.</p>
</li>
<li>
<p><code>processing-instruction()</code> matches any
processing-instruction node.</p>
</li>
<li>
<p><code>processing-instruction(</code> <em>N</em> <code>)</code>
matches any processing-instruction node whose <del class="diff-old">name
 (called its "PITarget" in XML)</del> <ins class="diff-chg">PITarget</ins>
 is equal to <del class="diff-old">N ,
where N</del> <code><ins class="diff-chg">fn:normalize-space(N)</ins></code>
 .<ins class="diff-chg">If</ins> <code><ins class="diff-chg">fn:normalize-space(N)</ins></code>
 is <del class="diff-old">an NCName.</del> <ins class="diff-chg">not in 
the
lexical space of NCName, a type error is raised [</ins> <a 
title="err:XPTY0004" href="#ERRXPTY0004"><ins class="diff-chg">err:XPTY0004</ins></a>
 <ins class="diff-chg">]</ins></p>
<p>Example: <code>processing-instruction(xml-stylesheet)</code>
matches any processing instruction whose PITarget is
<code>xml-stylesheet</code> .</p>
<p>For backward compatibility with XPath 1.0, the PITarget of a
processing instruction may also be expressed as a string literal,
as in this example:
<code>processing-instruction("xml-stylesheet")</code> .</p>
<p><ins class="diff-new">If the specified PITarget is not a
syntactically valid NCName, a type error is raised [</ins>
<a title="err:XPTY0004" href="#ERRXPTY0004"><ins class="diff-new">err:XPTY0004</ins></a>
 <ins class="diff-new">].</ins></p>
</li>
<li>
<p><code>comment()</code> matches any comment node.</p>
</li>
<li>
<p><code><ins class="diff-new">namespace-node()</ins></code>
<ins class="diff-new">matches any namespace node.</ins></p>
</li>
<li>
<p><code>document-node()</code> matches any document node.</p>
</li>
<li>
<p><code>document-node(</code> <em>E</em> <code>)</code> matches
any document node that contains exactly one element node,
optionally accompanied by one or more comment and processing
instruction nodes, if <em>E</em> is an <a 
href="#doc-xquery11-ElementTest">ElementTest</a> or <a 
href="#doc-xquery11-SchemaElementTest">SchemaElementTest</a> that
matches the element node (see <a href="#id-element-test"><b>2.5.4.3
Element Test</b></a> and <a href="#id-schema-element-test"><b>2.5.4.4 
Schema Element Test</b></a>
).</p>
<p>Example: <code>document-node(element(book))</code> matches a
document node containing exactly one element node that is matched
by the ElementTest <code>element(book)</code> .</p>
</li>
<li>
<p><ins class="diff-new">A</ins> <a 
href="#doc-xquery11-TypedFunctionTest"><ins class="diff-new">TypedFunctionTest</ins></a>
 <ins class="diff-new">matches an item if it is a</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#dt-function-item"><ins 
class="diff-new">
function item</ins></a> <sup><small><ins class="diff-new">DM11</ins></small></sup>
 ,<ins class="diff-new">and the
function item's type signature (as defined in</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#function-items"><ins 
class="diff-new">
Section 2.7 Function Items</ins></a> <sup><small><ins class="diff-new">DM11</ins></small></sup>
 <ins class="diff-new">) is
a</ins> <a title="subtype" href="#dt-subtype"><ins class="diff-new">subtype</ins></a>
 <ins class="diff-new">of the</ins>
<a href="#doc-xquery11-TypedFunctionTest"><ins class="diff-new">TypedFunctionTest</ins></a>
 .</p>
</li>
<li>
<p>An <a href="#doc-xquery11-ItemType">ItemType</a> that is an
<a href="#doc-xquery11-ElementTest">ElementTest</a> , <a 
href="#doc-xquery11-SchemaElementTest">SchemaElementTest</a> , <a 
href="#doc-xquery11-AttributeTest">AttributeTest</a> , or <a 
href="#doc-xquery11-SchemaAttributeTest">SchemaAttributeTest</a> matches
an <del class="diff-old">element or attribute node</del>
<ins class="diff-chg">item</ins> as described in the following
sections.</p>
</li>
</ul>
</div>
<div class="div4">
<h5><a id="id-element-test" name="id-element-test"></a> 2.5.4.3
Element Test</h5>
<p>An <a href="#doc-xquery11-ElementTest">ElementTest</a> is used
to match an element node by its name and/or <a title="type annotation" 
href="#dt-type-annotation">type annotation</a> .
An <a href="#doc-xquery11-ElementTest">ElementTest</a> may take any
of the following forms. In these forms, <a 
href="#doc-xquery11-ElementName">ElementName</a> need not be present in
the <a title="in-scope element declarations" href="#dt-is-elems">in-scope
 element declarations</a> , but <a href="#doc-xquery11-TypeName">TypeName</a>
 must be present in the
<a title="in-scope schema type" href="#dt-is-types">in-scope schema
types</a> [ <a title="err:XPST0008" href="#ERRXPST0008">err:XPST0008</a>
 ]. Note that <a title="substitution group" 
href="#dt-substitution-group">substitution
groups</a> do not affect the semantics of <a 
href="#doc-xquery11-ElementTest">ElementTest</a> .</p>
<ol class="enumar">
<li>
<p><code>element()</code> and <code>element(*)</code> match any
single element node, regardless of its name or type annotation.</p>
</li>
<li>
<p><code>element(</code> <a href="#doc-xquery11-ElementName">ElementName</a>
 <code>)</code> matches
any element node whose name is <a href="#doc-xquery11-ElementName">ElementName</a>
 , regardless of its
type annotation or <code>nilled</code> property.</p>
<p>Example: <code>element(person)</code> matches any element node
whose name is <code>person</code> .</p>
</li>
<li>
<p><code>element(</code> <a href="#doc-xquery11-ElementName">ElementName</a>
 <code>,</code> <a href="#doc-xquery11-TypeName">TypeName</a> <code>)</code>
 matches an
element node whose name is <a href="#doc-xquery11-ElementName">ElementName</a>
 if
<code>derives-from(</code> <em>AT</em> , <a 
href="#doc-xquery11-TypeName">TypeName</a> <code>)</code> is
<code>true</code> , where <em>AT</em> is the type annotation of the
element node, and the <code>nilled</code> property of the node is
<code>false</code> .</p>
<p>Example: <code>element(person, surgeon)</code> matches a
non-nilled element node whose name is <code>person</code> and whose
type annotation is <code>surgeon</code> (or is derived from
<code>surgeon</code> ).</p>
</li>
<li>
<p><code>element(</code> <a href="#doc-xquery11-ElementName">ElementName</a>
 , <a href="#doc-xquery11-TypeName">TypeName</a> <code>?)</code> matches
 an
element node whose name is <a href="#doc-xquery11-ElementName">ElementName</a>
 if
<code>derives-from(</code> <em>AT</em> , <a 
href="#doc-xquery11-TypeName">TypeName</a> <code>)</code> is
<code>true</code> , where <em>AT</em> is the type annotation of the
element node. The <code>nilled</code> property of the node may be
either <code>true</code> or <code>false</code> .</p>
<p>Example: <code>element(person, surgeon?)</code> matches a nilled
or non-nilled element node whose name is <code>person</code> and
whose type annotation is <code>surgeon</code> (or is derived from
<code>surgeon</code> ).</p>
</li>
<li>
<p><code>element(*,</code> <a href="#doc-xquery11-TypeName">TypeName</a>
 <code>)</code> matches an
element node regardless of its name, if <code>derives-from(</code>
<em>AT</em> , <a href="#doc-xquery11-TypeName">TypeName</a>
<code>)</code> is <code>true</code> , where <em>AT</em> is the type
annotation of the element node, and the <code>nilled</code>
property of the node is <code>false</code> .</p>
<p>Example: <code>element(*, surgeon)</code> matches any non-nilled
element node whose type annotation is <code>surgeon</code> (or is
derived from <code>surgeon</code> ), regardless of its name.</p>
</li>
<li>
<p><code>element(*,</code> <a href="#doc-xquery11-TypeName">TypeName</a>
 <code>?)</code> matches an
element node regardless of its name, if <code>derives-from(</code>
<em>AT</em> , <a href="#doc-xquery11-TypeName">TypeName</a>
<code>)</code> is <code>true</code> , where <em>AT</em> is the type
annotation of the element node. The <code>nilled</code> property of
the node may be either <code>true</code> or <code>false</code>
.</p>
<p>Example: <code>element(*, surgeon?)</code> matches any nilled or
non-nilled element node whose type annotation is
<code>surgeon</code> (or is derived from <code>surgeon</code> ),
regardless of its name.</p>
</li>
</ol>
</div>
<div class="div4">
<h5><a id="id-schema-element-test" name="id-schema-element-test"></a> 
2.5.4.4 Schema Element Test</h5>
<p>A <a href="#doc-xquery11-SchemaElementTest">SchemaElementTest</a> 
matches an
element node against a corresponding element declaration found in
the <a title="in-scope element declarations" href="#dt-is-elems">in-scope
 element declarations</a> . It takes the
following form:</p>
<p><code>schema-element(</code> <a href="#doc-xquery11-ElementName">ElementName</a>
 <code>)</code></p>
<p>If the <a href="#doc-xquery11-ElementName">ElementName</a>
specified in the <a href="#doc-xquery11-SchemaElementTest">SchemaElementTest</a>
 is not
found in the <a title="in-scope element declarations" 
href="#dt-is-elems">in-scope element declarations</a> , a <a 
title="static error" href="#dt-static-error">static error</a> is raised [
<a title="err:XPST0008" href="#ERRXPST0008">err:XPST0008</a> ].</p>
<p>A <a href="#doc-xquery11-SchemaElementTest">SchemaElementTest</a> 
matches a
candidate element node if all three of the following conditions are
satisfied:</p>
<ol class="enumar">
<li>
<p>The name of the candidate node matches the specified <a 
href="#doc-xquery11-ElementName">ElementName</a> or matches the name of
an element in a <a title="substitution group" 
href="#dt-substitution-group">substitution group</a> headed by an
element named <a href="#doc-xquery11-ElementName">ElementName</a>
.</p>
</li>
<li>
<p><code>derives-from(</code> <em>AT, ET</em> <code>)</code> is
<code>true</code> , where <em>AT</em> is the type annotation of the
candidate node and <em>ET</em> is the schema type declared for
element <a href="#doc-xquery11-ElementName">ElementName</a> in the
<a title="in-scope element declarations" href="#dt-is-elems">in-scope 
element declarations</a> .</p>
</li>
<li>
<p>If the element declaration for <a href="#doc-xquery11-ElementName">ElementName</a>
 in the <a title="in-scope element declarations" href="#dt-is-elems">in-scope
element
 declarations</a> is not <code>nillable</code> , then the
<code>nilled</code> property of the candidate node is
<code>false</code> .</p>
</li>
</ol>
<p>Example: The <a href="#doc-xquery11-SchemaElementTest">SchemaElementTest</a>
<code>schema-element(customer)</code> matches a candidate element
node if <code>customer</code> is a top-level element declaration in
the <a title="in-scope element declarations" href="#dt-is-elems">in-scope
 element declarations</a> , the name of the
candidate node is <code>customer</code> or is in a <a 
title="substitution group" href="#dt-substitution-group">substitution
group</a> headed by <code>customer</code> , the type annotation of
the candidate node is the same as or derived from the schema type
declared for the <code>customer</code> element, and either the
candidate node is not <code>nilled</code> or <code>customer</code>
is declared to be <code>nillable</code> .</p>
</div>
<div class="div4">
<h5><a id="id-attribute-test" name="id-attribute-test"></a> 2.5.4.5
Attribute Test</h5>
<p>An <a href="#doc-xquery11-AttributeTest">AttributeTest</a> is
used to match an attribute node by its name and/or <a title="type 
annotation" href="#dt-type-annotation">type annotation</a> .
An <a href="#doc-xquery11-AttributeTest">AttributeTest</a> any take
any of the following forms. In these forms, <a 
href="#doc-xquery11-AttributeName">AttributeName</a> need not be present
in the <a title="in-scope attribute declarations" href="#dt-is-attrs">in-scope
 attribute declarations</a> , but <a href="#doc-xquery11-TypeName">TypeName</a>
 must be present in the
<a title="in-scope schema type" href="#dt-is-types">in-scope schema
types</a> [ <a title="err:XPST0008" href="#ERRXPST0008">err:XPST0008</a>
 ].</p>
<ol class="enumar">
<li>
<p><code>attribute()</code> and <code>attribute(*)</code> match any
single attribute node, regardless of its name or type
annotation.</p>
</li>
<li>
<p><code>attribute(</code> <a href="#doc-xquery11-AttributeName">AttributeName</a>
 <code>)</code>
matches any attribute node whose name is <a 
href="#doc-xquery11-AttributeName">AttributeName</a> , regardless of its
type annotation.</p>
<p>Example: <code>attribute(price)</code> matches any attribute
node whose name is <code>price</code> .</p>
</li>
<li>
<p><code>attribute(</code> <a href="#doc-xquery11-AttributeName">AttributeName</a>
 , <a href="#doc-xquery11-TypeName">TypeName</a> <code>)</code> matches 
an
attribute node whose name is <a href="#doc-xquery11-AttributeName">AttributeName</a>
 if
<code>derives-from(</code> <em>AT</em> , <a 
href="#doc-xquery11-TypeName">TypeName</a> <code>)</code> is
<code>true</code> , where <em>AT</em> is the type annotation of the
attribute node.</p>
<p>Example: <code>attribute(price, currency)</code> matches an
attribute node whose name is <code>price</code> and whose type
annotation is <code>currency</code> (or is derived from
<code>currency</code> ).</p>
</li>
<li>
<p><code>attribute(*,</code> <a href="#doc-xquery11-TypeName">TypeName</a>
 <code>)</code> matches an
attribute node regardless of its name, if
<code>derives-from(</code> <em>AT</em> , <a 
href="#doc-xquery11-TypeName">TypeName</a> <code>)</code> is
<code>true</code> , where <em>AT</em> is the type annotation of the
attribute node.</p>
<p>Example: <code>attribute(*, currency)</code> matches any
attribute node whose type annotation is <code>currency</code> (or
is derived from <code>currency</code> ), regardless of its
name.</p>
</li>
</ol>
</div>
<div class="div4">
<h5><a id="id-schema-attribute-test" name="id-schema-attribute-test"></a>
 2.5.4.6 Schema Attribute Test</h5>
<p>A <a href="#doc-xquery11-SchemaAttributeTest">SchemaAttributeTest</a>
 matches
an attribute node against a corresponding attribute declaration
found in the <a title="in-scope attribute declarations" 
href="#dt-is-attrs">in-scope attribute declarations</a> . It takes the
following form:</p>
<p><code>schema-attribute(</code> <a href="#doc-xquery11-AttributeName">AttributeName</a>
 <code>)</code></p>
<p>If the <a href="#doc-xquery11-AttributeName">AttributeName</a>
specified in the <a href="#doc-xquery11-SchemaAttributeTest">SchemaAttributeTest</a>
 is not
found in the <a title="in-scope attribute declarations" 
href="#dt-is-attrs">in-scope attribute declarations</a> , a <a 
title="static error" href="#dt-static-error">static error</a> is raised [
<a title="err:XPST0008" href="#ERRXPST0008">err:XPST0008</a> ].</p>
<p>A <a href="#doc-xquery11-SchemaAttributeTest">SchemaAttributeTest</a>
 matches
a candidate attribute node if both of the following conditions are
satisfied:</p>
<ol class="enumar">
<li>
<p>The name of the candidate node matches the specified <a 
href="#doc-xquery11-AttributeName">AttributeName</a> .</p>
</li>
<li>
<p><code>derives-from(</code> <em>AT, ET</em> <code>)</code> is
<code>true</code> , where <em>AT</em> is the type annotation of the
candidate node and <em>ET</em> is the schema type declared for
attribute <a href="#doc-xquery11-AttributeName">AttributeName</a>
in the <a title="in-scope attribute declarations" href="#dt-is-attrs">in-scope
 attribute declarations</a> .</p>
</li>
</ol>
<p>Example: The <a href="#doc-xquery11-SchemaAttributeTest">SchemaAttributeTest</a>
<code>schema-attribute(color)</code> matches a candidate attribute
node if <code>color</code> is a top-level attribute declaration in
the <a title="in-scope attribute declarations" href="#dt-is-attrs">in-scope
 attribute declarations</a> , the name of
the candidate node is <code>color</code> , and the type annotation
of the candidate node is the same as or derived from the schema
type declared for the <code>color</code> attribute.</p>
</div>
</div>
<div class="div3">
<h4><a id="id-sequencetype-subtype" name="id-sequencetype-subtype"></a> <ins
 class="diff-new">2.5.5
SequenceType Subtype Relationships</ins></h4>
<p><ins class="diff-new">Given two</ins> <a title="sequence type" 
href="#dt-sequence-type"><ins class="diff-new">sequence
types</ins></a> ,<ins class="diff-new">it is possible to determine
if one is a subtype of the other. [</ins> <a title="subtype" 
id="dt-subtype" name="dt-subtype"><ins class="diff-new">Definition</ins></a>
 :<ins class="diff-new">A</ins>
<a title="sequence type" href="#dt-sequence-type"><ins class="diff-new">sequence
 type</ins></a> <code><ins class="diff-new">A</ins></code> <ins 
class="diff-new">is a</ins>
<b><ins class="diff-new">subtype</ins></b> <ins class="diff-new">of
a sequence type</ins> <code><ins class="diff-new">B</ins></code>
<ins class="diff-new">if and only if, for every value</ins>
<code><ins class="diff-new">V</ins></code> ,<ins class="diff-new">if</ins>
 <code><ins class="diff-new">V</ins></code>
<ins class="diff-new">matches</ins> <code><ins class="diff-new">A</ins></code>
 <ins class="diff-new">according to the
rules of</ins> <a title="SequenceType matching" 
href="#dt-sequencetype-matching"><ins class="diff-new">SequenceType
matching</ins></a> ,<ins class="diff-new">then</ins>
<code><ins class="diff-new">V</ins></code> <ins class="diff-new">also 
matches</ins> <code><ins class="diff-new">B</ins></code> .]<ins 
class="diff-new">The subtype
relationship can be computed using the</ins> <code><ins class="diff-new">subtype(A,
 B)</ins></code> ,<code><ins class="diff-new">subtype-itemtype(Ai, Bi)</ins></code>
 ,<ins class="diff-new">and</ins> <code><ins class="diff-new">derives-from(AT,
ET)</ins></code> <ins class="diff-new">judgements.</ins></p>
<div class="div4">
<h5><a id="id-seqtype-subtype" name="id-seqtype-subtype"></a><ins 
class="diff-new">2.5.5.1 The
SequenceType Subtype Judgement</ins></h5>
<p><ins class="diff-new">The judgement</ins> <code><ins class="diff-new">subtype(A,
 B)</ins></code> <ins class="diff-new">determines if the</ins> <a 
title="sequence type" href="#dt-sequence-type"><ins class="diff-new">sequence
 type</ins></a>
<code><ins class="diff-new">A</ins></code> <ins class="diff-new">is
a</ins> <a title="subtype" href="#dt-subtype"><ins class="diff-new">subtype</ins></a>
 <ins class="diff-new">of the sequence
type</ins> <code><ins class="diff-new">B</ins></code>
.<code><ins class="diff-new">A</ins></code> <ins class="diff-new">can 
either be</ins> <code><ins class="diff-new">empty-sequence()</ins></code>
 <ins class="diff-new">or
an</ins> <a href="#doc-xquery11-ItemType"><ins class="diff-new">ItemType</ins></a>
 ,<code><ins class="diff-new">Ai</ins></code> ,<ins class="diff-new">possibly
 followed
by an occurrence indicator. Similarly</ins> <code><ins class="diff-new">B</ins></code>
 <ins class="diff-new">can either be</ins>
<code><ins class="diff-new">empty-sequence()</ins></code>
<ins class="diff-new">or an</ins> <a href="#doc-xquery11-ItemType"><ins 
class="diff-new">ItemType</ins></a>
,<code><ins class="diff-new">Bi</ins></code> ,<ins class="diff-new">possibly
 followed by an occurrence indicator. The result
of the</ins> <code><ins class="diff-new">subtype(A, B)</ins></code>
<ins class="diff-new">judgement can be determined from the table
below, which makes use of the auxiliary judgement</ins>
<code><ins class="diff-new">subtype-itemtype(Ai, Bi)</ins></code>
<ins class="diff-new">defined in</ins> <a href="#id-itemtype-subtype"><b><ins
 class="diff-new">2.5.5.2 The
ItemType Subtype Judgement</ins></b></a> .</p>
<table summary="Special characters" border="1">
<tbody>
<tr>
<th rowspan="2" colspan="2"></th>
<th colspan="5"><a title="sequence type" href="#dt-sequence-type"><ins 
class="diff-new">Sequence type</ins></a>
<code><ins class="diff-new">B</ins></code></th>
</tr>
<tr>
<th colspan="1"><code><ins class="diff-new">empty-sequence()</ins></code></th>
<th colspan="1"><code><ins class="diff-new">Bi?</ins></code></th>
<th colspan="1"><code><ins class="diff-new">Bi*</ins></code></th>
<th colspan="1"><code><ins class="diff-new">Bi</ins></code></th>
<th colspan="1"><code><ins class="diff-new">Bi+</ins></code></th>
</tr>
<tr>
<th rowspan="5" colspan="1"><a title="sequence type" 
href="#dt-sequence-type"><ins class="diff-new">Sequence type</ins></a>
<code><ins class="diff-new">A</ins></code></th>
<th colspan="1"><code><ins class="diff-new">empty-sequence()</ins></code></th>
<td><ins class="diff-new">true</ins></td>
<td><ins class="diff-new">true</ins></td>
<td><ins class="diff-new">true</ins></td>
<td><ins class="diff-new">false</ins></td>
<td><ins class="diff-new">false</ins></td>
</tr>
<tr>
<th colspan="1"><code><ins class="diff-new">Ai?</ins></code></th>
<td><ins class="diff-new">false</ins></td>
<td><code><ins class="diff-new">subtype-itemtype(Ai,
Bi)</ins></code></td>
<td><code><ins class="diff-new">subtype-itemtype(Ai,
Bi)</ins></code></td>
<td><ins class="diff-new">false</ins></td>
<td><ins class="diff-new">false</ins></td>
</tr>
<tr>
<th colspan="1"><code><ins class="diff-new">Ai*</ins></code></th>
<td><ins class="diff-new">false</ins></td>
<td><ins class="diff-new">false</ins></td>
<td><code><ins class="diff-new">subtype-itemtype(Ai,
Bi)</ins></code></td>
<td><ins class="diff-new">false</ins></td>
<td><ins class="diff-new">false</ins></td>
</tr>
<tr>
<th colspan="1"><code><ins class="diff-new">Ai</ins></code></th>
<td><ins class="diff-new">false</ins></td>
<td><code><ins class="diff-new">subtype-itemtype(Ai,
Bi)</ins></code></td>
<td><code><ins class="diff-new">subtype-itemtype(Ai,
Bi)</ins></code></td>
<td><code><ins class="diff-new">subtype-itemtype(Ai,
Bi)</ins></code></td>
<td><code><ins class="diff-new">subtype-itemtype(Ai,
Bi)</ins></code></td>
</tr>
<tr>
<th colspan="1"><code><ins class="diff-new">Ai+</ins></code></th>
<td><ins class="diff-new">false</ins></td>
<td><ins class="diff-new">false</ins></td>
<td><code><ins class="diff-new">subtype-itemtype(Ai,
Bi)</ins></code></td>
<td><ins class="diff-new">false</ins></td>
<td><code><ins class="diff-new">subtype-itemtype(Ai,
Bi)</ins></code></td>
</tr>
</tbody>
</table>
</div>
<div class="div4">
<h5><a id="id-itemtype-subtype" name="id-itemtype-subtype"></a><ins 
class="diff-new">2.5.5.2 The
ItemType Subtype Judgement</ins></h5>
<p><ins class="diff-new">The judgement</ins> <code><ins class="diff-new">subtype-itemtype(Ai,
 Bi)</ins></code> <ins class="diff-new">determines if the</ins> <a 
href="#doc-xquery11-ItemType"><ins class="diff-new">ItemType</ins></a>
<code><ins class="diff-new">Ai</ins></code> <ins class="diff-new">is a</ins>
 <a title="subtype" href="#dt-subtype"><ins class="diff-new">subtype</ins></a>
 <ins class="diff-new">of the ItemType</ins> <code><ins class="diff-new">Bi</ins></code>
 .<code><ins class="diff-new">Ai</ins></code> <ins class="diff-new">is a
 subtype
of</ins> <code><ins class="diff-new">Bi</ins></code> <ins 
class="diff-new">if and only if at least one of the following conditions
applies:</ins></p>
<ul>
<li>
<p><code><ins class="diff-new">Ai</ins></code> <ins class="diff-new">and</ins>
 <code><ins class="diff-new">Bi</ins></code>
<ins class="diff-new">are</ins> <a href="#doc-xquery11-AtomicType"><ins 
class="diff-new">AtomicTypes</ins></a> ,<ins class="diff-new">and</ins>
<code><ins class="diff-new">derives-from(Ai, Bi)</ins></code>
<ins class="diff-new">returns true.</ins></p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is</ins>
 <code><ins class="diff-new">item()</ins></code>
.</p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is</ins>
 <code><ins class="diff-new">node()</ins></code>
,<ins class="diff-new">and</ins> <code><ins class="diff-new">Ai</ins></code>
 <ins class="diff-new">is a</ins>
<a href="#doc-xquery11-KindTest"><ins class="diff-new">KindTest</ins></a>
 .</p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is</ins>
 <code><ins class="diff-new">function(*)</ins></code> ,<ins 
class="diff-new">and</ins> <code><ins class="diff-new">Ai</ins></code>
<ins class="diff-new">is a</ins> <a href="#doc-xquery11-FunctionTest"><ins
 class="diff-new">FunctionTest</ins></a> .</p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is</ins>
 <code><ins class="diff-new">text()</ins></code>
<ins class="diff-new">and</ins> <code><ins class="diff-new">Ai</ins></code>
 <ins class="diff-new">is also</ins>
<code><ins class="diff-new">text()</ins></code> .</p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is</ins>
 <code><ins class="diff-new">comment()</ins></code> <ins 
class="diff-new">and</ins>
<code><ins class="diff-new">Ai</ins></code> <ins class="diff-new">is 
also</ins> <code><ins class="diff-new">comment()</ins></code> .</p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is</ins>
 <code><ins class="diff-new">namespace-node()</ins></code> <ins 
class="diff-new">and</ins> <code><ins class="diff-new">Ai</ins></code>
<ins class="diff-new">is also</ins> <code><ins class="diff-new">namespace-node()</ins></code>
 .</p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is</ins>
 <code><ins class="diff-new">processing-instruction()</ins></code> <ins 
class="diff-new">and</ins> <code><ins class="diff-new">Ai</ins></code>
<ins class="diff-new">is either</ins> <code><ins class="diff-new">processing-instruction()</ins></code>
 <ins class="diff-new">or</ins> <code><ins class="diff-new">processing-instruction(N)</ins></code>
 <ins class="diff-new">for any name N..</ins></p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is</ins>
 <code><ins class="diff-new">processing-instruction(Bn)</ins></code> ,<ins
 class="diff-new">and</ins> <code><ins class="diff-new">Ai</ins></code>
<ins class="diff-new">is also</ins> <code><ins class="diff-new">processing-instruction(Bn)</ins></code>
 .</p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is</ins>
 <code><ins class="diff-new">document-node()</ins></code> <ins 
class="diff-new">and</ins> <code><ins class="diff-new">Ai</ins></code>
<ins class="diff-new">is either</ins> <code><ins class="diff-new">document-node()</ins></code>
 <ins class="diff-new">or</ins> <code><ins class="diff-new">document-node(E)</ins></code>
 <ins class="diff-new">for
any</ins> <a href="#doc-xquery11-ElementTest"><ins class="diff-new">ElementTest</ins></a>
 <ins class="diff-new">E.</ins></p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is</ins>
 <code><ins class="diff-new">document-node(Be)</ins></code> <ins 
class="diff-new">and</ins> <code><ins class="diff-new">Ai</ins></code>
<ins class="diff-new">is</ins> <code><ins class="diff-new">document-node(Ae)</ins></code>
 ,<ins class="diff-new">and</ins> <code><ins class="diff-new">subtype-itemtype(Ae,
 Be)</ins></code> .</p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is 
either</ins> <code><ins class="diff-new">element()</ins></code> <ins 
class="diff-new">or</ins>
<code><ins class="diff-new">element(*)</ins></code> ,<ins 
class="diff-new">and</ins> <code><ins class="diff-new">Ai</ins></code>
<ins class="diff-new">is an</ins> <a href="#doc-xquery11-ElementTest"><ins
 class="diff-new">ElementTest</ins></a> .</p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is 
either</ins> <code><ins class="diff-new">element(Bn)</ins></code> <ins 
class="diff-new">or</ins>
<code><ins class="diff-new">element(Bn, xs:anyType)</ins></code>
,<ins class="diff-new">and</ins> <code><ins class="diff-new">Ai</ins></code>
 <ins class="diff-new">is either</ins>
<code><ins class="diff-new">element(Bn)</ins></code> ,<ins 
class="diff-new">or</ins> <code><ins class="diff-new">element(Bn,
T)</ins></code> <ins class="diff-new">for any type T.</ins></p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is</ins>
 <code><ins class="diff-new">element(Bn,
Bt)</ins></code> ,<code><ins class="diff-new">Ai</ins></code>
<ins class="diff-new">is</ins> <code><ins class="diff-new">element(Bn, 
At)</ins></code> ,<ins class="diff-new">and</ins> <code><ins 
class="diff-new">derives-from(At,
Bt)</ins></code> <ins class="diff-new">returns true.</ins></p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is</ins>
 <code><ins class="diff-new">element(Bn,
Bt?)</ins></code> ,<code><ins class="diff-new">Ai</ins></code>
<ins class="diff-new">is either</ins> <code><ins class="diff-new">element(Bn,
 At)</ins></code> ,<ins class="diff-new">or</ins> <code><ins 
class="diff-new">element(Bn,
At?)</ins></code> ,<ins class="diff-new">and</ins>
<code><ins class="diff-new">derives-from(At, Bt)</ins></code>
<ins class="diff-new">returns true.</ins></p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is</ins>
 <code><ins class="diff-new">element(*,
Bt)</ins></code> ,<code><ins class="diff-new">Ai</ins></code>
<ins class="diff-new">is either</ins> <code><ins class="diff-new">element(*,
 At)</ins></code> ,<ins class="diff-new">or</ins> <code><ins 
class="diff-new">element(N,
At)</ins></code> <ins class="diff-new">for any name N, and</ins>
<code><ins class="diff-new">derives-from(At, Bt)</ins></code>
<ins class="diff-new">returns true.</ins></p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is</ins>
 <code><ins class="diff-new">element(*,
Bt?)</ins></code> ,<code><ins class="diff-new">Ai</ins></code>
<ins class="diff-new">is either</ins> <code><ins class="diff-new">element(*,
 At)</ins></code> ,<code><ins class="diff-new">element(*, At?)</ins></code>
 ,<code><ins class="diff-new">element(N, At)</ins></code> ,<ins 
class="diff-new">or</ins> <code><ins class="diff-new">element(N,
At?)</ins></code> <ins class="diff-new">for any name N, and</ins>
<code><ins class="diff-new">derives-from(At, Bt)</ins></code>
<ins class="diff-new">returns true.</ins></p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is</ins>
 <code><ins class="diff-new">schema-element(Bn)</ins></code> ,<code><ins
 class="diff-new">Ai</ins></code> <ins class="diff-new">is</ins>
<code><ins class="diff-new">schema-element(An)</ins></code>
,<ins class="diff-new">and either the</ins> <a title="expanded QName" 
href="#dt-expanded-qname"><ins class="diff-new">expanded QName</ins></a>
 <code><ins class="diff-new">An</ins></code> <ins class="diff-new">equals
 the</ins>
<a title="expanded QName" href="#dt-expanded-qname"><ins 
class="diff-new">expanded QName</ins></a> <code><ins class="diff-new">Bn</ins></code>
 <ins class="diff-new">or the element
declaration named</ins> <code><ins class="diff-new">An</ins></code>
<ins class="diff-new">is in the substitution group of the element
declaration named</ins> <code><ins class="diff-new">Bn</ins></code>
.</p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is 
either</ins> <code><ins class="diff-new">attribute()</ins></code> <ins 
class="diff-new">or</ins>
<code><ins class="diff-new">attribute(*)</ins></code> ,<ins 
class="diff-new">and</ins> <code><ins class="diff-new">Ai</ins></code>
<ins class="diff-new">is an</ins> <a href="#doc-xquery11-AttributeTest"><ins
 class="diff-new">AttributeTest</ins></a> .</p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is 
either</ins> <code><ins class="diff-new">attribute(Bn)</ins></code> <ins
 class="diff-new">or</ins> <code><ins class="diff-new">attribute(Bn,
xs:anyType)</ins></code> ,<ins class="diff-new">and</ins>
<code><ins class="diff-new">Ai</ins></code> <ins class="diff-new">is 
either</ins> <code><ins class="diff-new">attribute(Bn)</ins></code> ,<ins
 class="diff-new">or</ins> <code><ins class="diff-new">attribute(Bn,
T)</ins></code> <ins class="diff-new">for any type T.</ins></p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is</ins>
 <code><ins class="diff-new">attribute(Bn,
Bt)</ins></code> ,<code><ins class="diff-new">Ai</ins></code>
<ins class="diff-new">is</ins> <code><ins class="diff-new">attribute(Bn,
 At)</ins></code> ,<ins class="diff-new">and</ins> <code><ins 
class="diff-new">derives-from(At,
Bt)</ins></code> <ins class="diff-new">returns true.</ins></p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is</ins>
 <code><ins class="diff-new">attribute(*,
Bt)</ins></code> ,<code><ins class="diff-new">Ai</ins></code>
<ins class="diff-new">is either</ins> <code><ins class="diff-new">attribute(*,
 At)</ins></code> ,<ins class="diff-new">or</ins> <code><ins 
class="diff-new">attribute(N,
At)</ins></code> <ins class="diff-new">for any name N, and</ins>
<code><ins class="diff-new">derives-from(At, Bt)</ins></code>
<ins class="diff-new">returns true.</ins></p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is</ins>
 <code><ins class="diff-new">schema-attribute(Bn)</ins></code> <ins 
class="diff-new">and</ins> <code><ins class="diff-new">Ai</ins></code>
<ins class="diff-new">is also</ins> <code><ins class="diff-new">schema-attribute(Bn)</ins></code>
 .</p>
</li>
<li>
<p><code><ins class="diff-new">Bi</ins></code> <ins class="diff-new">is</ins>
 <code><ins class="diff-new">function(Ba_1,
Ba_2, ... Ba_N) as Br</ins></code> ,<code><ins class="diff-new">Ai</ins></code>
 <ins class="diff-new">is</ins>
<code><ins class="diff-new">function(Aa_1, Aa_2, ... Aa_M) as
Ar</ins></code> ,<code><ins class="diff-new">N</ins></code>
<ins class="diff-new">(arity of Bi) equals</ins> <code><ins 
class="diff-new">M</ins></code> <ins class="diff-new">(arity of
Ai),</ins> <code><ins class="diff-new">subtype(Ar, Br)</ins></code>
,<ins class="diff-new">and for values of</ins> <code><ins 
class="diff-new">I</ins></code> <ins class="diff-new">between 1 and</ins>
<code><ins class="diff-new">N</ins></code> ,<code><ins class="diff-new">subtype(Ba_I,
 Aa_I)</ins></code> .</p>
</li>
</ul>
</div>
</div>
</div>
<div class="div2">
<h3><a id="comments" name="comments"></a> 2.6 Comments</h3>
<h5><a id="N121E0" name="N121E0"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-Comment" name="doc-xquery11-Comment"></a>
<del class="diff-old">[151]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[207]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-Comment">Comment</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"(:" ( <a href="#doc-xquery11-CommentContents">CommentContents</a>
 | <a href="#doc-xquery11-Comment">Comment</a> )* ":)"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CommentContents" 
name="doc-xquery11-CommentContents"></a> <del class="diff-old">[159]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[215]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CommentContents">CommentContents</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>( <a href="#prod-xquery11-Char">Char</a> + - (Char* ('(:'
| ':)') Char*))</code></td>
</tr>
</tbody>
</table>
<p>Comments may be used to provide informative annotation for
<span class="xquery">a query, either in the <a title="Prolog" 
href="#dt-prolog">Prolog</a> or in the <a title="query body" 
href="#dt-queryBody">Query Body</a></span> <del class="diff-old">.</del>
<ins class="diff-chg">.</ins> Comments are lexical constructs only,
and do not affect <span class="xquery">query</span> processing.</p>
<p>Comments are strings, delimited by the symbols <code>(:</code>
and <code>:)</code> . Comments may be nested.</p>
<p>A comment may be used anywhere <a title="ignorable whitespace" 
href="#IgnorableWhitespace">ignorable whitespace</a> is allowed
(see <a href="#DefaultWhitespaceHandling"><b>A.2.4.1 Default
Whitespace Handling</b></a> ).</p>
<p>The following is an example of a comment:</p>
<div class="exampleInner">
<pre>(: Houston, we have a problem :)
</pre></div>
</div>
</div>
<div class="div1">
<h2><a id="id-expressions" name="id-expressions"></a> 3
Expressions</h2>
<p>This section discusses each of the basic kinds of expression.
Each kind of expression has a name such as <code>PathExpr</code> ,
which is introduced on the left side of the grammar production that
defines the expression. Since XQuery <ins class="diff-new">1.1</ins> is a
 composable language, each kind of
expression is defined in terms of other expressions whose operators
have a higher precedence. In this way, the precedence of operators
is represented explicitly in the grammar.</p>
<p>The order in which expressions are discussed in this document
does not reflect the order of operator precedence. In general, this
document introduces the simplest kinds of expressions first,
followed by more complex expressions. For the complete grammar, see
Appendix [ <a href="#nt-bnf"><b>A XQuery <ins class="diff-new">1.1</ins>
 Grammar</b></a> ].</p>
<p><span class="xquery">[ <a title="query" id="dt-query" name="dt-query">Definition</a>
 : A <b>query</b> consists of one or more
<a title="module" href="#dt-module">modules</a> .] If a query is
executable, one of its modules has a <a title="query body" 
href="#dt-queryBody">Query Body</a> containing an expression whose value
is the result of the query. An expression is represented in the
XQuery grammar by the symbol <a href="#doc-xquery11-Expr">Expr</a>
.</span></p>
<h5><a id="N12255" name="N12255"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-Expr" name="doc-xquery11-Expr"></a>
<del class="diff-old">[31]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[39]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-Expr">Expr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-ExprSingle">ExprSingle</a> (","
<a href="#doc-xquery11-ExprSingle">ExprSingle</a> )*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ExprSingle" name="doc-xquery11-ExprSingle"></a> <del
 class="diff-old">[32]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[40]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ExprSingle">ExprSingle</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-FLWORExpr">FLWORExpr</a><br>
| <a href="#doc-xquery11-QuantifiedExpr">QuantifiedExpr</a><br>
| <a href="#doc-xquery11-SwitchExpr"><ins class="diff-chg">SwitchExpr</ins></a><br>
<ins class="diff-chg">|</ins> <a href="#doc-xquery11-TypeswitchExpr">TypeswitchExpr</a><br>
| <a href="#doc-xquery11-IfExpr">IfExpr</a><br>
| <a href="#doc-xquery11-TryCatchExpr"><ins class="diff-chg">TryCatchExpr</ins></a><br>
<ins class="diff-chg">|</ins> <a href="#doc-xquery11-OrExpr">OrExpr</a></code></td>
</tr>
</tbody>
</table>
<p>The XQuery <ins class="diff-new">1.1</ins> operator that has
lowest precedence is the <a title="comma operator" 
href="#dt-comma-operator">comma operator</a> , which is used to combine
two operands to form a sequence. As shown in the grammar, a general
expression ( <a href="#doc-xquery11-Expr">Expr</a> ) can consist of
multiple <a href="#doc-xquery11-ExprSingle">ExprSingle</a>
operands, separated by commas. The name <a 
href="#doc-xquery11-ExprSingle">ExprSingle</a> denotes an expression
that does not contain a top-level <a title="comma operator" 
href="#dt-comma-operator">comma operator</a> (despite its name, an
<a href="#doc-xquery11-ExprSingle">ExprSingle</a> may evaluate to a
sequence containing more than one item.)</p>
<p>The symbol <a href="#doc-xquery11-ExprSingle">ExprSingle</a> is
used in various places in the grammar where an expression is not
allowed to contain a top-level comma. For example, each of the
arguments of a function call must be an <a 
href="#doc-xquery11-ExprSingle">ExprSingle</a> , because commas are used
to separate the arguments of a function call.</p>
<p>After the comma, the expressions that have next lowest
precedence are <span class="xquery"><a href="#doc-xquery11-FLWORExpr">FLWORExpr</a>
 ,</span> <a href="#doc-xquery11-QuantifiedExpr">QuantifiedExpr</a> , <span
 class="xquery"><a href="#doc-xquery11-TypeswitchExpr">TypeswitchExpr</a>
,</span> <a href="#doc-xquery11-IfExpr">IfExpr</a> , and <a 
href="#doc-xquery11-OrExpr">OrExpr</a> . Each of these expressions is
described in a separate section of this document.</p>
<div class="div2">
<h3><a id="id-primary-expressions" name="id-primary-expressions"></a> 
3.1 Primary Expressions</h3>
<p>[ <a title="primary expression" id="dt-primary-expression" 
name="dt-primary-expression">Definition</a> : <b>Primary expressions</b>
are the basic primitives of the language. They include literals,
variable references, context item expressions, <span class="xquery">constructors,</span>
 and function calls. A primary
expression may also be created by enclosing any expression in
parentheses, which is sometimes helpful in controlling the
precedence of operators.] <span class="xquery">Constructors are
described in <a href="#id-constructors"><b><del class="diff-old">3.7</del>
 <ins class="diff-chg">3.8</ins>
Constructors</b></a> .</span></p>
<h5><a id="N12319" name="N12319"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-PrimaryExpr" name="doc-xquery11-PrimaryExpr"></a>
 <del class="diff-old">[84]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[125]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-PrimaryExpr">PrimaryExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-Literal">Literal</a><br>
| <a href="#doc-xquery11-VarRef">VarRef</a><br>
| <a href="#doc-xquery11-ParenthesizedExpr">ParenthesizedExpr</a><br>
| <a href="#doc-xquery11-ContextItemExpr">ContextItemExpr</a><br>
| <a href="#doc-xquery11-FunctionCall">FunctionCall</a><br>
| <a href="#doc-xquery11-OrderedExpr">OrderedExpr</a><br>
| <a href="#doc-xquery11-UnorderedExpr">UnorderedExpr</a><br>
| <a href="#doc-xquery11-Constructor">Constructor</a><br>
<ins class="diff-new">|</ins> <a href="#doc-xquery11-FunctionItemExpr"><ins
 class="diff-new">FunctionItemExpr</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-FunctionItemExpr" 
name="doc-xquery11-FunctionItemExpr"></a><ins class="diff-new">[164]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-FunctionItemExpr"><ins 
class="diff-new">FunctionItemExpr</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-LiteralFunctionItem"><ins 
class="diff-new">LiteralFunctionItem</ins></a> <ins class="diff-new">|</ins>
 <a href="#doc-xquery11-InlineFunction"><ins class="diff-new">InlineFunction</ins></a></code></td>
</tr>
</tbody>
</table>
<div class="div3">
<h4><a id="id-literals" name="id-literals"></a> 3.1.1 Literals</h4>
<p>[ <a title="literal" id="dt-literal" name="dt-literal">Definition</a>
 : A <b>literal</b> is a direct
syntactic representation of an atomic value.] XQuery <ins 
class="diff-new">1.1</ins> supports two kinds of literals: numeric
literals and string literals.</p>
<h5><a id="N1238A" name="N1238A"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-Literal" name="doc-xquery11-Literal"></a>
<del class="diff-old">[85]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[126]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-Literal">Literal</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-NumericLiteral">NumericLiteral</a>
| <a href="#doc-xquery11-StringLiteral">StringLiteral</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-NumericLiteral" 
name="doc-xquery11-NumericLiteral"></a> <del class="diff-old">[86]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[127]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-NumericLiteral">NumericLiteral</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-IntegerLiteral">IntegerLiteral</a>
| <a href="#doc-xquery11-DecimalLiteral">DecimalLiteral</a> |
<a href="#doc-xquery11-DoubleLiteral">DoubleLiteral</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-IntegerLiteral" 
name="doc-xquery11-IntegerLiteral"></a> <del class="diff-old">[141]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[197]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-IntegerLiteral">IntegerLiteral</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-Digits">Digits</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-DecimalLiteral" 
name="doc-xquery11-DecimalLiteral"></a> <del class="diff-old">[142]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[198]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-DecimalLiteral">DecimalLiteral</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>("." <a href="#doc-xquery11-Digits">Digits</a> ) | (
<a href="#doc-xquery11-Digits">Digits</a> "." [0-9]*)</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-DoubleLiteral" name="doc-xquery11-DoubleLiteral"></a>
 <del class="diff-old">[143]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[199]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-DoubleLiteral">DoubleLiteral</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>(("." <a href="#doc-xquery11-Digits">Digits</a> ) | (
<a href="#doc-xquery11-Digits">Digits</a> ("." [0-9]*)?)) [eE]
[+-]? <a href="#doc-xquery11-Digits">Digits</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-StringLiteral" name="doc-xquery11-StringLiteral"></a>
 <del class="diff-old">[144]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[200]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-StringLiteral">StringLiteral</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>('"' ( <a href="#doc-xquery11-PredefinedEntityRef">PredefinedEntityRef</a>
 |
<a href="#prod-xquery11-CharRef">CharRef</a> | <a 
href="#doc-xquery11-EscapeQuot">EscapeQuot</a> | [^"&amp;])* '"') | ("'"
( <a href="#doc-xquery11-PredefinedEntityRef">PredefinedEntityRef</a> |
<a href="#prod-xquery11-CharRef">CharRef</a> | <a 
href="#doc-xquery11-EscapeApos">EscapeApos</a> | [^'&amp;])*
"'")</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-PredefinedEntityRef" 
name="doc-xquery11-PredefinedEntityRef"></a> <del class="diff-old">[145]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[201]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-PredefinedEntityRef">PredefinedEntityRef</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"&amp;" ("lt" | "gt" | "amp" | "quot" | "apos")
";"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-Digits" name="doc-xquery11-Digits"></a>
<del class="diff-old">[158]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[214]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-Digits">Digits</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>[0-9]+</code></td>
</tr>
</tbody>
</table>
<p>The value of a <b>numeric literal</b> containing no "
<code>.</code> " and no <code>e</code> or <code>E</code> character
is an atomic value of type <code>xs:integer</code> . The value of a
numeric literal containing " <code>.</code> " but no <code>e</code>
or <code>E</code> character is an atomic value of type
<code>xs:decimal</code> . The value of a numeric literal containing
an <code>e</code> or <code>E</code> character is an atomic value of
type <code>xs:double</code> . The value of the numeric literal is
determined by casting it to the appropriate type according to the
rules for casting from <code>xs:untypedAtomic</code> to a numeric
type as specified in <a 
href="http://www.w3.org/TR/xpath-functions/#casting-from-strings">Section
17.1.1
 Casting from xs:string and xs:untypedAtomic</a>
<sup><small>FO</small></sup> .</p>
<p>The value of a <b>string literal</b> is an atomic value whose
type is <code>xs:string</code> and whose value is the string
denoted by the characters between the delimiting apostrophes or
quotation marks. If the literal is delimited by apostrophes, two
adjacent apostrophes within the literal are interpreted as a single
apostrophe. Similarly, if the literal is delimited by quotation
marks, two adjacent quotation marks within the literal are
interpreted as one quotation mark.</p>
<p class="xquery">A string literal may contain a <b>predefined
entity reference</b> . [ <a title="predefined entity reference" 
id="dt-predefined-entity-reference" 
name="dt-predefined-entity-reference">Definition</a> : A <b>predefined
entity reference</b> is a short sequence of characters, beginning
with an ampersand, that represents a single character that might
otherwise have syntactic significance.] Each predefined entity
reference is replaced by the character it represents when the
string literal is processed. The predefined entity references
recognized by XQuery are as follows:</p>
<table class="xquery" summary="Special characters" width="60%" 
border="1">
<tbody>
<tr>
<td align="center">Entity Reference</td>
<td align="center">Character Represented</td>
</tr>
<tr>
<td align="center"><code>&amp;lt;</code></td>
<td align="center"><code>&lt;</code></td>
</tr>
<tr>
<td align="center"><code>&amp;gt;</code></td>
<td align="center"><code>&gt;</code></td>
</tr>
<tr>
<td align="center"><code>&amp;amp;</code></td>
<td align="center"><code>&amp;</code></td>
</tr>
<tr>
<td align="center"><code>&amp;quot;</code></td>
<td align="center"><code>"</code></td>
</tr>
<tr>
<td align="center"><code>&amp;apos;</code></td>
<td align="center"><code>'</code></td>
</tr>
</tbody>
</table>
<p class="xquery">A string literal may also contain a <b>character
reference</b> . [ <a title="character reference" 
id="dt-character-reference" name="dt-character-reference">Definition</a>
 : A <b>character
reference</b> is an XML-style reference to a <a href="#Unicode">[Unicode]</a>
 character, identified by its decimal or
hexadecimal <del class="diff-old">code point.]</del> <ins 
class="diff-chg">codepoint.]</ins> For example, the Euro symbol (€) can
be represented by the character reference <code>&amp;#8364;</code>
. Character references are normatively defined in Section 4.1 of
the XML specification (it is <a title="implementation defined" 
href="#dt-implementation-defined">implementation-defined</a>
whether the rules in <a href="#XML">[XML 1.0]</a> or <a href="#XML1.1">[XML
 1.1]</a> apply.) A <a title="static error" href="#dt-static-error">static
 error</a> [ <a title="err:XQST0090" href="#ERRXQST0090">err:XQST0090</a>
 ] is raised if a character
reference does not identify a valid character in the version of XML
that is in use.</p>
<p>Here are some examples of literal expressions:</p>
<ul>
<li>
<p><code>"12.5"</code> denotes the string containing the characters
'1', '2', '.', and '5'.</p>
</li>
<li>
<p><code>12</code> denotes the <code>xs:integer</code> value
twelve.</p>
</li>
<li>
<p><code>12.5</code> denotes the <code>xs:decimal</code> value
twelve and one half.</p>
</li>
<li>
<p><code>125E2</code> denotes the <code>xs:double</code> value
twelve thousand, five hundred.</p>
</li>
<li>
<p><code>"He said, ""I don't like it."""</code> denotes a string
containing two quotation marks and one apostrophe.</p>
</li>
<li>
<p><code>"Ben &amp;amp; Jerry&amp;apos;s"</code> denotes the
<code>xs:string</code> value " <code>Ben &amp; Jerry's</code>
".</p>
</li>
<li>
<p><code>"&amp;#8364;99.50"</code> denotes the
<code>xs:string</code> value " <code>€99.50</code> ".</p>
</li>
</ul>
<p>The <code>xs:boolean</code> values <code>true</code> and
<code>false</code> can be represented by calls to the <a title="built-in
 function" href="#dt-built-in-function">built-in
functions</a> <code>fn:true()</code> and <code>fn:false()</code> ,
respectively.</p>
<p>Values of other atomic types can be constructed by calling the
<a title="constructor function" href="#dt-constructor-function">constructor
 function</a> for the given
type. The constructor functions for XML Schema built-in types are
defined in <a href="#xpath-functions-11">[XQuery <del class="diff-old">1.0</del>
 and XPath <del class="diff-old">2.0</del>
Functions and <del class="diff-old">Operators]</del> <ins 
class="diff-chg">Operators 1.1]</ins></a> . In general, the name of a
constructor function for a given type is the same as the name of
the type (including its namespace). For example:</p>
<ul>
<li>
<p><code>xs:integer("12")</code> returns the integer value
twelve.</p>
</li>
<li>
<p><code>xs:date("2001-08-25")</code> returns an item whose type is
<code>xs:date</code> and whose value represents the date 25th
August 2001.</p>
</li>
<li>
<p><code>xs:dayTimeDuration("PT5H")</code> returns an item whose
type is <code>xs:dayTimeDuration</code> and whose value represents
a duration of five hours.</p>
</li>
</ul>
<p>Constructor functions can also be used to create special values
that have no literal representation, as in the following
examples:</p>
<ul>
<li>
<p><code>xs:float("NaN")</code> returns the special floating-point
value, "Not a Number."</p>
</li>
<li>
<p><code>xs:double("INF")</code> returns the special
double-precision value, "positive infinity."</p>
</li>
</ul>
<p>It is also possible to construct values of various types by
using a <code>cast</code> expression. For example:</p>
<ul>
<li>
<p><code>9 cast as hatsize</code> returns the atomic value
<code>9</code> whose type is <code>hatsize</code> .</p>
</li>
</ul>
</div>
<div class="div3">
<h4><a id="id-variables" name="id-variables"></a> 3.1.2 Variable
References</h4>
<h5><a id="N125A8" name="N125A8"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-VarRef" name="doc-xquery11-VarRef"></a>
<del class="diff-old">[87]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[128]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-VarRef">VarRef</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"$" <a href="#doc-xquery11-VarName">VarName</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-VarName" name="doc-xquery11-VarName"></a>
<del class="diff-old">[88]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[129]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-VarName">VarName</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">QName</del> <a 
href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a></code></td>
</tr>
</tbody>
</table>
<p>[ <a title="variable reference" id="dt-variable-reference" 
name="dt-variable-reference">Definition</a> : A <b>variable
reference</b> is <del class="diff-old">a QName</del> <ins 
class="diff-chg">an EQName</ins> preceded by a $-sign.] Two variable
references are equivalent if their local names are the same and
their namespace prefixes are bound to the same namespace URI in the
<a title="statically known namespaces" href="#dt-static-namespaces">statically
 known namespaces</a> . An
unprefixed variable reference is in no namespace.</p>
<p>Every variable reference must match a name in the <a title="in-scope 
variables" href="#dt-in-scope-variables">in-scope
variables</a> , which include variables from the following
sources:</p>
<ol class="enumar">
<li>
<p>A variable may be declared in a <a title="Prolog" href="#dt-prolog">Prolog</a>
 , in the current <a title="module" href="#dt-module">module</a> or an <b>imported
 module</b> . See <a href="#id-query-prolog"><b>4 Modules and Prologs</b></a>
 for a
discussion of modules and Prologs.</p>
</li>
<li>
<p>The <a title="in-scope variables" href="#dt-in-scope-variables">in-scope
 variables</a> may be augmented by
<a title="implementation defined" href="#dt-implementation-defined">implementation-defined</a>
variables.</p>
</li>
<li>
<p>A variable may be bound by an XQuery <ins class="diff-new">1.1</ins> 
expression. <span class="xquery">The kinds of
expressions that can bind variables are FLWOR expressions (
<a href="#id-flwor-expressions"><b><del class="diff-old">3.8</del>
<ins class="diff-chg">3.9</ins> FLWOR Expressions</b></a> ),
quantified expressions ( <a href="#id-quantified-expressions"><b><del 
class="diff-old">3.11</del>
<ins class="diff-chg">3.13</ins> Quantified Expressions</b></a> ),
and <code>typeswitch</code> expressions ( <a href="#id-typeswitch"><b><del
 class="diff-old">3.12.2</del> <ins class="diff-chg">3.15.2</ins> 
Typeswitch</b></a> ). Function calls also
bind values to the formal parameters of functions before executing
the function body.</span></p>
</li>
</ol>
<p>Every variable binding has a static scope. The scope defines
where references to the variable can validly occur. It is a
<a title="static error" href="#dt-static-error">static error</a> [
<a title="err:XPST0008" href="#ERRXPST0008">err:XPST0008</a> ] to
reference a variable that is not in scope. If a variable is bound
in the <a title="static context" href="#dt-static-context">static
context</a> for an expression, that variable is in scope for the
entire expression.</p>
<p class="xquery">A reference to a variable that was declared
<code>external</code> , but was not bound to a value by the
external environment, raises a dynamic error [ <a title="err:XPDY0002" 
href="#ERRXPDY0002">err:XPDY0002</a> ].</p>
<p>If a variable reference matches two or more variable bindings
that are in scope, then the reference is taken as referring to the
inner binding, that is, the one whose scope is smaller. At
evaluation time, the value of a variable reference is the value of
the expression to which the relevant variable is bound. The scope
of a variable binding is defined separately for each kind of
expression that can bind variables.</p>
</div>
<div class="div3">
<h4><a id="id-paren-expressions" name="id-paren-expressions"></a>
3.1.3 Parenthesized Expressions</h4>
<h5><a id="N12629" name="N12629"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ParenthesizedExpr" 
name="doc-xquery11-ParenthesizedExpr"></a> <del class="diff-old">[89]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[130]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ParenthesizedExpr">ParenthesizedExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"(" <a href="#doc-xquery11-Expr">Expr</a> ?
")"</code></td>
</tr>
</tbody>
</table>
<p>Parentheses may be used to enforce a particular evaluation order
in expressions that contain multiple operators. For example, the
expression <code>(2 + 4) * 5</code> evaluates to thirty, since the
parenthesized expression <code>(2 + 4)</code> is evaluated first
and its result is multiplied by five. Without parentheses, the
expression <code>2 + 4 * 5</code> evaluates to twenty-two, because
the multiplication operator has higher precedence than the addition
operator.</p>
<p>Empty parentheses are used to denote an empty sequence, as
described in <a href="#construct_seq"><b><del class="diff-old">3.3.1</del>
 <ins class="diff-chg">3.4.1</ins>
Constructing Sequences</b></a> .</p>
</div>
<div class="div3">
<h4><a id="id-context-item-expression" name="id-context-item-expression"></a>
 3.1.4 Context Item
Expression</h4>
<h5><a id="N12650" name="N12650"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ContextItemExpr" 
name="doc-xquery11-ContextItemExpr"></a> <del class="diff-old">[90]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[131]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ContextItemExpr">ContextItemExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"."</code></td>
</tr>
</tbody>
</table>
<p>A <b>context item expression</b> evaluates to the <a title="context 
item" href="#dt-context-item">context item</a> , which may
be either a node (as in the expression
<code>fn:doc("bib.xml")/books/book[fn:count(./author)&gt;1]</code>
) or an atomic value (as in the expression <code>(1 to 100)[. mod 5
eq 0]</code> ).</p>
<p>If the <a title="context item" href="#dt-context-item">context
item</a> is undefined, a context item expression raises a dynamic
error [ <a title="err:XPDY0002" href="#ERRXPDY0002">err:XPDY0002</a> ].</p>
</div>
<div class="div3">
<h4><a id="id-function-calls" name="id-function-calls"></a> 3.1.5
Function Calls</h4>
<p>[ <a title="built-in function" id="dt-built-in-function" 
name="dt-built-in-function">Definition</a> : The <b>built-in
functions</b> supported by XQuery <ins class="diff-new">1.1</ins>
are defined in <a href="#xpath-functions-11">[XQuery <del 
class="diff-old">1.0</del> and XPath <del class="diff-old">2.0</del>
Functions and <del class="diff-old">Operators]</del> <ins 
class="diff-chg">Operators 1.1]</ins></a> .] <span class="xquery">Additional
 functions may be declared in a <a title="Prolog" href="#dt-prolog">Prolog</a>
 , imported from a <a title="library module" href="#dt-library-module">library
 module</a> , or
provided by the external environment as part of the <a title="static 
context" href="#dt-static-context">static context</a>
.</span></p>
<h5><a id="N12696" name="N12696"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-FunctionCall" name="doc-xquery11-FunctionCall"></a>
 <del class="diff-old">[93]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[134]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-FunctionCall">FunctionCall</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">QName</del> <a 
href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a>
<del class="diff-old">"(" ( ExprSingle</del> <a 
href="#doc-xquery11-ArgumentList"><ins class="diff-chg">ArgumentList</ins></a>
 <del class="diff-old">(","</del></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-Argument" name="doc-xquery11-Argument"></a>
<ins class="diff-chg">[135]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-Argument"><ins class="diff-chg">Argument</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ExprSingle">ExprSingle</a>
<del class="diff-old">)*)? ")"</del> <ins class="diff-chg">|</ins>
<a href="#doc-xquery11-ArgumentPlaceholder"><ins class="diff-chg">ArgumentPlaceholder</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ArgumentPlaceholder" 
name="doc-xquery11-ArgumentPlaceholder"></a><ins class="diff-chg">[136]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ArgumentPlaceholder"><ins 
class="diff-chg">ArgumentPlaceholder</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"?"</ins></code></td>
</tr>
</tbody>
</table>
<p>A <b>function call</b> consists of a <del class="diff-old">QName</del>
 <ins class="diff-chg">EQName</ins> followed
by a parenthesized list of zero or more <del class="diff-old">expressions,
 called</del> <ins class="diff-chg">arguments. [</ins> <a 
title="argument expression" id="dt-arg-expr" name="dt-arg-expr"><ins 
class="diff-chg">Definition</ins></a> :<ins class="diff-chg">An argument
to a function call is either an</ins> <b><del class="diff-old">arguments
 .</del> <ins class="diff-chg">argument
expression</ins></b> <ins class="diff-chg">or an
ArgumentPlaceholder ("?").]</ins> If the <del class="diff-old">QName</del>
 <ins class="diff-chg">EQName</ins> in the
function call has no namespace prefix, it is considered to be in
the <a title="default function namespace" href="#dt-def-fn-ns">default 
function namespace.</a></p>
<p>If the <a title="expanded QName" href="#dt-expanded-qname">expanded 
QName</a> and number of arguments in
a function call do not match the name and arity of a <a title="function 
signature" href="#dt-function-signature">function
signature</a> in the <a title="static context" href="#dt-static-context">static
 context</a> , a <a title="static error" href="#dt-static-error">static 
error</a> is raised [ <a title="err:XPST0017" href="#ERRXPST0017">err:XPST0017</a>
 ].</p>
<p><ins class="diff-new">[</ins> <a title="partial function application"
 id="dt-partial-function-application" 
name="dt-partial-function-application"><ins class="diff-new">Definition</ins></a>
 : A function call is <del class="diff-old">evaluated</del> <ins 
class="diff-chg">a</ins>
<b><ins class="diff-chg">partial function application</ins></b>
<ins class="diff-chg">if one or more arguments is an
ArgumentPlaceholder.] Evaluation of partial function applications
is described in</ins> <a href="#id-partial-function-application"><b><ins
 class="diff-chg">3.1.5.4
Evaluating Partial Function Applications</ins></b></a> ,<ins 
class="diff-chg">while evaluation of (non-partial) function calls is
described in</ins> <a href="#id-eval-function-call"><b><ins 
class="diff-chg">3.1.5.1 Evaluating Function Calls</ins></b></a> .</p>
<p><ins class="diff-chg">Since the arguments of a function call are
separated by commas, any</ins> <a title="argument expression" 
href="#dt-arg-expr"><ins class="diff-chg">argument expression</ins></a>
<ins class="diff-chg">that contains a top-level</ins> <a title="comma 
operator" href="#dt-comma-operator"><ins class="diff-chg">comma operator</ins></a>
 <ins class="diff-chg">must be
enclosed in parentheses. Here are some illustrative examples of
function calls:</ins></p>
<ul>
<li>
<p><code><ins class="diff-chg">my:three-argument-function(1, 2,
3)</ins></code> <ins class="diff-chg">denotes a function call with
three arguments.</ins></p>
</li>
<li>
<p><code><ins class="diff-chg">my:two-argument-function((1, 2),
3)</ins></code> <ins class="diff-chg">denotes a function call with
two arguments, the first of which is a sequence of two
values.</ins></p>
</li>
<li>
<p><code><ins class="diff-chg">my:two-argument-function(1,
())</ins></code> <ins class="diff-chg">denotes a function call with
two arguments, the second of which is an empty sequence.</ins></p>
</li>
<li>
<p><code><ins class="diff-chg">my:one-argument-function((1, 2,
3))</ins></code> <ins class="diff-chg">denotes a function call with
one argument that is a sequence of three values.</ins></p>
</li>
<li>
<p><code><ins class="diff-chg">my:one-argument-function((
))</ins></code> <ins class="diff-chg">denotes a function call with
one argument that is an empty sequence.</ins></p>
</li>
<li>
<p><code><ins class="diff-chg">my:zero-argument-function(
)</ins></code> <ins class="diff-chg">denotes a function call with
zero arguments.</ins></p>
</li>
</ul>
<div class="div4">
<h5><a id="id-eval-function-call" name="id-eval-function-call"></a><ins 
class="diff-chg">3.1.5.1
Evaluating Function Calls</ins></h5>
<p><ins class="diff-chg">The result of a function call on a
function or</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#dt-function-item"><ins 
class="diff-chg">
function item</ins></a> <sup><small><ins class="diff-chg">DM11</ins></small></sup>
 <code><ins class="diff-chg">$f</ins></code> <ins class="diff-chg">is
calculated</ins> as follows:</p>
<ol class="enumar">
<li>
<p><ins class="diff-new">[</ins> <a title="argument value" 
id="dt-arg-value" name="dt-arg-value"><ins class="diff-new">Definition</ins></a>
 :<a title="argument expression" href="#dt-arg-expr">Argument 
expressions</a> are evaluated,
producing <b>argument <del class="diff-old">values.</del>
<ins class="diff-chg">values</ins></b> .] The order of argument
evaluation is <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a> and a
function need not evaluate an argument if the function can evaluate
its body without evaluating that argument.</p>
</li>
<li>
<p>Each argument value is converted by applying the <a title="function 
conversion rules" href="#dt-function-conversion">function
conversion rules <del class="diff-old">listed below.</del></a>
.</p>
</li>
<li>
<p>If <ins class="diff-new">$f is a</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#dt-function-item"><ins 
class="diff-new">
function item</ins></a> <sup><small><ins class="diff-new">DM11</ins></small></sup>
 ,<ins class="diff-new">then the
set of variable values from</ins> the function <ins class="diff-new">item's
 closure are added to the dynamic context with a
scope of the invocation of the function.</ins></p>
</li>
<li>
<p><ins class="diff-new">If</ins> <code><ins class="diff-new">$f</ins></code>
 is a built-in function, it is evaluated
using the converted argument values. The result is either an
instance of the function's declared return type or a dynamic error.
Errors raised by built-in functions are defined in <a 
href="#xpath-functions-11">[XQuery <del class="diff-old">1.0</del> and
XPath <del class="diff-old">2.0</del> Functions and <del 
class="diff-old">Operators]</del> <ins class="diff-chg">Operators
1.1]</ins></a> .</p>
</li>
<li>
<p>If <del class="diff-old">the function</del> <code><ins 
class="diff-chg">$f</ins></code> is a user-declared function that has a
body, the converted argument values are bound to the formal
parameters of <del class="diff-old">the function,</del>
<code><ins class="diff-chg">$f</ins></code> , and the function body
is evaluated. The value returned by the function body is then
converted to the declared return type of <del class="diff-old">the
function</del> <code><ins class="diff-chg">$f</ins></code> by
applying the <a title="function conversion rules" 
href="#dt-function-conversion">function conversion <del class="diff-old">rules.</del>
 <ins class="diff-chg">rules</ins></a> .</p>
<p>When a converted argument value is bound to a function
parameter, the argument value retains its most specific <a 
title="dynamic type" href="#dt-dynamic-type">dynamic type</a> , even
though this type may be derived from the type of the formal
parameter. For example, a function with a parameter <code>$p</code>
of type <code>xs:decimal</code> can be invoked with an argument of
type <code>xs:integer</code> , which is derived from
<code>xs:decimal</code> . During the processing of this function
invocation, the <a title="dynamic type" href="#dt-dynamic-type">dynamic 
type</a> of <code>$p</code> inside the
body of the function is considered to be <code>xs:integer</code> .
Similarly, the value returned by a function retains its most
specific type, which may be derived from the declared return type
of <del class="diff-old">the function.</del> <code><ins class="diff-chg">$f</ins></code>
 . For example, a function that has a
declared return type of <code>xs:decimal</code> may in fact return
a value of dynamic type <code>xs:integer</code> .</p>
<p>During evaluation of a function body, the <a title="static context" 
href="#dt-static-context">static context</a> and
<a title="dynamic context" href="#dt-dynamic-context">dynamic
context</a> for expression evaluation are defined by the
<span class="xquery"><a title="module" href="#dt-module">module</a>
<ins class="diff-new">or</ins></span> <ins class="diff-new">expression</ins>
 in which the function is declared,
which is not necessarily the same as the <del class="diff-old">module</del>
 <ins class="diff-chg">context</ins> in
which the function is called. For example, the variables in scope
while evaluating a function body are defined by <ins class="diff-new">the</ins>
 in-scope variables <del class="diff-old">of
the module that declares the function</del> <ins class="diff-chg">where 
it is declared,</ins> rather than <del class="diff-old">the module</del>
 <ins class="diff-chg">those</ins> in
<del class="diff-old">which</del> <ins class="diff-chg">scope
where</ins> the function is called. During evaluation of a function
body, the <a title="focus" href="#dt-focus">focus</a> (context
item, context position, and context size) is undefined, except
where it is defined by some expression inside the function
body.</p>
</li>
<li>
<p>If <del class="diff-old">the function</del> <code><ins 
class="diff-chg">$f</ins></code> is a user-declared external function,
its <a title="function implementation" 
href="#dt-function-implementation">function implementation</a> is
invoked with the converted argument values. The result is either a
value of the declared type or an <a title="implementation defined" 
href="#dt-implementation-defined">implementation-defined</a> error
(see <a href="#id-consistency-constraints"><b>2.2.5 Consistency
Constraints</b></a> ).</p>
</li>
</ol>
</div>
<div class="div4">
<h5><a id="id-function-conversion-rules" 
name="id-function-conversion-rules"></a> <ins class="diff-new">3.1.5.2
Function Conversion Rules</ins></h5>
<p><ins class="diff-new">[</ins> <a title="function conversion rules" 
id="dt-function-conversion" name="dt-function-conversion"><ins 
class="diff-new">Definition</ins></a>
: The <b>function conversion rules</b> are used to convert an
argument value <span class="xquery">or a return value</span> to its
expected type; that is, to the declared type of the function
<span class="xquery">parameter or return.</span> <ins class="diff-chg">]</ins>
 The expected type is expressed as a <a title="sequence type" 
href="#dt-sequence-type">sequence type</a> . The
function conversion rules are applied to a given value as
follows:</p>
<ul>
<li>
<p>If the expected type is a sequence of an atomic type (possibly
with an occurrence indicator <code>*</code> , <code>+</code> , or
<code>?</code> ), the following conversions are applied:</p>
<ol class="enumar">
<li>
<p><a title="atomization" href="#dt-atomization">Atomization</a> is
applied to the given value, resulting in a sequence of atomic
values.</p>
</li>
<li>
<p>Each item in the atomic sequence that is of type
<code>xs:untypedAtomic</code> is cast to the expected atomic type.
For <a title="built-in function" href="#dt-built-in-function">built-in 
functions</a> where the expected
type is specified as <a title="numeric" href="#dt-numeric">numeric</a> ,
 arguments of type
<code>xs:untypedAtomic</code> are cast to <code>xs:double</code>
.</p>
</li>
<li>
<p>For each <a title="numeric" href="#dt-numeric">numeric</a> item
in the atomic sequence that can be <a title="type promotion" 
href="#dt-type-promotion">promoted</a> to the expected atomic type using
numeric promotion as described in <a href="#promotion"><b>B.1 Type
Promotion</b></a> , the promotion is done.</p>
</li>
<li>
<p>For each item of type <code>xs:anyURI</code> in the atomic
sequence that can be <a title="type promotion" href="#dt-type-promotion">promoted</a>
 to the expected atomic type using
URI promotion as described in <a href="#promotion"><b>B.1 Type
Promotion</b></a> , the promotion is done.</p>
</li>
</ol>
</li>
<li>
<p><ins class="diff-new">If the expected type is a</ins> <a 
href="#doc-xquery11-TypedFunctionTest"><ins class="diff-new">TypedFunctionTest</ins></a>
 <ins class="diff-new">(possibly with an occurrence indicator</ins>
<code><ins class="diff-new">*</ins></code> ,<code><ins class="diff-new">+</ins></code>
 ,<ins class="diff-new">or</ins>
<code><ins class="diff-new">?</ins></code> <ins class="diff-new">),</ins>
 <a title="function item coercion" href="#dt-function-item-coercion"><ins
 class="diff-new">function item
coercion</ins></a> <ins class="diff-new">is applied to each
function item in the given value.</ins></p>
</li>
<li>
<p>If, after the above conversions, the resulting value does not
match the expected type according to the rules for <a 
title="SequenceType matching" href="#dt-sequencetype-matching">SequenceType
 Matching</a> , a <a title="type error" href="#dt-type-error">type error</a>
 is raised [
<a title="err:XPTY0004" href="#ERRXPTY0004">err:XPTY0004</a> ].
<span class="xquery">If the function call takes place in a
<a title="module" href="#dt-module">module</a> other than the
<a title="module" href="#dt-module">module</a> in which the
function is defined, this rule must be satisfied in both the module
where the function is called and the module where the function is
defined (the test is repeated because the two modules may have
different <a title="in-scope schema definitions" href="#dt-issd">in-scope
 schema definitions</a> .)</span> Note that the
rules for <a title="SequenceType matching" 
href="#dt-sequencetype-matching">SequenceType Matching</a> permit a
value of a derived type to be substituted for a value of its base
type.</p>
</li>
</ul>
</div>
<div class="div4">
<h5><a id="id-function-coercion" name="id-function-coercion"></a>
<ins class="diff-new">3.1.5.3 Function Item Coercion</ins></h5>
<p><del class="diff-old">Since</del> <ins class="diff-chg">Function
item coercion is a transformation applied to</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#dt-function-item"><ins 
class="diff-chg">
function items</ins></a> <sup><small><ins class="diff-chg">DM11</ins></small></sup>
 <ins class="diff-chg">during
application of the</ins> <a title="function conversion rules" 
href="#dt-function-conversion"><ins class="diff-chg">function conversion
rules</ins></a> .<ins class="diff-chg">[</ins> <a title="function item 
coercion" id="dt-function-item-coercion" 
name="dt-function-item-coercion"><ins class="diff-chg">Definition</ins></a>
 :<b><ins class="diff-chg">Function
item coercion</ins></b> <ins class="diff-chg">wraps a</ins>
<a href="http://www.w3.org/TR/xpath-datamodel-11/#dt-function-item">
<ins class="diff-chg">function item</ins></a>
<sup><small><ins class="diff-chg">DM11</ins></small></sup>
<ins class="diff-chg">in a new</ins> <a title="inline function" 
href="#dt-inline-func"><ins class="diff-chg">inline
function</ins></a> <ins class="diff-chg">with signature the same as
the expected type. This effectively delays the checking of the
argument and return types until the function item is
invoked.]</ins></p>
<p><ins class="diff-chg">Function item coercion is only defined to
operate on</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#dt-function-item"><ins 
class="diff-chg">
function items</ins></a> <sup><small><ins class="diff-chg">DM11</ins></small></sup>
 .<ins class="diff-chg">Given a
function item,</ins> <code><ins class="diff-chg">$function</ins></code> ,<ins
 class="diff-chg">function
item coercion returns a new function item with the following
properties (as defined in</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#function-items"><ins 
class="diff-chg">
Section 2.7 Function Items</ins></a> <sup><small><ins class="diff-chg">DM11</ins></small></sup>
 <ins class="diff-chg">):</ins></p>
<ul>
<li>
<p><ins class="diff-chg">An empty set of variable values.</ins></p>
</li>
<li>
<p><ins class="diff-chg">The name of</ins> <code><ins class="diff-chg">$function</ins></code>
 .</p>
</li>
<li>
<p><ins class="diff-chg">A</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#dt-signature"><ins 
class="diff-chg">function signature</ins></a> <sup><small><ins 
class="diff-chg">DM11</ins></small></sup> <ins class="diff-chg">equal to
the expected type for the function argument or return
type.</ins></p>
</li>
<li>
<p><ins class="diff-chg">A new function, whose result is calculated
by invoking</ins> <code><ins class="diff-chg">$function</ins></code> <ins
 class="diff-chg">with</ins>
the arguments <ins class="diff-new">that were specified at the new
function's invocation.</ins></p>
</li>
</ul>
<p><ins class="diff-new">If the result</ins> of <ins class="diff-new">invoking
 the new function item would necessarily result
in</ins> a <ins class="diff-new">type error, that error may be
raised during</ins> function <del class="diff-old">call</del>
<ins class="diff-chg">coercion. It is implementation dependent
whether this happens or not.</ins></p>
<p><ins class="diff-chg">These rules have the following
consequences:</ins></p>
<ul>
<li>
<p><ins class="diff-chg">SequenceType matching of the function
item's arguments and result</ins> are <del class="diff-old">separated</del>
 <ins class="diff-chg">delayed until that
function item is invoked.</ins></p>
</li>
<li>
<p><ins class="diff-chg">The function conversion rules applied to
the function item's arguments and result are defined</ins> by
<del class="diff-old">commas,</del> <ins class="diff-chg">the
SequenceType it has most recently been coerced to. Additional
function conversion rules could apply when the wrapped function
item is invoked.</ins></p>
</li>
<li>
<p><ins class="diff-chg">If an implementation has static type
information about a function item, that can be used to type check
the function item's argument and return types during static
analysis.</ins></p>
</li>
</ul>
<p><ins class="diff-chg">For instance, consider the following
query:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
declare function local:filter($s as item()*, $p as function(xs:string) as xs:boolean) as item()*
{
  $s[$p(.)]
};
let $f := function($a) { starts-with($a, "E") }
return
  local:filter(("Ethel", "Enid", "Gertrude"), $f)
      
</ins>
</pre></div>
<p><ins class="diff-chg">The function item</ins> <code><ins 
class="diff-chg">$f</ins></code> <ins class="diff-chg">has a static type
of</ins> <code><ins class="diff-chg">function(item()*) as
item()*</ins></code> .<ins class="diff-chg">When the</ins>
<code><ins class="diff-chg">local:filter()</ins></code> <ins 
class="diff-chg">function is called, the following occurs to the 
function
item:</ins></p>
<ol class="enumar">
<li>
<p><ins class="diff-chg">The function conversion rules result in
applying function coercion to</ins> <code><ins class="diff-chg">$function</ins></code>
 ,<ins class="diff-chg">wrapping
$f in a new inline function ($p) with the signature</ins>
<code><ins class="diff-chg">function(xs:string) as
xs:boolean</ins></code> .</p>
</li>
<li>
<p><ins class="diff-chg">$p is matched against the SequenceType
of</ins> <code><ins class="diff-chg">function(xs:string) as
xs:boolean</ins></code> ,<ins class="diff-chg">and
succeeds.</ins></p>
</li>
<li>
<p><ins class="diff-chg">When $p is invoked inside the predicate,
function conversion and SequenceType matching rules are applied to
the context item argument, resulting in a</ins> <code><ins 
class="diff-chg">xs:string</ins></code> <ins class="diff-chg">value or a
type error.</ins></p>
</li>
<li>
<p><ins class="diff-chg">$f is invoked with the</ins>
<code><ins class="diff-chg">xs:string</ins></code> ,<ins 
class="diff-chg">which returns a</ins> <code><ins class="diff-chg">xs:boolean</ins></code>
 .</p>
</li>
<li>
<p><ins class="diff-chg">$p applies function conversion rules to
the result sequence from $f, which already matches its declared
return type of</ins> <code><ins class="diff-chg">xs:boolean</ins></code>
 .</p>
</li>
<li>
<p><ins class="diff-chg">The</ins> <code><ins class="diff-chg">xs:boolean</ins></code>
 <ins class="diff-chg">is
returned as the result of $p.</ins></p>
</li>
</ol>
<div class="note">
<p class="prefix"><b><ins class="diff-chg">Note:</ins></b></p>
<p><ins class="diff-chg">Although the semantics of function item
coercion are specified in terms of wrapping the function items,
static typing will often be able to reduce the number of places
where this is actually necessary.</ins></p>
</div>
</div>
<div class="div4">
<h5><a id="id-partial-function-application" 
name="id-partial-function-application"></a><ins class="diff-chg">3.1.5.4
Evaluating Partial Function Applications</ins></h5>
<p><ins class="diff-chg">The result of a</ins> <a title="partial 
function application" href="#dt-partial-function-application"><ins 
class="diff-chg">partial
function application</ins></a> <ins class="diff-chg">of a function
or</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#dt-function-item"><ins 
class="diff-chg">
function item</ins></a> <sup><small><ins class="diff-chg">DM11</ins></small></sup>
 <ins class="diff-chg">$f is a
single function item</ins> <code><ins class="diff-chg">$new</ins></code>
 <ins class="diff-chg">with the
following properties (as defined in</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#function-items"><ins 
class="diff-chg">
Section 2.7 Function Items</ins></a> <sup><small><ins class="diff-chg">DM11</ins></small></sup>
 <ins class="diff-chg">):</ins></p>
<ul>
<li>
<p><ins class="diff-chg">If</ins> <code><ins class="diff-chg">$f</ins></code>
 <ins class="diff-chg">is a function
item, the set of variable values is the same as the variable values
of</ins> <code><ins class="diff-chg">$f</ins></code> ,<ins 
class="diff-chg">otherwise it is empty.</ins></p>
</li>
<li>
<p><ins class="diff-chg">An absent name.</ins></p>
</li>
<li>
<p><ins class="diff-chg">The</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#dt-signature"><ins 
class="diff-chg">function signature</ins></a> <sup><small><ins 
class="diff-chg">DM11</ins></small></sup> <ins class="diff-chg">of</ins>
<code><ins class="diff-chg">$new</ins></code> <ins class="diff-chg">is 
the same as</ins> <code><ins class="diff-chg">$f</ins></code> ,<ins 
class="diff-chg">removing the
parameters in the positions for which</ins> any <a title="argument 
expression" href="#dt-arg-expr"><ins class="diff-new">argument 
expressions</ins></a> <ins class="diff-new">have been provided to the 
partial function application.
The function arity of</ins> <code><ins class="diff-new">$new</ins></code>
 <ins class="diff-new">is the arity
of</ins> <code><ins class="diff-new">$f</ins></code> <ins 
class="diff-new">minus the number of argument expressions
provided.</ins></p>
</li>
<li>
<p><ins class="diff-new">The result of invoking</ins>
<code><ins class="diff-new">$new</ins></code> <ins class="diff-new">is 
the result of invoking</ins> <code><ins class="diff-new">$f</ins></code>
 <ins class="diff-new">with the arguments
from the invocation of</ins> <code><ins class="diff-new">$new</ins></code>
 ,<ins class="diff-new">inserting
any</ins> <a title="argument value" href="#dt-arg-value"><ins 
class="diff-new">argument values</ins></a>
<ins class="diff-new">from the partial function application in
their respective positions.</ins></p>
</li>
</ul>
<p><ins class="diff-new">If the value of any</ins> <a title="argument 
expression" href="#dt-arg-expr">argument expression</a>
<ins class="diff-new">specified to a partial function application
cannot be converted to the required type of the corresponding
argument of</ins> <code><ins class="diff-new">$f</ins></code>
<ins class="diff-new">by applying the</ins> <a title="function 
conversion rules" href="#dt-function-conversion"><ins class="diff-new">function
 conversion
rules</ins></a> ,<ins class="diff-new">then a type error [</ins>
<a title="err:XPTY0004" href="#ERRXPTY0004"><ins class="diff-new">err:XPTY0004</ins></a>
 <ins class="diff-new">] MAY be
raised. (If a type error is not raised at this stage, it will be
raised later when the new function is invoked.)</ins></p>
<p><ins class="diff-new">The static context for evaluation of the
function item</ins> <code><ins class="diff-new">$f</ins></code>
<ins class="diff-new">is inherited from the location of the partial
function application expression, with the exception of the static
type of the context item which is initially undefined.</ins></p>
<p><ins class="diff-new">Partially applied function items cannot
access the</ins> <a title="focus" href="#dt-focus"><ins class="diff-new">focus</ins></a>
 <ins class="diff-new">(context item,
context position, and context size), which is undefined when they
are</ins> <a href="http://www.w3.org/TR/xpath-datamodel-11/#dt-invoke"><ins
 class="diff-new">invoked</ins></a> <sup><small><ins class="diff-new">DM11</ins></small></sup>
 .<ins class="diff-new">It is
a</ins> <a title="static error" href="#dt-static-error"><ins 
class="diff-new">static error</ins></a> <ins class="diff-new">to
partially apply a function which accesses the focus [</ins>
<a title="err:XPST0112" href="#ERRXPST0112"><ins class="diff-new">err:XPST0112</ins></a>
 <ins class="diff-new">].</ins></p>
</div>
</div>
<div class="div3">
<h4><a id="id-literal-func-ref" name="id-literal-func-ref"></a><ins 
class="diff-new">3.1.6 Literal
Function Items</ins></h4>
<h5><a id="N1296D" name="N1296D"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-LiteralFunctionItem" 
name="doc-xquery11-LiteralFunctionItem"></a><ins class="diff-new">[165]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-LiteralFunctionItem"><ins 
class="diff-new">LiteralFunctionItem</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-EQName"><ins class="diff-new">EQName</ins></a>
 <ins class="diff-new">"#"</ins>
<a href="#doc-xquery11-IntegerLiteral"><ins class="diff-new">IntegerLiteral</ins></a></code></td>
</tr>
</tbody>
</table>
<p><ins class="diff-new">[</ins> <a title="literal function item" 
id="dt-literal-func-item" name="dt-literal-func-item"><ins 
class="diff-new">Definition</ins></a> :<ins class="diff-new">A</ins>
<b><ins class="diff-new">literal function item</ins></b>
<ins class="diff-new">creates a</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#dt-function-item"><ins 
class="diff-new">
function item</ins></a> <sup><small><ins class="diff-new">DM11</ins></small></sup>
 that <del class="diff-old">contains</del> <ins class="diff-chg">represents</ins>
 a
<del class="diff-old">top-level comma operator</del> <a title="named 
function" href="#tm-named-func"><ins class="diff-chg">named
function</ins></a> .]<ins class="diff-chg">[</ins> <a title="named 
function" id="tm-named-func" name="tm-named-func"><ins class="diff-chg">Definition</ins></a>
:<ins class="diff-chg">A</ins> <b><ins class="diff-chg">named
function</ins></b> <ins class="diff-chg">is a function defined in
the static context for the query. To uniquely identify a particular
named function, both its name as a QName and its arity are
required.]</ins></p>
<p><ins class="diff-chg">If the EQName is a</ins> <a title="lexical 
QName" href="#dt-qname"><ins class="diff-chg">lexical
QName</ins></a> <del class="diff-old">must</del> <ins class="diff-chg">that
 has no namespace prefix, it is considered to</ins>
be <del class="diff-old">enclosed</del> in <del class="diff-old">parentheses.</del>
 <ins class="diff-chg">the default
function namespace.</ins></p>
<p><ins class="diff-chg">If the</ins> <a title="expanded QName" 
href="#dt-expanded-qname"><ins class="diff-chg">expanded
QName</ins></a> <ins class="diff-chg">and arity in a literal
function item do not match the name and arity of a function
signature in the static context, a static error is raised [</ins>
<a title="err:XPST0017" href="#ERRXPST0017"><ins class="diff-chg">err:XPST0017</ins></a>
 <ins class="diff-chg">].</ins></p>
<p><ins class="diff-chg">The result of a literal function item is a
single function item with the following properties (as defined
in</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#function-items"><ins 
class="diff-chg">
Section 2.7 Function Items</ins></a> <sup><small><ins class="diff-chg">DM11</ins></small></sup>
 <ins class="diff-chg">):</ins></p>
<ul>
<li>
<p><ins class="diff-chg">An empty set of variable values.</ins></p>
</li>
<li>
<p><ins class="diff-chg">The name specified in the literal function
item.</ins></p>
</li>
<li>
<p><ins class="diff-chg">The</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#dt-signature"><ins 
class="diff-chg">function signature</ins></a> <sup><small><ins 
class="diff-chg">DM11</ins></small></sup> <ins class="diff-chg">of the
function from the static context that matches the name and arity
given.</ins></p>
</li>
<li>
<p><ins class="diff-chg">The function from the static context that
matches the name and arity given.</ins></p>
</li>
</ul>
<p><ins class="diff-chg">The static context for evaluation of the
function item is inherited from the location of the literal
function item expression, with the exception of the static type of
the context item which is initially undefined.</ins></p>
<p><ins class="diff-chg">Literal function items cannot access
the</ins> <a title="focus" href="#dt-focus"><ins class="diff-chg">focus</ins></a>
 <ins class="diff-chg">(context item,
context position, and context size), which is undefined when they
are</ins> <a href="http://www.w3.org/TR/xpath-datamodel-11/#dt-invoke"><ins
 class="diff-chg">invoked</ins></a> <sup><small><ins class="diff-chg">DM11</ins></small></sup>
 .<ins class="diff-chg">It is
a</ins> <a title="static error" href="#dt-static-error"><ins 
class="diff-chg">static error</ins></a> <ins class="diff-chg">to create a
function item for a function which accesses the focus [</ins>
<a title="err:XPST0112" href="#ERRXPST0112"><ins class="diff-chg">err:XPST0112</ins></a>
 <ins class="diff-chg">].</ins></p>
<div class="note">
<p class="prefix"><b><ins class="diff-chg">Note:</ins></b></p>
<p><ins class="diff-chg">User-declared functions cannot access the
focus, so this error only applies to built-in functions
like:</ins></p>
<ul>
<li>
<p><code><ins class="diff-chg">fn:position#0</ins></code></p>
</li>
<li>
<p><code><ins class="diff-chg">fn:last#0</ins></code></p>
</li>
<li>
<p><code><ins class="diff-chg">fn:name#0</ins></code></p>
</li>
<li>
<p><code><ins class="diff-chg">fn:namespace-uri#0</ins></code></p>
</li>
<li>
<p><code><ins class="diff-chg">fn:local-name#0</ins></code></p>
</li>
<li>
<p><code><ins class="diff-chg">fn:number#0</ins></code></p>
</li>
<li>
<p><code><ins class="diff-chg">fn:string#0</ins></code></p>
</li>
<li>
<p><code><ins class="diff-chg">fn:string-length#0</ins></code></p>
</li>
<li>
<p><code><ins class="diff-chg">fn:normalize-space#0</ins></code></p>
</li>
<li>
<p><code><ins class="diff-chg">fn:root#0</ins></code></p>
</li>
<li>
<p><code><ins class="diff-chg">fn:id#1</ins></code></p>
</li>
<li>
<p><code><ins class="diff-chg">fn:idref#1</ins></code></p>
</li>
<li>
<p><code><ins class="diff-chg">fn:lang#1</ins></code></p>
</li>
<li>
<p><code><ins class="diff-chg">fn:base-uri#0</ins></code></p>
</li>
</ul>
</div>
<p><ins class="diff-chg">Certain functions in the</ins> <a 
href="#xpath-functions-11"><ins class="diff-chg">[XQuery and XPath
Functions and Operators 1.1]</ins></a> <ins class="diff-chg">specification
 are defined to be polymorphic. These are
denoted as accepting parameters of "numeric" type, or returning
"numeric" type.</ins> Here <ins class="diff-new">"numeric" is a
pseudonym for the four primitive numeric types xs:decimal,
xs:integer, xs:float, and xs:double. The functions in question
are:</ins></p>
<ul>
<li>
<p><code><ins class="diff-new">fn:abs</ins></code></p>
</li>
<li>
<p><code><ins class="diff-new">fn:ceiling</ins></code></p>
</li>
<li>
<p><code><ins class="diff-new">fn:floor</ins></code></p>
</li>
<li>
<p><code><ins class="diff-new">fn:round</ins></code></p>
</li>
<li>
<p><code><ins class="diff-new">fn:round-half-to-even</ins></code></p>
</li>
</ul>
<p><ins class="diff-new">For the purposes of literal function
items, these functions are regarded as taking arguments and
producing results of type xs:anyAtomicType, with a type error
raised at runtime if the argument value provided is not of the
correct numeric type.</ins></p>
<div class="note">
<p class="prefix"><b><ins class="diff-new">Note:</ins></b></p>
<p><ins class="diff-new">The above way of modeling polymorphic
functions is semantically backwards compatible with XQuery 1.0. An
implementation that supports static typing can choose to model the
types of these functions more accurately if desired.</ins></p>
</div>
<p><ins class="diff-new">The following</ins> are <del class="diff-old">some
 illustrative</del> examples of <ins class="diff-new">some literal</ins>
 function <del class="diff-old">calls:</del> <ins class="diff-chg">item
expressions:</ins></p>
<ul>
<li>
<p><code><del class="diff-old">my:three-argument-function(1, 2,
3)</del> <ins class="diff-chg">fn:abs#1</ins></code> <del 
class="diff-old">denotes</del> <ins class="diff-chg">references the
fn:abs function which takes</ins> a <ins class="diff-new">single
argument.</ins></p>
</li>
<li>
<p><code><ins class="diff-new">fn:concat#5</ins></code> <ins 
class="diff-new">references the fn:concat</ins> function <del 
class="diff-old">call with three</del> <ins class="diff-chg">which takes
5</ins> arguments.</p>
</li>
<li>
<p><code><del class="diff-old">my:two-argument-function((1, 2),
3)</del> <ins class="diff-chg">local:myfunc#2</ins></code>
<del class="diff-old">denotes</del> <ins class="diff-chg">references</ins>
 a function <del class="diff-old">call</del> <ins class="diff-chg">named
 local:myfunc
which takes 2 arguments.</ins></p>
</li>
</ul>
</div>
<div class="div3">
<h4><a id="id-inline-func" name="id-inline-func"></a><ins 
class="diff-chg">3.1.7 Inline Functions</ins></h4>
<h5><a id="N12A79" name="N12A79"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-InlineFunction" 
name="doc-xquery11-InlineFunction"></a><ins class="diff-chg">[166]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-InlineFunction"><ins class="diff-chg">InlineFunction</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"function" "("</ins> <a 
href="#doc-xquery11-ParamList"><ins class="diff-chg">ParamList</ins></a>
<ins class="diff-chg">? ")" ("as"</ins> <a 
href="#doc-xquery11-SequenceType"><ins class="diff-chg">SequenceType</ins></a>
 <ins class="diff-chg">)?</ins>
<a href="#doc-xquery11-EnclosedExpr"><ins class="diff-chg">EnclosedExpr</ins></a></code></td>
</tr>
</tbody>
</table>
<p><ins class="diff-chg">[</ins> <a title="inline function" 
id="dt-inline-func" name="dt-inline-func"><ins class="diff-chg">Definition</ins></a>
 :<ins class="diff-chg">An</ins>
<b><ins class="diff-chg">inline function</ins></b> <ins class="diff-chg">expression
 creates a</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#dt-function-item"><ins 
class="diff-chg">
function item</ins></a> <sup><small><ins class="diff-chg">DM11</ins></small></sup>
 <ins class="diff-chg">that
represents an anonymous function defined directly in the inline
function expression itself.] An inline function specifies the names
and SequenceTypes of the parameters to the function, the
SequenceType of the result, and the body of the function.</ins></p>
<p><ins class="diff-chg">If a function parameter is declared using
a name but no type, its default type is item()*. If the result type
is omitted from a function declaration, its default result type is
item()*.</ins></p>
<p><ins class="diff-chg">The parameters of a function declaration
are considered to be variables whose scope is the function body. It
is a static error [</ins> <a title="err:XQST0039" href="#ERRXQST0039"><ins
 class="diff-chg">err:XQST0039</ins></a>
<ins class="diff-chg">] for a function declaration to have more
than one parameter</ins> with <del class="diff-old">two
arguments,</del> the <del class="diff-old">first</del> <ins 
class="diff-chg">same name.</ins></p>
<p><ins class="diff-chg">The static context for the function body
is inherited from the location of the inline function expression,
with the exception of the static type</ins> of <ins class="diff-new">the
 context item</ins> which is <ins class="diff-new">initially undefined.</ins></p>
<p><ins class="diff-new">The variables in scope for the function
body include all variables representing the function parameters, as
well as all variables that are in scope for the inline function
expression.</ins></p>
<div class="note">
<p class="prefix"><b><ins class="diff-new">Note:</ins></b></p>
<p><ins class="diff-new">Function parameter names can mask
variables that would otherwise be in scope for the function
body.</ins></p>
</div>
<p><ins class="diff-new">The result of an inline function is a
single function item with the following properties (as defined
in</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#function-items"><ins 
class="diff-new">
Section 2.7 Function Items</ins></a> <sup><small><ins class="diff-new">DM11</ins></small></sup>
 <ins class="diff-new">):</ins></p>
<ul>
<li>
<p><ins class="diff-new">The set of variable values for any
variables referenced by the inline function's body.</ins></p>
</li>
<li>
<p><ins class="diff-new">An absent name.</ins></p>
</li>
<li>
<p><ins class="diff-new">The</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#dt-signature"><ins 
class="diff-new">function signature</ins></a> <sup><small><ins 
class="diff-new">DM11</ins></small></sup> <ins class="diff-new">of the
inline function.</ins></p>
</li>
<li>
<p><ins class="diff-new">The inline function itself.</ins></p>
</li>
</ul>
<p><ins class="diff-new">The following are examples of some inline
functions:</ins></p>
<ul>
<li>
<p><ins class="diff-new">This example creates an inline function
that takes no arguments and returns</ins> a sequence of <ins 
class="diff-new">the first 6 primes:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
function() as xs:integer+ { 2, 3, 5, 7, 11, 13 }
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-new">This example creates an inline function
that takes</ins> two <del class="diff-old">values.</del>
<ins class="diff-chg">xs:double arguments and returns their
product:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">function($a as xs:double, $b as xs:double) as xs:double { $a * $b }
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-new">This example creates an inline function
that returns its item()* argument:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
function($a) { $a }
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-new">This example creates an inline function
that returns the xs:integer value 7, i.e.: the value of the
variable $a from the scope of the inline function
expression:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
let $a := 7
return
let $f := function() { $a }
return
let $a := 8
return $f()
</ins>
</pre></div>
</li>
</ul>
</div>
</div>
<div class="div2">
<h3><a id="id-postfix-expression" name="id-postfix-expression"></a><ins 
class="diff-new">3.2 Postfix
Expressions</ins></h3>
<h5><a id="N12AF4" name="N12AF4"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-PostfixExpr" name="doc-xquery11-PostfixExpr"></a><ins
 class="diff-new">[121]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">my:two-argument-function(1,
())</del> <a href="#prod-xquery11-PostfixExpr"><ins class="diff-chg">PostfixExpr</ins></a></code>
 <del class="diff-old">denotes</del></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-PrimaryExpr"><ins class="diff-chg">PrimaryExpr</ins></a>
 <ins class="diff-chg">(</ins>
<a href="#doc-xquery11-Predicate"><ins class="diff-chg">Predicate</ins></a>
 <ins class="diff-chg">|</ins>
<a href="#doc-xquery11-ArgumentList"><ins class="diff-chg">ArgumentList</ins></a>
 <ins class="diff-chg">)*</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N12B74.doc-xquery11-Predicate" 
name="noid_N12B74.doc-xquery11-Predicate"></a><ins class="diff-chg">[124]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">Predicate</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"["</ins> <a href="#doc-xquery11-Expr"><ins
 class="diff-chg">Expr</ins></a>
<ins class="diff-chg">"]"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N12B77.doc-xquery11-ArgumentList" 
name="noid_N12B77.doc-xquery11-ArgumentList"></a><ins class="diff-chg">[122]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">ArgumentList</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"(" (</ins> <a 
href="#doc-xquery11-Argument"><ins class="diff-chg">Argument</ins></a>
<ins class="diff-chg">(","</ins> <a href="#doc-xquery11-Argument"><ins 
class="diff-chg">Argument</ins></a>
<ins class="diff-chg">)*)? ")"</ins></code></td>
</tr>
</tbody>
</table>
<p><ins class="diff-chg">[</ins> <a title="filter expression" 
id="dt-filter-expression" name="dt-filter-expression"><ins 
class="diff-chg">Definition</ins></a> :<ins class="diff-chg">An
expression followed by</ins> a <ins class="diff-new">predicate
(that is,</ins> <code><ins class="diff-new">E1[E2]</ins></code>
<ins class="diff-new">) is referred to as a</ins> <b><ins 
class="diff-new">filter expression</ins></b> :<ins class="diff-new">its
effect is to return those items from the value of</ins>
<code><ins class="diff-new">E1</ins></code> <ins class="diff-new">that 
satisfy the predicate in E2.] Filter expressions
are described in</ins> <a href="#id-filter-expression"><b><ins 
class="diff-new">3.2.1 Filter
Expressions</ins></b></a></p>
<p><ins class="diff-new">[</ins> <a title="dynamic function invocation" 
id="dt-dynamic-function-invoction" name="dt-dynamic-function-invoction"><ins
 class="diff-new">Definition</ins></a> :<ins class="diff-new">An
expression (other than a raw EQName) followed by an argument list
in parentheses (that is,</ins> <code><ins class="diff-new">E1(E2,
E3, ...)</ins></code> <ins class="diff-new">) is referred to as
a</ins> <b><ins class="diff-new">dynamic</ins> function <ins 
class="diff-new">invocation</ins></b> .<ins class="diff-new">Its effect
is to evaluate</ins> <code><ins class="diff-new">E1</ins></code>
<ins class="diff-new">to obtain a function item, and then</ins>
call <del class="diff-old">with two arguments,</del> the
<del class="diff-old">second</del> <ins class="diff-chg">function
represented by that function item, with</ins> <code><ins 
class="diff-chg">E2</ins></code> ,<code><ins class="diff-chg">E3</ins></code>
 ,<code>...</code><ins class="diff-chg">as arguments.] Dynamic function 
invocations are
described in</ins> <a href="#id-dynamic-function-invocation"><b><ins 
class="diff-chg">3.2.2
Dynamic Function Invocation</ins></b></a> .</p>
<div class="div3">
<h4><a id="id-filter-expression" name="id-filter-expression"></a><ins 
class="diff-chg">3.2.1 Filter
Expressions</ins></h4>
<h5><a id="N12B63" name="N12B63"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="noid_N12BB3.doc-xquery11-PostfixExpr" 
name="noid_N12BB3.doc-xquery11-PostfixExpr"></a><ins class="diff-chg">[121]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">PostfixExpr</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-PrimaryExpr"><ins class="diff-chg">PrimaryExpr</ins></a>
 <ins class="diff-chg">(</ins>
<a href="#doc-xquery11-Predicate"><ins class="diff-chg">Predicate</ins></a>
 <ins class="diff-chg">|</ins>
<a href="#doc-xquery11-ArgumentList"><ins class="diff-chg">ArgumentList</ins></a>
 <ins class="diff-chg">)*</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-Predicate" name="doc-xquery11-Predicate"></a><ins
 class="diff-chg">[124]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-Predicate"><ins class="diff-chg">Predicate</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"["</ins> <a href="#doc-xquery11-Expr"><ins
 class="diff-chg">Expr</ins></a>
<ins class="diff-chg">"]"</ins></code></td>
</tr>
</tbody>
</table>
<p><ins class="diff-chg">A filter expression consists</ins> of
<ins class="diff-new">a base expression followed by a
predicate,</ins> which is an <del class="diff-old">empty
sequence.</del> <ins class="diff-chg">expression written in square
brackets. The result of the filter expression consists of the items
returned by the base expression, filtered by applying the predicate
to each item in turn. The ordering of the items returned by a
filter expression is the same as their order in the result of the
primary expression.</ins></p>
<div class="note">
<p class="prefix"><b><ins class="diff-chg">Note:</ins></b></p>
<p><ins class="diff-chg">Where the expression before the square
brackets is a</ins> <a href="#doc-xquery11-ReverseStep"><ins 
class="diff-chg">ReverseStep</ins></a> <ins class="diff-chg">or</ins>
<a href="#doc-xquery11-ForwardStep"><ins class="diff-chg">ForwardStep</ins></a>
 ,<ins class="diff-chg">the
expression is technically not a filter expression but an</ins>
<a href="#doc-xquery11-AxisStep"><ins class="diff-chg">AxisStep</ins></a>
 .<ins class="diff-chg">There are
minor differences in the semantics: see</ins> <a href="#id-predicate"><b><ins
 class="diff-chg">3.3.2 Predicates within
Steps</ins></b></a></p>
</div>
<p><ins class="diff-chg">Here are some examples of filter
expressions:</ins></p>
<ul>
<li>
<p><ins class="diff-new">Given a sequence of products in a
variable, return only those products whose price is greater than
100.</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
$products[price gt 100]
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-new">List all the integers from 1 to 100 that
are divisible by 5. (See</ins> <a href="#construct_seq"><b><ins 
class="diff-new">3.4.1 Constructing
Sequences</ins></b></a> <ins class="diff-new">for an explanation of
the</ins> <code><del class="diff-old">my:one-argument-function((1,
2, 3))</del> <ins class="diff-chg">to</ins></code> <del class="diff-old">denotes</del>
 <ins class="diff-chg">operator.)</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
(1 to 100)[. mod 5 eq 0]
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-chg">The result of the following expression is
the integer 25:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
(21 to 29)[5]
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-chg">The following example returns the fifth
through ninth items in the sequence bound to variable</ins>
<code><ins class="diff-chg">$orders</ins></code> .</p>
<div class="exampleInner">
<pre><ins class="diff-chg">
$orders[fn:position() = (5 to 9)]
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-chg">The following example illustrates the use
of</ins> a <del class="diff-old">function call with one argument
that</del> <ins class="diff-chg">filter expression as a</ins>
<a title="step" href="#dt-step"><ins class="diff-chg">step</ins></a> <ins
 class="diff-chg">in a</ins>
<a title="path expression" href="#dt-path-expression"><ins 
class="diff-chg">path expression</ins></a> .<ins class="diff-chg">It
returns the last chapter or appendix within the book bound to
variable</ins> <code><ins class="diff-chg">$book</ins></code> :</p>
<div class="exampleInner">
<pre><ins class="diff-chg">
$book/(chapter | appendix)[fn:last()]
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-chg">The following example also illustrates the
use of a filter expression as a</ins> <a title="step" href="#dt-step"><ins
 class="diff-chg">step</ins></a> <ins class="diff-chg">in a</ins> <a 
title="path expression" href="#dt-path-expression"><ins class="diff-chg">path
expression</ins></a> .<ins class="diff-chg">It returns the element
node within the specified document whose ID value is</ins>
<code><ins class="diff-chg">tiger</ins></code> :</p>
<div class="exampleInner">
<pre><ins class="diff-chg">
fn:doc("zoo.xml")/fn:id('tiger')
</ins>
</pre></div>
</li>
</ul>
<p><ins class="diff-chg">For each item in the input sequence, the
predicate expression is evaluated using an</ins> <b><ins 
class="diff-chg">inner focus</ins></b> ,<ins class="diff-chg">defined as
follows: The context item is the item currently being tested
against the predicate. The context size is the number of items in
the input sequence. The context position is the position of the
context item within the input sequence.</ins></p>
<p><ins class="diff-chg">For each item in the input sequence, the
result of the predicate expression is coerced to an</ins>
<code><ins class="diff-chg">xs:boolean</ins></code> <ins 
class="diff-chg">value, called the</ins> <b><ins class="diff-chg">predicate
 truth value</ins></b> ,<ins class="diff-chg">as described below. Those 
items for which the predicate
truth value is</ins> <code><ins class="diff-chg">true</ins></code>
<ins class="diff-chg">are retained, and those for which the
predicate truth value is</ins> <code><ins class="diff-chg">false</ins></code>
 <ins class="diff-chg">are
discarded.</ins></p>
<p><ins class="diff-chg">The predicate truth value is derived by
applying the following rules, in order:</ins></p>
<ol class="enumar">
<li>
<p><ins class="diff-chg">If the value of the predicate
expression</ins> is a <del class="diff-old">sequence</del>
<a title="singleton" href="#dt-singleton"><ins class="diff-chg">singleton</ins></a>
 <ins class="diff-chg">atomic
value</ins> of <del class="diff-old">three values.</del>
<ins class="diff-chg">a</ins> <a title="numeric" href="#dt-numeric"><ins
 class="diff-chg">numeric</ins></a> <ins class="diff-chg">type or 
derived from a</ins> <a title="numeric" href="#dt-numeric"><ins 
class="diff-chg">numeric</ins></a> <ins class="diff-chg">type, the 
predicate truth value is</ins>
<code><ins class="diff-chg">true</ins></code> <ins class="diff-chg">if 
the value of the predicate expression is equal (by
the</ins> <code><ins class="diff-chg">eq</ins></code> <ins 
class="diff-chg">operator) to the</ins> <b><ins class="diff-chg">context
position</ins></b> ,<ins class="diff-chg">and is</ins>
<code><ins class="diff-chg">false</ins></code> <ins class="diff-chg">otherwise.
 [</ins> <a title="numeric predicate" id="dt-numeric-predicate" 
name="dt-numeric-predicate"><ins class="diff-chg">Definition</ins></a> :<ins
 class="diff-chg">A predicate
whose predicate expression returns a numeric type is called a</ins>
<b><ins class="diff-chg">numeric predicate</ins></b> .]</p>
<div class="note">
<p class="prefix"><b><ins class="diff-chg">Note:</ins></b></p>
<p><ins class="diff-new">In a region of a query where</ins>
<a title="ordering mode" href="#dt-ordering-mode"><ins class="diff-new">ordering
 mode</ins></a> <ins class="diff-new">is</ins>
<code><ins class="diff-new">unordered</ins></code> ,<ins 
class="diff-new">the result of a numeric predicate is nondeterministic,
as explained in</ins> <a href="#id-unordered-expressions"><b><ins 
class="diff-new">3.10 Ordered
and Unordered Expressions</ins></b></a> .</p>
</div>
</li>
<li>
<p><ins class="diff-new">Otherwise, the predicate truth value is
the</ins> <a title="effective boolean value" href="#dt-ebv"><ins 
class="diff-new">effective boolean value</ins></a>
<ins class="diff-new">of the predicate expression.</ins></p>
</li>
</ol>
</div>
<div class="div3">
<h4><a id="id-dynamic-function-invocation" 
name="id-dynamic-function-invocation"></a><ins class="diff-new">3.2.2
Dynamic Function Invocation</ins></h4>
<h5><a id="N12C44" name="N12C44"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="noid_N12C8E.doc-xquery11-PostfixExpr" 
name="noid_N12C8E.doc-xquery11-PostfixExpr"></a><ins class="diff-new">[121]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">my:one-argument-function(( ))</del>
<ins class="diff-chg">PostfixExpr</ins></code> <del class="diff-old">denotes</del></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-PrimaryExpr"><ins class="diff-chg">PrimaryExpr</ins></a>
 <ins class="diff-chg">(</ins>
<a href="#doc-xquery11-Predicate"><ins class="diff-chg">Predicate</ins></a>
 <ins class="diff-chg">|</ins>
<a href="#doc-xquery11-ArgumentList"><ins class="diff-chg">ArgumentList</ins></a>
 <ins class="diff-chg">)*</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ArgumentList" name="doc-xquery11-ArgumentList"></a><ins
 class="diff-chg">[122]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ArgumentList"><ins class="diff-chg">ArgumentList</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"(" (</ins> <a 
href="#doc-xquery11-Argument"><ins class="diff-chg">Argument</ins></a>
<ins class="diff-chg">(","</ins> <a href="#doc-xquery11-Argument"><ins 
class="diff-chg">Argument</ins></a>
<ins class="diff-chg">)*)? ")"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N12C95.doc-xquery11-Argument" 
name="noid_N12C95.doc-xquery11-Argument"></a><ins class="diff-chg">[135]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">Argument</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ExprSingle"><ins class="diff-chg">ExprSingle</ins></a>
 <ins class="diff-chg">|</ins>
<a href="#doc-xquery11-ArgumentPlaceholder"><ins class="diff-chg">ArgumentPlaceholder</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N12C98.doc-xquery11-ArgumentPlaceholder" 
name="noid_N12C98.doc-xquery11-ArgumentPlaceholder"></a><ins 
class="diff-chg">[136]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">ArgumentPlaceholder</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"?"</ins></code></td>
</tr>
</tbody>
</table>
<p><ins class="diff-chg">[</ins> <a title="dynamic function invocation" 
id="dt-dynamic-function-invocation" 
name="dt-dynamic-function-invocation"><ins class="diff-chg">Definition</ins></a>
 :<ins class="diff-chg">A</ins>
<b><ins class="diff-chg">dynamic function invocation</ins></b>
<ins class="diff-chg">consists of</ins> a <ins class="diff-new">PrimaryExpr
 that returns the</ins> function <del class="diff-old">call</del> <ins 
class="diff-chg">item and a
parenthesized list of zero or more arguments (</ins> <a title="argument 
expression" href="#dt-arg-expr"><ins class="diff-chg">argument 
expressions</ins></a> <ins class="diff-chg">or
ArgumentPlaceholders).]</ins></p>
<p><ins class="diff-chg">If the PrimaryExpr does not return a
sequence consisting of a single function item</ins> with
<ins class="diff-new">the same arity as the number of specified
arguments, a type error is raised [</ins> <a title="err:XPTY0004" 
href="#ERRXPTY0004"><ins class="diff-new">err:XPTY0004</ins></a>
<ins class="diff-new">].</ins></p>
<p><ins class="diff-new">A dynamic function invocation is a</ins>
<a title="partial function application" 
href="#dt-partial-function-application"><ins class="diff-new">partial
function application</ins></a> <ins class="diff-new">if at
least</ins> one <del class="diff-old">argument that</del>
<ins class="diff-chg">of the arguments</ins> is an <del class="diff-old">empty
 sequence.</del> <ins class="diff-chg">ArgumentPlaceholder ("?"), and is
 evaluated according to
the rules in</ins> <a href="#id-partial-function-application"><b><ins 
class="diff-chg">3.1.5.4
Evaluating Partial Function Applications</ins></b></a> .</p>
<p><ins class="diff-chg">A dynamic function invocation that is not
a</ins> <a title="partial function application" 
href="#dt-partial-function-application"><ins class="diff-chg">partial
function application</ins></a> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#dt-invoke"><ins 
class="diff-chg">invokes</ins></a> <sup><small><ins class="diff-chg">DM11</ins></small></sup>
 <ins class="diff-chg">the</ins>
<a href="http://www.w3.org/TR/xpath-datamodel-11/#dt-function-item"><ins
 class="diff-chg">
function item</ins></a> <sup><small><ins class="diff-chg">DM11</ins></small></sup>
 ,<ins class="diff-chg">calling
the function it represents, and is evaluated as described in</ins>
<a href="#id-eval-function-call"><b><ins class="diff-chg">3.1.5.1
Evaluating Function Calls</ins></b></a> .</p>
<p><ins class="diff-chg">The following are examples of some dynamic
function invocations:</ins></p>
<ul>
<li>
<p><ins class="diff-new">This example invokes the function item
contained in $f, passing the arguments 2 and 3:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
$f(2, 3)
</ins>
</pre>
<del class="diff-old">my:zero-argument-function( )
denotes</del></div>
</li>
<li>
<p><ins class="diff-chg">This example fetches the second item from
sequence $f, treats it as</ins> a function <del class="diff-old">call</del>
 <ins class="diff-chg">item and invokes it,
passing a xs:string argument:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
$f[2]("Hi there")
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-chg">This example invokes the function item $f
passing no arguments, and filters the result</ins> with <del 
class="diff-old">zero arguments.</del> <ins class="diff-chg">a 
positional
predicate:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">$f()[2]
</ins>
</pre></div>
</li>
</ul>
</div>
</div>
<div class="div2">
<h3><a id="id-path-expressions" name="id-path-expressions"></a>
<del class="diff-old">3.2</del> <ins class="diff-chg">3.3</ins>
Path Expressions</h3>
<h5><a id="N12CDD" name="N12CDD"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-PathExpr" name="doc-xquery11-PathExpr"></a>
<del class="diff-old">[68]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[108]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-PathExpr">PathExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>("/" <a href="#doc-xquery11-RelativePathExpr">RelativePathExpr</a>
 ?)<br>
| ("//" <a href="#doc-xquery11-RelativePathExpr">RelativePathExpr</a> )<br>
| <a href="#doc-xquery11-RelativePathExpr">RelativePathExpr</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-RelativePathExpr" 
name="doc-xquery11-RelativePathExpr"></a> <del class="diff-old">[69]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[109]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-RelativePathExpr">RelativePathExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-StepExpr">StepExpr</a> (("/" |
"//") <a href="#doc-xquery11-StepExpr">StepExpr</a> )*</code></td>
</tr>
</tbody>
</table>
<p>[ <a title="path expression" id="dt-path-expression" 
name="dt-path-expression">Definition</a> : A <b>path expression</b> can
be used to locate nodes within trees. A path expression consists of
a series of one or more <a title="step" href="#dt-step">steps</a> ,
separated by " <code>/</code> " or " <code>//</code> ", and
optionally beginning with " <code>/</code> " or " <code>//</code>
".] An initial " <code>/</code> " or " <code>//</code> " is an
abbreviation for one or more initial steps that are implicitly
added to the beginning of the path expression, as described
below.</p>
<p>A path expression consisting of a single step is evaluated as
described in <a href="#id-steps"><b><del class="diff-old">3.2.1</del> <ins
 class="diff-chg">3.3.1</ins>
Steps</b></a> .</p>
<p>A " <code>/</code> " at the beginning of a path expression is an
abbreviation for the initial step <code><del class="diff-old">fn:root(self::node())</del>
 <span><ins class="diff-chg">(fn:root(self::node())</ins> treat as <del 
class="diff-old">document-node()/</del> <ins class="diff-chg">document-node())</ins></span>
 <ins class="diff-chg">/</ins></code> (however, if the " <code>/</code> "
 is
the entire path expression, the trailing " <code>/</code> " is
omitted from the expansion.) The effect of this initial step is to
begin the path at the root node of the tree that contains the
context node. If the context item is not a node, a <a title="type error"
 href="#dt-type-error">type error</a> is raised [
<a title="err:XPTY0020" href="#ERRXPTY0020">err:XPTY0020</a> ]. At
evaluation time, if the root node above the context node is not a
document node, a <a title="dynamic error" href="#dt-dynamic-error">dynamic
 error</a> is raised [ <a title="err:XPDY0050" href="#ERRXPDY0050">err:XPDY0050</a>
 ].</p>
<p>A " <code>//</code> " at the beginning of a path expression is
an abbreviation for the initial steps <code><del class="diff-old">fn:root(self::node())</del>
 <span><ins class="diff-chg">(fn:root(self::node())</ins> treat as <del 
class="diff-old">document-node()/descendant-or-self::node()/</del>
<ins class="diff-chg">document-node())</ins></span> <ins 
class="diff-chg">/descendant-or-self::node()/</ins></code> (however, "
<code>//</code> " by itself is not a valid path expression [
<a title="err:XPST0003" href="#ERRXPST0003">err:XPST0003</a> ].)
The effect of these initial steps is to establish an initial node
sequence that contains the root of the tree in which the context
node is found, plus all nodes descended from this root. This node
sequence is used as the input to subsequent steps in the path
expression. If the context item is not a node, a <a title="type error" 
href="#dt-type-error">type error</a> is raised [
<a title="err:XPTY0020" href="#ERRXPTY0020">err:XPTY0020</a> ]. At
evaluation time, if the root node above the context node is not a
document node, a <a title="dynamic error" href="#dt-dynamic-error">dynamic
 error</a> is raised [ <a title="err:XPDY0050" href="#ERRXPDY0050">err:XPDY0050</a>
 ].</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The descendants of a node do not include attribute nodes .</p>
</div>
<p>Each non-initial occurrence of " <code>//</code> " in a path
expression is expanded as described in <a href="#abbrev"><b><del 
class="diff-old">3.2.4</del> <ins class="diff-chg">3.3.4</ins> 
Abbreviated Syntax</b></a> , leaving a
sequence of steps separated by " <code>/</code> ". This sequence of
steps is then evaluated from left to right. Each operation
<code>E1/E2</code> is evaluated as follows: Expression
<code>E1</code> is evaluated, and if the result is not a (possibly
empty) sequence of nodes, a <a title="type error" href="#dt-type-error">type
 error</a> is raised [ <a title="err:XPTY0019" href="#ERRXPTY0019">err:XPTY0019</a>
 ]. Each node resulting from
the evaluation of <code>E1</code> then serves in turn to provide an
<b>inner focus</b> for an evaluation of <code>E2</code> , as
described in <a href="#eval_context"><b>2.1.2 Dynamic
Context</b></a> . The sequences resulting from all the evaluations
of <code>E2</code> are combined as follows:</p>
<ol class="enumar">
<li>
<p>If every evaluation of <code>E2</code> returns a (possibly
empty) sequence of nodes, these sequences are combined, and
duplicate nodes are eliminated based on node identity. <span 
class="xquery">If <a title="ordering mode" href="#dt-ordering-mode">ordering
 mode</a> is <code>ordered</code> , the
resulting node sequence is returned in <a title="document order" 
href="#dt-document-order">document order</a> ; otherwise it is
returned in <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a>
order.</span></p>
</li>
<li>
<p>If every evaluation of <code>E2</code> returns a (possibly
empty) sequence of <del class="diff-old">atomic values,</del>
<ins class="diff-chg">non-nodes,</ins> these sequences are
concatenated and returned. <span class="xquery">If <a title="ordering 
mode" href="#dt-ordering-mode">ordering mode</a> is
<code>ordered</code> , the returned sequence preserves the
orderings within and among the subsequences generated by the
evaluations of <code>E2</code> ; otherwise the order of the
returned sequence is <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a>
.</span></p>
</li>
<li>
<p>If the multiple evaluations of <code>E2</code> return at least
one node and at least one <del class="diff-old">atomic value,</del>
<ins class="diff-chg">non-node,</ins> a <a title="type error" 
href="#dt-type-error">type error</a> is raised [ <a title="err:XPTY0018"
 href="#ERRXPTY0018">err:XPTY0018</a> ].</p>
</li>
</ol>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>Since each step in a path provides context nodes for the
following step, in effect, only the last step in a path is allowed
to return a sequence of <del class="diff-old">atomic values.</del>
<ins class="diff-chg">non-nodes.</ins></p>
</div>
<p>As an example of a path expression,
<code>child::div1/child::para</code> selects the <code>para</code>
element children of the <code>div1</code> element children of the
context node, or, in other words, the <code>para</code> element
grandchildren of the context node that have <code>div1</code>
parents.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p id="Chg-slash-note">The " <code>/</code> " character can be used
either as a complete path expression or as the beginning of a
longer path expression such as " <code>/*</code> ". Also, "
<code>*</code> " is both the multiply operator and a wildcard in
path expressions. This can cause parsing difficulties when "
<code>/</code> " appears on the left hand side of " <code>*</code>
". This is resolved using the <a href="#parse-note-leading-lone-slash">leading-lone-slash</a>
 constraint.
For example, " <code>/*</code> " and " <code>/ *</code> " are valid
path expressions containing wildcards, but " <code>/*5</code> " and
" <code>/ * 5</code> " raise syntax errors. Parentheses must be
used when " <code>/</code> " is used on the left hand side of an
operator, as in " <code>(/) * 5</code> ". Similarly, " <code>4 + /
* 5</code> " raises a syntax error, but " <code>4 + (/) * 5</code>
" is a valid expression. The expression " <code>4 + /</code> " is
also valid, because <code>/</code> does not occur on the left hand
side of the operator.</p>
<p><ins class="diff-new">Similarly, in the expression</ins>
<code><ins class="diff-new">/ union /*</ins></code> ,<ins 
class="diff-new">"union" is interpreted as an element name rather than 
an
operator. For it to be parsed as an operator, the expression should
be written</ins> <code><ins class="diff-new">(/) union
/*</ins></code> .</p>
</div>
<div class="div3">
<h4><a id="id-steps" name="id-steps"></a> <del class="diff-old">3.2.1</del>
 <ins class="diff-chg">3.3.1</ins> Steps</h4>
<h5><a id="N12E4B" name="N12E4B"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-StepExpr" name="doc-xquery11-StepExpr"></a>
<del class="diff-old">[70]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[110]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-StepExpr">StepExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">FilterExpr</del> <a 
href="#doc-xquery11-PostfixExpr"><ins class="diff-chg">PostfixExpr</ins></a>
 | <a href="#doc-xquery11-AxisStep">AxisStep</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N12E69.doc-xquery11-AxisStep" 
name="noid_N12E69.doc-xquery11-AxisStep"></a> <del class="diff-old">[71]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[111]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code>AxisStep</code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>( <a href="#doc-xquery11-ReverseStep">ReverseStep</a> |
<a href="#doc-xquery11-ForwardStep">ForwardStep</a> ) <a 
href="#doc-xquery11-PredicateList">PredicateList</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ForwardStep" name="doc-xquery11-ForwardStep"></a>
 <del class="diff-old">[72]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[112]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ForwardStep">ForwardStep</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>( <a href="#doc-xquery11-ForwardAxis">ForwardAxis</a>
<a href="#doc-xquery11-NodeTest">NodeTest</a> ) | <a 
href="#doc-xquery11-AbbrevForwardStep">AbbrevForwardStep</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ReverseStep" name="doc-xquery11-ReverseStep"></a>
 <del class="diff-old">[75]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[115]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ReverseStep">ReverseStep</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>( <a href="#doc-xquery11-ReverseAxis">ReverseAxis</a>
<a href="#doc-xquery11-NodeTest">NodeTest</a> ) | <a 
href="#doc-xquery11-AbbrevReverseStep">AbbrevReverseStep</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N12E73.doc-xquery11-PredicateList" 
name="noid_N12E73.doc-xquery11-PredicateList"></a> <del class="diff-old">[82]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[123]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code>PredicateList</code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-Predicate">Predicate</a>
*</code></td>
</tr>
</tbody>
</table>
<p>[ <a title="step" id="dt-step" name="dt-step">Definition</a> : A
<b>step</b> is a part of a <a title="path expression" 
href="#dt-path-expression">path expression</a> that generates a sequence
of items and then filters the sequence by zero or more <a title="" 
href="#dt-predicate">predicates</a> . The value of the step
consists of those items that satisfy the predicates, working from
left to right. A step may be either an <a title="axis step" 
href="#dt-axis-step">axis step</a> or a <del class="diff-old">filter
expression .] Filter</del> <ins class="diff-chg">postfix
expression.] Postfix</ins> expressions are described in <a 
href="#id-postfix-expression"><b><del class="diff-old">3.3.2
Filter</del> <ins class="diff-chg">3.2 Postfix</ins>
Expressions</b></a> .</p>
<p>[ <a title="axis step" id="dt-axis-step" name="dt-axis-step">Definition</a>
 : An <b>axis step</b> returns a
sequence of nodes that are reachable from the context node via a
specified axis. Such a step has two parts: an <b>axis</b> , which
defines the "direction of movement" for the step, and a <a title="node 
test" href="#dt-node-test">node test</a> , which selects
nodes based on their kind, name, and/or <a title="type annotation" 
href="#dt-type-annotation">type annotation</a> .] If the context
item is a node, an axis step returns a sequence of zero or more
nodes; otherwise, a <a title="type error" href="#dt-type-error">type 
error</a> is raised [ <a title="err:XPTY0020" href="#ERRXPTY0020">err:XPTY0020</a>
 ]. <span class="xquery">If
<a title="ordering mode" href="#dt-ordering-mode">ordering mode</a>
is <code>ordered</code> , the resulting node sequence is returned
in <a title="document order" href="#dt-document-order">document
order</a> ; otherwise it is returned in <a title="implementation 
dependent" href="#dt-implementation-dependent">implementation-dependent</a>
order.</span> An axis step may be either a <b>forward step</b> or a
<b>reverse step</b> , followed by zero or more <a title="" 
href="#dt-predicate">predicates</a> .</p>
<p>In the <b>abbreviated syntax</b> for a step, the axis can be
omitted and other shorthand notations can be used as described in
<a href="#abbrev"><b><del class="diff-old">3.2.4</del> <ins 
class="diff-chg">3.3.4</ins> Abbreviated Syntax</b></a> .</p>
<p>The unabbreviated syntax for an axis step consists of the axis
name and node test separated by a double colon. The result of the
step consists of the nodes reachable from the context node via the
specified axis that have the node kind, name, and/or <a title="type 
annotation" href="#dt-type-annotation">type annotation</a>
specified by the node test. For example, the step
<code>child::para</code> selects the <code>para</code> element
children of the context node: <code>child</code> is the name of the
axis, and <code>para</code> is the name of the element nodes to be
selected on this axis. The available axes are described in <a 
href="#axes"><b><del class="diff-old">3.2.1.1</del> <ins 
class="diff-chg">3.3.1.1</ins> Axes</b></a> . The available node tests
are described in <a href="#node-tests"><b><del class="diff-old">3.2.1.2</del>
 <ins class="diff-chg">3.3.1.2</ins> Node
Tests</b></a> . Examples of steps are provided in <a href="#unabbrev"><b><del
 class="diff-old">3.2.3</del> <ins class="diff-chg">3.3.3</ins> 
Unabbreviated Syntax</b></a> and <a href="#abbrev"><b><del 
class="diff-old">3.2.4</del> <ins class="diff-chg">3.3.4</ins> 
Abbreviated Syntax</b></a> .</p>
<div class="div4">
<h5><a id="axes" name="axes"></a> <del class="diff-old">3.2.1.1</del> <ins
 class="diff-chg">3.3.1.1</ins>
Axes</h5>
<h5><a id="N12F37" name="N12F37"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ForwardAxis" name="doc-xquery11-ForwardAxis"></a>
 <del class="diff-old">[73]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[113]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ForwardAxis">ForwardAxis</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>("child" "::")<br>
| ("descendant" "::")<br>
| ("attribute" "::")<br>
| ("self" "::")<br>
| ("descendant-or-self" "::")<br>
| ("following-sibling" "::")<br>
| ("following" "::")</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ReverseAxis" name="doc-xquery11-ReverseAxis"></a>
 <del class="diff-old">[76]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[116]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ReverseAxis">ReverseAxis</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>("parent" "::")<br>
| ("ancestor" "::")<br>
| ("preceding-sibling" "::")<br>
| ("preceding" "::")<br>
| ("ancestor-or-self" "::")</code></td>
</tr>
</tbody>
</table>
<p class="xquery">XQuery supports the following <del class="diff-old">axes
 (subject to limitations as described in 5.2.4 Full
Axis Feature ):</del> <ins class="diff-chg">axes:</ins></p>
<ul>
<li>
<p>The <code>child</code> axis contains the children of the context
node, which are the nodes returned by the <code>dm:children</code>
accessor in <del class="diff-old">[XQuery/XPath</del> <a 
href="#xpath-datamodel-11"><ins class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> .</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>Only document nodes and element nodes have children. If the
context node is any other kind of node, or if the context node is
an empty document or element node, then the child axis is an empty
sequence. The children of a document node or element node may be
element, processing instruction, comment, or text nodes. Attribute
and document nodes can never appear as children.</p>
</div>
</li>
<li>
<p>the <code>descendant</code> axis is defined as the transitive
closure of the child axis; it contains the descendants of the
context node (the children, the children of the children, and so
on)</p>
</li>
<li>
<p>the <code>parent</code> axis contains the sequence returned by
the <code>dm:parent</code> accessor in <del class="diff-old">[XQuery/XPath</del>
 <a href="#xpath-datamodel-11"><ins class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> , which returns the parent of the
context node, or an empty sequence if the context node has no
parent</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>An attribute node may have an element node as its parent, even
though the attribute node is not a child of the element node.</p>
</div>
</li>
<li>
<p>the <code>ancestor</code> axis is defined as the transitive
closure of the parent axis; it contains the ancestors of the
context node (the parent, the parent of the parent, and so on)</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The ancestor axis includes the root node of the tree in which
the context node is found, unless the context node is the root
node.</p>
</div>
</li>
<li>
<p>the <code>following-sibling</code> axis contains the context
node's following siblings, those children of the context node's
parent that occur after the context node in <a title="document order" 
href="#dt-document-order">document order</a> ; if
the context node is an attribute node, the
<code>following-sibling</code> axis is empty</p>
</li>
<li>
<p>the <code>preceding-sibling</code> axis contains the context
node's preceding siblings, those children of the context node's
parent that occur before the context node in <a title="document order" 
href="#dt-document-order">document order</a> ; if
the context node is an attribute node, the
<code>preceding-sibling</code> axis is empty</p>
</li>
<li>
<p>the <code>following</code> axis contains all nodes that are
descendants of the root of the tree in which the context node is
found, are not descendants of the context node, and occur after the
context node in <a title="document order" href="#dt-document-order">document
 order</a></p>
</li>
<li>
<p>the <code>preceding</code> axis contains all nodes that are
descendants of the root of the tree in which the context node is
found, are not ancestors of the context node, and occur before the
context node in <a title="document order" href="#dt-document-order">document
 order</a></p>
</li>
<li>
<p>the <code>attribute</code> axis contains the attributes of the
context node, which are the nodes returned by the
<code>dm:attributes</code> accessor in <del class="diff-old">[XQuery/XPath</del>
 <a href="#xpath-datamodel-11"><ins class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> ; the axis will be empty unless the
context node is an element</p>
</li>
<li>
<p>the <code>self</code> axis contains just the context node
itself</p>
</li>
<li>
<p>the <code>descendant-or-self</code> axis contains the context
node and the descendants of the context node</p>
</li>
<li>
<p>the <code>ancestor-or-self</code> axis contains the context node
and the ancestors of the context node; thus, the ancestor-or-self
axis will always include the root node</p>
</li>
</ul>
<p>Axes can be categorized as <b>forward axes</b> and <b>reverse
axes</b> . An axis that only ever contains the context node or
nodes that are after the context node in <a title="document order" 
href="#dt-document-order">document order</a> is a forward axis. An
axis that only ever contains the context node or nodes that are
before the context node in <a title="document order" 
href="#dt-document-order">document order</a> is a reverse axis.</p>
<p>The <code>parent</code> , <code>ancestor</code> ,
<code>ancestor-or-self</code> , <code>preceding</code> , and
<code>preceding-sibling</code> axes are reverse axes; all other
axes are forward axes. The <code>ancestor</code> ,
<code>descendant</code> , <code>following</code> ,
<code>preceding</code> and <code>self</code> axes partition a
document (ignoring attribute nodes): they do not overlap and
together they contain all the nodes in the document.</p>
<p>[ <a title="principal node kind" id="dt-principal-node-kind" 
name="dt-principal-node-kind">Definition</a> : Every axis has a
<b>principal node kind</b> . If an axis can contain elements, then
the principal node kind is element; otherwise, it is the kind of
nodes that the axis can contain.] Thus:</p>
<ul>
<li>
<p>For the attribute axis, the principal node kind is
attribute.</p>
</li>
<li>
<p>For all other axes, the principal node kind is element.</p>
</li>
</ul>
</div>
<div class="div4">
<h5><a id="node-tests" name="node-tests"></a> <del class="diff-old">3.2.1.2</del>
 <ins class="diff-chg">3.3.1.2</ins> Node
Tests</h5>
<p>[ <a title="node test" id="dt-node-test" name="dt-node-test">Definition</a>
 : A <b>node test</b> is a condition
that must be true for each node selected by a <a title="step" 
href="#dt-step">step</a> .] The condition may be based on the kind of
the node (element, attribute, text, document, comment, or
processing instruction), the name of the node, or (in the case of
element, attribute, and document nodes), the <a title="type annotation" 
href="#dt-type-annotation">type annotation</a> of
the node.</p>
<h5><a id="N13032" name="N13032"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-NodeTest" name="doc-xquery11-NodeTest"></a>
<del class="diff-old">[78]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[118]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-NodeTest">NodeTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-KindTest">KindTest</a> | <a 
href="#doc-xquery11-NameTest">NameTest</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-NameTest" name="doc-xquery11-NameTest"></a>
<del class="diff-old">[79]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[119]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-NameTest">NameTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">QName</del> <a 
href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a> |
<a href="#doc-xquery11-Wildcard">Wildcard</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-Wildcard" name="doc-xquery11-Wildcard"></a>
<del class="diff-old">[80]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[120]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-Wildcard">Wildcard</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"*"<br>
| ( <a href="#prod-xquery11-NCName">NCName</a> ":" "*")<br>
| ("*" ":" <a href="#prod-xquery11-NCName">NCName</a> )</code></td>
</tr>
</tbody>
</table>
<p>[ <a title="name test" id="dt-name-test" name="dt-name-test">Definition</a>
 : A node test that consists only of a
<del class="diff-old">QName</del> <ins class="diff-chg">EQName</ins> or a
 Wildcard is called a <b>name test</b>
.] A name test is true if and only if the <b>kind</b> of the node
is the <a title="principal node kind" href="#dt-principal-node-kind">principal
 node kind</a> for the step axis
and the <a title="expanded QName" href="#dt-expanded-qname">expanded 
QName</a> of the node is equal (as
defined by the <code>eq</code> operator) to the <a title="expanded 
QName" href="#dt-expanded-qname">expanded QName</a>
specified by the name test. For example, <code>child::para</code>
selects the <code>para</code> element children of the context node;
if the context node has no <code>para</code> children, it selects
an empty set of nodes. <code>attribute::abc:href</code> selects the
attribute of the context node with the QName <code>abc:href</code>
; if the context node has no such attribute, it selects an empty
set of nodes.</p>
<p><del class="diff-old">A QName in</del> <ins class="diff-chg">If
the EQName is</ins> a <del class="diff-old">name test</del>
<a title="lexical QName" href="#dt-qname"><ins class="diff-chg">lexical 
QName</ins></a> ,<ins class="diff-chg">it</ins>
is resolved into an <a title="expanded QName" href="#dt-expanded-qname">expanded
 QName</a> using the <a title="statically known namespaces" 
href="#dt-static-namespaces">statically known namespaces</a> in the
expression context. It is a <a title="static error" 
href="#dt-static-error">static error</a> [ <a title="err:XPST0081" 
href="#ERRXPST0081">err:XPST0081</a> ] if the QName has a prefix that
does not correspond to any statically known namespace. An
unprefixed QName, when used as a name test on an axis whose
<a title="principal node kind" href="#dt-principal-node-kind">principal 
node kind</a> is element, has
the namespace URI of the <a title="default element/type namespace" 
href="#dt-def-elemtype-ns">default element/type namespace</a> in
the expression context; otherwise, it has no namespace URI.</p>
<p>A name test is not satisfied by an element node whose name does
not match the <a title="expanded QName" href="#dt-expanded-qname">expanded
 QName</a> of the name test, even if
it is in a <a title="substitution group" href="#dt-substitution-group">substitution
 group</a> whose head is the
named element.</p>
<p>A node test <code>*</code> is true for any node of the <a 
title="principal node kind" href="#dt-principal-node-kind">principal 
node
kind</a> of the step axis. For example, <code>child::*</code> will
select all element children of the context node, and
<code>attribute::*</code> will select all attributes of the context
node.</p>
<p>A node test can have the form <code>NCName:*</code> . In this
case, the prefix is expanded in the same way as with a <del 
class="diff-old">QName,</del> <a title="lexical QName" href="#dt-qname"><ins
 class="diff-chg">lexical QName</ins></a> , using
the <a title="statically known namespaces" href="#dt-static-namespaces">statically
 known namespaces</a> in the
<a title="static context" href="#dt-static-context">static
context</a> . If the prefix is not found in the statically known
namespaces, a <a title="static error" href="#dt-static-error">static 
error</a> is raised [ <a title="err:XPST0081" href="#ERRXPST0081">err:XPST0081</a>
 ]. The node
test is true for any node of the <a title="principal node kind" 
href="#dt-principal-node-kind">principal node kind</a> of the step
axis whose <a title="expanded QName" href="#dt-expanded-qname">expanded 
QName</a> has the namespace URI to
which the prefix is bound, regardless of the local part of the
name.</p>
<p>A node test can also have the form <code>*:NCName</code> . In
this case, the node test is true for any node of the <a title="principal
 node kind" href="#dt-principal-node-kind">principal node
kind</a> of the step axis whose local name matches the given
NCName, regardless of its namespace or lack of a namespace.</p>
<p>[ <a title="kind test" id="dt-kind-test" name="dt-kind-test">Definition</a>
 : An alternative form of a node test
called a <b>kind test</b> can select nodes based on their kind,
name, and <a title="type annotation" href="#dt-type-annotation">type 
annotation</a> .] The syntax and
semantics of a kind test are described in <a 
href="#id-sequencetype-syntax"><b>2.5.3 SequenceType Syntax</b></a> and
<a href="#id-sequencetype-matching"><b>2.5.4 SequenceType
Matching</b></a> . When a kind test is used in a <a title="node test" 
href="#dt-node-test">node test</a> , only those nodes
on the designated axis that match the kind test are selected. Shown
below are several examples of kind tests that might be used in path
expressions:</p>
<ul>
<li>
<p><code>node()</code> matches any node.</p>
</li>
<li>
<p><code>text()</code> matches any text node.</p>
</li>
<li>
<p><code>comment()</code> matches any comment node.</p>
</li>
<li>
<p><code><ins class="diff-new">namespace-node()</ins></code>
<ins class="diff-new">matches any namespace node.</ins></p>
</li>
<li>
<p><code>element()</code> matches any element node.</p>
</li>
<li>
<p><code>schema-element(person)</code> matches any element node
whose name is <code>person</code> (or is in the <a title="substitution 
group" href="#dt-substitution-group">substitution
group</a> headed by <code>person</code> ), and whose type
annotation is the same as (or is derived from) the declared type of
the <code>person</code> element in the <a title="in-scope element 
declarations" href="#dt-is-elems">in-scope
element declarations</a> .</p>
</li>
<li>
<p><code>element(person)</code> matches any element node whose name
is <code>person</code> , regardless of its type annotation.</p>
</li>
<li>
<p><code>element(person, surgeon)</code> matches any non-nilled
element node whose name is <code>person</code> , and whose type
annotation is <code>surgeon</code> or is derived from
<code>surgeon</code> .</p>
</li>
<li>
<p><code>element(*, surgeon)</code> matches any non-nilled element
node whose type annotation is <code>surgeon</code> (or is derived
from <code>surgeon</code> ), regardless of its name.</p>
</li>
<li>
<p><code>attribute()</code> matches any attribute node.</p>
</li>
<li>
<p><code>attribute(price)</code> matches any attribute whose name
is <code>price</code> , regardless of its type annotation.</p>
</li>
<li>
<p><code>attribute(*, xs:decimal)</code> matches any attribute
whose type annotation is <code>xs:decimal</code> (or is derived
from <code>xs:decimal</code> ), regardless of its name.</p>
</li>
<li>
<p><code>document-node()</code> matches any document node.</p>
</li>
<li>
<p><code>document-node(element(book))</code> matches any document
node whose content consists of a single element node that satisfies
the <a title="kind test" href="#dt-kind-test">kind test</a>
<code>element(book)</code> , interleaved with zero or more comments
and processing instructions.</p>
</li>
</ul>
</div>
</div>
<div class="div3">
<h4><a id="id-predicate" name="id-predicate"></a> <del class="diff-old">3.2.2</del>
 <ins class="diff-chg">3.3.2</ins> Predicates
<ins class="diff-new">within Steps</ins></h4>
<h5><a id="N131B7" name="N131B7"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-AxisStep" name="doc-xquery11-AxisStep"></a>
<del class="diff-old">[83]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[111]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-AxisStep"><ins class="diff-chg">AxisStep</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">(</ins> <a 
href="#doc-xquery11-ReverseStep"><ins class="diff-chg">ReverseStep</ins></a>
 <ins class="diff-chg">|</ins>
<a href="#doc-xquery11-ForwardStep"><ins class="diff-chg">ForwardStep</ins></a>
 <ins class="diff-chg">)</ins>
<a href="#doc-xquery11-PredicateList"><ins class="diff-chg">PredicateList</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-PredicateList" name="doc-xquery11-PredicateList"></a><ins
 class="diff-chg">[123]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-PredicateList"><ins class="diff-chg">PredicateList</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-Predicate">Predicate</a>
<ins class="diff-new">*</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N131F0.doc-xquery11-Predicate" 
name="noid_N131F0.doc-xquery11-Predicate"></a> <ins class="diff-new">[124]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">Predicate</ins></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"[" <a href="#doc-xquery11-Expr">Expr</a> "]"</code></td>
</tr>
</tbody>
</table>
<del class="diff-old">[ Definition : A predicate consists of an
expression, called a predicate expression , enclosed in square
brackets.</del>
<p id="dt-predicate">A predicate <del class="diff-old">serves to
filter</del> <ins class="diff-chg">within</ins> a <del class="diff-old">sequence,
 retaining some items</del> <ins class="diff-chg">Step has similar 
syntax</ins> and <del class="diff-old">discarding others.] In the case 
of multiple adjacent
predicates, the predicates are applied from left</del> <ins 
class="diff-chg">semantics</ins> to <del class="diff-old">right, and the
result of applying each predicate serves as the input sequence for
the following predicate. For each item in the input sequence,
the</del> <ins class="diff-chg">a</ins> predicate <ins class="diff-new">within
 a</ins> <a title="" href="#id-filter-expression"><ins class="diff-new">filter</ins>
expression <del class="diff-old">is evaluated using an inner focus
, defined as follows: The context item is the item currently being
tested against the predicate.</del></a> . The <del class="diff-old">context
 size</del> <ins class="diff-chg">only
difference</ins> is <del class="diff-old">the number of items</del>
in the <del class="diff-old">input sequence. The</del> <ins 
class="diff-chg">way the</ins> context position is <del class="diff-old">the
 position</del> <ins class="diff-chg">set for
evaluation</ins> of the <del class="diff-old">context item within
the input sequence.</del> <ins class="diff-chg">predicate.</ins></p>
<p>For the purpose of evaluating the context position within a
predicate, the input sequence is considered to be sorted as
follows: into document order if the predicate is in a forward-axis
step, into reverse document order if the predicate is in a
reverse-axis step, or in its original order if the predicate is not
in a step.</p>
<p><del class="diff-old">For each item in the input sequence, the
result of the predicate expression is coerced to an xs:boolean
value, called the predicate truth value , as described below. Those
items for which the predicate truth value is true are retained, and
those for which the predicate truth value is false are discarded.
The predicate truth value is derived by applying the following
rules, in order: If the value of the predicate expression is a
singleton atomic value of a numeric type or derived from a numeric
type, the predicate truth value is true if the value of the
predicate expression is equal (by the eq operator) to the context
position , and is false otherwise. [ Definition : A predicate whose
predicate expression returns a numeric type is called a numeric
predicate .] Note: In a region of a query where ordering mode is
unordered , the result of a numeric predicate is nondeterministic,
as explained in 3.9 Ordered and Unordered Expressions . Otherwise,
the predicate truth value is the effective boolean value of the
predicate expression.</del> Here are some examples of <a title="axis 
step" href="#dt-axis-step">axis steps</a> that contain
predicates:</p>
<ul>
<li>
<p>This example selects the second <code>chapter</code> element
that is a child of the context node:</p>
<div class="exampleInner">
<pre>child::chapter[2]
</pre></div>
</li>
<li>
<p>This example selects all the descendants of the context node
that are elements named <code>"toy"</code> and whose
<code>color</code> attribute has the value <code>"red"</code> :</p>
<div class="exampleInner">
<pre>descendant::toy[attribute::color = "red"]
</pre></div>
</li>
<li>
<p>This example selects all the <code>employee</code> children of
the context node that have both a <code>secretary</code> child
element and an <code>assistant</code> child element:</p>
<div class="exampleInner">
<pre>child::employee[secretary][assistant]
</pre></div>
</li>
</ul>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>When using <a title="" href="#dt-predicate">predicates</a> with
a sequence of nodes selected using a <b>reverse axis</b> , it is
important to remember that the the context positions for such a
sequence are assigned in <a title="reverse document order" 
href="#dt-reverse-document-order">reverse document order</a> . For
example, <code>preceding::foo[1]</code> returns the first
qualifying <code>foo</code> element in <a title="reverse document order"
 href="#dt-reverse-document-order">reverse
document order</a> , because the predicate is part of an <a title="axis 
step" href="#dt-axis-step">axis step</a> using a reverse
axis. By contrast, <code>(preceding::foo)[1]</code> returns the
first qualifying <code>foo</code> element in <a title="document order" 
href="#dt-document-order">document order</a> ,
because the parentheses cause <code>(preceding::foo)</code> to be
parsed as a <a title="primary expression" href="#dt-primary-expression">primary
 expression</a> in which context
positions are assigned in document order. Similarly,
<code>ancestor::*[1]</code> returns the nearest ancestor element,
because the <code>ancestor</code> axis is a reverse axis, whereas
<code>(ancestor::*)[1]</code> returns the root element (first
ancestor in document order).</p>
<p>The fact that a reverse-axis step assigns context positions in
reverse document order for the purpose of evaluating predicates
does not alter the fact that the final result of the step
<span class="xquery">(when in ordered mode)</span> is always in
document order.</p>
</div>
</div>
<div class="div3">
<h4><a id="unabbrev" name="unabbrev"></a> <del class="diff-old">3.2.3</del>
 <ins class="diff-chg">3.3.3</ins>
Unabbreviated Syntax</h4>
<p>This section provides a number of examples of path expressions
in which the axis is explicitly specified in each <a title="step" 
href="#dt-step">step</a> . The syntax used in these examples is
called the <b>unabbreviated syntax</b> . In many common cases, it
is possible to write path expressions more concisely using an
<b>abbreviated syntax</b> , as explained in <a href="#abbrev"><b><del 
class="diff-old">3.2.4</del> <ins class="diff-chg">3.3.4</ins> 
Abbreviated Syntax</b></a> .</p>
<ul>
<li>
<p><code>child::para</code> selects the <code>para</code> element
children of the context node</p>
</li>
<li>
<p><code>child::*</code> selects all element children of the
context node</p>
</li>
<li>
<p><code>child::text()</code> selects all text node children of the
context node</p>
</li>
<li>
<p><code>child::node()</code> selects all the children of the
context node. Note that no attribute nodes are returned, because
attributes are not children.</p>
</li>
<li>
<p><code>attribute::name</code> selects the <code>name</code>
attribute of the context node</p>
</li>
<li>
<p><code>attribute::*</code> selects all the attributes of the
context node</p>
</li>
<li>
<p><code>parent::node()</code> selects the parent of the context
node. If the context node is an attribute node, this expression
returns the element node (if any) to which the attribute node is
attached.</p>
</li>
<li>
<p><code>descendant::para</code> selects the <code>para</code>
element descendants of the context node</p>
</li>
<li>
<p><code>ancestor::div</code> selects all <code>div</code>
ancestors of the context node</p>
</li>
<li>
<p><code>ancestor-or-self::div</code> selects the <code>div</code>
ancestors of the context node and, if the context node is a
<code>div</code> element, the context node as well</p>
</li>
<li>
<p><code>descendant-or-self::para</code> selects the
<code>para</code> element descendants of the context node and, if
the context node is a <code>para</code> element, the context node
as well</p>
</li>
<li>
<p><code>self::para</code> selects the context node if it is a
<code>para</code> element, and otherwise returns an empty
sequence</p>
</li>
<li>
<p><code>child::chapter/descendant::para</code> selects the
<code>para</code> element descendants of the <code>chapter</code>
element children of the context node</p>
</li>
<li>
<p><code>child::*/child::para</code> selects all <code>para</code>
grandchildren of the context node</p>
</li>
<li>
<p><code>/</code> selects the root of the tree that contains the
context node, but raises a dynamic error if this root is not a
document node</p>
</li>
<li>
<p><code>/descendant::para</code> selects all the <code>para</code>
elements in the same document as the context node</p>
</li>
<li>
<p><code>/descendant::list/child::member</code> selects all the
<code>member</code> elements that have a <code>list</code> parent
and that are in the same document as the context node</p>
</li>
<li>
<p><code>child::para[fn:position() = 1]</code> selects the first
<code>para</code> child of the context node</p>
</li>
<li>
<p><code>child::para[fn:position() = fn:last()]</code> selects the
last <code>para</code> child of the context node</p>
</li>
<li>
<p><code>child::para[fn:position() = fn:last()-1]</code> selects
the last but one <code>para</code> child of the context node</p>
</li>
<li>
<p><code>child::para[fn:position() &gt; 1]</code> selects all the
<code>para</code> children of the context node other than the first
<code>para</code> child of the context node</p>
</li>
<li>
<p><code>following-sibling::chapter[fn:position() = 1]</code>
selects the next <code>chapter</code> sibling of the context
node</p>
</li>
<li>
<p><code>preceding-sibling::chapter[fn:position() = 1]</code>
selects the previous <code>chapter</code> sibling of the context
node</p>
</li>
<li>
<p><code>/descendant::figure[fn:position() = 42]</code> selects the
forty-second <code>figure</code> element in the document containing
the context node</p>
</li>
<li>
<p><code>/child::book/child::chapter[fn:position() =
5]/child::section[fn:position() = 2]</code> selects the second
<code>section</code> of the fifth <code>chapter</code> of the
<code>book</code> whose parent is the document node that contains
the context node</p>
</li>
<li>
<p><code>child::para[attribute::type eq "warning"]</code> selects
all <code>para</code> children of the context node that have a
<code>type</code> attribute with value <code>warning</code></p>
</li>
<li>
<p><code>child::para[attribute::type eq 'warning'][fn:position() =
5]</code> selects the fifth <code>para</code> child of the context
node that has a <code>type</code> attribute with value
<code>warning</code></p>
</li>
<li>
<p><code>child::para[fn:position() = 5][attribute::type eq
"warning"]</code> selects the fifth <code>para</code> child of the
context node if that child has a <code>type</code> attribute with
value <code>warning</code></p>
</li>
<li>
<p><code>child::chapter[child::title = 'Introduction']</code>
selects the <code>chapter</code> children of the context node that
have one or more <code>title</code> children whose <a title="typed 
value" href="#dt-typed-value">typed value</a> is equal to
the string <code>Introduction</code></p>
</li>
<li>
<p><code>child::chapter[child::title]</code> selects the
<code>chapter</code> children of the context node that have one or
more <code>title</code> children</p>
</li>
<li>
<p><code>child::*[self::chapter or self::appendix]</code> selects
the <code>chapter</code> and <code>appendix</code> children of the
context node</p>
</li>
<li>
<p><code>child::*[self::chapter or self::appendix][fn:position() =
fn:last()]</code> selects the last <code>chapter</code> or
<code>appendix</code> child of the context node</p>
</li>
</ul>
</div>
<div class="div3">
<h4><a id="abbrev" name="abbrev"></a> <del class="diff-old">3.2.4</del> <ins
 class="diff-chg">3.3.4</ins>
Abbreviated Syntax</h4>
<h5><a id="N133E8" name="N133E8"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-AbbrevForwardStep" 
name="doc-xquery11-AbbrevForwardStep"></a> <del class="diff-old">[74]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[114]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-AbbrevForwardStep">AbbrevForwardStep</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"@"? <a href="#doc-xquery11-NodeTest">NodeTest</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-AbbrevReverseStep" 
name="doc-xquery11-AbbrevReverseStep"></a> <del class="diff-old">[77]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[117]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-AbbrevReverseStep">AbbrevReverseStep</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>".."</code></td>
</tr>
</tbody>
</table>
<p>The abbreviated syntax permits the following abbreviations:</p>
<ol class="enumar">
<li>
<p>The attribute axis <code>attribute::</code> can be abbreviated
by <code>@</code> . For example, a path expression
<code>para[@type="warning"]</code> is short for
<code>child::para[attribute::type="warning"]</code> and so selects
<code>para</code> children with a <code>type</code> attribute with
value equal to <code>warning</code> .</p>
</li>
<li>
<p>If the axis name is omitted from an <a title="axis step" 
href="#dt-axis-step">axis step</a> , the default axis is <code>child
<del class="diff-old">unless</del></code> , <ins class="diff-chg">with 
two exceptions: if</ins> the axis step contains an
<a href="#doc-xquery11-AttributeTest">AttributeTest</a> or <a 
href="#doc-xquery11-SchemaAttributeTest">SchemaAttributeTest</a>
<del class="diff-old">; in that case,</del> <ins class="diff-chg">then</ins>
 the default axis is <code>attribute</code>
<ins class="diff-new">; if the axis step contains</ins>
<code><ins class="diff-new">namespace-node()</ins></code>
<ins class="diff-new">then the default axis is</ins>
<code><ins class="diff-new">namespace</ins></code> .</p>
<div class="note">
<p class="prefix"><b><ins class="diff-new">Note:</ins></b></p>
<p><ins class="diff-new">In an implementation that does not support
the namespace axis, an attempt to access it it always raises an
error. Thus, an XQuery implementation will always raise an error in
this case, since XQuery does not support the namespace axis. The
namespace axis is deprecated in XPath 2.1, but required in some
languages that use XPath, including XSLT.</ins></p>
</div>
<p>For example, the path expression <code>section/para</code> is an
abbreviation for <code>child::section/child::para</code> , and the
path expression <code>section/@id</code> is an abbreviation for
<code>child::section/attribute::id</code> . Similarly,
<code>section/attribute(id)</code> is an abbreviation for
<code>child::section/attribute::attribute(id)</code> . Note that
the latter expression contains both an axis specification and a
<a title="node test" href="#dt-node-test">node test</a> .</p>
</li>
<li>
<p>Each non-initial occurrence of <code>//</code> is effectively
replaced by <code>/descendant-or-self::node()/</code> during
processing of a path expression. For example,
<code>div1//para</code> is short for
<code>child::div1/descendant-or-self::node()/child::para</code> and
so will select all <code>para</code> descendants of
<code>div1</code> children.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The path expression <code>//para[1]</code> does <em>not</em>
mean the same as the path expression
<code>/descendant::para[1]</code> . The latter selects the first
descendant <code>para</code> element; the former selects all
descendant <code>para</code> elements that are the first
<code>para</code> children of their respective parents.</p>
</div>
</li>
<li>
<p>A step consisting of <code>..</code> is short for
<code>parent::node()</code> . For example, <code>../title</code> is
short for <code>parent::node()/child::title</code> and so will
select the <code>title</code> children of the parent of the context
node.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The expression <code>.</code> , known as a <b>context item
expression</b> , is a <a title="primary expression" 
href="#dt-primary-expression">primary expression</a> , and is described
in <a href="#id-context-item-expression"><b>3.1.4 Context Item
Expression</b></a> .</p>
</div>
</li>
</ol>
<p>Here are some examples of path expressions that use the
abbreviated syntax:</p>
<ul>
<li>
<p><code>para</code> selects the <code>para</code> element children
of the context node</p>
</li>
<li>
<p><code>*</code> selects all element children of the context
node</p>
</li>
<li>
<p><code>text()</code> selects all text node children of the
context node</p>
</li>
<li>
<p><code>@name</code> selects the <code>name</code> attribute of
the context node</p>
</li>
<li>
<p><code>@*</code> selects all the attributes of the context
node</p>
</li>
<li>
<p><code>para[1]</code> selects the first <code>para</code> child
of the context node</p>
</li>
<li>
<p><code>para[fn:last()]</code> selects the last <code>para</code>
child of the context node</p>
</li>
<li>
<p><code>*/para</code> selects all <code>para</code> grandchildren
of the context node</p>
</li>
<li>
<p><code>/book/chapter[5]/section[2]</code> selects the second
<code>section</code> of the fifth <code>chapter</code> of the
<code>book</code> whose parent is the document node that contains
the context node</p>
</li>
<li>
<p><code>chapter//para</code> selects the <code>para</code> element
descendants of the <code>chapter</code> element children of the
context node</p>
</li>
<li>
<p><code>//para</code> selects all the <code>para</code>
descendants of the root document node and thus selects all
<code>para</code> elements in the same document as the context
node</p>
</li>
<li>
<p><code>//@version</code> selects all the <code>version</code>
attribute nodes that are in the same document as the context
node</p>
</li>
<li>
<p><code>//list/member</code> selects all the <code>member</code>
elements in the same document as the context node that have a
<code>list</code> parent</p>
</li>
<li>
<p><code>.//para</code> selects the <code>para</code> element
descendants of the context node</p>
</li>
<li>
<p><code>..</code> selects the parent of the context node</p>
</li>
<li>
<p><code>../@lang</code> selects the <code>lang</code> attribute of
the parent of the context node</p>
</li>
<li>
<p><code>para[@type="warning"]</code> selects all <code>para</code>
children of the context node that have a <code>type</code>
attribute with value <code>warning</code></p>
</li>
<li>
<p><code>para[@type="warning"][5]</code> selects the fifth
<code>para</code> child of the context node that has a
<code>type</code> attribute with value <code>warning</code></p>
</li>
<li>
<p><code>para[5][@type="warning"]</code> selects the fifth
<code>para</code> child of the context node if that child has a
<code>type</code> attribute with value <code>warning</code></p>
</li>
<li>
<p><code>chapter[title="Introduction"]</code> selects the
<code>chapter</code> children of the context node that have one or
more <code>title</code> children whose <a title="typed value" 
href="#dt-typed-value">typed value</a> is equal to the string
<code>Introduction</code></p>
</li>
<li>
<p><code>chapter[title]</code> selects the <code>chapter</code>
children of the context node that have one or more
<code>title</code> children</p>
</li>
<li>
<p><code>employee[@secretary and @assistant]</code> selects all the
<code>employee</code> children of the context node that have both a
<code>secretary</code> attribute and an <code>assistant</code>
attribute</p>
</li>
<li>
<p><code>book/(chapter|appendix)/section</code> selects every
<code>section</code> element that has a parent that is either a
<code>chapter</code> or an <code>appendix</code> element, that in
turn is a child of a <code>book</code> element that is a child of
the context node.</p>
</li>
<li>
<p>If <code>E</code> is any expression that returns a sequence of
nodes, then the expression <code>E/.</code> returns the same nodes
in <a title="document order" href="#dt-document-order">document
order</a> , with duplicates eliminated based on node identity.</p>
</li>
</ul>
</div>
</div>
<div class="div2">
<h3><a id="id-sequence-expressions" name="id-sequence-expressions"></a> <del
 class="diff-old">3.3</del>
<ins class="diff-chg">3.4</ins> Sequence Expressions</h3>
<p>XQuery <ins class="diff-new">1.1</ins> supports operators to
construct, filter, and combine <a title="sequence" href="#dt-sequence">sequences</a>
 of <a title="item" href="#dt-item">items</a> . Sequences are never 
nested—for example,
combining the values <code>1</code> , <code>(2, 3)</code> , and
<code>( )</code> into a single sequence results in the sequence
<code>(1, 2, 3)</code> .</p>
<div class="div3">
<h4><a id="construct_seq" name="construct_seq"></a> <del 
class="diff-old">3.3.1</del> <ins class="diff-chg">3.4.1</ins>
Constructing Sequences</h4>
<h5><a id="N135F4" name="N135F4"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="noid_N136CD.doc-xquery11-Expr" 
name="noid_N136CD.doc-xquery11-Expr"></a> <del class="diff-old">[31]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[39]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code>Expr</code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-ExprSingle">ExprSingle</a> (","
<a href="#doc-xquery11-ExprSingle">ExprSingle</a> )*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-RangeExpr" name="doc-xquery11-RangeExpr"></a> <del
 class="diff-old">[49]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[89]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-RangeExpr">RangeExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-AdditiveExpr">AdditiveExpr</a> (
"to" <a href="#doc-xquery11-AdditiveExpr">AdditiveExpr</a>
)?</code></td>
</tr>
</tbody>
</table>
<p>[ <a title="comma operator" id="dt-comma-operator" 
name="dt-comma-operator">Definition</a> : One way to construct a
sequence is by using the <b>comma operator</b> , which evaluates
each of its operands and concatenates the resulting sequences, in
order, into a single result sequence.] Empty parentheses can be
used to denote an empty sequence.</p>
<p>A sequence may contain duplicate atomic values or nodes, but a
sequence is never an item in another sequence. When a new sequence
is created by concatenating two or more input sequences, the new
sequence contains all the items of the input sequences and its
length is the sum of the lengths of the input sequences.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>In places where the grammar calls for <a 
href="#doc-xquery11-ExprSingle">ExprSingle</a> , such as the arguments
of a function call, any expression that contains a top-level comma
operator must be enclosed in parentheses.</p>
</div>
<p>Here are some examples of expressions that construct
sequences:</p>
<ul>
<li>
<p>The result of this expression is a sequence of five
integers:</p>
<div class="exampleInner">
<pre>(10, 1, 2, 3, 4)
</pre></div>
</li>
<li>
<p>This expression combines four sequences of length one, two,
zero, and two, respectively, into a single sequence of length five.
The result of this expression is the sequence <code>10, 1, 2, 3,
4</code> .</p>
<div class="exampleInner">
<pre>(10, (1, 2), (), (3, 4))
</pre></div>
</li>
<li>
<p>The result of this expression is a sequence containing all
<code>salary</code> children of the context node followed by all
<code>bonus</code> children.</p>
<div class="exampleInner">
<pre>(salary, bonus)
</pre></div>
</li>
<li>
<p>Assuming that <code>$price</code> is bound to the value
<code>10.50</code> , the result of this expression is the sequence
<code>10.50, 10.50</code> .</p>
<div class="exampleInner">
<pre>($price, $price)
</pre></div>
</li>
</ul>
<p>A <b>range expression</b> can be used to construct a sequence of
consecutive integers. Each of the operands of the <code>to</code>
operator is converted as though it was an argument of a function
with the expected parameter type <code>xs:integer?</code> . If
either operand is an empty sequence, or if the integer derived from
the first operand is greater than the integer derived from the
second operand, the result of the range expression is an empty
sequence. If the two operands convert to the same integer, the
result of the range expression is that integer. Otherwise, the
result is a sequence containing the two integer operands and every
integer between the two operands, in increasing order.</p>
<ul>
<li>
<p>This example uses a range expression as one operand in
constructing a sequence. It evaluates to the sequence <code>10, 1,
2, 3, 4</code> .</p>
<div class="exampleInner">
<pre>(10, 1 to 4)
</pre></div>
</li>
<li>
<p>This example constructs a sequence of length one containing the
single integer <code>10</code> .</p>
<div class="exampleInner">
<pre>10 to 10
</pre></div>
</li>
<li>
<p>The result of this example is a sequence of length zero.</p>
<div class="exampleInner">
<pre>15 to 10
</pre></div>
</li>
<li>
<p>This example uses the <code>fn:reverse</code> function to
construct a sequence of six integers in decreasing order. It
evaluates to the sequence <code>15, 14, 13, 12, 11, 10</code> .</p>
<div class="exampleInner">
<pre>fn:reverse(10 to 15)
</pre></div>
<del class="diff-old">3.3.2 Filter Expressions
[81]&nbsp;&nbsp;&nbsp; FilterExpr
&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp; PrimaryExpr PredicateList
[82]&nbsp;&nbsp;&nbsp; PredicateList
&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp; Predicate * [ Definition :
A filter expression consists simply of a primary expression
followed by zero or more predicates . The result of the filter
expression consists of the items returned by the primary
expression, filtered by applying each predicate in turn, working
from left to right.] If no predicates are specified, the result is
simply the result of the primary expression. The ordering of the
items returned by a filter expression is the same as their order in
the result of the primary expression. Context positions are
assigned to items based on their ordinal position in the result
sequence. The first context position is 1. Here are some examples
of filter expressions: Given a sequence of products in a variable,
return only those products whose price is greater than 100.
$products[price gt 100] List all the integers from 1 to 100 that
are divisible by 5. (See 3.3.1 Constructing Sequences for an
explanation of the to operator.) (1 to 100)[. mod 5 eq 0] The
result of the following expression is the integer 25: (21 to 29)[5]
The following example returns the fifth through ninth items in the
sequence bound to variable $orders . $orders[fn:position() = (5 to
9)] The following example illustrates the use of a filter
expression as a step in a path expression . It returns the last
chapter or appendix within the book bound to variable $book :
$book/(chapter | appendix)[fn:last()] The following example also
illustrates the use of a filter expression as a step in a path
expression . It returns the element node within the specified
document whose ID value is tiger :
fn:doc("zoo.xml")/fn:id('tiger')</del></li>
</ul>
</div>
<div class="div3">
<h4><a id="combining_seq" name="combining_seq"></a> <del 
class="diff-old">3.3.3</del> <ins class="diff-chg">3.4.2</ins> Combining
Node Sequences</h4>
<h5><a id="N1369B" name="N1369B"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-UnionExpr" name="doc-xquery11-UnionExpr"></a> <del
 class="diff-old">[52]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[92]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-UnionExpr">UnionExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-IntersectExceptExpr">IntersectExceptExpr</a>
 (
("union" | "|") <a href="#doc-xquery11-IntersectExceptExpr">IntersectExceptExpr</a>
)*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-IntersectExceptExpr" 
name="doc-xquery11-IntersectExceptExpr"></a> <del class="diff-old">[53]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[93]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-IntersectExceptExpr">IntersectExceptExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-InstanceofExpr">InstanceofExpr</a>
( ("intersect" | "except") <a href="#doc-xquery11-InstanceofExpr">InstanceofExpr</a>
 )*</code></td>
</tr>
</tbody>
</table>
<p>XQuery <ins class="diff-new">1.1</ins> provides the following
operators for combining sequences of nodes:</p>
<ul>
<li>
<p>The <code>union</code> and <code>|</code> operators are
equivalent. They take two node sequences as operands and return a
sequence containing all the nodes that occur in either of the
operands.</p>
</li>
<li>
<p>The <code>intersect</code> operator takes two node sequences as
operands and returns a sequence containing all the nodes that occur
in both operands.</p>
</li>
<li>
<p>The <code>except</code> operator takes two node sequences as
operands and returns a sequence containing all the nodes that occur
in the first operand but not in the second operand.</p>
</li>
</ul>
<p>All these operators eliminate duplicate nodes from their result
sequences based on node identity. <span class="xquery">If <a 
title="ordering mode" href="#dt-ordering-mode">ordering mode</a> is
<code>ordered</code> , the resulting sequence is returned in
<a title="document order" href="#dt-document-order">document
order</a> ; otherwise it is returned in <a title="implementation 
dependent" href="#dt-implementation-dependent">implementation-dependent</a>
order.</span></p>
<p>If an operand of <code>union</code> , <code>intersect</code> ,
or <code>except</code> contains an item that is not a node, a
<a title="type error" href="#dt-type-error">type error</a> is
raised [ <a title="err:XPTY0004" href="#ERRXPTY0004">err:XPTY0004</a> ].</p>
<p><ins class="diff-new">If an IntersectExceptExpr contains more
than two InstanceofExprs, they are grouped from left to right. With
a UnionExpr, it makes no difference how operands are grouped, the
results are the same.</ins></p>
<p>Here are some examples of expressions that combine sequences.
Assume the existence of three element nodes that we will refer to
by symbolic names A, B, and C. Assume that the variables
<code>$seq1</code> , <code>$seq2</code> and <code>$seq3</code> are
bound to the following sequences of these nodes:</p>
<ul>
<li>
<p><code>$seq1</code> is bound to (A, B)</p>
</li>
<li>
<p><code>$seq2</code> is bound to (A, B)</p>
</li>
<li>
<p><code>$seq3</code> is bound to (B, C)</p>
</li>
</ul>
<p>Then:</p>
<ul>
<li>
<p><code>$seq1 union $seq2</code> evaluates to the sequence (A,
B).</p>
</li>
<li>
<p><code>$seq2 union $seq3</code> evaluates to the sequence (A, B,
C).</p>
</li>
<li>
<p><code>$seq1 intersect $seq2</code> evaluates to the sequence (A,
B).</p>
</li>
<li>
<p><code>$seq2 intersect $seq3</code> evaluates to the sequence
containing B only.</p>
</li>
<li>
<p><code>$seq1 except $seq2</code> evaluates to the empty
sequence.</p>
</li>
<li>
<p><code>$seq2 except $seq3</code> evaluates to the sequence
containing A only.</p>
</li>
</ul>
<p>In addition to the sequence operators described here, <a 
href="#xpath-functions-11">[XQuery <del class="diff-old">1.0</del> and
XPath <del class="diff-old">2.0</del> Functions and <del 
class="diff-old">Operators]</del> <ins class="diff-chg">Operators
1.1]</ins></a> includes functions for indexed access to items or
sub-sequences of a sequence, for indexed insertion or removal of
items in a sequence, and for removing duplicate items from a
sequence.</p>
</div>
</div>
<div class="div2">
<h3><a id="id-arithmetic" name="id-arithmetic"></a> <del 
class="diff-old">3.4</del> <ins class="diff-chg">3.5</ins> Arithmetic
Expressions</h3>
<p>XQuery <ins class="diff-new">1.1</ins> provides arithmetic
operators for addition, subtraction, multiplication, division, and
modulus, in their usual binary and unary forms.</p>
<h5><a id="N1375C" name="N1375C"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-AdditiveExpr" name="doc-xquery11-AdditiveExpr"></a>
 <del class="diff-old">[50]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[90]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-AdditiveExpr">AdditiveExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-MultiplicativeExpr">MultiplicativeExpr</a>
 ( ("+" |
"-") <a href="#doc-xquery11-MultiplicativeExpr">MultiplicativeExpr</a>
)*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-MultiplicativeExpr" 
name="doc-xquery11-MultiplicativeExpr"></a> <del class="diff-old">[51]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[91]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-MultiplicativeExpr">MultiplicativeExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-UnionExpr">UnionExpr</a> ( ("*" |
"div" | "idiv" | "mod") <a href="#doc-xquery11-UnionExpr">UnionExpr</a> 
)*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-UnaryExpr" name="doc-xquery11-UnaryExpr"></a> <del
 class="diff-old">[58]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[98]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-UnaryExpr">UnaryExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>("-" | "+")* <a href="#doc-xquery11-ValueExpr">ValueExpr</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ValueExpr" name="doc-xquery11-ValueExpr"></a> <del
 class="diff-old">[59]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[99]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ValueExpr">ValueExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-ValidateExpr">ValidateExpr</a> |
<a href="#doc-xquery11-PathExpr">PathExpr</a> | <a 
href="#doc-xquery11-ExtensionExpr">ExtensionExpr</a></code></td>
</tr>
</tbody>
</table>
<p>A subtraction operator must be preceded by whitespace if it
could otherwise be interpreted as part of the previous token. For
example, <code>a-b</code> will be interpreted as a name, but
<code>a - b</code> and <code>a -b</code> will be interpreted as
arithmetic expressions. (See <a href="#whitespace-rules"><b>A.2.4
Whitespace Rules</b></a> for further details on whitespace
handling.)</p>
<p><ins class="diff-new">If an AdditiveExpr contains more than two
MultiplicativeExprs, they are grouped from left to right. So, for
instance,</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
A - B + C - D
</ins>
</pre></div>
<p><ins class="diff-new">is equivalent to</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
((A - B) + C) - D
</ins>
</pre></div>
<p><ins class="diff-new">Similarly, the operands of a
MultiplicativeExpr are grouped from left to right.</ins></p>
<p>The first step in evaluating an arithmetic expression is to
evaluate its operands. The order in which the operands are
evaluated is <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a> .</p>
<p><span class="xquery">Each</span> operand is evaluated by
applying the following steps, in order:</p>
<ol class="enumar">
<li>
<p><a title="atomization" href="#dt-atomization">Atomization</a> is
applied to the operand. The result of this operation is called the
<b>atomized operand</b> .</p>
</li>
<li>
<p>If the atomized operand is an empty sequence, the result of the
arithmetic expression is an empty sequence, and the implementation
need not evaluate the other operand or apply the operator. However,
an implementation may choose to evaluate the other operand in order
to determine whether it raises an error.</p>
</li>
<li>
<p>If the atomized operand is a sequence of length greater than
one, a <a title="type error" href="#dt-type-error">type error</a>
is raised [ <a title="err:XPTY0004" href="#ERRXPTY0004">err:XPTY0004</a>
 ].</p>
</li>
<li>
<p>If the atomized operand is of type <code>xs:untypedAtomic</code>
, it is cast to <code>xs:double</code> . If the cast fails, a
<a title="dynamic error" href="#dt-dynamic-error">dynamic error</a>
is raised. [err:FORG0001]</p>
</li>
</ol>
<p>After evaluation of the operands, if the types of the operands
are a valid combination for the given arithmetic operator, the
operator is applied to the operands, resulting in an atomic value
or a <a title="dynamic error" href="#dt-dynamic-error">dynamic
error</a> (for example, an error might result from dividing by
zero.) The combinations of atomic types that are accepted by the
various arithmetic operators, and their respective result types,
are listed in <a href="#mapping"><b>B.2 Operator Mapping</b></a>
together with the <a title="operator function" 
href="#dt-operator-function">operator functions</a> that define the
semantics of the operator for each type combination, including the
dynamic errors that can be raised by the operator. The definitions
of the operator functions are found in <a href="#xpath-functions-11">[XQuery
 <del class="diff-old">1.0</del> and
XPath <del class="diff-old">2.0</del> Functions and <del 
class="diff-old">Operators]</del> <ins class="diff-chg">Operators
1.1]</ins></a> .</p>
<p>If the types of the operands, after evaluation, are not a valid
combination for the given operator, according to the rules in
<a href="#mapping"><b>B.2 Operator Mapping</b></a> , a <a title="type 
error" href="#dt-type-error">type error</a> is raised [
<a title="err:XPTY0004" href="#ERRXPTY0004">err:XPTY0004</a> ].</p>
<p>XQuery <ins class="diff-new">1.1</ins> supports two division
operators named <code>div</code> and <code>idiv</code> . Each of
these operators accepts two operands of any <a title="numeric" 
href="#dt-numeric">numeric</a> type. As described in <a 
href="#xpath-functions-11">[XQuery <del class="diff-old">1.0</del> and
XPath <del class="diff-old">2.0</del> Functions and <del 
class="diff-old">Operators]</del> <ins class="diff-chg">Operators
1.1]</ins></a> , <code>$arg1 idiv $arg2</code> is equivalent to
<code>($arg1 div $arg2) cast as xs:integer?</code> except for error
cases.</p>
<p>Here are some examples of arithmetic expressions:</p>
<ul>
<li>
<p>The first expression below returns the <code>xs:decimal</code>
value <code>-1.5</code> , and the second expression returns the
<code>xs:integer</code> value <code>-1</code> :</p>
<div class="exampleInner">
<pre>-3 div 2
-3 idiv 2
</pre></div>
</li>
<li>
<p>Subtraction of two date values results in a value of type
<code>xs:dayTimeDuration</code> :</p>
<div class="exampleInner">
<pre>$emp/hiredate - $emp/birthdate
</pre></div>
</li>
<li>
<p>This example illustrates the difference between a subtraction
operator and a hyphen:</p>
<div class="exampleInner">
<pre>$unit-price - $unit-discount
</pre></div>
</li>
<li>
<p>Unary operators have higher precedence than binary operators,
subject of course to the use of parentheses. Therefore, the
following two examples have different meanings:</p>
<div class="exampleInner">
<pre>-$bellcost + $whistlecost
-($bellcost + $whistlecost)
</pre></div>
</li>
</ul>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p id="note-consecutive-unary-ops">Multiple consecutive unary
arithmetic operators are permitted by XQuery <ins class="diff-new">1.1</ins>
 for compatibility with <del class="diff-old">[XPath</del> <a 
href="#xpath"><ins class="diff-chg">[XML
Path Language (XPath) Version</ins> 1.0]</a> .</p>
</div>
</div>
<div class="div2">
<h3><a id="id-comparisons" name="id-comparisons"></a> <del 
class="diff-old">3.5</del> <ins class="diff-chg">3.6</ins> Comparison
Expressions</h3>
<p>Comparison expressions allow two values to be compared. XQuery
<ins class="diff-new">1.1</ins> provides three kinds of comparison
expressions, called value comparisons, general comparisons, and
node comparisons.</p>
<h5><a id="N1386A" name="N1386A"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ComparisonExpr" 
name="doc-xquery11-ComparisonExpr"></a> <del class="diff-old">[48]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[88]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ComparisonExpr">ComparisonExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-RangeExpr">RangeExpr</a> ( (
<a href="#doc-xquery11-ValueComp">ValueComp</a><br>
| <a href="#doc-xquery11-GeneralComp">GeneralComp</a><br>
| <a href="#doc-xquery11-NodeComp">NodeComp</a> ) <a 
href="#doc-xquery11-RangeExpr">RangeExpr</a> )?</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ValueComp" name="doc-xquery11-ValueComp"></a> <del
 class="diff-old">[61]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[101]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ValueComp">ValueComp</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"eq" | "ne" | "lt" | "le" | "gt" | "ge"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-GeneralComp" name="doc-xquery11-GeneralComp"></a>
 <del class="diff-old">[60]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[100]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-GeneralComp">GeneralComp</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"=" | "!=" | "&lt;" | "&lt;=" | "&gt;" |
"&gt;="</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-NodeComp" name="doc-xquery11-NodeComp"></a>
<del class="diff-old">[62]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[102]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-NodeComp">NodeComp</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"is" | "&lt;&lt;" | "&gt;&gt;"</code></td>
</tr>
</tbody>
</table>
<div class="div3">
<h4><a id="id-value-comparisons" name="id-value-comparisons"></a>
<del class="diff-old">3.5.1</del> <ins class="diff-chg">3.6.1</ins>
Value Comparisons</h4>
<p>The value comparison operators are <code>eq</code> ,
<code>ne</code> , <code>lt</code> , <code>le</code> ,
<code>gt</code> , and <code>ge</code> . Value comparisons are used
for comparing single values.</p>
<p>The first step in evaluating a value comparison is to evaluate
its operands. The order in which the operands are evaluated is
<a title="implementation dependent" href="#dt-implementation-dependent">implementation-dependent</a>
 . Each
operand is evaluated by applying the following steps, in order:</p>
<ol class="enumar">
<li>
<p><a title="atomization" href="#dt-atomization">Atomization</a> is
applied to the operand. The result of this operation is called the
<b>atomized operand</b> .</p>
</li>
<li>
<p>If the atomized operand is an empty sequence, the result of the
value comparison is an empty sequence, and the implementation need
not evaluate the other operand or apply the operator. However, an
implementation may choose to evaluate the other operand in order to
determine whether it raises an error.</p>
</li>
<li>
<p>If the atomized operand is a sequence of length greater than
one, a <a title="type error" href="#dt-type-error">type error</a>
is raised [ <a title="err:XPTY0004" href="#ERRXPTY0004">err:XPTY0004</a>
 ].</p>
</li>
<li>
<p>If the atomized operand is of type <code>xs:untypedAtomic</code>
, it is cast to <code>xs:string</code> .</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The purpose of this rule is to make value comparisons
transitive. Users should be aware that the general comparison
operators have a different rule for casting of
<code>xs:untypedAtomic</code> operands. Users should also be aware
that transitivity of value comparisons may be compromised by loss
of precision during type conversion (for example, two
<code>xs:integer</code> values that differ slightly may both be
considered equal to the same <code>xs:float</code> value because
<code>xs:float</code> has less precision than
<code>xs:integer</code> ).</p>
</div>
</li>
</ol>
<p>Next, if possible, the two operands are converted to their least
common type by a combination of <a title="type promotion" 
href="#dt-type-promotion">type promotion</a> and <a title="subtype 
substitution" href="#dt-subtype-substitution">subtype
substitution</a> . For example, if the operands are of type
<code>hatsize</code> (derived from <code>xs:integer</code> ) and
<code>shoesize</code> (derived from <code>xs:float</code> ), their
least common type is <code>xs:float</code> .</p>
<p>Finally, if the types of the operands are a valid combination
for the given operator, the operator is applied to the operands.
The combinations of atomic types that are accepted by the various
value comparison operators, and their respective result types, are
listed in <a href="#mapping"><b>B.2 Operator Mapping</b></a>
together with the <a title="operator function" 
href="#dt-operator-function">operator functions</a> that define the
semantics of the operator for each type combination. The
definitions of the operator functions are found in <a 
href="#xpath-functions-11">[XQuery <del class="diff-old">1.0</del> and
XPath <del class="diff-old">2.0</del> Functions and <del 
class="diff-old">Operators]</del> <ins class="diff-chg">Operators
1.1]</ins></a> .</p>
<p>Informally, if both atomized operands consist of exactly one
atomic value, then the result of the comparison is
<code>true</code> if the value of the first operand is (equal, not
equal, less than, less than or equal, greater than, greater than or
equal) to the value of the second operand; otherwise the result of
the comparison is <code>false</code> .</p>
<p>If the types of the operands, after evaluation, are not a valid
combination for the given operator, according to the rules in
<a href="#mapping"><b>B.2 Operator Mapping</b></a> , a <a title="type 
error" href="#dt-type-error">type error</a> is raised [
<a title="err:XPTY0004" href="#ERRXPTY0004">err:XPTY0004</a> ].</p>
<p>Here are some examples of value comparisons:</p>
<ul>
<li>
<p>The following comparison atomizes the node(s) that are returned
by the expression <code>$book/author</code> . The comparison is
true only if the result of atomization is the value "Kennedy" as an
instance of <code>xs:string</code> or <code>xs:untypedAtomic</code>
. If the result of atomization is an empty sequence, the result of
the comparison is an empty sequence. If the result of atomization
is a sequence containing more than one value, a <a title="type error" 
href="#dt-type-error">type error</a> is raised [
<a title="err:XPTY0004" href="#ERRXPTY0004">err:XPTY0004</a> ].</p>
<div class="exampleInner">
<pre>$book1/author eq "Kennedy"
</pre></div>
</li>
<li>
<p>The following <a title="path expression" href="#dt-path-expression">path
 expression</a> contains a predicate that
selects products whose weight is greater than 100. For any product
that does not have a <code>weight</code> subelement, the value of
the predicate is the empty sequence, and the product is not
selected. This example assumes that <code>weight</code> is a
validated element with a numeric type.</p>
<div class="exampleInner">
<pre>//product[weight gt 100]
</pre></div>
</li>
<li>
<p>The following comparisons are true because, in each case, the
two constructed nodes have the same value after atomization, even
though they have different identities and/or names:</p>
<div class="exampleInner">
<pre>&lt;a&gt;5&lt;/a&gt; eq &lt;a&gt;5&lt;/a&gt;
</pre></div>
<div class="exampleInner">
<pre>&lt;a&gt;5&lt;/a&gt; eq &lt;b&gt;5&lt;/b&gt;
</pre></div>
</li>
<li>
<p>The following comparison is true if <code>my:hatsize</code> and
<code>my:shoesize</code> are both user-defined types that are
derived by restriction from a primitive <a title="numeric" 
href="#dt-numeric">numeric</a> type:</p>
<div class="exampleInner">
<pre>my:hatsize(5) eq my:shoesize(5)
</pre></div>
</li>
<li>
<p>The following comparison is true. The <code>eq</code> operator
compares two QNames by performing codepoint-comparisons of their
namespace URIs and their local names, ignoring their namespace
prefixes.</p>
<div class="exampleInner">
<pre>fn:QName("http://example.com/ns1", "this:color")
   eq fn:QName("http://example.com/ns1", "that:color")
</pre></div>
</li>
</ul>
</div>
<div class="div3">
<h4><a id="id-general-comparisons" name="id-general-comparisons"></a> <del
 class="diff-old">3.5.2</del>
<ins class="diff-chg">3.6.2</ins> General Comparisons</h4>
<p>The general comparison operators are <code>=</code> ,
<code>!=</code> , <code>&lt;</code> , <code>&lt;=</code> ,
<code>&gt;</code> , and <code>&gt;=</code> . General comparisons
are existentially quantified comparisons that may be applied to
operand sequences of any length. The result of a general comparison
that does not raise an error is always <code>true</code> or
<code>false</code> .</p>
<p><span class="xquery">A</span> general comparison is evaluated by
applying the following rules, in order:</p>
<ol class="enumar">
<li>
<p><a title="atomization" href="#dt-atomization">Atomization</a> is
applied to each operand. After atomization, each operand is a
sequence of atomic values.</p>
</li>
<li>
<p>The result of the comparison is <code>true</code> if and only if
there is a pair of atomic values, one in the first operand sequence
and the other in the second operand sequence, that have the
required <b>magnitude relationship</b> . Otherwise the result of
the comparison is <code>false</code> . The <b>magnitude
relationship</b> between two atomic values is determined by
applying the following rules. If a <code>cast</code> operation
called for by these rules is not successful, a dynamic error is
raised. [err:FORG0001]</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The purpose of these rules is to preserve compatibility with
XPath 1.0, in which (for example) <code>x &lt; 17</code> is a
numeric comparison if <code>x</code> is an untyped value. Users
should be aware that the value comparison operators have different
rules for casting of <code>xs:untypedAtomic</code> operands.</p>
</div>
<ol class="enumla">
<li>
<p>If <del class="diff-old">one of the</del> <ins class="diff-chg">both</ins>
 atomic values <del class="diff-old">is an
instance</del> <ins class="diff-chg">are instances</ins> of
<code>xs:untypedAtomic <del class="diff-old">and the other is an
instance of a numeric type,</del></code> , then the <del 
class="diff-old">xs:untypedAtomic value is</del> <ins class="diff-chg">values
 are</ins> cast to the type <code><del class="diff-old">xs:double</del> <ins
 class="diff-chg">xs:string</ins></code> .</p>
</li>
<li>
<p>If <ins class="diff-new">exactly</ins> one of the atomic values
is an instance of <code>xs:untypedAtomic <del class="diff-old">and</del></code>
 , <ins class="diff-chg">it is cast to a
type depending on</ins> the other <ins class="diff-new">value's
dynamic type T according to the following rules, in which V denotes
the value to be cast:</ins></p>
<ol class="enumlr">
<li>
<p><ins class="diff-new">If T</ins> is <del class="diff-old">an
instance of</del> <ins class="diff-chg">a numeric type or is
derived from a numeric type, then V is cast to</ins>
<code><del class="diff-old">xs:untypedAtomic</del> <ins class="diff-chg">xs:double</ins></code>
 .</p>
</li>
<li>
<p><ins class="diff-chg">If T is</ins> <code><ins class="diff-chg">xs:dayTimeDuration</ins></code>
 or <ins class="diff-new">is derived from</ins> <code><del 
class="diff-old">xs:string</del> <ins class="diff-chg">xs:dayTimeDuration</ins></code>
 , then <del class="diff-old">the xs:untypedAtomic value (or values)</del>
 <ins class="diff-chg">V</ins> is <del class="diff-old">(are)</del> cast
 to
<del class="diff-old">the type</del> <code><del class="diff-old">xs:string</del>
 <ins class="diff-chg">xs:dayTimeDuration</ins></code> .</p>
</li>
<li>
<p>If <del class="diff-old">one of the atomic values</del>
<ins class="diff-chg">T</ins> is <del class="diff-old">an instance
of</del> <code><del class="diff-old">xs:untypedAtomic</del>
<ins class="diff-chg">xs:yearMonthDuration</ins></code> <del 
class="diff-old">and the other</del> <ins class="diff-chg">or</ins> is
<del class="diff-old">not an instance of xs:string ,</del>
<ins class="diff-chg">derived from</ins> <code><del class="diff-old">xs:untypedAtomic</del>
 <ins class="diff-chg">xs:yearMonthDuration</ins></code> , <del 
class="diff-old">or any numeric type,</del> then <del class="diff-old">the</del>
 <ins class="diff-chg">V is cast to</ins>
<code><del class="diff-old">xs:untypedAtomic value</del>
<ins class="diff-chg">xs:yearMonthDuration</ins></code> .</p>
</li>
<li>
<p><ins class="diff-chg">In all other cases, V</ins> is cast to the
<del class="diff-old">dynamic</del> <ins class="diff-chg">primitive
base</ins> type <ins class="diff-chg">of T.</ins></p>
</li>
</ol>
<div class="note">
<p class="prefix"><b><ins class="diff-chg">Note:</ins></b></p>
<p><ins class="diff-chg">The special treatment</ins> of the
<del class="diff-old">other value.</del> <ins class="diff-chg">duration 
types is required to avoid errors that may
arise when comparing the primitive type</ins> <code><ins 
class="diff-chg">xs:duration</ins></code> <ins class="diff-chg">with any
duration type.</ins></p>
</div>
</li>
<li>
<p>After performing the conversions described above, the atomic
values are compared using one of the value comparison operators
<code>eq</code> , <code>ne</code> , <code>lt</code> ,
<code>le</code> , <code>gt</code> , or <code>ge</code> , depending
on whether the general comparison operator was <code>=</code> ,
<code>!=</code> , <code>&lt;</code> , <code>&lt;=</code> ,
<code>&gt;</code> , or <code>&gt;=</code> . The values have the
required <b>magnitude relationship</b> if and only if the result of
this value comparison is <code>true</code> .</p>
</li>
</ol>
</li>
</ol>
<p>When evaluating a general comparison in which either operand is
a sequence of items, an implementation may return <code>true</code>
as soon as it finds an item in the first operand and an item in the
second operand that have the required <b>magnitude relationship</b>
. Similarly, a general comparison may raise a <a title="dynamic error" 
href="#dt-dynamic-error">dynamic error</a> as soon
as it encounters an error in evaluating either operand, or in
comparing a pair of items from the two operands. As a result of
these rules, the result of a general comparison is not
deterministic in the presence of errors.</p>
<p>Here are some examples of general comparisons:</p>
<ul>
<li>
<p>The following comparison is true if the <a title="typed value" 
href="#dt-typed-value">typed value</a> of any <code>author</code>
subelement of <code>$book1</code> is "Kennedy" as an instance of
<code>xs:string</code> or <code>xs:untypedAtomic</code> :</p>
<div class="exampleInner">
<pre>$book1/author = "Kennedy"
</pre></div>
</li>
<li>
<p>The following example contains three general comparisons. The
value of the first two comparisons is <code>true</code> , and the
value of the third comparison is <code>false</code> . This example
illustrates the fact that general comparisons are not
transitive.</p>
<div class="exampleInner">
<pre>(1, 2) = (2, 3)
(2, 3) = (3, 4)
(1, 2) = (3, 4)
</pre></div>
</li>
<li>
<p>The following example contains two general comparisons, both of
which are <code>true</code> . This example illustrates the fact
that the <code>=</code> and <code>!=</code> operators are not
inverses of each other.</p>
<div class="exampleInner">
<pre>(1, 2) = (2, 3)
(1, 2) != (2, 3)
</pre></div>
</li>
<li>
<p>Suppose that <code>$a</code> , <code>$b</code> , and
<code>$c</code> are bound to element nodes with type annotation
<code>xs:untypedAtomic</code> , with <a title="string value" 
href="#dt-string-value">string values</a> " <code>1</code> ", "
<code>2</code> ", and " <code>2.0</code> " respectively. Then
<code>($a, $b) = ($c, 3.0)</code> returns <code>false</code> ,
because <code>$b</code> and <code>$c</code> are compared as
strings. However, <code>($a, $b) = ($c, 2.0)</code> returns
<code>true</code> , because <code>$b</code> and <code>2.0</code>
are compared as numbers.</p>
</li>
</ul>
</div>
<div class="div3">
<h4><a id="id-node-comparisons" name="id-node-comparisons"></a>
<del class="diff-old">3.5.3</del> <ins class="diff-chg">3.6.3</ins>
Node Comparisons</h4>
<p>Node comparisons are used to compare two nodes, by their
identity or by their <a title="document order" href="#dt-document-order">document
 order</a> . The result of a node
comparison is defined by the following rules:</p>
<ol class="enumar">
<li>
<p>The operands of a node comparison are evaluated in <a 
title="implementation dependent" href="#dt-implementation-dependent">implementation-dependent</a>
order.</p>
</li>
<li>
<p>If either operand is an empty sequence, the result of the
comparison is an empty sequence, and the implementation need not
evaluate the other operand or apply the operator. However, an
implementation may choose to evaluate the other operand in order to
determine whether it raises an error.</p>
</li>
<li>
<p>Each operand must be either a single node or an empty sequence;
otherwise a <a title="type error" href="#dt-type-error">type
error</a> is raised [ <a title="err:XPTY0004" href="#ERRXPTY0004">err:XPTY0004</a>
 ].</p>
</li>
<li>
<p>A comparison with the <code>is</code> operator is
<code>true</code> if the two operand nodes have the same identity,
and are thus the same node; otherwise it is <code>false</code> .
See <del class="diff-old">[XQuery/XPath</del> <a 
href="#xpath-datamodel-11"><ins class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> for a definition of node
identity.</p>
</li>
<li>
<p>A comparison with the <code>&lt;&lt;</code> operator returns
<code>true</code> if the left operand node precedes the right
operand node in <a title="document order" href="#dt-document-order">document
 order</a> ; otherwise it returns
<code>false</code> .</p>
</li>
<li>
<p>A comparison with the <code>&gt;&gt;</code> operator returns
<code>true</code> if the left operand node follows the right
operand node in <a title="document order" href="#dt-document-order">document
 order</a> ; otherwise it returns
<code>false</code> .</p>
</li>
</ol>
<p>Here are some examples of node comparisons:</p>
<ul>
<li>
<p>The following comparison is true only if the left and right
sides each evaluate to exactly the same single node:</p>
<div class="exampleInner">
<pre>/books/book[isbn="1558604820"] is /books/book[call="QA76.9 C3845"]
</pre></div>
</li>
<li>
<p>The following comparison is false because each constructed node
has its own identity:</p>
<div class="exampleInner">
<pre>&lt;a&gt;5&lt;/a&gt; is &lt;a&gt;5&lt;/a&gt;
</pre></div>
</li>
<li>
<p>The following comparison is true only if the node identified by
the left side occurs before the node identified by the right side
in document order:</p>
<div class="exampleInner">
<pre>/transactions/purchase[parcel="28-451"] 
   &lt;&lt; /transactions/sale[parcel="33-870"]
</pre></div>
</li>
</ul>
</div>
</div>
<div class="div2">
<h3><a id="id-logical-expressions" name="id-logical-expressions"></a> <del
 class="diff-old">3.6</del>
<ins class="diff-chg">3.7</ins> Logical Expressions</h3>
<p>A <b>logical expression</b> is either an <b>and-expression</b>
or an <b>or-expression</b> . If a logical expression does not raise
an error, its value is always one of the boolean values
<code>true</code> or <code>false</code> .</p>
<h5><a id="N13B33" name="N13B33"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-OrExpr" name="doc-xquery11-OrExpr"></a>
<del class="diff-old">[46]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[86]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-OrExpr">OrExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-AndExpr">AndExpr</a> ( "or"
<a href="#doc-xquery11-AndExpr">AndExpr</a> )*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-AndExpr" name="doc-xquery11-AndExpr"></a>
<del class="diff-old">[47]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[87]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-AndExpr">AndExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-ComparisonExpr">ComparisonExpr</a>
( "and" <a href="#doc-xquery11-ComparisonExpr">ComparisonExpr</a>
)*</code></td>
</tr>
</tbody>
</table>
<p>The first step in evaluating a logical expression is to find the
<a title="effective boolean value" href="#dt-ebv">effective boolean
value</a> of each of its operands (see <a href="#id-ebv"><b>2.4.3
Effective Boolean Value</b></a> ).</p>
<p>The value of an and-expression is determined by the effective
boolean values (EBV's) of its operands, as shown in the following
table:</p>
<table summary="AND EBV" width="80%" border="1" cellpadding="4" 
cellspacing="1">
<tbody>
<tr>
<td>AND:</td>
<td>EBV <sub>2</sub> = <code>true</code></td>
<td>EBV <sub>2</sub> = <code>false</code></td>
<td>error in EBV <sub>2</sub></td>
</tr>
<tr>
<td>EBV <sub>1</sub> = <code>true</code></td>
<td><code>true</code></td>
<td><code>false</code></td>
<td>error</td>
</tr>
<tr>
<td>EBV <sub>1</sub> = <code>false</code></td>
<td><code>false</code></td>
<td><code>false</code></td>
<td><span class="xquery">either <code>false</code> or
error</span></td>
</tr>
<tr>
<td>error in EBV <sub>1</sub></td>
<td>error</td>
<td><span class="xquery">either <code>false</code> or
error</span></td>
<td>error</td>
</tr>
</tbody>
</table>
<p>The value of an or-expression is determined by the effective
boolean values (EBV's) of its operands, as shown in the following
table:</p>
<table summary="OR EBV" width="80%" border="1" cellpadding="4" 
cellspacing="1">
<tbody>
<tr>
<td>OR:</td>
<td>EBV <sub>2</sub> = <code>true</code></td>
<td>EBV <sub>2</sub> = <code>false</code></td>
<td>error in EBV <sub>2</sub></td>
</tr>
<tr>
<td>EBV <sub>1</sub> = <code>true</code></td>
<td><code>true</code></td>
<td><code>true</code></td>
<td><span class="xquery">either <code>true</code> or
error</span></td>
</tr>
<tr>
<td>EBV <sub>1</sub> = <code>false</code></td>
<td><code>true</code></td>
<td><code>false</code></td>
<td>error</td>
</tr>
<tr>
<td>error in EBV <sub>1</sub></td>
<td><span class="xquery">either <code>true</code> or
error</span></td>
<td>error</td>
<td>error</td>
</tr>
</tbody>
</table>
<p><span class="xquery">The order in which the operands of a
logical expression are evaluated is <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a> . The
tables above are defined in such a way that</span> an or-expression
can return <code>true</code> if the first expression evaluated is
true, and it can raise an error if evaluation of the first
expression raises an error. Similarly, an and-expression can return
<code>false</code> if the first expression evaluated is false, and
it can raise an error if evaluation of the first expression raises
an error. As a result of these rules, a logical expression is not
deterministic in the presence of errors, as illustrated in the
examples below.</p>
<p>Here are some examples of logical expressions:</p>
<ul>
<li>
<p>The following expressions return <code>true</code> :</p>
<div class="exampleInner">
<pre>1 eq 1 and 2 eq 2
</pre></div>
<div class="exampleInner">
<pre>1 eq 1 or 2 eq 3
</pre></div>
</li>
<li>
<p>The following expression may return either <code>false</code> or
raise a <a title="dynamic error" href="#dt-dynamic-error">dynamic
error</a> :</p>
<div class="exampleInner">
<pre>1 eq 2 and 3 idiv 0 = 1
</pre></div>
</li>
<li>
<p>The following expression may return either <code>true</code> or
raise a <a title="dynamic error" href="#dt-dynamic-error">dynamic
error</a> :</p>
<div class="exampleInner">
<pre>1 eq 1 or 3 idiv 0 = 1
</pre></div>
</li>
<li>
<p>The following expression must raise a <a title="dynamic error" 
href="#dt-dynamic-error">dynamic error</a> :</p>
<div class="exampleInner">
<pre>1 eq 1 and 3 idiv 0 = 1
</pre></div>
</li>
</ul>
<p>In addition to and- and or-expressions, XQuery <ins class="diff-new">1.1</ins>
 provides a function named <code>fn:not</code>
that takes a general sequence as parameter and returns a boolean
value. The <code>fn:not</code> function is defined in <a 
href="#xpath-functions-11">[XQuery <del class="diff-old">1.0</del> and
XPath <del class="diff-old">2.0</del> Functions and <del 
class="diff-old">Operators]</del> <ins class="diff-chg">Operators
1.1]</ins></a> . The <code>fn:not</code> function reduces its
parameter to an <a title="effective boolean value" href="#dt-ebv">effective
 boolean value</a> . It then returns
<code>true</code> if the effective boolean value of its parameter
is <code>false</code> , and <code>false</code> if the effective
boolean value of its parameter is <code>true</code> . If an error
is encountered in finding the effective boolean value of its
operand, <code>fn:not</code> raises the same error.</p>
</div>
<div class="div2">
<h3><a id="id-constructors" name="id-constructors"></a> <del 
class="diff-old">3.7</del> <ins class="diff-chg">3.8</ins>
Constructors</h3>
<p>XQuery provides constructors that can create XML structures
within a query. Constructors are provided for element, attribute,
document, text, comment, and processing instruction nodes. Two
kinds of constructors are provided: <b>direct constructors</b> ,
which use an XML-like notation, and <b>computed constructors</b> ,
which use a notation based on enclosed expressions.</p>
<h5><a id="N13CE6" name="N13CE6"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-Constructor" name="doc-xquery11-Constructor"></a>
 <del class="diff-old">[94]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[137]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-Constructor">Constructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-DirectConstructor">DirectConstructor</a><br>
| <a href="#doc-xquery11-ComputedConstructor">ComputedConstructor</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-DirectConstructor" 
name="doc-xquery11-DirectConstructor"></a> <del class="diff-old">[95]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[138]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-DirectConstructor">DirectConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-DirElemConstructor">DirElemConstructor</a><br>
| <a href="#doc-xquery11-DirCommentConstructor">DirCommentConstructor</a><br>

| <a href="#doc-xquery11-DirPIConstructor">DirPIConstructor</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-DirElemConstructor" 
name="doc-xquery11-DirElemConstructor"></a> <del class="diff-old">[96]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[139]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-DirElemConstructor">DirElemConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"&lt;" <a href="#prod-xquery11-QName">QName</a> <a 
href="#doc-xquery11-DirAttributeList">DirAttributeList</a> ("/&gt;" |
("&gt;" <a href="#doc-xquery11-DirElemContent">DirElemContent</a> *
"&lt;/" <a href="#prod-xquery11-QName">QName</a> <a 
href="#prod-xquery11-S">S</a> ? "&gt;"))</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-DirElemContent" 
name="doc-xquery11-DirElemContent"></a> <del class="diff-old">[101]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[144]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-DirElemContent">DirElemContent</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-DirectConstructor">DirectConstructor</a><br>
| <a href="#doc-xquery11-CDataSection">CDataSection</a><br>
| <a href="#doc-xquery11-CommonContent">CommonContent</a><br>
| <a href="#doc-xquery11-ElementContentChar">ElementContentChar</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ElementContentChar" 
name="doc-xquery11-ElementContentChar"></a> <del class="diff-old">[148]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[204]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ElementContentChar">ElementContentChar</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-Char">Char</a> -
[{}&lt;&amp;]</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CommonContent" name="doc-xquery11-CommonContent"></a>
 <del class="diff-old">[102]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[145]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CommonContent">CommonContent</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-PredefinedEntityRef">PredefinedEntityRef</a>
 |
<a href="#prod-xquery11-CharRef">CharRef</a> | "{{" | "}}" |
<a href="#doc-xquery11-EnclosedExpr">EnclosedExpr</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CDataSection" name="doc-xquery11-CDataSection"></a>
 <del class="diff-old">[107]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[150]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CDataSection">CDataSection</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"&lt;![CDATA[" <a href="#doc-xquery11-CDataSectionContents">CDataSectionContents</a>
"]]&gt;"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CDataSectionContents" 
name="doc-xquery11-CDataSectionContents"></a> <del class="diff-old">[108]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[151]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CDataSectionContents">CDataSectionContents</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>( <a href="#prod-xquery11-Char">Char</a> * - (Char*
']]&gt;' Char*))</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-DirAttributeList" 
name="doc-xquery11-DirAttributeList"></a> <del class="diff-old">[97]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[140]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-DirAttributeList">DirAttributeList</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>( <a href="#prod-xquery11-S">S</a> ( <a 
href="#prod-xquery11-QName">QName</a> <a href="#prod-xquery11-S">S</a> ?
"=" <a href="#prod-xquery11-S">S</a> ? <a 
href="#doc-xquery11-DirAttributeValue">DirAttributeValue</a>
)?)*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-DirAttributeValue" 
name="doc-xquery11-DirAttributeValue"></a> <del class="diff-old">[98]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[141]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-DirAttributeValue">DirAttributeValue</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>('"' ( <a href="#doc-xquery11-EscapeQuot">EscapeQuot</a>
| <a href="#doc-xquery11-QuotAttrValueContent">QuotAttrValueContent</a> 
)*
'"')<br>
| ("'" ( <a href="#doc-xquery11-EscapeApos">EscapeApos</a> |
<a href="#doc-xquery11-AposAttrValueContent">AposAttrValueContent</a> )*
"'")</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-QuotAttrValueContent" 
name="doc-xquery11-QuotAttrValueContent"></a> <del class="diff-old">[99]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[142]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-QuotAttrValueContent">QuotAttrValueContent</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-QuotAttrContentChar">QuotAttrContentChar</a><br>
| <a href="#doc-xquery11-CommonContent">CommonContent</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-AposAttrValueContent" 
name="doc-xquery11-AposAttrValueContent"></a> <del class="diff-old">[100]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[143]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-AposAttrValueContent">AposAttrValueContent</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-AposAttrContentChar">AposAttrContentChar</a><br>
| <a href="#doc-xquery11-CommonContent">CommonContent</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-QuotAttrContentChar" 
name="doc-xquery11-QuotAttrContentChar"></a> <del class="diff-old">[149]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[205]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-QuotAttrContentChar">QuotAttrContentChar</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-Char">Char</a> -
["{}&lt;&amp;]</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-AposAttrContentChar" 
name="doc-xquery11-AposAttrContentChar"></a> <del class="diff-old">[150]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[206]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-AposAttrContentChar">AposAttrContentChar</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-Char">Char</a> -
['{}&lt;&amp;]</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-EscapeQuot" name="doc-xquery11-EscapeQuot"></a> <del
 class="diff-old">[146]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[202]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-EscapeQuot">EscapeQuot</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>'""'</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-EscapeApos" name="doc-xquery11-EscapeApos"></a> <del
 class="diff-old">[147]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[203]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-EscapeApos">EscapeApos</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"''"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-EnclosedExpr" name="doc-xquery11-EnclosedExpr"></a>
 <del class="diff-old">[29]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[36]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-EnclosedExpr">EnclosedExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"{" <a href="#doc-xquery11-Expr">Expr</a> "}"</code></td>
</tr>
</tbody>
</table>
<p>This section contains a conceptual description of the semantics
of various kinds of constructor expressions. An XQuery
implementation is free to use any implementation technique that
produces the same result as the processing steps described in this
section.</p>
<div class="div3">
<h4><a id="id-element-constructor" name="id-element-constructor"></a> <del
 class="diff-old">3.7.1</del>
<ins class="diff-chg">3.8.1</ins> Direct Element Constructors</h4>
<p>An <b>element constructor</b> creates an element node. [
<a title="direct element constructor" id="dt-direct-elem-const" 
name="dt-direct-elem-const">Definition</a> : A <b>direct element
constructor</b> is a form of element constructor in which the name
of the constructed element is a constant.] Direct element
constructors are based on standard XML notation. For example, the
following expression is a direct element constructor that creates a
<code>book</code> element containing an attribute and some nested
elements:</p>
<div class="exampleInner">
<pre>&lt;book isbn="isbn-0060229357"&gt;
    &lt;title&gt;Harold and the Purple Crayon&lt;/title&gt;
    &lt;author&gt;
        &lt;first&gt;Crockett&lt;/first&gt;
        &lt;last&gt;Johnson&lt;/last&gt;
    &lt;/author&gt;
&lt;/book&gt;
</pre></div>
<p>If the element name in a direct element constructor has a
namespace prefix, the namespace prefix is resolved to a namespace
URI using the <a title="statically known namespaces" 
href="#dt-static-namespaces">statically known namespaces</a> . If the
element name has no namespace prefix, it is implicitly qualified by
the <a title="default element/type namespace" href="#dt-def-elemtype-ns">default
 element/type namespace</a> . Note
that both the statically known namespaces and the default
element/type namespace may be affected by <a title="namespace 
declaration attribute" href="#dt-namespace-decl-attr">namespace 
declaration attributes</a>
found inside the element constructor. The namespace prefix of the
element name is retained after expansion of the <del class="diff-old">QName,</del>
 <a title="lexical QName" href="#dt-qname"><ins class="diff-chg">lexical
 QName</ins></a>
<ins class="diff-chg">,</ins> as described in <del class="diff-old">[XQuery/XPath</del>
 <a href="#xpath-datamodel-11"><ins class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> . The resulting <a title="expanded QName" 
href="#dt-expanded-qname">expanded QName</a>
becomes the <code>node-name</code> property of the constructed
element node.</p>
<p>In a direct element constructor, the name used in the end tag
must exactly match the name used in the corresponding start tag,
including its prefix or absence of a prefix.</p>
<p>In a direct element constructor, curly braces { } delimit
<b>enclosed expressions</b> , distinguishing them from literal
text. Enclosed expressions are evaluated and replaced by their
value, as illustrated by the following example:</p>
<div class="exampleInner">
<pre>&lt;example&gt;
   &lt;p&gt; Here is a query. &lt;/p&gt;
   &lt;eg&gt; $b/title &lt;/eg&gt;
   &lt;p&gt; Here is the result of the query. &lt;/p&gt;
   &lt;eg&gt;{ $b/title }&lt;/eg&gt;
&lt;/example&gt;
</pre></div>
<p>The above query might generate the following result (whitespace
has been added for readability to this result and other result
examples in this document):</p>
<div class="exampleInner">
<pre>&lt;example&gt;
  &lt;p&gt; Here is a query. &lt;/p&gt;
  &lt;eg&gt; $b/title &lt;/eg&gt;
  &lt;p&gt; Here is the result of the query. &lt;/p&gt;
  &lt;eg&gt;&lt;title&gt;Harold and the Purple Crayon&lt;/title&gt;&lt;/eg&gt;
&lt;/example&gt;
</pre></div>
<p>Since XQuery uses curly braces to denote enclosed expressions,
some convention is needed to denote a curly brace used as an
ordinary character. For this purpose, a pair of identical curly
brace characters within the content of an element or attribute are
interpreted by XQuery as a single curly brace character (that is,
the pair " <code>{{</code> " represents the character "
<code>{</code> " and the pair " <code>}}</code> " represents the
character " <code>}</code> ".) Alternatively, the <a title="character 
reference" href="#dt-character-reference">character
references</a> <code>&amp;#x7b;</code> and <code>&amp;#x7d;</code>
can be used to denote curly brace characters. A single left curly
brace (" <code>{</code> ") is interpreted as the beginning
delimiter for an enclosed expression. A single right curly brace ("
<code>}</code> ") without a matching left curly brace is treated as
a <a title="static error" href="#dt-static-error">static error</a>
[ <a title="err:XPST0003" href="#ERRXPST0003">err:XPST0003</a>
].</p>
<p>The result of an element constructor is a new element node, with
its own node identity. All the attribute and descendant nodes of
the new element node are also new nodes with their own identities,
even if they are copies of existing nodes.</p>
<div class="div4">
<h5><a id="id-attributes" name="id-attributes"></a> <del 
class="diff-old">3.7.1.1</del> <ins class="diff-chg">3.8.1.1</ins>
Attributes</h5>
<p>The start tag of a direct element constructor may contain one or
more attributes. As in XML, each attribute is specified by a name
and a value. In a direct element constructor, the name of each
attribute is specified by a constant <del class="diff-old">QName,</del> <a
 title="lexical QName" href="#dt-qname"><ins class="diff-chg">lexical 
QName</ins></a> , and the
value of the attribute is specified by a string of characters
enclosed in single or double quotes. As in the main content of the
element constructor, an attribute value may contain expressions
enclosed in curly braces, which are evaluated and replaced by their
value during processing of the element constructor.</p>
<p>Each attribute in a direct element constructor creates a new
attribute node, with its own node identity, whose parent is the
constructed element node. However, note that <a title="namespace 
declaration attribute" href="#dt-namespace-decl-attr">namespace 
declaration attributes</a> (see
<a href="#id-namespaces"><b><del class="diff-old">3.7.1.2</del>
<ins class="diff-chg">3.8.1.2</ins> Namespace Declaration
Attributes</b></a> ) do not create attribute nodes.</p>
<p>If an attribute name has a namespace prefix, the prefix is
resolved to a namespace URI using the <a title="statically known 
namespaces" href="#dt-static-namespaces">statically known namespaces</a>
 . If the
attribute name has no namespace prefix, the attribute is in no
namespace. Note that the statically known namespaces used in
resolving an attribute name may be affected by <a title="namespace 
declaration attribute" href="#dt-namespace-decl-attr">namespace 
declaration attributes</a> that
are found inside the same element constructor. The namespace prefix
of the attribute name is retained after expansion of the
<del class="diff-old">QName,</del> <a title="lexical QName" 
href="#dt-qname"><ins class="diff-chg">lexical QName</ins></a> , as
described in <del class="diff-old">[XQuery/XPath</del> <a 
href="#xpath-datamodel-11"><ins class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> . The resulting <a title="expanded QName" 
href="#dt-expanded-qname">expanded QName</a>
becomes the <code>node-name</code> property of the constructed
attribute node.</p>
<p>If the attributes in a direct element constructor do not have
distinct <a title="expanded QName" href="#dt-expanded-qname">expanded 
QNames</a> as their respective
<code>node-name</code> properties, a <a title="static error" 
href="#dt-static-error">static error</a> is raised [ <a 
title="err:XQST0040" href="#ERRXQST0040">err:XQST0040</a> ].</p>
<p>Conceptually, an attribute (other than a namespace declaration
attribute) in a direct element constructor is processed by the
following steps:</p>
<ol class="enumar">
<li>
<p>Each consecutive sequence of literal characters in the attribute
content is treated as a string containing those <del class="diff-old">characters.</del>
 <ins class="diff-chg">characters, with
the following exceptions:</ins></p>
<ol class="enumla">
<li>
<p><ins class="diff-chg">Each occurrence of two consecutive</ins>
<code><ins class="diff-chg">{</ins></code> <ins class="diff-chg">characters
 is replaced by a single</ins>
<code><ins class="diff-chg">{</ins></code> <ins class="diff-chg">character.</ins></p>
</li>
<li>
<p><ins class="diff-chg">Each occurrence of two consecutive</ins>
<code><ins class="diff-chg">}</ins></code> <ins class="diff-chg">characters
 is replaced by a single</ins>
<code><ins class="diff-chg">}</ins></code> <ins class="diff-chg">character.</ins></p>
</li>
<li>
<p><ins class="diff-chg">Each occurrence of two consecutive</ins>
<code><ins class="diff-chg">"</ins></code> <ins class="diff-chg">characters
 is replaced by a single</ins>
<code><ins class="diff-chg">"</ins></code> <ins class="diff-chg">character.</ins></p>
</li>
<li>
<p><ins class="diff-chg">Each occurrence of two consecutive</ins>
<code><ins class="diff-chg">'</ins></code> <ins class="diff-chg">characters
 is replaced by a single</ins>
<code><ins class="diff-chg">'</ins></code> <ins class="diff-chg">character.</ins></p>
</li>
</ol>
<p>Attribute value normalization is then applied to normalize
whitespace and expand <a title="character reference" 
href="#dt-character-reference">character references</a> and <a 
title="predefined entity reference" 
href="#dt-predefined-entity-reference">predefined entity references</a>
. An XQuery processor that supports XML 1.0 uses the rules for
attribute value normalization in Section 3.3.3 of <a href="#XML">[XML 
1.0]</a> ; an XQuery processor that supports XML 1.1
uses the rules for attribute value normalization in Section 3.3.3
of <a href="#XML1.1">[XML 1.1]</a> . In either case, the
normalization rules are applied as though the type of the attribute
were CDATA (leading and trailing whitespace characters are not
stripped.) The choice between XML 1.0 and XML 1.1 rules is
<a title="implementation defined" href="#dt-implementation-defined">implementation-defined</a>
 .</p>
</li>
<li>
<p>Each enclosed expression is converted to a string as
follows:</p>
<ol class="enumla">
<li>
<p><a title="atomization" href="#dt-atomization">Atomization</a> is
applied to the value of the enclosed expression, converting it to a
sequence of atomic values.</p>
</li>
<li>
<p>If the result of atomization is an empty sequence, the result is
the zero-length string. Otherwise, each atomic value in the
atomized sequence is cast into a string.</p>
</li>
<li>
<p>The individual strings resulting from the previous step are
merged into a single string by concatenating them with a single
space character between each pair.</p>
</li>
</ol>
</li>
<li>
<p>Adjacent strings resulting from the above steps are concatenated
with no intervening blanks. The resulting string becomes the
<code>string-value</code> property of the attribute node. The
attribute node is given a <a title="type annotation" 
href="#dt-type-annotation">type annotation</a> ( <code>type-name</code>
property) of <code>xs:untypedAtomic</code> (this type annotation
may change if the parent element is validated). The
<code>typed-value</code> property of the attribute node is the same
as its <code>string-value</code> , as an instance of
<code>xs:untypedAtomic</code> .</p>
</li>
<li>
<p>The <code>parent</code> property of the attribute node is set to
the element node constructed by the direct element constructor that
contains this attribute.</p>
</li>
<li>
<p>If the attribute name is <code>xml:id</code> , then
<code>xml:id</code> processing is performed as defined in <a 
href="#XMLID">[XML ID]</a> . This ensures that the attribute has the
type <code>xs:ID</code> and that its value is properly normalized.
If an error is encountered during <code>xml:id</code> processing,
an implementation <del class="diff-old">MAY</del> <ins class="diff-chg">may</ins>
 raise a <a title="dynamic error" href="#dt-dynamic-error">dynamic error</a>
 [ <a title="err:XQDY0091" href="#ERRXQDY0091">err:XQDY0091</a> ].</p>
</li>
<li>
<p>If the attribute name is <code>xml:id</code> , the
<code>is-id</code> property of the resulting attribute node is set
to <code>true</code> ; otherwise the <code>is-id</code> property is
set to <code>false</code> . The <code>is-idrefs</code> property of
the attribute node is unconditionally set to <code>false</code>
.</p>
</li>
</ol>
<ul>
<li>
<p>Example:</p>
<div class="exampleInner">
<pre>&lt;shoe size="7"/&gt;
</pre></div>
<p>The string value of the <code>size</code> attribute is "
<code>7</code> ".</p>
</li>
<li>
<p>Example:</p>
<div class="exampleInner">
<pre>&lt;shoe size="{7}"/&gt;
</pre></div>
<p>The string value of the <code>size</code> attribute is "
<code>7</code> ".</p>
</li>
<li>
<p>Example:</p>
<div class="exampleInner">
<pre>&lt;shoe size="{()}"/&gt;
</pre></div>
<p>The string value of the <code>size</code> attribute is the
zero-length string.</p>
</li>
<li>
<p>Example:</p>
<div class="exampleInner">
<pre>&lt;chapter ref="[{1, 5 to 7, 9}]"/&gt;
</pre></div>
<p>The string value of the <code>ref</code> attribute is " <code>[1
5 6 7 9]</code> ".</p>
</li>
<li>
<p>Example:</p>
<div class="exampleInner">
<pre>&lt;shoe size="As big as {$hat/@size}"/&gt;
</pre></div>
<p>The string value of the <code>size</code> attribute is the
string " <code>As big as</code> ", concatenated with the string
value of the node denoted by the expression <code>$hat/@size</code>
.</p>
</li>
</ul>
</div>
<div class="div4">
<h5><a id="id-namespaces" name="id-namespaces"></a> <del 
class="diff-old">3.7.1.2</del> <ins class="diff-chg">3.8.1.2</ins>
Namespace Declaration Attributes</h5>
<p>The names of a constructed element and its attributes may be
<a title="lexical QName" href="#dt-qname"><ins class="diff-chg">lexical</ins>
 QNames</a> that include <b>namespace
prefixes</b> . Namespace prefixes can be bound to namespaces in the
<a title="Prolog" href="#dt-prolog">Prolog</a> or by <b>namespace
declaration attributes</b> . It is a <a title="static error" 
href="#dt-static-error">static error</a> to use a namespace prefix that
has not been bound to a namespace [ <a title="err:XPST0081" 
href="#ERRXPST0081">err:XPST0081</a> ].</p>
<p>[ <a title="namespace declaration attribute" 
id="dt-namespace-decl-attr" name="dt-namespace-decl-attr">Definition</a>
 : A <b>namespace
declaration attribute</b> is used inside a direct element
constructor. Its purpose is to bind a namespace prefix or to set
the <a title="default element/type namespace" href="#dt-def-elemtype-ns">default
 element/type namespace</a> for the
constructed element node, including its attributes.] Syntactically,
a namespace declaration attribute has the form of an attribute with
namespace prefix <code>xmlns</code> , or with name
<code>xmlns</code> and no namespace prefix. <del class="diff-old">The 
value of a namespace declaration attribute must be a
URILiteral ; otherwise a static error is raised [ err:XQST0022
].</del> All the namespace declaration attributes of a given
element must have distinct names [ <a title="err:XQST0071" 
href="#ERRXQST0071">err:XQST0071</a> ]. Each namespace declaration
attribute is processed as follows:</p>
<ul>
<li>
<p>The <del class="diff-old">local part</del> <ins class="diff-chg">value</ins>
 of the <ins class="diff-new">namespace
declaration</ins> attribute <del class="diff-old">name</del>
<ins class="diff-chg">(a</ins> <a href="#doc-xquery11-DirAttributeValue"><ins
 class="diff-chg">DirAttributeValue</ins></a> <ins class="diff-chg">)</ins>
 is <del class="diff-old">interpreted</del>
<ins class="diff-chg">processed</ins> as <ins class="diff-new">follows. 
If the</ins> <a href="#doc-xquery11-DirAttributeValue"><ins 
class="diff-new">DirAttributeValue</ins></a> <ins class="diff-new">contains
 an</ins> <a href="#doc-xquery11-EnclosedExpr"><ins class="diff-new">EnclosedExpr</ins></a>
 , a <del class="diff-old">namespace prefix</del> <ins class="diff-chg">static
error
 is raised [</ins> <a title="err:XQST0022" href="#ERRXQST0022"><ins 
class="diff-chg">err:XQST0022</ins></a>
<ins class="diff-chg">]. Otherwise, it is processed as described in
rule 1 of</ins> <a href="#id-attributes"><b><ins class="diff-chg">3.8.1.1
 Attributes</ins></b></a> .<ins class="diff-chg">An implementation MAY 
raise a static error [</ins>
<a title="err:XQST0046" href="#ERRXQST0046"><ins class="diff-chg">err:XQST0046</ins></a>
 <ins class="diff-chg">] if the
resulting value is of nonzero length</ins> and <ins class="diff-new">is 
not in</ins> the <ins class="diff-new">lexical space
of</ins> <code><ins class="diff-new">xs:anyURI</ins></code>
.<ins class="diff-new">The resulting</ins> value <ins class="diff-new">is
 used as the namespace URI in the following
rules.</ins></p>
</li>
<li>
<p><ins class="diff-new">If the prefix of the attribute name
is</ins> <code><ins class="diff-new">xmlns</ins></code>
,<ins class="diff-new">then the local part</ins> of the attribute
<ins class="diff-new">name</ins> is interpreted as a namespace
<del class="diff-old">URI.</del> <ins class="diff-chg">prefix.</ins> 
This prefix and <ins class="diff-new">the
namespace</ins> URI are added to the <a title="statically known 
namespaces" href="#dt-static-namespaces">statically known namespaces</a>
 of the
constructor expression (overriding any existing binding of the
given prefix), and are also added as a namespace binding to the
<a title="in-scope namespaces" href="#dt-in-scope-namespaces">in-scope 
namespaces</a> of the
constructed element. If the namespace URI is a zero-length string
and the implementation supports <a href="#XMLNAMES11">[XML Names
1.1]</a> , any existing namespace binding for the given prefix is
removed from the <a title="in-scope namespaces" 
href="#dt-in-scope-namespaces">in-scope namespaces</a> of the
constructed element and from the <a title="statically known namespaces" 
href="#dt-static-namespaces">statically known namespaces</a> of the
constructor expression. If the namespace URI is a zero-length
string and the implementation does not support <a href="#XMLNAMES11">[XML
 Names 1.1]</a> , a static error is raised [
<a title="err:XQST0085" href="#ERRXQST0085">err:XQST0085</a> ]. It
is <a title="implementation defined" href="#dt-implementation-defined">implementation-defined</a>
 whether an
implementation supports <a href="#XMLNAMES">[XML Names]</a> or
<a href="#XMLNAMES11">[XML Names 1.1]</a> .</p>
</li>
<li>
<p>If the name of the namespace declaration attribute is
<code>xmlns</code> with no prefix, <ins class="diff-new">then</ins>
the <del class="diff-old">value of the attribute is interpreted as
a</del> namespace <del class="diff-old">URI. This</del> URI
specifies the <a title="default element/type namespace" 
href="#dt-def-elemtype-ns">default element/type namespace</a> of the
constructor expression (overriding any existing default), and is
added (with no prefix) to the <a title="in-scope namespaces" 
href="#dt-in-scope-namespaces">in-scope namespaces</a> of the
constructed element (overriding any existing namespace binding with
no prefix). If the namespace URI is a zero-length string, the
<a title="default element/type namespace" href="#dt-def-elemtype-ns">default
 element/type namespace</a> of the
constructor expression is set to "none," and any no-prefix
namespace binding is removed from the <a title="in-scope namespaces" 
href="#dt-in-scope-namespaces">in-scope
namespaces</a> of the constructed element.</p>
</li>
<li>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> [ <a title="err:XQST0070" href="#ERRXQST0070">err:XQST0070</a>
 ] if a namespace declaration
attribute <del class="diff-old">binds a namespace URI</del>
<ins class="diff-chg">attempts</ins> to <ins class="diff-new">do
any of the following:</ins></p>
<ul>
<li>
<p><ins class="diff-new">Bind</ins> the <del class="diff-old">predefined</del>
 prefix <code><del class="diff-old">xmlns . It is also a static error [ 
err:XQST0070 ] if a
namespace declaration attribute binds a</del> <ins class="diff-chg">xml</ins></code>
 <ins class="diff-chg">to some</ins>
namespace URI other than <code>http://www.w3.org/XML/1998/namespace
<del class="diff-old">to the prefix xml , or binds</del></code>
.</p>
</li>
<li>
<p><ins class="diff-chg">Bind</ins> a prefix other than
<code>xml</code> to the namespace URI
<code>http://www.w3.org/XML/1998/namespace</code> .</p>
</li>
<li>
<p><ins class="diff-new">Bind the prefix</ins> <code><ins 
class="diff-new">xmlns</ins></code> <ins class="diff-new">to any
namespace URI.</ins></p>
</li>
<li>
<p><ins class="diff-new">Bind a prefix to the namespace URI</ins>
<code><ins class="diff-new">http://www.w3.org/2000/xmlns/</ins></code> .</p>
</li>
</ul>
</li>
</ul>
<p>A namespace declaration attribute does not cause an attribute
node to be created.</p>
<p>The following examples illustrate namespace declaration
attributes:</p>
<ul>
<li>
<p>In this element constructor, a namespace declaration attribute
is used to set the <a title="default element/type namespace" 
href="#dt-def-elemtype-ns">default element/type namespace</a> to
<code>http://example.org/animals</code> :</p>
<div class="exampleInner">
<pre>&lt;cat xmlns = "http://example.org/animals"&gt;
  &lt;breed&gt;Persian&lt;/breed&gt;
&lt;/cat&gt;
</pre></div>
</li>
<li>
<p>In this element constructor, namespace declaration attributes
are used to bind the namespace prefixes <code>metric</code> and
<code>english</code> :</p>
<div class="exampleInner">
<pre>&lt;box xmlns:metric = "http://example.org/metric/units"
     xmlns:english = "http://example.org/english/units"&gt;
  &lt;height&gt; &lt;metric:meters&gt;3&lt;/metric:meters&gt; &lt;/height&gt;
  &lt;width&gt; &lt;english:feet&gt;6&lt;/english:feet&gt; &lt;/width&gt;
  &lt;depth&gt; &lt;english:inches&gt;18&lt;/english:inches&gt; &lt;/depth&gt;
&lt;/box&gt;
</pre></div>
</li>
</ul>
</div>
<div class="div4">
<h5><a id="id-content" name="id-content"></a> <del class="diff-old">3.7.1.3</del>
 <ins class="diff-chg">3.8.1.3</ins>
Content</h5>
<p>The part of a direct element constructor between the start tag
and the end tag is called the <b>content</b> of the element
constructor. This content may consist of text characters (parsed as
<a href="#doc-xquery11-ElementContentChar">ElementContentChar</a>
), nested direct constructors, <a href="#doc-xquery11-CDataSection">CdataSections</a>
 , character and
<a title="predefined entity reference" 
href="#dt-predefined-entity-reference">predefined entity references</a>
, and expressions enclosed in curly braces. In general, the value
of an enclosed expression may be any sequence of nodes and/or
atomic values. Enclosed expressions can be used in the content of
an element constructor to compute both the content and the
attributes of the constructed node.</p>
<p>Conceptually, the content of an element constructor is processed
as follows:</p>
<ol class="enumar">
<li>
<p>The content is evaluated to produce a sequence of nodes called
the <b>content sequence</b> , as follows:</p>
<ol class="enumla">
<li>
<p>If the <a title="boundary-space policy" 
href="#dt-boundary-space-policy">boundary-space policy</a> in the
<a title="static context" href="#dt-static-context">static
context</a> is <code>strip</code> , <a title="boundary whitespace" 
href="#dt-boundary-whitespace">boundary whitespace</a> is
identified and deleted (see <a href="#id-whitespace"><b><del 
class="diff-old">3.7.1.4</del> <ins class="diff-chg">3.8.1.4</ins>
Boundary Whitespace</b></a> for a definition of boundary
whitespace.)</p>
</li>
<li>
<p><a title="predefined entity reference" 
href="#dt-predefined-entity-reference">Predefined entity references</a>
and <a title="character reference" href="#dt-character-reference">character
 references</a> are expanded
into their referenced strings, as described in <a href="#id-literals"><b>3.1.1
 Literals</b></a> . Characters inside a
<a href="#doc-xquery11-CDataSection">CDataSection</a> , including
special characters such as <code>&lt;</code> and <code>&amp;</code>
, are treated as literal characters rather than as markup
characters (except for the sequence <code>]]&gt;</code> , which
terminates the CDataSection).</p>
</li>
<li>
<p>Each consecutive sequence of literal characters evaluates to a
single text node containing the characters.</p>
</li>
<li>
<p>Each nested direct constructor is evaluated according to the
rules in <a href="#id-element-constructor"><b><del class="diff-old">3.7.1</del>
 <ins class="diff-chg">3.8.1</ins> Direct
Element Constructors</b></a> or <a href="#id-otherConstructors"><b><del 
class="diff-old">3.7.2</del>
<ins class="diff-chg">3.8.2</ins> Other Direct Constructors</b></a>
, resulting in a new element, comment, or processing instruction
node. Then:</p>
<ol class="enumlr">
<li>
<p>The <code>parent</code> property of the resulting node is then
set to the newly constructed element node.</p>
</li>
<li>
<p>The <code>base-uri</code> property of the resulting node, and of
each of its descendants, is set to be the same as that of its new
parent, unless it (the child node) has an <code>xml:base</code>
attribute, in which case its <code>base-uri</code> property is set
to the value of that attribute, resolved (if it is relative)
against the <code>base-uri</code> property of its new parent
node.</p>
</li>
</ol>
</li>
<li>
<p>Enclosed expressions are evaluated as follows:</p>
<ol class="enumlr">
<li>
<p><ins class="diff-new">If an enclosed expression returns a</ins>
<a href="http://www.w3.org/TR/xpath-datamodel-11/#dt-function-item"><ins
 class="diff-new">
function item</ins></a> <sup><small><ins class="diff-new">DM11</ins></small></sup>
 ,<ins class="diff-new">a type
error is raised [</ins> <a title="err:XQTY0105" href="#ERRXQTY0105"><ins
 class="diff-new">err:XQTY0105</ins></a>
<ins class="diff-new">].</ins></p>
</li>
<li>
<p>For each adjacent sequence of one or more atomic values returned
by an enclosed expression, a new text node is constructed,
containing the result of casting each atomic value to a string,
with a single space character inserted between adjacent values.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The insertion of blank characters between adjacent values
applies even if one or both of the values is a zero-length
string.</p>
</div>
</li>
<li>
<p>For each node returned by an enclosed expression, a new copy is
made of the given node and all nodes that have the given node as an
ancestor, collectively referred to as <b>copied nodes</b> . The
properties of the copied nodes are as follows:</p>
<ol class="enumua">
<li>
<p>Each copied node receives a new node identity.</p>
</li>
<li>
<p>The <code>parent</code> , <code>children</code> , and
<code>attributes</code> properties of the copied nodes are set so
as to preserve their inter-node relationships. For the topmost node
(the node directly returned by the enclosed expression), the
<code>parent</code> property is set to the node constructed by this
constructor.</p>
</li>
<li>
<p>If <a title="construction mode" href="#dt-construction-mode">construction
 mode</a> in the <a title="static context" href="#dt-static-context">static
 context</a> is
<code>strip</code> :</p>
<ol class="enumur">
<li>
<p>If the copied node is an element node, its
<code>type-name</code> property is set to <code>xs:untyped</code> .
Its <code>nilled</code> , <code>is-id</code> , and
<code>is-idrefs</code> properties are set to <code>false</code>
.</p>
</li>
<li>
<p>If the copied node is an attribute node, its
<code>type-name</code> property is set to
<code>xs:untypedAtomic</code> . Its <code>is-idrefs</code> property
is set to <code>false</code> . Its <code>is-id</code> property is
set to <code>true</code> if the qualified name of the attribute
node is <code>xml:id</code> ; otherwise it is set to
<code>false</code> .</p>
</li>
<li>
<p>The <code>string-value</code> of each copied element and
attribute node remains unchanged, and its <code>typed-value</code>
becomes equal to its <code>string-value</code> as an instance of
<code>xs:untypedAtomic</code> .</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>Implementations that store only the <a title="typed value" 
href="#dt-typed-value">typed value</a> of a node are required at this
point to convert the typed value to a string form.</p>
</div>
</li>
</ol>
<p>On the other hand, if <a title="construction mode" 
href="#dt-construction-mode">construction mode</a> in the <a 
title="static context" href="#dt-static-context">static context</a> is
<code>preserve</code> , the <code>type-name</code> ,
<code>nilled</code> , <code>string-value</code> ,
<code>typed-value</code> , <code>is-id</code> , and
<code>is-idrefs</code> properties of the copied nodes are
preserved.</p>
</li>
<li>
<p>The <code>in-scope-namespaces</code> property of a copied
element node is determined by the following rules. In applying
these rules, the default namespace or absence of a default
namespace is treated like any other namespace binding:</p>
<ol class="enumur">
<li>
<p>If <a title="copy-namespaces mode" href="#dt-copy-namespaces-mode">copy-namespaces
 mode</a> specifies
<code>preserve</code> , all in-scope-namespaces of the original
element are retained in the new copy. If <a title="copy-namespaces mode"
 href="#dt-copy-namespaces-mode">copy-namespaces mode</a> specifies
<code>no-preserve</code> , the new copy retains only those in-scope
namespaces of the original element that are used in the names of
the element and its attributes. <del class="diff-old">It is a type
error</del></p>
</li>
<li>
<p><ins class="diff-chg">If</ins> <a title="copy-namespaces mode" 
href="#dt-copy-namespaces-mode"><ins class="diff-chg">copy-namespaces 
mode</ins></a> <ins class="diff-chg">specifies</ins> <code><ins 
class="diff-chg">inherit</ins></code> ,<ins class="diff-chg">the copied
node inherits all the in-scope namespaces of the constructed node,
augmented and overridden by the in-scope namespaces of the original
element that were preserved by the preceding rule. If</ins>
<a title="copy-namespaces mode" href="#dt-copy-namespaces-mode"><ins 
class="diff-chg">copy-namespaces
mode</ins></a> <ins class="diff-new">specifies</ins>
<code><ins class="diff-new">no-inherit</ins></code> ,<ins 
class="diff-new">the copied node does not inherit any in-scope 
namespaces
from the constructed node.</ins></p>
</li>
</ol>
</li>
<li>
<p><ins class="diff-new">An enclosed expression in the content of
an element constructor may cause one or more existing nodes to be
copied. Type error</ins> [ <a title="err:XQTY0086" href="#ERRXQTY0086">err:XQTY0086</a>
 ] <ins class="diff-new">is
raised</ins> in <del class="diff-old">this case if</del> the
<ins class="diff-chg">following cases:</ins></p>
<ol class="enumur">
<li>
<p><ins class="diff-chg">An element node is copied, and the</ins>
<a title="typed value" href="#dt-typed-value">typed value</a> of
the <del class="diff-old">copied</del> element <ins class="diff-new">node</ins>
 or <del class="diff-old">of any</del>
<ins class="diff-chg">one</ins> of its attributes is <a 
title="namespace-sensitive" href="#dt-namespace-sensitive"><ins 
class="diff-new">namespace-sensitive</ins></a> ,<ins class="diff-new">and</ins>
 <a title="construction mode" href="#dt-construction-mode"><ins 
class="diff-new">construction
mode</ins></a> <ins class="diff-new">is</ins> <code><ins 
class="diff-new">preserve</ins></code> ,<ins class="diff-new">and</ins>
<a title="copy-namespaces mode" href="#dt-copy-namespaces-mode"><ins 
class="diff-new">copy-namespaces
mode</ins></a> <ins class="diff-new">is</ins> <code><ins 
class="diff-new">no-preserve</ins></code> .</p>
</li>
<li>
<p><ins class="diff-new">An attribute node is copied but its parent
element node is not copied, and the</ins> <a title="typed value" 
href="#dt-typed-value"><ins class="diff-new">typed value</ins></a>
<ins class="diff-new">of the copied attribute node is</ins>
<a title="namespace-sensitive" href="#dt-namespace-sensitive">namespace-sensitive
 <del class="diff-old">.</del></a> , <ins class="diff-chg">and</ins> <a 
title="construction mode" href="#dt-construction-mode"><ins 
class="diff-chg">construction mode</ins></a> <ins class="diff-chg">is</ins>
 <code><ins class="diff-chg">preserve</ins></code> .</p>
</li>
</ol>
<p>[ <a title="namespace-sensitive" id="dt-namespace-sensitive" 
name="dt-namespace-sensitive">Definition</a> : A value is
<b>namespace-sensitive</b> if it includes an item whose <a 
title="dynamic type" href="#dt-dynamic-type">dynamic type</a> is
<code>xs:QName</code> or <code>xs:NOTATION</code> or is derived by
restriction from <code>xs:QName</code> or <code>xs:NOTATION</code>
.]</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p><del class="diff-old">Error</del> <ins class="diff-chg">The
rationale for error</ins> [ <a title="err:XQTY0086" href="#ERRXQTY0086">err:XQTY0086</a>
 ] <del class="diff-old">can occur
only if construction mode</del> is <del class="diff-old">preserve ,
since otherwise the typed value of the copied node</del>
<ins class="diff-chg">as follows: It</ins> is <del class="diff-old">never
 namespace-sensitive. If copy-namespaces mode
specifies inherit , the copied node inherits all the in-scope
namespaces of the constructed node, augmented and overridden
by</del> <ins class="diff-chg">not possible to preserve</ins> the
<del class="diff-old">in-scope namespaces</del> <ins class="diff-chg">type</ins>
 of <ins class="diff-new">a QName without also
preserving</ins> the <del class="diff-old">original element</del>
<ins class="diff-chg">namespace binding</ins> that <del class="diff-old">were
 preserved by the preceding rule. If copy-namespaces
mode specifies no-inherit ,</del> <ins class="diff-chg">defines</ins> 
the <del class="diff-old">copied node does
not inherit any in-scope namespaces from</del> <ins class="diff-chg">prefix
 of</ins> the <del class="diff-old">constructed
node.</del> <ins class="diff-chg">QName.</ins></p>
</div>
</li>
<li>
<p>When an element or processing instruction node is copied, its
<code>base-uri</code> property is set to be the same as that of its
new parent, with the following exception: if a copied element node
has an <code>xml:base</code> attribute, its <code>base-uri</code>
property is set to the value of that attribute, resolved (if it is
relative) against the <code>base-uri</code> property of the new
parent node.</p>
</li>
<li>
<p>All other properties of the copied nodes are preserved.</p>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>
<p>If the content sequence contains a document node, the document
node is replaced in the content sequence by its children.</p>
</li>
<li>
<p>Adjacent text nodes in the content sequence are merged into a
single text node by concatenating their contents, with no
intervening blanks. After concatenation, any text node whose
content is a zero-length string is deleted from the content
sequence.</p>
</li>
<li>
<p>If the content sequence contains an attribute node <ins 
class="diff-new">or a namespace node</ins> following a node that is not
an attribute <ins class="diff-new">node or a namespace</ins> node,
a <a title="type error" href="#dt-type-error">type error</a> is
raised [ <a title="err:XQTY0024" href="#ERRXQTY0024">err:XQTY0024</a> ].</p>
</li>
<li>
<p>The properties of the newly constructed element node are
determined as follows:</p>
<ol class="enumla">
<li>
<p><code>node-name</code> is the <a title="expanded QName" 
href="#dt-expanded-qname">expanded QName</a> resulting from resolving
the element name in the start tag, including its original namespace
prefix (if any), as described in <a href="#id-element-constructor"><b><del
 class="diff-old">3.7.1</del>
<ins class="diff-chg">3.8.1</ins> Direct Element
Constructors</b></a> .</p>
</li>
<li>
<p><code>parent</code> is set to empty.</p>
</li>
<li>
<p><code>attributes</code> consist of all the attributes specified
in the start tag as described in <a href="#id-attributes"><b><del 
class="diff-old">3.7.1.1</del> <ins class="diff-chg">3.8.1.1</ins> 
Attributes</b></a> , together with all the
attribute nodes in the content sequence, in <a title="implementation 
dependent" href="#dt-implementation-dependent">implementation-dependent</a>
 order.
Note that the <code>parent</code> property of each of these
attribute nodes has been set to the newly constructed element node.
If two or more attributes have the same <code>node-name</code> , a
<a title="dynamic error" href="#dt-dynamic-error">dynamic error</a>
is raised [ <a title="err:XQDY0025" href="#ERRXQDY0025">err:XQDY0025</a>
 ]. If an attribute named
<code>xml:space</code> has a value other than <code>preserve</code>
or <code>default</code> , a dynamic error <del class="diff-old">MAY</del>
 <ins class="diff-chg">may</ins> be raised [
<a title="err:XQDY0092" href="#ERRXQDY0092">err:XQDY0092</a> ].</p>
</li>
<li>
<p><code>children</code> consist of all the element, text, comment,
and processing instruction nodes in the content sequence. Note that
the <code>parent</code> property of each of these nodes has been
set to the newly constructed element node.</p>
</li>
<li>
<p><code>base-uri</code> is set to the following value:</p>
<ol class="enumlr">
<li>
<p>If the constructed node has an attribute named
<code>xml:base</code> , then the value of this attribute, resolved
if it is relative against the <a title="base URI" href="#dt-base-uri">base
 URI</a> in the <a title="base URI" href="#dt-base-uri">static context</a>
 . The value of the
<code>xml:base</code> attribute is normalized as described in
<a href="#XMLBASE">[XML Base]</a> .</p>
</li>
<li>
<p>Otherwise, the value of the <a title="base URI" href="#dt-base-uri">base
 URI</a> in the <a title="base URI" href="#dt-base-uri">static context</a>
 .</p>
</li>
</ol>
</li>
<li>
<p><code>in-scope-namespaces</code> consist of all the namespace
bindings resulting from namespace declaration attributes as
described in <a href="#id-namespaces"><b><del class="diff-old">3.7.1.2</del>
 <ins class="diff-chg">3.8.1.2</ins>
Namespace Declaration Attributes</b></a> , and possibly additional
namespace bindings as described in <a href="#id-ns-nodes-on-elements"><b><del
 class="diff-old">3.7.4</del>
<ins class="diff-chg">3.8.4</ins> In-scope Namespaces of a
Constructed Element</b></a> .</p>
</li>
<li>
<p>The <code>nilled</code> property is <code>false</code> .</p>
</li>
<li>
<p>The <code>string-value</code> property is equal to the
concatenated contents of the text-node descendants in document
order. If there are no text-node descendants, the
<code>string-value</code> property is a zero-length string.</p>
</li>
<li>
<p>The <code>typed-value</code> property is equal to the
<code>string-value</code> property, as an instance of
<code>xs:untypedAtomic</code> .</p>
</li>
<li>
<p>If <a title="construction mode" href="#dt-construction-mode">construction
 mode</a> in the <a title="static context" href="#dt-static-context">static
 context</a> is
<code>strip</code> , the <code>type-name</code> property is
<code>xs:untyped</code> . On the other hand, if construction mode
is <code>preserve</code> , the <code>type-name</code> property is
<code>xs:anyType</code> .</p>
</li>
<li>
<p>The <code>is-id</code> and <code>is-idrefs</code> properties are
set to <code>false</code> .</p>
</li>
</ol>
</li>
</ol>
<ul>
<li>
<p>Example:</p>
<div class="exampleInner">
<pre>&lt;a&gt;{1}&lt;/a&gt;
</pre></div>
<p>The constructed element node has one child, a text node
containing the value " <code>1</code> ".</p>
</li>
<li>
<p>Example:</p>
<div class="exampleInner">
<pre>&lt;a&gt;{1, 2, 3}&lt;/a&gt;
</pre></div>
<p>The constructed element node has one child, a text node
containing the value " <code>1 2 3</code> ".</p>
</li>
<li>
<p>Example:</p>
<div class="exampleInner">
<pre>&lt;c&gt;{1}{2}{3}&lt;/c&gt;
</pre></div>
<p>The constructed element node has one child, a text node
containing the value " <code>123</code> ".</p>
</li>
<li>
<p>Example:</p>
<div class="exampleInner">
<pre>&lt;b&gt;{1, "2", "3"}&lt;/b&gt;
</pre></div>
<p>The constructed element node has one child, a text node
containing the value " <code>1 2 3</code> ".</p>
</li>
<li>
<p>Example:</p>
<div class="exampleInner">
<pre>&lt;fact&gt;I saw 8 cats.&lt;/fact&gt;
</pre></div>
<p>The constructed element node has one child, a text node
containing the value " <code>I saw 8 cats.</code> ".</p>
</li>
<li>
<p>Example:</p>
<div class="exampleInner">
<pre>&lt;fact&gt;I saw {5 + 3} cats.&lt;/fact&gt;
</pre></div>
<p>The constructed element node has one child, a text node
containing the value " <code>I saw 8 cats.</code> ".</p>
</li>
<li>
<p>Example:</p>
<div class="exampleInner">
<pre>&lt;fact&gt;I saw &lt;howmany&gt;{5 + 3}&lt;/howmany&gt; cats.&lt;/fact&gt;
</pre></div>
<p>The constructed element node has three children: a text node
containing " <code>I saw</code> ", a child element node named
<code>howmany</code> , and a text node containing "
<code>cats.</code> ". The child element node in turn has a single
text node child containing the value " <code>8</code> ".</p>
</li>
</ul>
</div>
<div class="div4">
<h5><a id="id-whitespace" name="id-whitespace"></a> <del 
class="diff-old">3.7.1.4</del> <ins class="diff-chg">3.8.1.4</ins>
Boundary Whitespace</h5>
<p>In a direct element constructor, whitespace characters may
appear in the content of the constructed element. In some cases,
enclosed expressions and/or nested elements may be separated only
by whitespace characters. For example, in the expression below, the
end-tag <code>&lt;/title&gt;</code> and the start-tag
<code>&lt;author&gt;</code> are separated by a newline character
and four space characters:</p>
<div class="exampleInner">
<pre>&lt;book isbn="isbn-0060229357"&gt;
    &lt;title&gt;Harold and the Purple Crayon&lt;/title&gt;
    &lt;author&gt;
        &lt;first&gt;Crockett&lt;/first&gt;
        &lt;last&gt;Johnson&lt;/last&gt;
    &lt;/author&gt;
&lt;/book&gt;
</pre></div>
<p>[ <a title="boundary whitespace" id="dt-boundary-whitespace" 
name="dt-boundary-whitespace">Definition</a> : <b>Boundary
whitespace</b> is a sequence of consecutive whitespace characters
within the content of a <a title="direct element constructor" 
href="#dt-direct-elem-const">direct element constructor</a> , that is
delimited at each end either by the start or end of the content, or
by a <a href="#doc-xquery11-DirectConstructor">DirectConstructor</a> , 
or by an
<a href="#doc-xquery11-EnclosedExpr">EnclosedExpr</a> . For this
purpose, characters generated by <a title="character reference" 
href="#dt-character-reference">character references</a> such as
<code>&amp;#x20;</code> or by <a href="#doc-xquery11-CDataSection">CdataSections</a>
 are not considered
to be whitespace characters.]</p>
<p>The <a title="boundary-space policy" href="#dt-boundary-space-policy">boundary-space
 policy</a> in the
<a title="static context" href="#dt-static-context">static
context</a> controls whether boundary whitespace is preserved by
element constructors. If boundary-space policy is
<code>strip</code> , boundary whitespace is not considered
significant and is discarded. On the other hand, if boundary-space
policy is <code>preserve</code> , boundary whitespace is considered
significant and is preserved.</p>
<ul>
<li>
<p>Example:</p>
<div class="exampleInner">
<pre>&lt;cat&gt; 
   &lt;breed&gt;{$b}&lt;/breed&gt;
   &lt;color&gt;{$c}&lt;/color&gt; 
&lt;/cat&gt;
</pre></div>
<p>The constructed <code>cat</code> element node has two child
element nodes named <code>breed</code> and <code>color</code> .
Whitespace surrounding the child elements will be stripped away by
the element constructor if boundary-space policy is
<code>strip</code> .</p>
</li>
<li>
<p>Example:</p>
<div class="exampleInner">
<pre>&lt;a&gt;  {"abc"}  &lt;/a&gt;
</pre></div>
<p>If boundary-space policy is <code>strip</code> , this example is
equivalent to <code>&lt;a&gt;abc&lt;/a&gt;</code> . However, if
boundary-space policy is <code>preserve</code> , this example is
equivalent to
<code>&lt;a&gt;&nbsp;&nbsp;abc&nbsp;&nbsp;&lt;/a&gt;</code> .</p>
</li>
<li>
<p>Example:</p>
<div class="exampleInner">
<pre>&lt;a&gt; z {"abc"}&lt;/a&gt;
</pre></div>
<p>Since the whitespace surrounding the <code>z</code> is not
boundary whitespace, it is always preserved. This example is
equivalent to <code>&lt;a&gt;&nbsp;z&nbsp;abc&lt;/a&gt;</code>
.</p>
</li>
<li>
<p>Example:</p>
<div class="exampleInner">
<pre>&lt;a&gt;&amp;#x20;{"abc"}&lt;/a&gt;
</pre></div>
<p>This example is equivalent to
<code>&lt;a&gt;&nbsp;abc&lt;/a&gt;</code> , regardless of the
boundary-space policy, because the space generated by the <a 
title="character reference" href="#dt-character-reference">character
reference</a> is not treated as a whitespace character.</p>
</li>
<li>
<p>Example:</p>
<div class="exampleInner">
<pre>&lt;a&gt;{"  "}&lt;/a&gt;
</pre></div>
<p>This example constructs an element containing two space
characters, regardless of the boundary-space policy, because
whitespace inside an enclosed expression is never considered to be
boundary whitespace.</p>
</li>
</ul>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>Element constructors treat attributes named
<code>xml:space</code> as ordinary attributes. An
<code>xml:space</code> attribute does not affect the handling of
whitespace by an element constructor.</p>
</div>
</div>
</div>
<div class="div3">
<h4><a id="id-otherConstructors" name="id-otherConstructors"></a>
<del class="diff-old">3.7.2</del> <ins class="diff-chg">3.8.2</ins>
Other Direct Constructors</h4>
<p>XQuery allows an expression to generate a processing instruction
node or a comment node. This can be accomplished by using a
<b>direct processing instruction constructor</b> or a <b>direct
comment constructor</b> . In each case, the syntax of the
constructor expression is based on the syntax of a similar
construct in XML.</p>
<h5><a id="N14466" name="N14466"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-DirPIConstructor" 
name="doc-xquery11-DirPIConstructor"></a> <del class="diff-old">[105]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[148]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-DirPIConstructor">DirPIConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"&lt;?" <a href="#prod-xquery11-PITarget">PITarget</a> (
<a href="#prod-xquery11-S">S</a> <a href="#doc-xquery11-DirPIContents">DirPIContents</a>
 )?
"?&gt;"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-DirPIContents" name="doc-xquery11-DirPIContents"></a>
 <del class="diff-old">[106]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[149]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-DirPIContents">DirPIContents</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>( <a href="#prod-xquery11-Char">Char</a> * - (Char*
'?&gt;' Char*))</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-DirCommentConstructor" 
name="doc-xquery11-DirCommentConstructor"></a> <del class="diff-old">[103]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[146]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-DirCommentConstructor">DirCommentConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"&lt;!--" <a href="#doc-xquery11-DirCommentContents">DirCommentContents</a>
"--&gt;"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-DirCommentContents" 
name="doc-xquery11-DirCommentContents"></a> <del class="diff-old">[104]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[147]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-DirCommentContents">DirCommentContents</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>(( <a href="#prod-xquery11-Char">Char</a> - '-') | ('-' (
<a href="#prod-xquery11-Char">Char</a> - '-')))*</code></td>
</tr>
</tbody>
</table>
<p>A direct processing instruction constructor creates a processing
instruction node whose <code>target</code> property is <a 
href="#prod-xquery11-PITarget">PITarget</a> and whose
<code>content</code> property is <a href="#doc-xquery11-DirPIContents">DirPIContents</a>
 . The
<code>base-uri</code> property of the node is empty. The
<code>parent</code> property of the node is empty.</p>
<p>The <a href="#prod-xquery11-PITarget">PITarget</a> of a
processing instruction <del class="diff-old">may</del> <ins 
class="diff-chg">must</ins> not consist of the characters "XML" in any
combination of upper and lower case. The <a 
href="#doc-xquery11-DirPIContents">DirPIContents</a> of a processing
instruction <del class="diff-old">may</del> <ins class="diff-chg">must</ins>
 not contain the string " <code>?&gt;</code>
".</p>
<p>The following example illustrates a direct processing
instruction constructor:</p>
<div class="exampleInner">
<pre>&lt;?format role="output" ?&gt;
</pre></div>
<p>A direct comment constructor creates a comment node whose
<code>content</code> property is <a 
href="#doc-xquery11-DirCommentContents">DirCommentContents</a> . Its
<code>parent</code> property is empty.</p>
<p>The <a href="#doc-xquery11-DirCommentContents">DirCommentContents</a>
 of a
comment <del class="diff-old">may</del> <ins class="diff-chg">must</ins>
 not contain two consecutive hyphens or end
with a hyphen. These rules are syntactically enforced by the
grammar shown above.</p>
<p>The following example illustrates a direct comment
constructor:</p>
<div class="exampleInner">
<pre>&lt;!-- Tags are ignored in the following section --&gt;
</pre></div>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>A direct comment constructor is different from a <a 
href="#doc-xquery11-Comment">comment</a> , since a direct comment
constructor actually constructs a comment node, whereas a <a 
href="#doc-xquery11-Comment">comment</a> is simply used in documenting a
query and is not evaluated.</p>
</div>
</div>
<div class="div3">
<h4><a id="id-computedConstructors" name="id-computedConstructors"></a> <del
 class="diff-old">3.7.3</del>
<ins class="diff-chg">3.8.3</ins> Computed Constructors</h4>
<h5><a id="N14511" name="N14511"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ComputedConstructor" 
name="doc-xquery11-ComputedConstructor"></a> <del class="diff-old">[109]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[152]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ComputedConstructor">ComputedConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-CompDocConstructor">CompDocConstructor</a><br>
| <a href="#doc-xquery11-CompElemConstructor">CompElemConstructor</a><br>
| <a href="#doc-xquery11-CompAttrConstructor">CompAttrConstructor</a><br>
| <a href="#doc-xquery11-CompNamespaceConstructor"><ins class="diff-chg">CompNamespaceConstructor</ins></a><br>
<ins class="diff-chg">|</ins> <a 
href="#doc-xquery11-CompTextConstructor">CompTextConstructor</a><br>
| <a href="#doc-xquery11-CompCommentConstructor">CompCommentConstructor</a><br>

| <a href="#doc-xquery11-CompPIConstructor">CompPIConstructor</a></code></td>
</tr>
</tbody>
</table>
<p>An alternative way to create nodes is by using a <b>computed
constructor</b> . A computed constructor begins with a keyword that
identifies the type of node to be created: <code>element</code> ,
<code>attribute</code> , <code>document</code> , <code>text</code>
, <code>processing-instruction</code> , <del class="diff-old">or</del> <code>comment</code>
 , <ins class="diff-new">or</ins> <code><ins class="diff-new">namespace</ins></code>
 .</p>
<p>For those kinds of nodes that have names (element, attribute,
and processing instruction nodes), the keyword that specifies the
node kind is followed by the name of the node to be created. This
name may be specified either as <del class="diff-old">a QName</del>
<ins class="diff-chg">an EQName</ins> or as an expression enclosed
in braces. [ <a title="name expression" id="dt-name-expression" 
name="dt-name-expression">Definition</a> : When an expression is
used to specify the name of a constructed node, that expression is
called the <b>name expression</b> of the constructor.]</p>
<p>[ <a title="content expression" id="dt-content-expression" 
name="dt-content-expression">Definition</a> : The final part of a
computed constructor is an expression enclosed in braces, called
the <b>content expression</b> of the constructor, that generates
the content of the node.]</p>
<p>The following example illustrates the use of computed element
and attribute constructors in a simple case where the names of the
constructed nodes are constants. This example generates exactly the
same result as the first example in <a href="#id-element-constructor"><b><del
 class="diff-old">3.7.1</del>
<ins class="diff-chg">3.8.1</ins> Direct Element
Constructors</b></a> :</p>
<div class="exampleInner">
<pre>element book { 
   attribute isbn {"isbn-0060229357" }, 
   element title { "Harold and the Purple Crayon"},
   element author { 
      element first { "Crockett" }, 
      element last {"Johnson" }
   }
}
</pre></div>
<div class="div4">
<h5><a id="id-computedElements" name="id-computedElements"></a>
<del class="diff-old">3.7.3.1</del> <ins class="diff-chg">3.8.3.1</ins> 
Computed Element Constructors</h5>
<h5><a id="N1458D" name="N1458D"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CompElemConstructor" 
name="doc-xquery11-CompElemConstructor"></a> <del class="diff-old">[111]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[154]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CompElemConstructor">CompElemConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"element" ( <del class="diff-old">QName</del> <a 
href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a> |
("{" <a href="#doc-xquery11-Expr">Expr</a> "}")) "{" <a 
href="#doc-xquery11-ContentExpr">ContentExpr</a> ? "}"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ContentExpr" name="doc-xquery11-ContentExpr"></a>
 <del class="diff-old">[112]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[155]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ContentExpr">ContentExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-Expr">Expr</a></code></td>
</tr>
</tbody>
</table>
<p>[ <a title="computed element constructor" id="dt-computed-elem-const"
 name="dt-computed-elem-const">Definition</a> : A <b>computed element
constructor</b> creates an element node, allowing both the name and
the content of the node to be computed.]</p>
<p>If the keyword <code>element</code> is followed by a <del 
class="diff-old">QName,</del> <a title="lexical QName" href="#dt-qname"><ins
 class="diff-chg">lexical QName</ins></a> , it is
expanded using the <a title="statically known namespaces" 
href="#dt-static-namespaces">statically known namespaces</a> , and the
resulting <a title="expanded QName" href="#dt-expanded-qname">expanded 
QName</a> is used as the
<code>node-name</code> property of the constructed element node. If
expansion of the QName is not successful, a <a title="static error" 
href="#dt-static-error">static error</a> is raised [ <a 
title="err:XPST0081" href="#ERRXPST0081">err:XPST0081</a> ].</p>
<p>If the keyword <code>element</code> is followed by a <a title="name 
expression" href="#dt-name-expression">name expression</a> ,
the name expression is processed as follows:</p>
<ol class="enumar">
<li>
<p><a title="atomization" href="#dt-atomization">Atomization</a> is
applied to the value of the <a title="name expression" 
href="#dt-name-expression">name expression</a> . If the result of
atomization is not a single atomic value of type
<code>xs:QName</code> , <code>xs:string</code> , or
<code>xs:untypedAtomic</code> , a <a title="type error" 
href="#dt-type-error">type error</a> is raised [ <a title="err:XPTY0004"
 href="#ERRXPTY0004">err:XPTY0004</a> ].</p>
</li>
<li>
<p>If the atomized value of the <a title="name expression" 
href="#dt-name-expression">name expression</a> is of type
<code>xs:QName</code> , that <a title="expanded QName" 
href="#dt-expanded-qname">expanded QName</a> is used as the
<code>node-name</code> property of the constructed element,
retaining the prefix part of the QName.</p>
</li>
<li>
<p>If the atomized value of the <a title="name expression" 
href="#dt-name-expression">name expression</a> is of type
<code>xs:string</code> or <code>xs:untypedAtomic</code> , that
value is converted to an <a title="expanded QName" 
href="#dt-expanded-qname">expanded QName</a> . If the string value
contains a namespace prefix, that prefix is resolved to a namespace
URI using the <a title="statically known namespaces" 
href="#dt-static-namespaces">statically known namespaces</a> . If the
string value contains no namespace prefix, it is treated as a local
name in the <a title="default element/type namespace" 
href="#dt-def-elemtype-ns">default element/type namespace</a> . The
resulting <a title="expanded QName" href="#dt-expanded-qname">expanded 
QName</a> is used as the
<code>node-name</code> property of the constructed element,
retaining the prefix part of the QName. If conversion of the
atomized <a title="name expression" href="#dt-name-expression">name
expression</a> to an <a title="expanded QName" href="#dt-expanded-qname">expanded
 QName</a> is not successful, a
<a title="dynamic error" href="#dt-dynamic-error">dynamic error</a>
is raised [ <a title="err:XQDY0074" href="#ERRXQDY0074">err:XQDY0074</a>
 ].</p>
</li>
</ol>
<p><ins class="diff-new">A</ins> <a title="dynamic error" 
href="#dt-dynamic-error"><ins class="diff-new">dynamic error</ins></a>
<ins class="diff-new">is raised [</ins> <a title="err:XQDY0096" 
href="#ERRXQDY0096"><ins class="diff-new">err:XQDY0096</ins></a>
<ins class="diff-new">] if the node-name of the constructed element
node has any of the following properties:</ins></p>
<ul>
<li>
<p><ins class="diff-new">Its namespace prefix is</ins>
<code><ins class="diff-new">xmlns</ins></code> .</p>
</li>
<li>
<p><ins class="diff-new">Its namespace URI is</ins>
<code><ins class="diff-new">http://www.w3.org/2000/xmlns/</ins></code> .</p>
</li>
<li>
<p><ins class="diff-new">Its namespace prefix is</ins>
<code><ins class="diff-new">xml</ins></code> <ins class="diff-new">and 
its namespace URI is not</ins> <code><ins class="diff-new">http://www.w3.org/XML/1998/namespace</ins></code>
 .</p>
</li>
<li>
<p><ins class="diff-new">Its namespace prefix is other than</ins>
<code><ins class="diff-new">xml</ins></code> <ins class="diff-new">and 
its namespace URI is</ins> <code><ins class="diff-new">http://www.w3.org/XML/1998/namespace</ins></code>
 .</p>
</li>
</ul>
<p>The <a title="content expression" href="#dt-content-expression">content
 expression</a> of a computed
element constructor (if present) is processed in exactly the same
way as an enclosed expression in the content of a <a title="direct 
element constructor" href="#dt-direct-elem-const">direct
element constructor</a> , as described in Step 1e of <a 
href="#id-content"><b><del class="diff-old">3.7.1.3</del> <ins 
class="diff-chg">3.8.1.3</ins> Content</b></a> . The result of 
processing
the content expression is a sequence of nodes called the <b>content
sequence</b> . If the <a title="content expression" 
href="#dt-content-expression">content expression</a> is absent, the
content sequence is an empty sequence.</p>
<p>Processing of the computed element constructor proceeds as
follows:</p>
<ol class="enumar">
<li>
<p><ins class="diff-new">If the content sequence contains a
document node, the document node is replaced in the content
sequence by its children.</ins></p>
</li>
<li>
<p>Adjacent text nodes in the content sequence are merged into a
single text node by concatenating their contents, with no
intervening blanks. After concatenation, any text node whose
content is a zero-length string is deleted from the content
sequence.</p>
</li>
<li>
<p>If the content sequence contains <del class="diff-old">a
document node, the document node is replaced in the content
sequence by its children. If the content sequence contains</del> an
attribute node <ins class="diff-new">or a namespace node</ins>
following a node that is not an attribute <ins class="diff-new">node or a
 namespace</ins> node, a <a title="type error" href="#dt-type-error">type
 error</a> is raised [ <a title="err:XQTY0024" href="#ERRXQTY0024">err:XQTY0024</a>
 ].</p>
</li>
<li>
<p>The properties of the newly constructed element node are
determined as follows:</p>
<ol class="enumla">
<li>
<p><code>node-name</code> is the <a title="expanded QName" 
href="#dt-expanded-qname">expanded QName</a> resulting from processing
the specified <a title="lexical QName" href="#dt-qname"><ins 
class="diff-new">lexical</ins> QName</a> or <a title="name expression" 
href="#dt-name-expression">name expression</a> , as described
above.</p>
</li>
<li>
<p><code>parent</code> is empty.</p>
</li>
<li>
<p><code>attributes</code> consist of all the attribute nodes in
the content sequence, in <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a> order.
Note that the <code>parent</code> property of each of these
attribute nodes has been set to the newly constructed element node.
If two or more attributes have the same <code>node-name</code> , a
<a title="dynamic error" href="#dt-dynamic-error">dynamic error</a>
is raised [ <a title="err:XQDY0025" href="#ERRXQDY0025">err:XQDY0025</a>
 ]. If an attribute named
<code>xml:space</code> has a value other than <code>preserve</code>
or <code>default</code> , a dynamic error <del class="diff-old">MAY</del>
 <ins class="diff-chg">may</ins> be raised [
<a title="err:XQDY0092" href="#ERRXQDY0092">err:XQDY0092</a> ].</p>
</li>
<li>
<p><code>children</code> consist of all the element, text, comment,
and processing instruction nodes in the content sequence. Note that
the <code>parent</code> property of each of these nodes has been
set to the newly constructed element node.</p>
</li>
<li>
<p><code>base-uri</code> is set to the following value:</p>
<ol class="enumlr">
<li>
<p>If the constructed node has an attribute named
<code>xml:base</code> , then the value of this attribute, resolved
if it is relative against the <a title="base URI" href="#dt-base-uri">base
 URI</a> in the <a title="base URI" href="#dt-base-uri">static context</a>
 . The value of the
<code>xml:base</code> attribute is normalized as described in
<a href="#XMLBASE">[XML Base]</a> .</p>
</li>
<li>
<p>Otherwise, the value of the <a title="base URI" href="#dt-base-uri">base
 URI</a> in the <a title="base URI" href="#dt-base-uri">static context</a>
 .</p>
</li>
</ol>
</li>
<li>
<p><code>in-scope-namespaces</code> are computed as described in
<a href="#id-ns-nodes-on-elements"><b><del class="diff-old">3.7.4</del> <ins
 class="diff-chg">3.8.4</ins> In-scope
Namespaces of a Constructed Element</b></a> .</p>
</li>
<li>
<p>The <code>nilled</code> property is <code>false</code> .</p>
</li>
<li>
<p>The <code>string-value</code> property is equal to the
concatenated contents of the text-node descendants in document
order.</p>
</li>
<li>
<p>The <code>typed-value</code> property is equal to the
<code>string-value</code> property, as an instance of
<code>xs:untypedAtomic</code> .</p>
</li>
<li>
<p>If <a title="construction mode" href="#dt-construction-mode">construction
 mode</a> in the <a title="static context" href="#dt-static-context">static
 context</a> is
<code>strip</code> , the <code>type-name</code> property is
<code>xs:untyped</code> . On the other hand, if construction mode
is <code>preserve</code> , the <code>type-name</code> property is
<code>xs:anyType</code> .</p>
</li>
<li>
<p>The <code>is-id</code> and <code>is-idrefs</code> properties are
set to <code>false</code> .</p>
</li>
</ol>
</li>
</ol>
<p>A computed element constructor might be used to make a modified
copy of an existing element. For example, if the variable
<code>$e</code> is bound to an element with <a title="numeric" 
href="#dt-numeric">numeric</a> content, the following constructor
might be used to create a new element with the same name and
attributes as <code>$e</code> and with numeric content equal to
twice the value of <code>$e</code> :</p>
<div class="exampleInner">
<pre>element {fn:node-name($e)}
   {$e/@*, 2 * fn:data($e)}
</pre></div>
<p>In this example, if <code>$e</code> is bound by the expression
<code>let $e := &lt;length
units="inches"&gt;{5}&lt;/length&gt;</code> , then the result of
the example expression is the element <code>&lt;length
units="inches"&gt;10&lt;/length&gt;</code> .</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The <a title="static type" href="#dt-static-type">static
type</a> of the expression <code>fn:node-name($e)</code> is
<code>xs:QName?</code> , denoting zero or one QName. Therefore, if
the <a title="static typing feature" href="#dt-static-typing-feature">Static
 Typing Feature</a> is in effect,
the above example raises a static type error, since the name
expression in a computed element constructor is required to return
exactly one string or QName. In order to avoid the static type
error, the name expression <code>fn:node-name($e)</code> could be
rewritten as <code>fn:exactly-one(fn:node-name($e))</code> . If the
<a title="static typing feature" href="#dt-static-typing-feature">Static
 Typing Feature</a> is not in
effect, the example can be successfully evaluated as written,
provided that <code>$e</code> is bound to exactly one element node
with numeric content.</p>
</div>
<p>One important purpose of computed constructors is to allow the
name of a node to be computed. We will illustrate this feature by
an expression that translates the name of an element from one
language to another. Suppose that the variable <code>$dict</code>
is bound to a <code>dictionary</code> element containing a sequence
of <code>entry</code> elements, each of which encodes translations
for a specific word. Here is an example entry that encodes the
German and Italian variants of the word "address":</p>
<div class="exampleInner">
<pre>&lt;entry word="address"&gt;
   &lt;variant xml:lang="de"&gt;Adresse&lt;/variant&gt;
   &lt;variant xml:lang="it"&gt;indirizzo&lt;/variant&gt;
&lt;/entry&gt; 
</pre></div>
<p>Suppose further that the variable <code>$e</code> is bound to
the following element:</p>
<div class="exampleInner">
<pre>&lt;address&gt;123 Roosevelt Ave. Flushing, NY 11368&lt;/address&gt;
</pre></div>
<p>Then the following expression generates a new element in which
the name of <code>$e</code> has been translated into Italian and
the content of <code>$e</code> (including its attributes, if any)
has been preserved. The first enclosed expression after the
<code>element</code> keyword generates the name of the element, and
the second enclosed expression generates the content and
attributes:</p>
<div class="exampleInner">
<pre>  element 
    {$dict/entry[@word=name($e)]/variant[@xml:lang="it"]}
    {$e/@*, $e/node()}
</pre></div>
<p>The result of this expression is as follows:</p>
<div class="exampleInner">
<pre>&lt;indirizzo&gt;123 Roosevelt Ave. Flushing, NY 11368&lt;/indirizzo&gt;
</pre></div>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>As in the previous example, if the <a title="static typing feature" 
href="#dt-static-typing-feature">Static
Typing Feature</a> is in effect, the enclosed expression that
computes the element name in the above computed element constructor
must be wrapped in a call to the <code>fn:exactly-one</code>
function in order to avoid a static type error.</p>
</div>
<p>Additional examples of computed element constructors can be
found in <a href="#id-recursive-transformations"><b><del 
class="diff-old">I.4</del> <ins class="diff-chg">I.3</ins> Recursive
Transformations</b></a> .</p>
</div>
<div class="div4">
<h5><a id="id-computedAttributes" name="id-computedAttributes"></a>
<del class="diff-old">3.7.3.2</del> <ins class="diff-chg">3.8.3.2</ins> 
Computed Attribute Constructors</h5>
<h5><a id="N147D7" name="N147D7"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CompAttrConstructor" 
name="doc-xquery11-CompAttrConstructor"></a> <del class="diff-old">[113]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[156]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CompAttrConstructor">CompAttrConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"attribute" ( <del class="diff-old">QName</del> <a 
href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a> |
("{" <a href="#doc-xquery11-Expr">Expr</a> "}")) "{" <a 
href="#doc-xquery11-Expr">Expr</a> ? "}"</code></td>
</tr>
</tbody>
</table>
<p>A computed attribute constructor creates a new attribute node,
with its own node identity.</p>
<p>If the keyword <code>attribute</code> is followed by a
<del class="diff-old">QName,</del> <a title="lexical QName" 
href="#dt-qname"><ins class="diff-chg">lexical QName</ins></a> , that
QName is expanded using the <a title="statically known namespaces" 
href="#dt-static-namespaces">statically known namespaces</a> , and
the resulting <a title="expanded QName" href="#dt-expanded-qname">expanded
 QName</a> (including its prefix) is
used as the <code>node-name</code> property of the constructed
attribute node. If expansion of the QName is not successful, a
<a title="static error" href="#dt-static-error">static error</a> is
raised [ <a title="err:XPST0081" href="#ERRXPST0081">err:XPST0081</a> ].</p>
<p>If the keyword <code>attribute</code> is followed by a <a title="name
 expression" href="#dt-name-expression">name expression</a> ,
the name expression is processed as follows:</p>
<ol class="enumar">
<li>
<p><a title="atomization" href="#dt-atomization">Atomization</a> is
applied to the result of the <a title="name expression" 
href="#dt-name-expression">name expression</a> . If the result of
<a title="atomization" href="#dt-atomization">atomization</a> is
not a single atomic value of type <code>xs:QName</code> ,
<code>xs:string</code> , or <code>xs:untypedAtomic</code> , a
<a title="type error" href="#dt-type-error">type error</a> is
raised [ <a title="err:XPTY0004" href="#ERRXPTY0004">err:XPTY0004</a> ].</p>
</li>
<li>
<p>If the atomized value of the <a title="name expression" 
href="#dt-name-expression">name expression</a> is of type <code>xs:QName
<del class="diff-old">,</del></code> :</p>
<ol class="enumla">
<li>
<p><ins class="diff-chg">If the</ins> <a title="expanded QName" 
href="#dt-expanded-qname"><ins class="diff-chg">expanded
QName</ins></a> <ins class="diff-chg">returned by the atomized name
expression has a namespace URI but has no prefix, it is given
an</ins> <a title="implementation dependent" 
href="#dt-implementation-dependent"><ins class="diff-chg">implementation-dependent</ins></a>
 <ins class="diff-chg">prefix.</ins></p>
<div class="note">
<p class="prefix"><b><ins class="diff-chg">Note:</ins></b></p>
<p><ins class="diff-chg">This step is necessary because attributes
have no default namespace. Therefore any attribute name</ins> that
<ins class="diff-new">has a namespace URI must also have a
prefix.</ins></p>
</div>
</li>
<li>
<p><ins class="diff-new">The resulting</ins> <a title="expanded QName" 
href="#dt-expanded-qname">expanded QName</a>
(including its prefix) is used as the <code>node-name</code>
property of the constructed attribute node.</p>
</li>
</ol>
</li>
<li>
<p>If the atomized value of the <a title="name expression" 
href="#dt-name-expression">name expression</a> is of type
<code>xs:string</code> or <code>xs:untypedAtomic</code> , that
value is converted to an <a title="expanded QName" 
href="#dt-expanded-qname">expanded QName</a> . If the string value
contains a namespace prefix, that prefix is resolved to a namespace
URI using the <a title="statically known namespaces" 
href="#dt-static-namespaces">statically known namespaces</a> . If the
string value contains no namespace prefix, it is treated as a local
name in no namespace. The resulting <a title="expanded QName" 
href="#dt-expanded-qname">expanded QName</a> (including its prefix) is
used as the <code>node-name</code> property of the constructed
attribute. If conversion of the atomized <a title="name expression" 
href="#dt-name-expression">name expression</a> to an <a title="expanded 
QName" href="#dt-expanded-qname">expanded QName</a> is
not successful, a <a title="dynamic error" href="#dt-dynamic-error">dynamic
 error</a> is raised [ <a title="err:XQDY0074" href="#ERRXQDY0074">err:XQDY0074</a>
 ].</p>
</li>
</ol>
<p><del class="diff-old">The</del> <ins class="diff-chg">A</ins>
<a title="dynamic error" href="#dt-dynamic-error"><ins class="diff-chg">dynamic
 error</ins></a> <ins class="diff-chg">is raised
[</ins> <a title="err:XQDY0044" href="#ERRXQDY0044"><ins 
class="diff-chg">err:XQDY0044</ins></a> <ins class="diff-chg">] if
the</ins> node-name <del class="diff-old">property</del> of the
constructed attribute <del class="diff-old">(an expanded QName
)</del> <ins class="diff-chg">node has any of the following
properties:</ins></p>
<ul>
<li>
<p><ins class="diff-chg">Its namespace prefix</ins> is <del 
class="diff-old">checked as follows: If</del> <code><ins 
class="diff-chg">xmlns</ins></code> .</p>
</li>
<li>
<p><ins class="diff-chg">It has no namespace prefix and</ins> its
<ins class="diff-new">local name is</ins> <code><ins class="diff-new">xmlns</ins></code>
 .</p>
</li>
<li>
<p><ins class="diff-new">Its namespace</ins> URI <del class="diff-old">part</del>
 is <code>http://www.w3.org/2000/xmlns/
<del class="diff-old">(corresponding to</del></code> .</p>
</li>
<li>
<p><ins class="diff-chg">Its</ins> namespace prefix <ins 
class="diff-new">is</ins> <code><del class="diff-old">xmlns</del>
<ins class="diff-chg">xml</ins></code> <del class="diff-old">) or
if it</del> <ins class="diff-chg">and its namespace URI</ins> is
<del class="diff-old">in no</del> <ins class="diff-chg">not</ins>
<code><ins class="diff-chg">http://www.w3.org/XML/1998/namespace</ins></code>
 .</p>
</li>
<li>
<p><ins class="diff-chg">Its</ins> namespace <ins class="diff-new">prefix
 is other than</ins> <code><ins class="diff-new">xml</ins></code> and 
its <del class="diff-old">local
name</del> <ins class="diff-chg">namespace URI</ins> is
<code><del class="diff-old">xmlns , a dynamic error [ err:XQDY0044
] is raised.</del> <ins class="diff-chg">http://www.w3.org/XML/1998/namespace</ins></code>
 .</p>
</li>
</ul>
<p>The <a title="content expression" href="#dt-content-expression">content
 expression</a> of a computed
attribute constructor is processed as follows:</p>
<ol class="enumar">
<li>
<p><a title="atomization" href="#dt-atomization">Atomization</a> is
applied to the result of the <a title="content expression" 
href="#dt-content-expression">content expression</a> , converting it to
a sequence of atomic values. (If the <a title="content expression" 
href="#dt-content-expression">content expression</a> is absent, the
result of this step is an empty sequence.)</p>
</li>
<li>
<p>If the result of atomization is an empty sequence, the value of
the attribute is the zero-length string. Otherwise, each atomic
value in the atomized sequence is cast into a string.</p>
</li>
<li>
<p>The individual strings resulting from the previous step are
merged into a single string by concatenating them with a single
space character between each pair. The resulting string becomes the
<code>string-value</code> property of the new attribute node. The
<a title="type annotation" href="#dt-type-annotation">type
annotation</a> ( <code>type-name</code> property) of the new
attribute node is <code>xs:untypedAtomic</code> . The
<code>typed-value</code> property of the attribute node is the same
as its <code>string-value</code> , as an instance of
<code>xs:untypedAtomic</code> .</p>
</li>
<li>
<p>The <code>parent</code> property of the attribute node is set to
empty.</p>
</li>
<li>
<p>If the attribute name is <code>xml:id</code> , then
<code>xml:id</code> processing is performed as defined in <a 
href="#XMLID">[XML ID]</a> . This ensures that the attribute node has
the type <code>xs:ID</code> and that its value is properly
normalized. If an error is encountered during <code>xml:id</code>
processing, an implementation <del class="diff-old">MAY</del>
<ins class="diff-chg">may</ins> raise a <a title="dynamic error" 
href="#dt-dynamic-error">dynamic error</a> [ <a title="err:XQDY0091" 
href="#ERRXQDY0091">err:XQDY0091</a> ].</p>
</li>
<li>
<p>If the attribute name is <code>xml:id</code> , the
<code>is-id</code> property of the resulting attribute node is set
to <code>true</code> ; otherwise the <code>is-id</code> property is
set to <code>false</code> . The <code>is-idrefs</code> property of
the attribute node is unconditionally set to <code>false</code>
.</p>
</li>
<li>
<p>If the attribute name is <code>xml:space</code> and the
attribute value is other than <code>preserve</code> or
<code>default</code> , a dynamic error <a title="may" href="#may">MAY</a>
 be raised [ <a title="err:XQDY0092" href="#ERRXQDY0092">err:XQDY0092</a>
 ].</p>
</li>
</ol>
<ul>
<li>
<p>Example:</p>
<div class="exampleInner">
<pre>attribute size {4 + 3}
</pre></div>
<p>The <a title="string value" href="#dt-string-value">string
value</a> of the <code>size</code> attribute is " <code>7</code> "
and its type is <code>xs:untypedAtomic</code> .</p>
</li>
<li>
<p>Example:</p>
<div class="exampleInner">
<pre><del class="diff-old">attribute
   { if ($sex = "M") then "husband" else "wife" }
</del>
<ins class="diff-chg">attribute  
   { if ($sex = "M") then "husband" else "wife" } 
</ins>
   { &lt;a&gt;Hello&lt;/a&gt;, 1 to 3, &lt;b&gt;Goodbye&lt;/b&gt; }
</pre></div>
<p>The name of the constructed attribute is either
<code>husband</code> or <code>wife</code> . Its <a title="string value" 
href="#dt-string-value">string value</a> is "
<code>Hello 1 2 3 Goodbye</code> ".</p>
</li>
</ul>
</div>
<div class="div4">
<h5><a id="id-documentConstructors" name="id-documentConstructors"></a> <del
 class="diff-old">3.7.3.3</del>
<ins class="diff-chg">3.8.3.3</ins> Document Node Constructors</h5>
<h5><a id="N1496C" name="N1496C"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CompDocConstructor" 
name="doc-xquery11-CompDocConstructor"></a> <del class="diff-old">[110]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[153]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CompDocConstructor">CompDocConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"document" "{" <a href="#doc-xquery11-Expr">Expr</a>
"}"</code></td>
</tr>
</tbody>
</table>
<p>All document node constructors are computed constructors. The
result of a document node constructor is a new document node, with
its own node identity.</p>
<p>A document node constructor is useful when the result of a query
is to be a document in its own right. The following example
illustrates a query that returns an XML document containing a root
element named <code>author-list</code> :</p>
<div class="exampleInner">
<pre>document
<del class="diff-old">   {
</del>
<ins class="diff-chg">  {
</ins>
      &lt;author-list&gt;
         {fn:doc("bib.xml")/bib/book/author}
      &lt;/author-list&gt;
<del class="diff-old">   }
</del>
<ins class="diff-chg">  }
</ins>
</pre></div>
<p>The <a title="content expression" href="#dt-content-expression">content
 expression</a> of a document node
constructor is processed in exactly the same way as an enclosed
expression in the content of a <a title="direct element constructor" 
href="#dt-direct-elem-const">direct
element constructor</a> , as described in Step 1e of <a 
href="#id-content"><b><del class="diff-old">3.7.1.3</del> <ins 
class="diff-chg">3.8.1.3</ins> Content</b></a> . The result of 
processing
the content expression is a sequence of nodes called the <b>content
sequence</b> . Processing of the document node constructor then
proceeds as follows:</p>
<ol class="enumar">
<li>
<p><ins class="diff-new">If the content sequence contains a
document node, the document node is replaced in the content
sequence by its children.</ins></p>
</li>
<li>
<p>Adjacent text nodes in the content sequence are merged into a
single text node by concatenating their contents, with no
intervening blanks. After concatenation, any text node whose
content is a zero-length string is deleted from the content
sequence.</p>
</li>
<li>
<p>If the content sequence contains <del class="diff-old">a
document</del> <ins class="diff-chg">an attribute</ins> node,
<del class="diff-old">the document node</del> <ins class="diff-chg">a</ins>
 <a title="type error" href="#dt-type-error"><ins class="diff-chg">type 
error</ins></a> is
<del class="diff-old">replaced in the content sequence by its
children.</del> <ins class="diff-chg">raised [</ins> <a 
title="err:XPTY0004" href="#ERRXPTY0004"><ins class="diff-chg">err:XPTY0004</ins></a>
 <ins class="diff-chg">].</ins></p>
</li>
<li>
<p>If the content sequence contains <del class="diff-old">an
attribute</del> <ins class="diff-chg">a namespace</ins> node, a
<a title="type error" href="#dt-type-error">type error</a> is
raised [ <a title="err:XPTY0004" href="#ERRXPTY0004">err:XPTY0004</a> ].</p>
</li>
<li>
<p>The properties of the newly constructed document node are
determined as follows:</p>
<ol class="enumla">
<li>
<p><code>base-uri</code> is taken from <a title="base URI" 
href="#dt-base-uri">base URI</a> in the <a title="base URI" 
href="#dt-base-uri">static context</a> . If no base URI is defined in
the static context, the <code>base-uri</code> property is
empty.</p>
</li>
<li>
<p><code>children</code> consist of all the element, text, comment,
and processing instruction nodes in the content sequence. Note that
the <code>parent</code> property of each of these nodes has been
set to the newly constructed document node.</p>
</li>
<li>
<p>The <code>unparsed-entities</code> and <code>document-uri</code>
properties are empty.</p>
</li>
<li>
<p>The <code>string-value</code> property is equal to the
concatenated contents of the text-node descendants in document
order.</p>
</li>
<li>
<p>The <code>typed-value</code> property is equal to the
<code>string-value</code> property, as an instance of
<code>xs:untypedAtomic</code> .</p>
</li>
</ol>
</li>
</ol>
<p>No validation is performed on the constructed document node. The
<a href="#XML">[XML 1.0]</a> rules that govern the structure of an
XML document (for example, the document node must have exactly one
child that is an element node) are not enforced by the XQuery
document node constructor.</p>
</div>
<div class="div4">
<h5><a id="id-textConstructors" name="id-textConstructors"></a>
<del class="diff-old">3.7.3.4</del> <ins class="diff-chg">3.8.3.4</ins> 
Text Node Constructors</h5>
<h5><a id="N149FA" name="N149FA"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CompTextConstructor" 
name="doc-xquery11-CompTextConstructor"></a> <del class="diff-old">[114]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[161]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CompTextConstructor">CompTextConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"text" "{" <a href="#doc-xquery11-Expr">Expr</a>
"}"</code></td>
</tr>
</tbody>
</table>
<p>All text node constructors are computed constructors. The result
of a text node constructor is a new text node, with its own node
identity.</p>
<p>The <a title="content expression" href="#dt-content-expression">content
 expression</a> of a text node
constructor is processed as follows:</p>
<ol class="enumar">
<li>
<p><a title="atomization" href="#dt-atomization">Atomization</a> is
applied to the value of the <a title="content expression" 
href="#dt-content-expression">content expression</a> , converting it to
a sequence of atomic values.</p>
</li>
<li>
<p>If the result of atomization is an empty sequence, no text node
is constructed. Otherwise, each atomic value in the atomized
sequence is cast into a string.</p>
</li>
<li>
<p>The individual strings resulting from the previous step are
merged into a single string by concatenating them with a single
space character between each pair. The resulting string becomes the
<code>content</code> property of the constructed text node.</p>
</li>
</ol>
<p>The <code>parent</code> property of the constructed text node is
set to empty.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>It is possible for a text node constructor to construct a text
node containing a zero-length string. However, if used in the
content of a constructed element or document node, such a text node
will be deleted or merged with another text node.</p>
</div>
<p>The following example illustrates a text node constructor:</p>
<div class="exampleInner">
<pre>text {"Hello"}
</pre></div>
</div>
<div class="div4">
<h5><a id="id-computed-pis" name="id-computed-pis"></a> <del 
class="diff-old">3.7.3.5</del> <ins class="diff-chg">3.8.3.5</ins>
Computed Processing Instruction Constructors</h5>
<h5><a id="N14A39" name="N14A39"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CompPIConstructor" 
name="doc-xquery11-CompPIConstructor"></a> <del class="diff-old">[116]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[163]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CompPIConstructor">CompPIConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"processing-instruction" ( <a href="#prod-xquery11-NCName">NCName</a>
 | ("{" <a href="#doc-xquery11-Expr">Expr</a> "}")) "{" <a 
href="#doc-xquery11-Expr">Expr</a> ? "}"</code></td>
</tr>
</tbody>
</table>
<p>A computed processing instruction constructor ( <a 
href="#doc-xquery11-CompPIConstructor">CompPIConstructor</a> )
constructs a new processing instruction node with its own node
identity.</p>
<p>If the keyword <code>processing-instruction</code> is followed
by an NCName, that NCName is used as the <code>target</code>
property of the constructed node. If the keyword
<code>processing-instruction</code> is followed by a <a title="name 
expression" href="#dt-name-expression">name expression</a> ,
the name expression is processed as follows:</p>
<ol class="enumar">
<li>
<p><a title="atomization" href="#dt-atomization">Atomization</a> is
applied to the value of the <a title="name expression" 
href="#dt-name-expression">name expression</a> . If the result of
<a title="atomization" href="#dt-atomization">atomization</a> is
not a single atomic value of type <code>xs:NCName</code> ,
<code>xs:string</code> , or <code>xs:untypedAtomic</code> , a
<a title="type error" href="#dt-type-error">type error</a> is
raised [ <a title="err:XPTY0004" href="#ERRXPTY0004">err:XPTY0004</a> ].</p>
</li>
<li>
<p>If the atomized value of the <a title="name expression" 
href="#dt-name-expression">name expression</a> is of type
<code>xs:string</code> or <code>xs:untypedAtomic</code> , that
value is cast to the type <code>xs:NCName</code> . If the value
cannot be cast to <code>xs:NCName</code> , a <a title="dynamic error" 
href="#dt-dynamic-error">dynamic error</a> is
raised [ <a title="err:XQDY0041" href="#ERRXQDY0041">err:XQDY0041</a> ].</p>
</li>
<li>
<p>The resulting NCName is then used as the <code>target</code>
property of the newly constructed processing instruction node.
However, a <a title="dynamic error" href="#dt-dynamic-error">dynamic 
error</a> is raised if the NCName is
equal to " <code>XML</code> " (in any combination of upper and
lower case) [ <a title="err:XQDY0064" href="#ERRXQDY0064">err:XQDY0064</a>
 ].</p>
</li>
</ol>
<p>The <a title="content expression" href="#dt-content-expression">content
 expression</a> of a computed
processing instruction constructor is processed as follows:</p>
<ol class="enumar">
<li>
<p><a title="atomization" href="#dt-atomization">Atomization</a> is
applied to the value of the <a title="content expression" 
href="#dt-content-expression">content expression</a> , converting it to
a sequence of atomic values. (If the <a title="content expression" 
href="#dt-content-expression">content expression</a> is absent, the
result of this step is an empty sequence.)</p>
</li>
<li>
<p>If the result of atomization is an empty sequence, it is
replaced by a zero-length string. Otherwise, each atomic value in
the atomized sequence is cast into a string. If any of the
resulting strings contains the string " <code>?&gt;</code> ", a
<a title="dynamic error" href="#dt-dynamic-error">dynamic error</a>
[ <a title="err:XQDY0026" href="#ERRXQDY0026">err:XQDY0026</a> ] is
raised.</p>
</li>
<li>
<p>The individual strings resulting from the previous step are
merged into a single string by concatenating them with a single
space character between each pair. Leading whitespace is removed
from the resulting string. The resulting string then becomes the
<code>content</code> property of the constructed processing
instruction node.</p>
</li>
</ol>
<p>The remaining properties of the new processing instruction node
are determined as follows:</p>
<ol class="enumar">
<li>
<p>The <code>parent</code> property is empty.</p>
</li>
<li>
<p>The <code>base-uri</code> property is empty.</p>
</li>
</ol>
<p>The following example illustrates a computed processing
instruction constructor:</p>
<div class="exampleInner">
<pre>let $target := "audio-output",
    $content := "beep" 
return processing-instruction {$target} {$content}
</pre></div>
<p>The processing instruction node constructed by this example
might be serialized as follows:</p>
<div class="exampleInner">
<pre>&lt;?audio-output beep?&gt;
</pre></div>
</div>
<div class="div4">
<h5><a id="id-computed-comments" name="id-computed-comments"></a>
<del class="diff-old">3.7.3.6</del> <ins class="diff-chg">3.8.3.6</ins> 
Computed Comment Constructors</h5>
<h5><a id="N14B01" name="N14B01"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CompCommentConstructor" 
name="doc-xquery11-CompCommentConstructor"></a> <del class="diff-old">[115]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[162]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CompCommentConstructor">CompCommentConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"comment" "{" <a href="#doc-xquery11-Expr">Expr</a>
"}"</code></td>
</tr>
</tbody>
</table>
<p>A computed comment constructor ( <a 
href="#doc-xquery11-CompCommentConstructor">CompCommentConstructor</a> )
constructs a new comment node with its own node identity. The
<a title="content expression" href="#dt-content-expression">content
expression</a> of a computed comment constructor is processed as
follows:</p>
<ol class="enumar">
<li>
<p><a title="atomization" href="#dt-atomization">Atomization</a> is
applied to the value of the <a title="content expression" 
href="#dt-content-expression">content expression</a> , converting it to
a sequence of atomic values.</p>
</li>
<li>
<p>If the result of atomization is an empty sequence, it is
replaced by a zero-length string. Otherwise, each atomic value in
the atomized sequence is cast into a string.</p>
</li>
<li>
<p>The individual strings resulting from the previous step are
merged into a single string by concatenating them with a single
space character between each pair. The resulting string becomes the
<code>content</code> property of the constructed comment node.</p>
</li>
<li>
<p>It is a <a title="dynamic error" href="#dt-dynamic-error">dynamic 
error</a> [ <a title="err:XQDY0072" href="#ERRXQDY0072">err:XQDY0072</a>
 ] if the result of the
<a title="content expression" href="#dt-content-expression">content
expression</a> of a computed comment constructor contains two
adjacent hyphens or ends with a hyphen.</p>
</li>
</ol>
<p>The <code>parent</code> property of the constructed comment node
is set to empty.</p>
<p>The following example illustrates a computed comment
constructor:</p>
<div class="exampleInner">
<pre>let $homebase := "Houston" 
return comment {fn:concat($homebase, ", we have a problem.")}
</pre></div>
<p>The comment node constructed by this example might be serialized
as follows:</p>
<div class="exampleInner">
<pre>&lt;!--Houston, we have a problem.--&gt;
</pre></div>
</div>
<div class="div4">
<h5><a id="id-computed-namespaces" name="id-computed-namespaces"></a> <ins
 class="diff-new">3.8.3.7
Computed Namespace Constructors</ins></h5>
<h5><a id="N14B55" name="N14B55"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CompNamespaceConstructor" 
name="doc-xquery11-CompNamespaceConstructor"></a><ins class="diff-new">[157]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CompNamespaceConstructor"><ins 
class="diff-new">CompNamespaceConstructor</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"namespace" (</ins> <a 
href="#prod-xquery11-Prefix"><ins class="diff-new">Prefix</ins></a>
<ins class="diff-new">| ("{"</ins> <a href="#doc-xquery11-PrefixExpr"><ins
 class="diff-new">PrefixExpr</ins></a> <ins class="diff-new">"}"))
"{"</ins> <a href="#doc-xquery11-URIExpr"><ins class="diff-new">URIExpr</ins></a>
 <ins class="diff-new">?
"}"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-PrefixExpr" name="doc-xquery11-PrefixExpr"></a><ins
 class="diff-new">[159]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-PrefixExpr"><ins class="diff-new">PrefixExpr</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-Expr"><ins class="diff-new">Expr</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-URIExpr" name="doc-xquery11-URIExpr"></a><ins 
class="diff-new">[160]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-URIExpr"><ins class="diff-new">URIExpr</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-Expr"><ins class="diff-new">Expr</ins></a></code></td>
</tr>
</tbody>
</table>
<p><ins class="diff-new">A computed namespace constructor creates a
new namespace node, with its own node identity. The parent of the
newly created namespace node is empty.</ins></p>
<p><ins class="diff-new">If the constructor specifies a</ins>
<code><ins class="diff-new">Prefix</ins></code> ,<ins class="diff-new">it
 is used as the prefix for the namespace
node.</ins></p>
<p><ins class="diff-new">If the constructor specifies a</ins>
<code><ins class="diff-new">PrefixExpr</ins></code> ,<ins 
class="diff-new">the prefix expression is evaluated as follows:</ins></p>
<ol class="enumar">
<li>
<p><a title="atomization" href="#dt-atomization"><ins class="diff-new">Atomization</ins></a>
 <ins class="diff-new">is applied
to the result of the</ins> <a title="name expression" 
href="#dt-name-expression"><ins class="diff-new">name
expression</ins></a> .</p>
</li>
<li>
<p><ins class="diff-new">If the result of</ins> <a title="atomization" 
href="#dt-atomization"><ins class="diff-new">atomization</ins></a> <ins 
class="diff-new">is a single
atomic value of type</ins> <code><ins class="diff-new">xs:NCName</ins></code>
 ,<code><ins class="diff-new">xs:string</ins></code> ,<ins 
class="diff-new">or</ins>
<code><ins class="diff-new">xs:untypedAtomic</ins></code>
,<ins class="diff-new">it is used as the</ins> <code><ins 
class="diff-new">prefix</ins></code> <ins class="diff-new">property of
the newly constructed namespace node. If the result is the empty
sequence or an empty string, the</ins> <code><ins class="diff-new">prefix</ins></code>
 <ins class="diff-new">property of
the newly constructed namespace node is empty. For any other
result, a</ins> <a title="type error" href="#dt-type-error"><ins 
class="diff-new">type error</ins></a>
<ins class="diff-new">is raised [</ins> <a title="err:XPTY0004" 
href="#ERRXPTY0004"><ins class="diff-new">err:XPTY0004</ins></a>
<ins class="diff-new">].</ins></p>
</li>
<li>
<p><ins class="diff-new">The</ins> <code><ins class="diff-new">URIExpr</ins></code>
 <ins class="diff-new">is evaluated,
and the result is cast to</ins> <code><ins class="diff-new">xs:anyURI</ins></code>
 <ins class="diff-new">to create
the</ins> <code><ins class="diff-new">URI</ins></code> <ins 
class="diff-new">property for the newly created node.</ins></p>
<p><ins class="diff-new">An error [</ins> <a title="err:XQDY0101" 
href="#ERRXQDY0101"><ins class="diff-new">err:XQDY0101</ins></a>
<ins class="diff-new">] is raised if the namespace URI in a
computed namespace constructor is bound to the predefined
prefix</ins> <code><ins class="diff-new">xmlns</ins></code>
,<ins class="diff-new">or if a namespace URI other than</ins>
<code><ins class="diff-new">http://www.w3.org/XML/1998/namespace</ins></code>
<ins class="diff-new">is bound to the prefix</ins>
<code><ins class="diff-new">xml</ins></code> ,<ins class="diff-new">or 
if the prefix</ins> <code><ins class="diff-new">xml</ins></code> <ins 
class="diff-new">is bound to a
namespace URI other than</ins> <code><ins class="diff-new">http://www.w3.org/XML/1998/namespace.</ins></code></p>
</li>
</ol>
<p><ins class="diff-new">By itself, a computed namespace
constructor has no effect on in-scope namespaces, but if an element
constructor's content sequence contains a namespace node, the
namespace binding it represents is added to the elements in-scope
namespaces.</ins></p>
<p><ins class="diff-new">A computed namespace constructor has no
effect on the statically known namespaces.</ins></p>
<div class="note">
<p class="prefix"><b><ins class="diff-new">Note:</ins></b></p>
<p><ins class="diff-new">The newly created namespace node has all
properties defined for a namespace node in the data model. Like all
nodes, it has identity. Like all nodes which do not share a common
parent, the relative order of these nodes is implementation
dependent. As defined in the data model, the name of the node is
the prefix, and the string value of the node is the URI.</ins></p>
</div>
<p><ins class="diff-new">Examples:</ins></p>
<ul>
<li>
<p><ins class="diff-new">A computed namespace constructor with a
prefix:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
namespace a {"http://a.example.com" }
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-new">A computed namespace constructor with a
prefix expression:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
namespace {"a"} {"http://a.example.com" }
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-new">A computed namespace constructor with an
empty prefix:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
namespace { "" } {"http://a.example.com" }
</ins>
</pre></div>
</li>
</ul>
<p><ins class="diff-new">Computed namespace constructors are
generally used to add to the in-scope namespaces of elements
created with element constructors:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
&lt;form&gt;
 {
    namespace a {"http://a.example.com" },
    attribute { xs:QName("a:id") } { "a-12-XE-45" },
    element { xs:QName("a:field")} { "Sample data" }
 }
&lt;/form&gt;
</ins>
</pre></div>
<p><ins class="diff-new">Computed namespace constructors have no
effect on the statically known namespaces. If the prefix a is not
already defined in the statically known namespaces, the following
expression results in a static error [</ins> <a title="err:XPST0081" 
href="#ERRXPST0081"><ins class="diff-new">err:XPST0081</ins></a> <ins 
class="diff-new">].</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
&lt;a:form&gt;
 {
  namespace a { "http://a.example.com" }
 }
&lt;/a:form&gt;
</ins>
</pre></div>
</div>
</div>
<div class="div3">
<h4><a id="id-ns-nodes-on-elements" name="id-ns-nodes-on-elements"></a> <del
 class="diff-old">3.7.4</del>
<ins class="diff-chg">3.8.4</ins> In-scope Namespaces of a
Constructed Element</h4>
<p>An element node constructed by a direct or computed element
constructor has an <a title="in-scope namespaces" 
href="#dt-in-scope-namespaces">in-scope namespaces</a> property that
consists of a set of <a title="in-scope namespaces" 
href="#dt-in-scope-namespaces">namespace bindings</a> . The in-scope
namespaces of an element node may affect the way the node is
serialized (see <a href="#id-serialization"><b>2.2.4
Serialization</b></a> ), and may also affect the behavior of
certain functions that operate on nodes, such as
<code>fn:name</code> . Note the difference between <a title="in-scope 
namespaces" href="#dt-in-scope-namespaces">in-scope
namespaces</a> , which is a dynamic property of an element node,
and <a title="statically known namespaces" href="#dt-static-namespaces">statically
 known namespaces</a> , which is
a static property of an expression. Also note that one of the
namespace bindings in the in-scope namespaces may have no prefix
(denoting the default namespace for the given element). The
in-scope namespaces of a constructed element node consist of the
following namespace bindings:</p>
<ul>
<li>
<p>A namespace binding is created for each namespace declared in
the current element constructor by a <a title="namespace declaration 
attribute" href="#dt-namespace-decl-attr">namespace declaration 
attribute</a> .</p>
</li>
<li>
<p>A namespace binding is created for each namespace <ins 
class="diff-new">node in the context sequence of the current element
constructor.</ins></p>
</li>
<li>
<p><ins class="diff-new">A namespace binding is created for each
namespace</ins> that is declared in a <a title="namespace declaration 
attribute" href="#dt-namespace-decl-attr">namespace declaration 
attribute</a> of an
enclosing <a title="direct element constructor" 
href="#dt-direct-elem-const">direct element constructor</a> and not
overridden by the current element constructor or an intermediate
constructor.</p>
</li>
<li>
<p>A namespace binding is always created to bind the prefix
<code>xml</code> to the namespace URI
<code>http://www.w3.org/XML/1998/namespace</code> .</p>
</li>
<li>
<p>For each namespace used in the name of the constructed element
or in the names of its attributes, a namespace binding must exist.
If a namespace binding does not already exist for one of these
namespaces, a new namespace binding is created for it. If the name
of the node includes a prefix, that prefix is used in the namespace
binding; if the name has no prefix, then a binding is created for
the empty prefix. If this would result in a conflict, because it
would require two different bindings of the same prefix, then the
prefix used in the node name is changed to an arbitrary <a 
title="implementation dependent" href="#dt-implementation-dependent">implementation-dependent</a>
 prefix
that does not cause such a conflict, and a namespace binding is
created for this new prefix.</p>
</li>
</ul>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p><a title="copy-namespaces mode" href="#dt-copy-namespaces-mode">Copy-namespaces
 mode</a> does not affect
the namespace bindings of a newly constructed element node. It
applies only to existing nodes that are copied by a constructor
expression.</p>
</div>
<p><ins class="diff-new">In an element constructor, if two or more
namespace bindings in the in-scope bindings would have the same
prefix, then an error is raised if they have different URIs [</ins>
<a title="err:XQTY0102" href="#ERRXQTY0102"><ins class="diff-new">err:XQTY0102</ins></a>
 <ins class="diff-new">]; if they
would have the same prefix and URI, duplicate bindings are
ignored.</ins></p>
<p>The following query serves as an example:</p>
<div class="exampleInner">
<pre>declare namespace p="http://example.com/ns/p";
declare namespace q="http://example.com/ns/q";
declare namespace f="http://example.com/ns/f";
&lt;p:a q:b="{f:func(2)}" xmlns:r="http://example.com/ns/r"/&gt;
</pre></div>
<p>The <a title="in-scope namespaces" href="#dt-in-scope-namespaces">in-scope
 namespaces</a> of the resulting
<code>p:a</code> element consists of the following <a title="in-scope 
namespaces" href="#dt-in-scope-namespaces">namespace
bindings</a> :</p>
<ul>
<li>
<p><code>p = "http://example.com/ns/p"</code></p>
</li>
<li>
<p><code>q = "http://example.com/ns/q"</code></p>
</li>
<li>
<p><code>r = "http://example.com/ns/r"</code></p>
</li>
<li>
<p><code>xml = "http://www.w3.org/XML/1998/namespace"</code></p>
</li>
</ul>
<p>The namespace bindings for <code>p</code> and <code>q</code> are
added to the result element because their respective namespaces are
used in the names of the element and its attributes. The namespace
binding <code>r="http://example.com/ns/r"</code> is added to the
in-scope namespaces of the constructed element because it is
defined by a <a title="namespace declaration attribute" 
href="#dt-namespace-decl-attr">namespace declaration attribute</a> ,
even though it is not used in a name.</p>
<p>No namespace binding corresponding to
<code>f="http://example.com/ns/f"</code> is created, because the
namespace prefix <code>f</code> appears only in the query prolog
and is not used in an element or attribute name of the constructed
node. This namespace binding does not appear in the query result,
even though it is present in the <a title="statically known namespaces" 
href="#dt-static-namespaces">statically known namespaces</a> and is
available for use during processing of the query.</p>
<p>Note that the following constructed element, if nested within a
<code>validate</code> expression, cannot be validated:</p>
<div class="exampleInner">
<pre>&lt;p xsi:type="xs:integer"&gt;3&lt;/p&gt;
</pre></div>
<p>The constructed element will have namespace bindings for the
prefixes <code>xsi</code> (because it is used in a name) and
<code>xml</code> (because it is defined for every constructed
element node). During validation of the constructed element, the
validator will be unable to interpret the namespace prefix
<code>xs</code> because it is has no namespace binding. Validation
of this constructed element could be made possible by providing a
<a title="namespace declaration attribute" 
href="#dt-namespace-decl-attr">namespace declaration attribute</a> , as
in the following example:</p>
<div class="exampleInner">
<pre>&lt;p xmlns:xs="http://www.w3.org/2001/XMLSchema"
   xsi:type="xs:integer"&gt;3&lt;/p&gt;
</pre></div>
</div>
</div>
<div class="div2">
<h3><a id="id-flwor-expressions" name="id-flwor-expressions"></a>
<del class="diff-old">3.8</del> <ins class="diff-chg">3.9</ins>
FLWOR Expressions</h3>
<p>XQuery provides a <del class="diff-old">feature</del>
<ins class="diff-chg">versatile expression</ins> called a FLWOR
expression that <del class="diff-old">supports iteration and
binding of variables to intermediate results. This kind of</del>
<ins class="diff-chg">may contain multiple clauses. The FLWOR</ins>
expression <del class="diff-old">is often useful</del> <ins 
class="diff-chg">can be used</ins> for <del class="diff-old">computing
joins between two or more documents</del> <ins class="diff-chg">many 
purposes, including iterating over sequences,
joining multiple documents,</ins> and <del class="diff-old">for
restructuring data.</del> <ins class="diff-chg">performing grouping
and aggregation.</ins> The name FLWOR, pronounced "flower", is
suggested by the keywords <code>for</code> , <code>let</code> ,
<code>where</code> , <code>order by</code> , and <code>return
<del class="diff-old">.</del></code> , <ins class="diff-chg">which
introduce some of the clauses used in FLWOR expressions (but this
is not a complete list of such clauses.)</ins></p>
<p><ins class="diff-new">The complete syntax of a FLWOR expression
is shown here, and relevant parts of the syntax are repeated in
subsequent sections of this document.</ins></p>
<h5><a id="N14CDB" name="N14CDB"></a></h5>
<del class="diff-old">The</del>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-FLWORExpr" name="doc-xquery11-FLWORExpr"></a> <del
 class="diff-old">[33]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[41]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-FLWORExpr">FLWORExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">(</del> <a 
href="#doc-xquery11-InitialClause"><ins class="diff-chg">InitialClause</ins></a>
 <a href="#doc-xquery11-IntermediateClause"><ins class="diff-chg">IntermediateClause</ins></a>
 <ins class="diff-chg">*</ins> <a href="#doc-xquery11-ReturnClause"><ins
 class="diff-chg">ReturnClause</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-InitialClause" name="doc-xquery11-InitialClause"></a><ins
 class="diff-chg">[42]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-InitialClause"><ins class="diff-chg">InitialClause</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ForClause">ForClause</a> |
<a href="#doc-xquery11-LetClause">LetClause</a> <del class="diff-old">)+</del>
 <ins class="diff-chg">|</ins> <a href="#doc-xquery11-WindowClause"><ins
 class="diff-chg">WindowClause</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-IntermediateClause" 
name="doc-xquery11-IntermediateClause"></a><ins class="diff-chg">[43]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-IntermediateClause"><ins 
class="diff-chg">IntermediateClause</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-InitialClause"><ins class="diff-chg">InitialClause</ins></a>
 <ins class="diff-chg">|</ins>
<a href="#doc-xquery11-WhereClause">WhereClause</a> <del 
class="diff-old">?</del> <ins class="diff-chg">|</ins> <a 
href="#doc-xquery11-GroupByClause"><ins class="diff-chg">GroupByClause</ins></a>
 <ins class="diff-chg">|</ins>
<a href="#doc-xquery11-OrderByClause">OrderByClause</a> <del 
class="diff-old">? "return" ExprSingle</del> <ins class="diff-chg">|</ins>
 <a href="#doc-xquery11-CountClause"><ins class="diff-chg">CountClause</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ForClause" name="doc-xquery11-ForClause"></a> <del
 class="diff-old">[34]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[44]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ForClause">ForClause</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"for" <a href="#prod-xquery11-ForBinding"><ins 
class="diff-new">ForBinding</ins></a> <ins class="diff-new">(","</ins>
<a href="#prod-xquery11-ForBinding"><ins class="diff-new">ForBinding</ins></a>
 <ins class="diff-new">)*</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N14F37.doc-xquery11-ForBinding" 
name="noid_N14F37.doc-xquery11-ForBinding"></a><ins class="diff-new">[45]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">ForBinding</ins></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code>"$" <a href="#doc-xquery11-VarName">VarName</a> <a 
href="#doc-xquery11-TypeDeclaration">TypeDeclaration</a> ? <a 
href="#doc-xquery11-AllowingEmpty"><ins class="diff-chg">AllowingEmpty</ins></a>
 <ins class="diff-chg">?</ins>
<a href="#doc-xquery11-PositionalVar">PositionalVar</a> ? "in"
<a href="#doc-xquery11-ExprSingle">ExprSingle</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-LetClause" name="doc-xquery11-LetClause"></a> <ins
 class="diff-new">[48]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-LetClause"><ins class="diff-new">LetClause</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"let"</ins> <a 
href="#prod-xquery11-LetBinding"><ins class="diff-new">LetBinding</ins></a>
 ("," <a href="#prod-xquery11-LetBinding"><ins class="diff-new">LetBinding</ins></a>
 <ins class="diff-new">)*</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N14F3E.doc-xquery11-LetBinding" 
name="noid_N14F3E.doc-xquery11-LetBinding"></a><ins class="diff-new">[49]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">LetBinding</ins></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code>"$" <a href="#doc-xquery11-VarName">VarName</a> <a 
href="#doc-xquery11-TypeDeclaration">TypeDeclaration</a> ? <ins 
class="diff-chg">":="</ins> <a href="#doc-xquery11-ExprSingle"><ins 
class="diff-chg">ExprSingle</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-TypeDeclaration" 
name="doc-xquery11-TypeDeclaration"></a><ins class="diff-chg">[168]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-TypeDeclaration"><ins class="diff-chg">TypeDeclaration</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"as"</ins> <a 
href="#doc-xquery11-SequenceType"><ins class="diff-chg">SequenceType</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-AllowingEmpty" name="doc-xquery11-AllowingEmpty"></a><ins
 class="diff-chg">[46]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-AllowingEmpty"><ins class="diff-chg">AllowingEmpty</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"allowing"
"empty"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-PositionalVar" name="doc-xquery11-PositionalVar"></a><ins
 class="diff-chg">[47]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-PositionalVar">PositionalVar</a>
<del class="diff-old">? "in" ExprSingle</del></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"at" "$"</ins> <a 
href="#doc-xquery11-VarName"><ins class="diff-chg">VarName</ins></a>
<del class="diff-old">)*</del></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-WindowClause" name="doc-xquery11-WindowClause"></a>
 <del class="diff-old">[36]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[50]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">LetClause</del> <a 
href="#prod-xquery11-WindowClause"><ins class="diff-chg">WindowClause</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">"let"</del> <ins class="diff-chg">"for" (</ins>
 <a href="#doc-xquery11-TumblingWindowClause"><ins class="diff-chg">TumblingWindowClause</ins></a>
 <ins class="diff-chg">|</ins> <a 
href="#doc-xquery11-SlidingWindowClause"><ins class="diff-chg">SlidingWindowClause</ins></a>
 <ins class="diff-chg">)</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-TumblingWindowClause" 
name="doc-xquery11-TumblingWindowClause"></a><ins class="diff-chg">[51]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-TumblingWindowClause"><ins 
class="diff-chg">TumblingWindowClause</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"tumbling" "window"</ins> "$"
<a href="#doc-xquery11-VarName">VarName</a> <a 
href="#doc-xquery11-TypeDeclaration">TypeDeclaration</a> ? <del 
class="diff-old">":="</del> <ins class="diff-chg">"in"</ins> <a 
href="#doc-xquery11-ExprSingle">ExprSingle</a> <del class="diff-old">(","</del>
 <a href="#doc-xquery11-WindowStartCondition"><ins class="diff-chg">WindowStartCondition</ins></a>
 <a href="#doc-xquery11-WindowEndCondition"><ins class="diff-chg">WindowEndCondition</ins></a>
 <ins class="diff-chg">?</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-SlidingWindowClause" 
name="doc-xquery11-SlidingWindowClause"></a><ins class="diff-chg">[52]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-SlidingWindowClause"><ins 
class="diff-chg">SlidingWindowClause</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"sliding" "window"</ins> "$"
<a href="#doc-xquery11-VarName">VarName</a> <a 
href="#doc-xquery11-TypeDeclaration">TypeDeclaration</a> ? <del 
class="diff-old">":="</del> <ins class="diff-chg">"in"</ins> <a 
href="#doc-xquery11-ExprSingle">ExprSingle</a> <del class="diff-old">)*</del>
 <a href="#doc-xquery11-WindowStartCondition"><ins class="diff-chg">WindowStartCondition</ins></a>
 <a href="#doc-xquery11-WindowEndCondition"><ins class="diff-chg">WindowEndCondition</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-WindowStartCondition" 
name="doc-xquery11-WindowStartCondition"></a> <del class="diff-old">[118]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[53]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">TypeDeclaration</del> <a 
href="#prod-xquery11-WindowStartCondition"><ins class="diff-chg">WindowStartCondition</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">"as" SequenceType</del> <ins 
class="diff-chg">"start"</ins> <a href="#doc-xquery11-WindowVars"><ins 
class="diff-chg">WindowVars</ins></a> <ins class="diff-chg">"when"</ins>
<a href="#doc-xquery11-ExprSingle"><ins class="diff-chg">ExprSingle</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-WindowEndCondition" 
name="doc-xquery11-WindowEndCondition"></a> <del class="diff-old">[35]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[54]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-WindowEndCondition"><ins 
class="diff-chg">WindowEndCondition</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"only"? "end"</ins> <a 
href="#doc-xquery11-WindowVars"><ins class="diff-chg">WindowVars</ins></a>
 <ins class="diff-chg">"when"</ins>
<a href="#doc-xquery11-ExprSingle"><ins class="diff-chg">ExprSingle</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-WindowVars" name="doc-xquery11-WindowVars"></a><ins
 class="diff-chg">[55]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-WindowVars"><ins class="diff-chg">WindowVars</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">("$"</ins> <a 
href="#doc-xquery11-CurrentItem"><ins class="diff-chg">CurrentItem</ins></a>
 <ins class="diff-chg">)?</ins>
<a href="#doc-xquery11-PositionalVar">PositionalVar</a> <ins 
class="diff-new">? ("previous" "$"</ins> <a 
href="#doc-xquery11-PreviousItem"><ins class="diff-new">PreviousItem</ins></a>
 <ins class="diff-new">)? ("next"
"$"</ins> <a href="#doc-xquery11-NextItem"><ins class="diff-new">NextItem</ins></a>
 <ins class="diff-new">)?</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CurrentItem" name="doc-xquery11-CurrentItem"></a><ins
 class="diff-new">[56]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CurrentItem"><ins class="diff-new">CurrentItem</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">"at"</del> <a 
href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-PreviousItem" name="doc-xquery11-PreviousItem"></a><ins
 class="diff-chg">[57]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-PreviousItem"><ins class="diff-chg">PreviousItem</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-NextItem" name="doc-xquery11-NextItem"></a><ins 
class="diff-chg">[58]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-NextItem"><ins class="diff-chg">NextItem</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CountClause" name="doc-xquery11-CountClause"></a><ins
 class="diff-chg">[59]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CountClause"><ins class="diff-chg">CountClause</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"count"</ins> "$" <a 
href="#doc-xquery11-VarName">VarName</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-WhereClause" name="doc-xquery11-WhereClause"></a>
 <del class="diff-old">[37]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[60]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-WhereClause">WhereClause</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"where" <a href="#doc-xquery11-ExprSingle">ExprSingle</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-GroupByClause" name="doc-xquery11-GroupByClause"></a>
 <del class="diff-old">[38]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[61]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-GroupByClause"><ins class="diff-chg">GroupByClause</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"group" "by"</ins> <a 
href="#doc-xquery11-GroupingSpecList"><ins class="diff-chg">GroupingSpecList</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-GroupingSpecList" 
name="doc-xquery11-GroupingSpecList"></a><ins class="diff-chg">[62]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-GroupingSpecList"><ins 
class="diff-chg">GroupingSpecList</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-GroupingSpec"><ins class="diff-chg">GroupingSpec</ins></a>
 <ins class="diff-chg">(","</ins>
<a href="#doc-xquery11-GroupingSpec"><ins class="diff-chg">GroupingSpec</ins></a>
 <ins class="diff-chg">)*</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-GroupingSpec" name="doc-xquery11-GroupingSpec"></a><ins
 class="diff-chg">[63]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-GroupingSpec"><ins class="diff-chg">GroupingSpec</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"$"</ins> <a 
href="#doc-xquery11-VarName"><ins class="diff-chg">VarName</ins></a>
<ins class="diff-chg">("collation"</ins> <a 
href="#doc-xquery11-URILiteral"><ins class="diff-chg">URILiteral</ins></a>
 <ins class="diff-chg">)?</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-OrderByClause" name="doc-xquery11-OrderByClause"></a><ins
 class="diff-chg">[64]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-OrderByClause">OrderByClause</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>(("order" "by") | ("stable" "order" "by")) <a 
href="#doc-xquery11-OrderSpecList">OrderSpecList</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-OrderSpecList" name="doc-xquery11-OrderSpecList"></a>
 <del class="diff-old">[39]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[65]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-OrderSpecList">OrderSpecList</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-OrderSpec">OrderSpec</a> (","
<a href="#doc-xquery11-OrderSpec">OrderSpec</a> )*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-OrderSpec" name="doc-xquery11-OrderSpec"></a> <del
 class="diff-old">[40]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[66]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-OrderSpec">OrderSpec</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-ExprSingle">ExprSingle</a>
<a href="#doc-xquery11-OrderModifier">OrderModifier</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-OrderModifier" name="doc-xquery11-OrderModifier"></a>
 <del class="diff-old">[41]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[67]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-OrderModifier">OrderModifier</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>("ascending" | "descending")? ("empty" ("greatest" |
"least"))? ("collation" <a href="#doc-xquery11-URILiteral">URILiteral</a>
 )?</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ReturnClause" name="doc-xquery11-ReturnClause"></a>
 <ins class="diff-chg">[68]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">for</del> <a 
href="#prod-xquery11-ReturnClause"><ins class="diff-chg">ReturnClause</ins></a></code>
 <del class="diff-old">and</del></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">let</del> <ins class="diff-chg">"return"</ins>
 <a href="#doc-xquery11-ExprSingle"><ins class="diff-chg">ExprSingle</ins></a></code>
 <del class="diff-old">clauses in a</del></td>
</tr>
</tbody>
</table>
<p><ins class="diff-chg">The semantics of</ins> FLWOR <del 
class="diff-old">expression generate</del> <ins class="diff-chg">expressions
 are based on a concept called a</ins>
<b><ins class="diff-chg">tuple stream</ins></b> .<ins class="diff-chg">[</ins>
 <a title="tuple stream" id="id-tuple-stream-foobar" 
name="id-tuple-stream-foobar"><ins class="diff-chg">Definition</ins></a>
 :<ins class="diff-chg">A</ins>
<b><ins class="diff-chg">tuple stream</ins></b> <ins class="diff-chg">is</ins>
 an ordered sequence of <ins class="diff-new">zero or more</ins> <b>tuples</b>
 .] <ins class="diff-new">[</ins> <a title="tuple" id="id-tuple-foobar" 
name="id-tuple-foobar"><ins class="diff-new">Definition</ins></a>
:<ins class="diff-new">A</ins> <b><ins class="diff-new">tuple</ins></b> <ins
 class="diff-new">is a set</ins> of
<del class="diff-old">bound</del> <ins class="diff-chg">zero or
more named</ins> variables, <del class="diff-old">called the</del>
<ins class="diff-chg">each of which is bound to a value that is
an</ins> <a title="XDM instance" href="#dt-data-model-instance"><ins 
class="diff-chg">XDM
instance</ins></a> .]<ins class="diff-chg">Each</ins> tuple stream
<del class="diff-old">. The optional where clause serves to
filter</del> <ins class="diff-chg">is homogeneous in</ins> the
<del class="diff-old">tuple stream, retaining some</del>
<ins class="diff-chg">sense that all its</ins> tuples <ins 
class="diff-new">contain variables with the same names</ins> and
<del class="diff-old">discarding others.</del> <ins class="diff-chg">the
 same</ins> <a title="static type" href="#dt-static-type"><ins 
class="diff-chg">static types</ins></a> .
The <del class="diff-old">optional</del> <ins class="diff-chg">following
 example illustrates a tuple stream consisting
of four tuples, each containing three variables named</ins>
<code><del class="diff-old">order by clause can be used to
reorder</del> <ins class="diff-chg">$x</ins></code>
,<code><ins class="diff-chg">$y</ins></code> ,<ins class="diff-chg">and</ins>
 <code><ins class="diff-chg">$z</ins></code>
:</p>
<div class="exampleInner">
<pre><ins class="diff-chg">
($x = 1003, $y = "Fred", $z = &lt;age&gt;21&lt;/age&gt;)
($x = 1017, $y = "Mary", $z = &lt;age&gt;35&lt;/age&gt;)
($x = 1020, $y = "Bill", $z = &lt;age&gt;18&lt;/age&gt;)
($x = 1024, $y = "John", $z = &lt;age&gt;29&lt;/age&gt;)
</ins>
</pre></div>
<div class="note">
<p class="prefix"><b><ins class="diff-chg">Note:</ins></b></p>
<p><ins class="diff-chg">In this section, tuple streams are
represented as shown in</ins> the <ins class="diff-new">above
example. Each</ins> tuple <del class="diff-old">stream. The return
clause constructs</del> <ins class="diff-chg">is on a separate line
and is enclosed in parentheses, and</ins> the <del class="diff-old">result</del>
 <ins class="diff-chg">variable bindings
inside each tuple are separated by commas. This notation does not
represent XQuery syntax, but is simply a representation of a tuple
stream for the purpose</ins> of <ins class="diff-new">defining</ins> the
 <ins class="diff-new">semantics of
FLWOR expressions.</ins></p>
</div>
<p><ins class="diff-new">Tuples and tuple streams are not part of
the</ins> <a title="data model" href="#dt-datamodel"><ins 
class="diff-new">data model</ins></a> .<ins class="diff-new">They exist
only as conceptual intermediate results during the processing of
a</ins> FLWOR expression. <del class="diff-old">The
return</del></p>
<p><ins class="diff-chg">A FLWOR expression consists of an initial
clause, zero or more intermediate clauses, and a final clause.
Conceptually, the initial</ins> clause <del class="diff-old">is
evaluated once for every</del> <ins class="diff-chg">generates
a</ins> tuple <del class="diff-old">in</del> <ins class="diff-chg">stream.
 Each intermediate clause takes</ins> the tuple
<del class="diff-old">stream, after filtering</del> <ins 
class="diff-chg">stream generated</ins> by the <del class="diff-old">where
 clause, using the variable bindings</del>
<ins class="diff-chg">previous clause as input and generates a
(possibly different) tuple stream as output. The final clause takes
a tuple stream as input and, for each tuple</ins> in <ins 
class="diff-new">this tuple stream, generates an</ins> <a title="XDM 
instance" href="#dt-data-model-instance"><ins class="diff-new">XDM 
instance</ins></a> <ins class="diff-new">;</ins> the
<del class="diff-old">respective tuples. The</del> <ins class="diff-chg">final</ins>
 result of the FLWOR expression is
<del class="diff-old">an ordered sequence containing</del> the
<del class="diff-old">results</del> <ins class="diff-chg">ordered
concatenation</ins> of these <del class="diff-old">evaluations,
concatenated as if by the comma operator</del> <a title="XDM instance" 
href="#dt-data-model-instance"><ins class="diff-chg">XDM instances</ins></a>
 .</p>
<p>The <del class="diff-old">following example of</del> <ins 
class="diff-chg">initial clause in</ins> a FLWOR expression <del 
class="diff-old">includes all of the possible clauses. The</del>
<ins class="diff-chg">may be a</ins> <code>for <del class="diff-old">clause
 iterates over all the departments in an input
document, binding the variable</del></code> , <code><del 
class="diff-old">$d</del> <ins class="diff-chg">let</ins></code>
,<code><ins class="diff-chg">window</ins></code> ,<ins class="diff-chg">or</ins>
 <code><ins class="diff-chg">count</ins></code>
<del class="diff-old">to each department number in turn. For each
binding of</del> <ins class="diff-chg">clause. Intermediate clauses
may be</ins> <code><del class="diff-old">$d</del> <ins class="diff-chg">for</ins></code>
 , <del class="diff-old">the</del>
<code>let</code> , <code><ins class="diff-new">window</ins></code>
,<code><ins class="diff-new">count</ins></code> ,<code><ins 
class="diff-new">where</ins></code> ,<code><ins class="diff-new">group
by</ins></code> ,<ins class="diff-new">or</ins> <code><ins 
class="diff-new">order by</ins></code> <ins class="diff-new">clauses.
These intermediate clauses may be repeated as many times as
desired, in any order. The final</ins> clause <del class="diff-old">binds
 variable</del> <ins class="diff-chg">of the FLWOR
expression must be a</ins> <code><del class="diff-old">$e</del>
<ins class="diff-chg">return</ins></code> <del class="diff-old">to
all</del> <ins class="diff-chg">clause. The semantics of</ins> the
<del class="diff-old">employees</del> <ins class="diff-chg">various
clauses are described</ins> in the <del class="diff-old">given
department, selected from another input document.</del> <ins 
class="diff-chg">following sections.</ins></p>
<div class="div3">
<h4><a id="id-binding-rules" name="id-binding-rules"></a><ins 
class="diff-chg">3.9.1 Variable
Bindings</ins></h4>
<p>The <del class="diff-old">result of the</del> <ins class="diff-chg">following
 clauses in FLWOR expressions bind values to
variables:</ins> <code>for <del class="diff-old">and</del></code> ,
<code>let <del class="diff-old">clauses is a tuple stream in which
each tuple contains a pair of bindings for</del></code> ,
<code><del class="diff-old">$d</del> <ins class="diff-chg">window</ins></code>
 , and <code><del class="diff-old">$e
( $d</del> <ins class="diff-chg">count</ins></code> <del 
class="diff-old">is bound to</del> <ins class="diff-chg">(in
addition,</ins> a <del class="diff-old">department number and</del>
<code><del class="diff-old">$e</del> <ins class="diff-chg">group
by</ins></code> <ins class="diff-new">clause changes the values of
variables that were previously bound.) In each case, binding of
variables</ins> is <del class="diff-old">bound to</del> <ins 
class="diff-chg">governed by the following rules:</ins></p>
<ol class="enumar">
<li>
<p><ins class="diff-chg">The scope of</ins> a <del class="diff-old">set</del>
 <ins class="diff-chg">bound variable includes
all subexpressions</ins> of <del class="diff-old">employees
in</del> <ins class="diff-chg">the containing FLWOR</ins> that
<del class="diff-old">department).</del> <ins class="diff-chg">appear 
after the variable binding.</ins> The <del class="diff-old">where clause
 filters</del> <ins class="diff-chg">scope
does not include</ins> the <del class="diff-old">tuple stream by
keeping only those binding-pairs that represent departments having
at least ten employees.</del> <ins class="diff-chg">expression to
which the variable is bound.</ins> The <ins class="diff-new">following 
code fragment, containing two</ins>
<code><del class="diff-old">order by</del> <ins class="diff-chg">let</ins></code>
 <ins class="diff-new">clauses,
illustrates how variable bindings may reference variables that were
bound in earlier clauses, or in earlier bindings in the same
clause:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
let $x := 47, $y := f($x)
let $z := g($x, $y)
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-new">A given variable may be bound more than
once in a FLWOR expression, or even within one</ins> clause
<del class="diff-old">orders</del> <ins class="diff-chg">of a FLWOR
expression. In such a case, each new binding occludes</ins> the
<del class="diff-old">surviving tuples</del> <ins class="diff-chg">previous
 one, which becomes inaccessible</ins> in
<del class="diff-old">descending order</del> <ins class="diff-chg">the 
remainder of the FLWOR expression.</ins></p>
</li>
<li>
<p><ins class="diff-chg">[</ins> <a title="type declaration" 
id="dt-type-declaration" name="dt-type-declaration"><ins 
class="diff-chg">Definition</ins></a> :<ins class="diff-chg">A variable
binding may be accompanied</ins> by <ins class="diff-new">a</ins>
<b><ins class="diff-new">type declaration</ins></b> ,<ins 
class="diff-new">which consists of</ins> the <del class="diff-old">average
 salary</del> <ins class="diff-chg">keyword</ins>
<code><ins class="diff-chg">as</ins></code> <ins class="diff-chg">followed
 by the static type</ins> of the <del class="diff-old">employees</del> <ins
 class="diff-chg">variable, declared
using the syntax</ins> in <a href="#id-sequencetype-syntax"><b><ins 
class="diff-new">2.5.3
SequenceType Syntax</ins></b></a> .]<ins class="diff-new">At run
time, if</ins> the <del class="diff-old">department. The</del>
<ins class="diff-chg">value bound to the variable does not match
the declared type according to the rules for</ins> <a 
title="SequenceType matching" href="#dt-sequencetype-matching"><ins 
class="diff-chg">SequenceType
matching</ins></a> ,<ins class="diff-chg">a</ins> <a title="type error" 
href="#dt-type-error"><ins class="diff-chg">type
error</ins></a> <ins class="diff-chg">is raised [</ins> <a 
title="err:XPTY0004" href="#ERRXPTY0004"><ins class="diff-chg">err:XPTY0004</ins></a>
 <ins class="diff-chg">]. For
example, the following</ins> <code><del class="diff-old">return</del> <ins
 class="diff-chg">let</ins></code>
clause <del class="diff-old">constructs</del> <ins class="diff-chg">raises</ins>
 a <del class="diff-old">new</del> <a title="type error" 
href="#dt-type-error"><ins class="diff-chg">type
error</ins></a> <ins class="diff-chg">because the variable</ins>
<code><del class="diff-old">big-dept</del> <ins class="diff-chg">$salary</ins></code>
 <del class="diff-old">element for
each surviving tuple, containing</del> <ins class="diff-chg">has a
type declaration that is not satisfied by</ins> the <del 
class="diff-old">department number, headcount, and average salary.</del>
<ins class="diff-chg">value that is bound to it:</ins></p>
<div class="exampleInner">
<pre><del class="diff-old">&lt;span class=
"parse-test"&gt;for $d in fn:doc("depts.xml")/depts/deptno
let $e := fn:doc("emps.xml")/emps/emp[deptno = $d]
where fn:count($e) &gt;= 10
order by fn:avg($e/salary) descending
return
   &lt;big-dept&gt;
      {
      $d,
      &lt;headcount&gt;{fn:count($e)}&lt;/headcount&gt;,
      &lt;avgsal&gt;{fn:avg($e/salary)}&lt;/avgsal&gt;
      }
   &lt;/big-dept&gt;
</del>
<ins class="diff-chg">let $salary as xs:decimal :=  "cat"
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-new">[</ins> <a title="binding sequence" 
id="dt-binding-sequence" name="dt-binding-sequence"><ins 
class="diff-new">Definition</ins></a> :<ins class="diff-new">In a</ins>
<code><ins class="diff-new">for</ins></code> <ins class="diff-new">clause
 or</ins> <code><ins class="diff-new">window</ins></code> <ins 
class="diff-new">clause, when
an expression is preceded by the keyword</ins> <code><ins 
class="diff-new">in</ins></code> ,<ins class="diff-new">the value of 
that
expression is called a</ins> <b><ins class="diff-new">binding
sequence</ins></b> .] The <code><ins class="diff-new">for</ins></code> <ins
 class="diff-new">and</ins>
<code><ins class="diff-new">window</ins></code> clauses <ins 
class="diff-new">iterate over their binding sequences, producing 
multiple
bindings for one or more variables. Details on how binding
sequences are used</ins> in <del class="diff-old">a FLWOR
expression</del> <code><ins class="diff-chg">for</ins></code>
<ins class="diff-chg">and</ins> <code><ins class="diff-chg">window</ins></code>
 <ins class="diff-chg">clauses</ins>
are described in <del class="diff-old">more detail below.</del>
<ins class="diff-chg">the following sections.</ins></p>
</li>
</ol>
</div>
<div class="div3">
<h4><a id="id-xquery-for-clause" name="id-xquery-for-clause"></a>
<del class="diff-old">3.8.1</del> <ins class="diff-chg">3.9.2</ins>
For <del class="diff-old">and Let Clauses</del> <ins class="diff-chg">Clause</ins></h4>
<h5><a id="N14FF2" name="N14FF2"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="noid_N15078.doc-xquery11-ForClause" 
name="noid_N15078.doc-xquery11-ForClause"></a> <ins class="diff-new">[44]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">ForClause</ins></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"for"</ins> <a 
href="#prod-xquery11-ForBinding"><ins class="diff-new">ForBinding</ins></a>
 <ins class="diff-new">(","</ins>
<a href="#prod-xquery11-ForBinding"><ins class="diff-new">ForBinding</ins></a>
 <ins class="diff-new">)*</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N1507B.doc-xquery11-ForBinding" 
name="noid_N1507B.doc-xquery11-ForBinding"></a><ins class="diff-new">[45]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">ForBinding</ins></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"$"</ins> <a 
href="#doc-xquery11-VarName"><ins class="diff-new">VarName</ins></a>
<a href="#doc-xquery11-TypeDeclaration"><ins class="diff-new">TypeDeclaration</ins></a>
 <ins class="diff-new">?</ins>
<a href="#doc-xquery11-AllowingEmpty"><ins class="diff-new">AllowingEmpty</ins></a>
 <ins class="diff-new">?</ins>
<a href="#doc-xquery11-PositionalVar"><ins class="diff-new">PositionalVar</ins></a>
 <ins class="diff-new">?
"in"</ins> <a href="#doc-xquery11-ExprSingle"><ins class="diff-new">ExprSingle</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N1507E.doc-xquery11-TypeDeclaration" 
name="noid_N1507E.doc-xquery11-TypeDeclaration"></a><ins 
class="diff-new">[168]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">TypeDeclaration</ins></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"as"</ins> <a 
href="#doc-xquery11-SequenceType"><ins class="diff-new">SequenceType</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N15081.doc-xquery11-AllowingEmpty" 
name="noid_N15081.doc-xquery11-AllowingEmpty"></a><ins class="diff-new">[46]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">AllowingEmpty</ins></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"allowing"
"empty"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N15084.doc-xquery11-PositionalVar" 
name="noid_N15084.doc-xquery11-PositionalVar"></a><ins class="diff-new">[47]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">PositionalVar</ins></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"at" "$"</ins> <a 
href="#doc-xquery11-VarName"><ins class="diff-new">VarName</ins></a></code></td>
</tr>
</tbody>
</table>
<p><del class="diff-old">The purpose of the</del> <ins class="diff-chg">A</ins>
 <code>for</code> <del class="diff-old">and</del>
<ins class="diff-chg">clause is used for iteration. Each variable
in a</ins> <code><del class="diff-old">let</del> <ins class="diff-chg">for</ins></code>
 <del class="diff-old">clauses in</del>
<ins class="diff-chg">clause iterates over</ins> a <del class="diff-old">FLWOR
 expression</del> <ins class="diff-chg">sequence
and</ins> is <ins class="diff-new">bound in turn</ins> to
<del class="diff-old">produce a tuple stream</del> <ins class="diff-chg">each
 item</ins> in <del class="diff-old">which</del>
<ins class="diff-chg">the sequence.</ins></p>
<p><ins class="diff-chg">If a</ins> <code><ins class="diff-chg">for</ins></code>
 <ins class="diff-chg">clause contains
multiple variables, it is semantically equivalent to multiple</ins>
<code><ins class="diff-chg">for</ins></code> <ins class="diff-chg">clauses,</ins>
 each <del class="diff-old">tuple consists
of</del> <ins class="diff-chg">containing</ins> one <del 
class="diff-old">or more bound variables.</del> <ins class="diff-chg">of
the variables in the original</ins> <code><ins class="diff-chg">for</ins></code>
 <ins class="diff-chg">clause.</ins></p>
<p><ins class="diff-new">Example:</ins></p>
<ul>
<li>
<p>The <del class="diff-old">simplest example</del> <ins 
class="diff-chg">clause</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
for $x in $expr1, $y in $expr2
</ins>
</pre></div>
<p><ins class="diff-chg">is semantically equivalent to:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
for $x in $expr1 
for $y in $expr2
</ins>
</pre></div>
</li>
</ul>
<p><ins class="diff-chg">In the remainder of this section, we
define the semantics</ins> of a <code>for</code> clause <del 
class="diff-old">contains one</del> <ins class="diff-chg">containing a
single</ins> variable and an associated <del class="diff-old">expression.
 [ Definition : The value of the</del>
expression <del class="diff-old">associated with a variable in
a</del> <ins class="diff-chg">(following the keyword</ins>
<code><del class="diff-old">for</del> <ins class="diff-chg">in</ins></code>
 <del class="diff-old">clause</del>
<ins class="diff-chg">) whose value</ins> is called the <a 
title="binding sequence" href="#dt-binding-sequence">binding sequence</a>
for that <del class="diff-old">variable.] The</del> <ins 
class="diff-chg">variable.</ins></p>
<p><ins class="diff-chg">If a single-variable</ins>
<code>for</code> clause <del class="diff-old">iterates over</del>
<ins class="diff-chg">is</ins> the <del class="diff-old">items</del> <ins
 class="diff-chg">initial clause</ins>
in <del class="diff-old">the</del> <ins class="diff-chg">a FLWOR
expression, it iterates over its</ins> <a title="binding sequence" 
href="#dt-binding-sequence">binding <del class="diff-old">sequence,</del>
 <ins class="diff-chg">sequence</ins></a>
, binding the variable to each item in turn. <ins class="diff-new">The 
resulting sequence of variable bindings becomes the
initial tuple stream that serves as input to the next clause of the
FLWOR expression.</ins> If <a title="ordering mode" 
href="#dt-ordering-mode">ordering mode</a> is <code>ordered</code> , the
<del class="diff-old">resulting sequence</del> <ins class="diff-chg">order</ins>
 of <del class="diff-old">variable bindings
is ordered according to</del> <ins class="diff-chg">tuples in the
tuple stream preserves</ins> the order of <del class="diff-old">values 
in</del> the <a title="binding sequence" href="#dt-binding-sequence">binding
 <del class="diff-old">sequence;</del> <ins class="diff-chg">sequence</ins></a>
<ins class="diff-chg">;</ins> otherwise the <del class="diff-old">ordering</del>
 <ins class="diff-chg">order</ins> of the
<del class="diff-old">variable bindings</del> <ins class="diff-chg">tuple
 stream</ins> is <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a> .</p>
<p><del class="diff-old">A</del> <ins class="diff-chg">If the</ins>
<a title="binding sequence" href="#dt-binding-sequence"><ins 
class="diff-chg">binding sequence</ins></a> <ins class="diff-chg">contains
 no items, the output tuple stream depends on
whether</ins> <code><del class="diff-old">for</del> <ins 
class="diff-chg">allowing empty</ins></code> <del class="diff-old">clause
may
 also contain multiple variables, each with</del> <ins class="diff-chg">is
 specified. If</ins> <code><ins class="diff-chg">allowing empty</ins></code>
 <ins class="diff-chg">is
specified, the output tuple stream consists of one tuple in which
the variable is bound to</ins> an <del class="diff-old">associated
expression whose value</del> <ins class="diff-chg">empty sequence.
If</ins> <code><ins class="diff-chg">allowing empty</ins></code> is
<ins class="diff-new">not specified,</ins> the <del class="diff-old">binding
 sequence</del> <ins class="diff-chg">output
tuple stream consists of zero tuples.</ins></p>
<p><ins class="diff-chg">The following examples illustrates tuple
streams that are generated by initial</ins> <code>for</code>
<ins class="diff-new">clauses:</ins></p>
<ul>
<li>
<p><ins class="diff-new">Initial clause:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
for $x in (100, 200, 300)
</ins>
</pre></div>
<p><ins class="diff-new">or (equivalently):</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
for $x allowing empty in (100, 200, 300)
</ins>
</pre></div>
<p><ins class="diff-new">Output tuple stream:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
($x = 100)
($x = 200)
($x = 300)
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-new">Initial clause:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
for $x in ()
</ins>
</pre></div>
<p><ins class="diff-new">Output tuple stream contains no
tuples.</ins></p>
</li>
<li>
<p><ins class="diff-new">Initial clause:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
for $x allowing empty in ()
</ins>
</pre></div>
<p><ins class="diff-new">Output tuple stream:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
($x = ())
</ins>
</pre></div>
</li>
</ul>
<p><ins class="diff-new">[</ins> <a title="positional variable" 
id="dt-positional-variable" name="dt-positional-variable"><ins 
class="diff-new">Definition</ins></a> :<ins class="diff-new">A</ins>
<b><ins class="diff-new">positional variable</ins></b> <ins 
class="diff-new">is a variable</ins> that <del class="diff-old">variable.
In
 this case,</del> <ins class="diff-chg">is preceded by</ins> the
<ins class="diff-new">keyword</ins> <code><ins class="diff-new">at</ins></code>
 .]<ins class="diff-new">A positional
variable may be associated with a variable that is bound in a</ins>
<code>for</code> <del class="diff-old">clause iterates each</del>
<ins class="diff-chg">clause. In this case, as the main</ins>
variable <ins class="diff-new">iterates</ins> over <ins class="diff-new">the
 items in</ins> its <a title="binding sequence" 
href="#dt-binding-sequence">binding <del class="diff-old">sequence. The
resulting</del> <ins class="diff-chg">sequence</ins></a>
,<ins class="diff-chg">the positional variable iterates over the
integers that represent the ordinal numbers of these items in
the</ins> <a title="binding sequence" href="#dt-binding-sequence"><ins 
class="diff-chg">binding
sequence</ins></a> ,<ins class="diff-chg">starting with one. Each
tuple in the output</ins> tuple stream contains <del class="diff-old">one
 tuple</del> <ins class="diff-chg">bindings</ins> for
<del class="diff-old">each combination of values in</del>
<ins class="diff-chg">both</ins> the <del class="diff-old">respective 
binding sequences.</del> <ins class="diff-chg">main variable and the 
positional variable.</ins> If
<del class="diff-old">ordering mode</del> <ins class="diff-chg">the</ins>
 <a title="binding sequence" href="#dt-binding-sequence"><ins 
class="diff-chg">binding
sequence</ins></a> is <ins class="diff-new">empty and</ins>
<code><del class="diff-old">ordered ,</del> <ins class="diff-chg">allowing
 empty</ins></code> <ins class="diff-chg">is
specified,</ins> the <del class="diff-old">order of</del>
<ins class="diff-chg">positional variable in</ins> the <ins 
class="diff-new">output</ins> tuple <del class="diff-old">stream</del> 
is
<del class="diff-old">determined primarily by</del> <ins 
class="diff-chg">bound to</ins> the <del class="diff-old">order</del>
<ins class="diff-chg">integer zero. Positional variables always
have the implied type</ins> <code><ins class="diff-chg">xs:integer</ins></code>
 .<ins class="diff-chg">The</ins>
<a title="expanded QName" href="#dt-expanded-qname"><ins 
class="diff-chg">expanded QName</ins></a> <ins class="diff-chg">of a
positional variable must be distinct from the</ins> <a title="expanded 
QName" href="#dt-expanded-qname"><ins class="diff-chg">expanded QName</ins></a>
 <ins class="diff-chg">of the
main variable with which it is associated [</ins> <a 
title="err:XQST0089" href="#ERRXQST0089"><ins class="diff-chg">err:XQST0089</ins></a>
 <ins class="diff-chg">].</ins></p>
<p><ins class="diff-chg">The following examples illustrate how a
positional variable would have affected the results</ins> of the
<ins class="diff-new">previous examples that generated
tuples:</ins></p>
<ul>
<li>
<p><ins class="diff-new">Initial clause:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
for $x at $i in (100, 200, 300)
</ins>
</pre></div>
<p><ins class="diff-new">Output tuple stream:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
($x = 100, $i = 1)
($x = 200, $i = 2)
($x = 300, $i = 3)
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-new">Initial clause:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
for $x allowing empty at $i in ()
</ins>
</pre></div>
<p><ins class="diff-new">Output tuple stream:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
($x = (), $i = 0)
</ins>
</pre></div>
</li>
</ul>
<p><ins class="diff-new">If a single-variable</ins>
<code><ins class="diff-new">for</ins></code> <ins class="diff-new">clause
 is an intermediate clause in a FLWOR expression,
its</ins> <a title="binding sequence" href="#dt-binding-sequence">binding
 sequence</a> <ins class="diff-new">is evaluated for each input tuple, 
given the bindings in
that input tuple. Each input tuple generates zero or more tuples in
the output tuple stream. Each of these output tuples consists</ins>
of the <del class="diff-old">leftmost variable, and secondarily
by</del> <ins class="diff-chg">original variable bindings of</ins>
the <ins class="diff-new">input tuple plus a</ins> binding
<del class="diff-old">sequences</del> of the <del class="diff-old">other
 variables, working from left</del> <ins class="diff-chg">new variable</ins>
 to <del class="diff-old">right.
Otherwise, the ordering</del> <ins class="diff-chg">one</ins> of
the <del class="diff-old">variable bindings is
implementation-dependent</del> <ins class="diff-chg">items in
its</ins> <a title="binding sequence" href="#dt-binding-sequence"><ins 
class="diff-chg">binding
sequence</ins></a> .</p>
<div class="note">
<p class="prefix"><b><ins class="diff-new">Note:</ins></b></p>
<p><del class="diff-old">A let clause may also contain one or more
variables,</del> <ins class="diff-chg">Although the</ins> <a 
title="binding sequence" href="#dt-binding-sequence"><ins 
class="diff-chg">binding sequence</ins></a> <ins class="diff-chg">is
conceptually evaluated independently for</ins> each <del 
class="diff-old">with</del> <ins class="diff-chg">input tuple,</ins> an
<del class="diff-old">associated expression. Unlike</del>
<ins class="diff-chg">optimized implementation may sometimes be
able to avoid re-evaluating the</ins> <a title="binding sequence" 
href="#dt-binding-sequence"><ins class="diff-chg">binding
sequence</ins></a> <ins class="diff-chg">if it can show that the
variables that the</ins> <a title="binding sequence" 
href="#dt-binding-sequence"><ins class="diff-chg">binding
sequence</ins></a> <ins class="diff-chg">depends on have the same
values as in a previous evaluation.</ins></p>
</div>
<p><ins class="diff-chg">For</ins> a <ins class="diff-new">given
input tuple, if the</ins> <a title="binding sequence" 
href="#dt-binding-sequence"><ins class="diff-new">binding
sequence</ins></a> <ins class="diff-new">for the new variable in
the</ins> <code>for</code> <del class="diff-old">clause, however,
a</del> <ins class="diff-chg">clause contains no items, the result
depends on whether</ins> <code><del class="diff-old">let</del>
<ins class="diff-chg">allowing empty</ins></code> <del class="diff-old">clause
 binds each</del> <ins class="diff-chg">is
specified. If</ins> <code><ins class="diff-chg">allowing
empty</ins></code> <ins class="diff-chg">is specified, the input
tuple generates one output tuple, with the original variable
bindings plus a binding of the new</ins> variable to <ins 
class="diff-new">an empty sequence. If</ins> <code><ins class="diff-new">allowing
 empty</ins></code> <ins class="diff-new">is not
specified,</ins> the <del class="diff-old">result of its associated
expression, without iteration. The</del> <ins class="diff-chg">input 
tuple generates zero output tuples (it is not
represented in the output tuple stream.)</ins></p>
<p><ins class="diff-chg">If the new</ins> variable <del class="diff-old">bindings
 generated</del> <ins class="diff-chg">introduced</ins> by <ins 
class="diff-new">a</ins>
<code><del class="diff-old">let</del> <ins class="diff-chg">for</ins></code>
 <del class="diff-old">clauses are added
to</del> <ins class="diff-chg">clause has an associated</ins>
<a title="positional variable" href="#dt-positional-variable"><ins 
class="diff-chg">positional
variable</ins></a> , the <del class="diff-old">binding</del>
<ins class="diff-chg">output</ins> tuples generated by the
<code>for</code> <del class="diff-old">clauses. If there are
no</del> <ins class="diff-chg">clause also contain bindings</ins>
for <del class="diff-old">clauses,</del> the <a title="positional 
variable" href="#dt-positional-variable"><ins class="diff-new">positional
 variable</ins></a> .<ins class="diff-new">In
this case, as the new variable is bound to each item in its</ins>
<a title="binding sequence" href="#dt-binding-sequence"><ins 
class="diff-new">binding sequence</ins></a> ,<ins class="diff-new">the</ins>
 <a title="positional variable" href="#dt-positional-variable"><ins 
class="diff-new">positional
variable</ins></a> <ins class="diff-new">is bound to the ordinal
position of that item within the</ins> <a title="binding sequence" 
href="#dt-binding-sequence"><ins class="diff-new">binding
sequence</ins></a> ,<ins class="diff-new">starting with one. Note
that, since the</ins> <a title="positional variable" 
href="#dt-positional-variable"><ins class="diff-new">positional
variable</ins></a> <ins class="diff-new">represents a position
within a</ins> <a title="binding sequence" href="#dt-binding-sequence"><ins
 class="diff-new">binding
sequence</ins></a> ,<ins class="diff-new">the output tuples
corresponding to each input tuple are independently numbered,
starting with one. For a given input tuple, if the</ins> <a 
title="binding sequence" href="#dt-binding-sequence"><ins 
class="diff-new">binding sequence</ins></a> <ins class="diff-new">is
empty and</ins> <code><del class="diff-old">let</del> <ins 
class="diff-chg">allowing empty</ins></code> <del class="diff-old">clauses
 generate one tuple containing all</del>
<ins class="diff-chg">is specified,</ins> the <a title="positional 
variable" href="#dt-positional-variable"><ins class="diff-new">positional</ins>
 variable <del class="diff-old">bindings.</del></a> <ins 
class="diff-chg">in the output
tuple is bound to the integer zero.</ins></p>
<p><del class="diff-old">Although for and</del> <ins class="diff-chg">If</ins>
 <a title="ordering mode" href="#dt-ordering-mode"><ins class="diff-chg">ordering
 mode</ins></a>
<ins class="diff-chg">is</ins> <code><del class="diff-old">let
clauses both bind variables,</del> <ins class="diff-chg">ordered</ins></code>
 , the <del class="diff-old">manner</del> <ins class="diff-chg">tuples</ins>
 in
<ins class="diff-new">the output tuple stream are ordered primarily
by the order of the input tuples from</ins> which <del class="diff-old">variables</del>
 <ins class="diff-chg">they</ins> are
<del class="diff-old">bound is quite different, as
illustrated</del> <ins class="diff-chg">derived, and
secondarily</ins> by the <del class="diff-old">following
examples.</del> <ins class="diff-chg">order of the</ins> <a 
title="binding sequence" href="#dt-binding-sequence"><ins 
class="diff-chg">binding sequence</ins></a> <ins class="diff-chg">for 
the
new variable; otherwise the order of the output tuple stream
is</ins> <a title="implementation dependent" 
href="#dt-implementation-dependent"><ins class="diff-chg">implementation-dependent</ins></a>
 .</p>
<p>The <del class="diff-old">first example uses a</del> <ins 
class="diff-chg">following examples illustrates the effects of
intermediate</ins> <code><del class="diff-old">let</del>
<ins class="diff-chg">for</ins></code> <del class="diff-old">clause:</del>
 <ins class="diff-chg">clauses:</ins></p>
<ul>
<li>
<p><ins class="diff-chg">Input tuple stream:</ins></p>
<div class="exampleInner">
<pre><del class="diff-old">&lt;span class=
"parse-test"&gt;let $s := (&lt;one/&gt;, &lt;two/&gt;, &lt;three/&gt;)
return &lt;out&gt;{$s}&lt;/out&gt;
</del>
<ins class="diff-chg">($x = 1)
($x = 2)
($x = 3)
($x = 4)
</ins>
</pre></div>
<p><del class="diff-old">The variable</del> <ins class="diff-chg">Intermediate</ins>
 <code><del class="diff-old">$s</del>
<ins class="diff-chg">for</ins></code> <ins class="diff-new">clause:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
for $y in ($x to 3)
</ins>
</pre></div>
<p><ins class="diff-new">Output tuple stream (assuming</ins>
<a title="ordering mode" href="#dt-ordering-mode"><ins class="diff-new">ordering
 mode</ins></a> is <del class="diff-old">bound
to the result of the expression</del> <code><del class="diff-old">(&lt;one/&gt;,
 &lt;two/&gt;, &lt;three/&gt;) .
Since</del> <ins class="diff-chg">ordered</ins></code> <ins 
class="diff-chg">):</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
($x = 1, $y = 1)
($x = 1, $y = 2)
($x = 1, $y = 3)
($x = 2, $y = 2)
($x = 2, $y = 3)
($x = 3, $y = 3)
</ins>
</pre></div>
<div class="note">
<p class="prefix"><b><ins class="diff-chg">Note:</ins></b></p>
<p><ins class="diff-chg">In this example,</ins> there <del 
class="diff-old">are</del> <ins class="diff-chg">is</ins> no <ins 
class="diff-new">output tuple that corresponds to the input tuple</ins>
<code><del class="diff-old">for</del> <ins class="diff-chg">($x =
4)</ins></code> <del class="diff-old">clauses,</del> <ins 
class="diff-chg">because, when</ins> the <code><del class="diff-old">let</del>
 <ins class="diff-chg">for</ins></code> clause
<del class="diff-old">generates one tuple that contains</del>
<ins class="diff-chg">is evaluated with the bindings in this input
tuple,</ins> the <ins class="diff-new">resulting</ins> <a title="binding
 sequence" href="#dt-binding-sequence">binding <del class="diff-old">of 
$s . The</del> <ins class="diff-chg">sequence</ins></a> <ins 
class="diff-chg">for</ins>
<code><del class="diff-old">return</del> <ins class="diff-chg">$y</ins></code>
 <del class="diff-old">clause</del> is
<del class="diff-old">invoked for this tuple, creating</del>
<ins class="diff-chg">empty.</ins></p>
</div>
</li>
<li>
<p><ins class="diff-chg">This example shows how</ins> the
<del class="diff-old">following output:</del> <ins class="diff-chg">previous
 example would have been affected by a</ins>
<a title="positional variable" href="#dt-positional-variable"><ins 
class="diff-chg">positional
variable</ins></a> <ins class="diff-chg">(assuming the same input
tuple stream):</ins></p>
<div class="exampleInner">
<pre><del class="diff-old">&lt;out&gt;
   &lt;one/&gt;
   &lt;two/&gt;
   &lt;three/&gt;
&lt;/out&gt;
</del>
<ins class="diff-chg">for $y at $j in ($x to 3)
</ins>
</pre></div>
<p><del class="diff-old">The next example</del> <ins class="diff-chg">Output
 tuple stream (assuming</ins> <a title="ordering mode" 
href="#dt-ordering-mode"><ins class="diff-chg">ordering mode</ins></a> 
is <del class="diff-old">a
similar query that contains a</del> <code><del class="diff-old">for
clause instead of a let</del> <ins class="diff-chg">ordered</ins></code>
 <del class="diff-old">clause:</del>
<ins class="diff-chg">):</ins></p>
<div class="exampleInner">
<pre><del class="diff-old">&lt;span class=
"parse-test"&gt;for $s in (&lt;one/&gt;, &lt;two/&gt;, &lt;three/&gt;)
return &lt;out&gt;{$s}&lt;/out&gt;
</del>
<ins class="diff-chg">($x = 1, $y = 1, $j = 1)
($x = 1, $y = 2, $j = 2)
($x = 1, $y = 3, $j = 3)
($x = 2, $y = 2, $j = 1)
($x = 2, $y = 3, $j = 2)
($x = 3, $y = 3, $j = 1)
</ins>
</pre></div>
</li>
<li>
<p><del class="diff-old">In this example,</del> <ins class="diff-chg">This
 example shows how</ins> the <del class="diff-old">variable</del> <ins 
class="diff-chg">previous example
would have been affected by</ins> <code><del class="diff-old">$s</del> <ins
 class="diff-chg">allowing
empty</ins></code> .<ins class="diff-chg">Note that</ins>
<code><ins class="diff-chg">allowing empty</ins></code> <del 
class="diff-old">iterates over</del> <ins class="diff-chg">causes</ins>
the <del class="diff-old">given expression. If ordering mode is
ordered ,</del> <ins class="diff-chg">input tuple</ins>
<code><del class="diff-old">$s</del> <ins class="diff-chg">($x =
4)</ins></code> <del class="diff-old">is first bound</del> to
<ins class="diff-new">be represented in the output tuple stream,
even though the</ins> <a title="binding sequence" 
href="#dt-binding-sequence"><ins class="diff-new">binding
sequence</ins></a> <ins class="diff-new">for</ins>
<code><del class="diff-old">&lt;one/&gt; , then to</del>
<ins class="diff-chg">$y</ins></code> <ins class="diff-chg">contains no 
items for this input tuple. This example
illustrates that</ins> <code><del class="diff-old">&lt;two/&gt; ,
and finally to</del> <ins class="diff-chg">allowing
empty</ins></code> <ins class="diff-chg">in a</ins>
<code><del class="diff-old">&lt;three/&gt; . One tuple is
generated</del> for <del class="diff-old">each</del></code>
<ins class="diff-chg">clause serves a purpose similar to that</ins>
of <del class="diff-old">these bindings, and</del> <ins class="diff-chg">an
 "outer join" in a relational database query.
(Assume</ins> the <ins class="diff-new">same input tuple stream as
in the previous example.)</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
for $y allowing empty at $j in ($x to 3)
</ins>
</pre></div>
<p><ins class="diff-new">Output tuple stream (assuming</ins>
<a title="ordering mode" href="#dt-ordering-mode"><ins class="diff-new">ordering
 mode</ins></a> <ins class="diff-new">is</ins>
<code><del class="diff-old">return</del> <ins class="diff-chg">ordered</ins></code>
 <del class="diff-old">clause is
invoked for each tuple, creating the following output:</del>
<ins class="diff-chg">):</ins></p>
<div class="exampleInner">
<pre><del class="diff-old">&lt;out&gt;
   &lt;one/&gt;
&lt;/out&gt;
&lt;out&gt;
   &lt;two/&gt;
&lt;/out&gt;
&lt;out&gt;
   &lt;three/&gt;
&lt;/out&gt;
</del>
<ins class="diff-chg">($x = 1, $y = 1, $j = 1)
($x = 1, $y = 2, $j = 2)
($x = 1, $y = 3, $j = 3)
($x = 2, $y = 2, $j = 1)
($x = 2, $y = 3, $j = 2)
($x = 3, $y = 3, $j = 1)
($x = 4, $y = (), $j = 0)
</ins>
</pre></div>
</li>
<li>
<p><del class="diff-old">The following</del> <ins class="diff-chg">This</ins>
 example <del class="diff-old">illustrates</del> <ins class="diff-chg">shows</ins>
 how
<del class="diff-old">binding tuples are generated by</del> a
<code>for</code> clause that <del class="diff-old">contains
multiple</del> <ins class="diff-chg">binds two</ins> variables
<del class="diff-old">when ordering mode</del> is <ins class="diff-new">semantically
 equivalent to two</ins> <code><del class="diff-old">ordered .</del> <ins
 class="diff-chg">for</ins></code>
<ins class="diff-chg">clauses that bind one variable each. We
assume that this</ins> <code><ins class="diff-chg">for</ins></code>
<ins class="diff-chg">clause occurs at the beginning of a FLWOR
expression. It is equivalent to an initial single-variable</ins>
<code><ins class="diff-chg">for</ins></code> <ins class="diff-chg">clause
 that provides an input tuple stream to an
intermediate single-variable</ins> <code><ins class="diff-chg">for</ins></code>
 <ins class="diff-chg">clause.</ins></p>
<div class="exampleInner">
<pre><del class="diff-old">for $i in (1, 2), $j in (3, 4)
</del>
<ins class="diff-chg">for $x in (1, 2, 3, 4), $y in ($x to 3)
</ins>
</pre></div>
<p><del class="diff-old">The</del> <ins class="diff-chg">Output</ins> 
tuple stream <del class="diff-old">generated by the above</del> <ins 
class="diff-chg">(assuming</ins> <a title="ordering mode" 
href="#dt-ordering-mode"><ins class="diff-chg">ordering mode</ins></a>
<ins class="diff-chg">is</ins> <code><del class="diff-old">for</del> <ins
 class="diff-chg">ordered</ins></code>
<del class="diff-old">clause is as follows:</del> <ins class="diff-chg">):</ins></p>
<div class="exampleInner">
<pre><del class="diff-old">($i = 1, $j = 3)
($i = 1, $j = 4)
($i = 2, $j = 3)
($i = 2, $j = 4)
</del>
<ins class="diff-chg">($x = 1, $y = 1)
($x = 1, $y = 2)
($x = 1, $y = 3)
($x = 2, $y = 2)
($x = 2, $y = 3)
($x = 3, $y = 3)
</ins>
</pre></div>
</li>
</ul>
<p><del class="diff-old">If</del> <ins class="diff-chg">In the
above examples, if</ins> <a title="ordering mode" 
href="#dt-ordering-mode">ordering mode</a> <del class="diff-old">were</del>
 <ins class="diff-chg">had been</ins>
<code>unordered</code> , the <del class="diff-old">for clause in
the above example</del> <ins class="diff-chg">output tuple
streams</ins> would <del class="diff-old">generate</del>
<ins class="diff-chg">have consisted of</ins> the same <del 
class="diff-old">tuple stream</del> <ins class="diff-chg">tuples, with
the same values for the</ins> <a title="positional variable" 
href="#dt-positional-variable"><ins class="diff-chg">positional
variables</ins></a> , but the <del class="diff-old">order</del>
<ins class="diff-chg">ordering</ins> of the tuples would
<del class="diff-old">be</del> <ins class="diff-chg">have
been</ins> <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a> .</p>
<p><ins class="diff-new">A</ins> <code><ins class="diff-new">for</ins></code>
 <ins class="diff-new">clause may
contain one or more</ins> <a title="type declaration" 
href="#dt-type-declaration"><ins class="diff-new">type
declarations</ins></a> ,<ins class="diff-new">identified by the
keyword</ins> <code><ins class="diff-new">as</ins></code> . The
<del class="diff-old">scope</del> <ins class="diff-chg">semantics
of</ins> <a title="type declaration" href="#dt-type-declaration"><ins 
class="diff-chg">type
declarations</ins></a> <ins class="diff-chg">are defined in</ins>
<a href="#id-binding-rules"><b><ins class="diff-chg">3.9.1 Variable
Bindings</ins></b></a> .</p>
</div>
<div class="div3">
<h4><a id="id-xquery-let-clause" name="id-xquery-let-clause"></a><ins 
class="diff-chg">3.9.3 Let
Clause</ins></h4>
<h5><a id="N15237" name="N15237"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="noid_N15289.doc-xquery11-LetClause" 
name="noid_N15289.doc-xquery11-LetClause"></a><ins class="diff-chg">[48]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">LetClause</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"let"</ins> <a 
href="#prod-xquery11-LetBinding"><ins class="diff-chg">LetBinding</ins></a>
 <ins class="diff-chg">(","</ins>
<a href="#prod-xquery11-LetBinding"><ins class="diff-chg">LetBinding</ins></a>
 <ins class="diff-chg">)*</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N1528C.doc-xquery11-LetBinding" 
name="noid_N1528C.doc-xquery11-LetBinding"></a><ins class="diff-chg">[49]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">LetBinding</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"$"</ins> <a 
href="#doc-xquery11-VarName"><ins class="diff-chg">VarName</ins></a>
<a href="#doc-xquery11-TypeDeclaration"><ins class="diff-chg">TypeDeclaration</ins></a>
 <ins class="diff-chg">?
":="</ins> <a href="#doc-xquery11-ExprSingle"><ins class="diff-chg">ExprSingle</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N1528F.doc-xquery11-TypeDeclaration" 
name="noid_N1528F.doc-xquery11-TypeDeclaration"></a><ins 
class="diff-chg">[168]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">TypeDeclaration</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"as"</ins> <a 
href="#doc-xquery11-SequenceType"><ins class="diff-chg">SequenceType</ins></a></code></td>
</tr>
</tbody>
</table>
<p><ins class="diff-chg">The purpose</ins> of a <code><ins 
class="diff-new">let</ins></code> <ins class="diff-new">clause is to 
bind
values to one or more variables. Each</ins> variable <ins 
class="diff-new">is</ins> bound <del class="diff-old">in</del>
<ins class="diff-chg">to the result of evaluating an
expression.</ins></p>
<p><ins class="diff-chg">If</ins> a <code><del class="diff-old">for</del>
 <ins class="diff-chg">let</ins></code>
<del class="diff-old">or</del> <ins class="diff-chg">clause
contains multiple variables, it is semantically equivalent to
multiple</ins> <code>let</code> <ins class="diff-new">clauses, each
containing a single variable. For example, the</ins> clause
<del class="diff-old">comprises all subexpressions</del></p>
<div class="exampleInner">
<pre><ins class="diff-chg">let $x := $expr1, $y := $expr2
</ins>
</pre></div>
<p><ins class="diff-chg">is semantically equivalent to the
following sequence of clauses:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
let $x := $expr1 
let $y := $expr2
</ins>
</pre></div>
<p><ins class="diff-chg">In the remainder</ins> of <ins class="diff-new">this
 section, we define</ins> the <ins class="diff-new">semantics of a</ins>
 <code><ins class="diff-new">let</ins></code> <ins class="diff-new">clause</ins>
containing <del class="diff-old">FLWOR</del> <ins class="diff-chg">a 
single variable</ins> <em><ins class="diff-chg">V</ins></em> <ins 
class="diff-chg">and an
associated</ins> expression <del class="diff-old">that appear
after</del> <em><ins class="diff-chg">E</ins></em> .</p>
<p><ins class="diff-chg">If a single-variable</ins>
<code><ins class="diff-chg">let</ins></code> <ins class="diff-chg">clause
 is</ins> the <del class="diff-old">variable
binding. The scope does not include</del> <ins class="diff-chg">initial 
clause in a FLWOR expression, it simply
binds</ins> the <del class="diff-old">expression</del> <ins 
class="diff-chg">variable</ins> <em><ins class="diff-chg">V</ins></em> 
to
<del class="diff-old">which</del> the <del class="diff-old">variable is 
bound.</del> <ins class="diff-chg">result of
the expression</ins> <em><ins class="diff-chg">E</ins></em> . The
<del class="diff-old">following example illustrates how bindings
in</del> <ins class="diff-chg">result of the</ins>
<code><del class="diff-old">for</del> <ins class="diff-chg">let</ins></code>
 <del class="diff-old">and</del>
<ins class="diff-chg">clause is a tuple stream consisting of one
tuple with a single binding that binds</ins> <em><ins class="diff-chg">V</ins></em>
 <ins class="diff-chg">to the result
of</ins> <em><ins class="diff-chg">E</ins></em> .<ins class="diff-chg">This
 tuple stream serves as input to the next clause in
the FLWOR expression.</ins></p>
<p><ins class="diff-chg">If a single-variable</ins>
<code>let</code> <del class="diff-old">clauses may reference
variables that were bound</del> <ins class="diff-chg">clause is an
intermediate clause</ins> in <del class="diff-old">earlier clauses,
or</del> <ins class="diff-chg">a FLWOR expression, it adds a new
binding for variable</ins> <em><ins class="diff-chg">V</ins></em>
<ins class="diff-chg">to each tuple</ins> in <del class="diff-old">earlier</del>
 <ins class="diff-chg">the input tuple
stream. For each input tuple, the value bound to</ins>
<em><ins class="diff-chg">V</ins></em> <ins class="diff-chg">is the
result of evaluating expression</ins> <em><ins class="diff-chg">E</ins></em>
 ,<ins class="diff-chg">given the</ins>
bindings <ins class="diff-new">that are already present</ins> in
<ins class="diff-new">that input tuple. The resulting tuples
become</ins> the <del class="diff-old">same clause</del>
<ins class="diff-chg">output tuple stream</ins> of the <del 
class="diff-old">FLWOR expression:</del> <code><ins class="diff-chg">let</ins></code>
 <ins class="diff-chg">clause.</ins></p>
<del class="diff-old">for $x in $w, $a in f($x) let $y := g($a) for
$z in p($x, $y) return q($x, $y, $z)</del>
<p>The <del class="diff-old">for and</del> <ins class="diff-chg">number 
of tuples in the output tuple stream of an
intermediate</ins> <code>let</code> <del class="diff-old">clauses
of a given FLWOR expression may bind</del> <ins class="diff-chg">clause 
is</ins> the same <del class="diff-old">variable
name</del> <ins class="diff-chg">as the number of tuples in the
input tuple stream. The number of bindings in the output tuples is
one</ins> more than <del class="diff-old">once. In</del>
<ins class="diff-chg">the number of bindings in the input tuples,
unless the input tuples already contain bindings for</ins>
<em><ins class="diff-chg">V</ins></em> <ins class="diff-chg">;
in</ins> this case, <del class="diff-old">each</del> <ins 
class="diff-chg">the</ins> new binding <ins class="diff-new">for</ins>
<em><ins class="diff-new">V</ins></em> occludes <ins class="diff-new">(replaces)</ins>
 the <del class="diff-old">previous one,
which becomes inaccessible in</del> <ins class="diff-chg">earlier
binding for</ins> <em><ins class="diff-chg">V</ins></em>
,<ins class="diff-chg">and</ins> the <del class="diff-old">remainder</del>
 <ins class="diff-chg">number</ins> of
<del class="diff-old">the FLWOR expression.</del> <ins class="diff-chg">bindings
 is unchanged.</ins></p>
<p><del class="diff-old">Each variable bound</del> <ins class="diff-chg">A</ins>
 <code><ins class="diff-chg">let</ins></code>
<ins class="diff-chg">clause may contain one or more</ins>
<a title="type declaration" href="#dt-type-declaration"><ins 
class="diff-chg">type declarations</ins></a> ,<ins class="diff-chg">identified
 by the keyword</ins> <code><ins class="diff-chg">as</ins></code> .<ins 
class="diff-chg">The semantics of
type declarations are defined</ins> in <a href="#id-binding-rules"><b><ins
 class="diff-new">3.9.1 Variable
Bindings</ins></b></a> .</p>
<p><ins class="diff-new">The following code fragment illustrates
how</ins> a <code>for</code> <del class="diff-old">or</del>
<ins class="diff-chg">clause and a</ins> <code>let</code> clause
<del class="diff-old">may have</del> <ins class="diff-chg">can be
used together. The</ins> <code><ins class="diff-chg">for</ins></code> <ins
 class="diff-chg">clause
produces</ins> an <del class="diff-old">optional type declaration ,
which is</del> <ins class="diff-chg">initial tuple stream
containing</ins> a <del class="diff-old">type declared using</del>
<ins class="diff-chg">binding for variable</ins> <code><ins 
class="diff-chg">$d</ins></code> <ins class="diff-chg">to each 
department
number found in a given input document. The</ins> <code><ins 
class="diff-chg">let</ins></code> <ins class="diff-chg">clause adds an
additional binding to each tuple, binding variable</ins>
<code><ins class="diff-chg">$e</ins></code> <ins class="diff-chg">to a 
sequence of employees whose department number
matches</ins> the <del class="diff-old">syntax</del> <ins 
class="diff-chg">value of</ins> <code><ins class="diff-chg">$d</ins></code>
 in <ins class="diff-chg">that
tuple.</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
for $d in fn:doc("depts.xml")/depts/deptno
let $e := fn:doc("emps.xml")/emps/emp[deptno eq $d]
</ins>
</pre>
<del class="diff-old">2.5.3 SequenceType Syntax</del></div>
</div>
<div class="div3">
<h4><del class="diff-old">. If</del> <a id="id-windows" 
name="id-windows"></a> <ins class="diff-chg">3.9.4 Window
Clause</ins></h4>
<h5><a id="N152F3" name="N152F3"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="noid_N1531C.doc-xquery11-WindowClause" 
name="noid_N1531C.doc-xquery11-WindowClause"></a><ins class="diff-chg">[50]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">WindowClause</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"for" (</ins> <a 
href="#doc-xquery11-TumblingWindowClause"><ins class="diff-chg">TumblingWindowClause</ins></a>
 <ins class="diff-chg">|</ins> <a 
href="#doc-xquery11-SlidingWindowClause"><ins class="diff-chg">SlidingWindowClause</ins></a>
 <ins class="diff-chg">)</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N1531F.doc-xquery11-TumblingWindowClause" 
name="noid_N1531F.doc-xquery11-TumblingWindowClause"></a><ins 
class="diff-chg">[51]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">TumblingWindowClause</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"tumbling" "window" "$"</ins>
<a href="#doc-xquery11-VarName"><ins class="diff-chg">VarName</ins></a> <a
 href="#doc-xquery11-TypeDeclaration"><ins class="diff-chg">TypeDeclaration</ins></a>
 <ins class="diff-chg">?
"in"</ins> <a href="#doc-xquery11-ExprSingle"><ins class="diff-chg">ExprSingle</ins></a>
 <a href="#doc-xquery11-WindowStartCondition"><ins class="diff-chg">WindowStartCondition</ins></a>
 <a href="#doc-xquery11-WindowEndCondition"><ins class="diff-chg">WindowEndCondition</ins></a>
 <ins class="diff-chg">?</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N15322.doc-xquery11-SlidingWindowClause" 
name="noid_N15322.doc-xquery11-SlidingWindowClause"></a><ins 
class="diff-chg">[52]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">SlidingWindowClause</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"sliding" "window" "$"</ins>
<a href="#doc-xquery11-VarName"><ins class="diff-chg">VarName</ins></a> <a
 href="#doc-xquery11-TypeDeclaration"><ins class="diff-chg">TypeDeclaration</ins></a>
 <ins class="diff-chg">?
"in"</ins> <a href="#doc-xquery11-ExprSingle"><ins class="diff-chg">ExprSingle</ins></a>
 <a href="#doc-xquery11-WindowStartCondition"><ins class="diff-chg">WindowStartCondition</ins></a>
 <a href="#doc-xquery11-WindowEndCondition"><ins class="diff-chg">WindowEndCondition</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N15325.doc-xquery11-WindowStartCondition" 
name="noid_N15325.doc-xquery11-WindowStartCondition"></a><ins 
class="diff-chg">[53]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">WindowStartCondition</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"start"</ins> <a 
href="#doc-xquery11-WindowVars"><ins class="diff-chg">WindowVars</ins></a>
 <ins class="diff-chg">"when"</ins>
<a href="#doc-xquery11-ExprSingle"><ins class="diff-chg">ExprSingle</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N15328.doc-xquery11-WindowEndCondition" 
name="noid_N15328.doc-xquery11-WindowEndCondition"></a><ins 
class="diff-chg">[54]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">WindowEndCondition</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"only"? "end"</ins> <a 
href="#doc-xquery11-WindowVars"><ins class="diff-chg">WindowVars</ins></a>
 <ins class="diff-chg">"when"</ins>
<a href="#doc-xquery11-ExprSingle"><ins class="diff-chg">ExprSingle</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N1532B.doc-xquery11-WindowVars" 
name="noid_N1532B.doc-xquery11-WindowVars"></a><ins class="diff-chg">[55]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">WindowVars</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">("$"</ins> <a 
href="#doc-xquery11-CurrentItem"><ins class="diff-chg">CurrentItem</ins></a>
 <ins class="diff-chg">)?</ins>
<a href="#doc-xquery11-PositionalVar"><ins class="diff-chg">PositionalVar</ins></a>
 <ins class="diff-chg">?
("previous" "$"</ins> <a href="#doc-xquery11-PreviousItem"><ins 
class="diff-chg">PreviousItem</ins></a> <ins class="diff-chg">)? ("next"
"$"</ins> <a href="#doc-xquery11-NextItem"><ins class="diff-chg">NextItem</ins></a>
 <ins class="diff-chg">)?</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N1532E.doc-xquery11-CurrentItem" 
name="noid_N1532E.doc-xquery11-CurrentItem"></a><ins class="diff-chg">[56]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">CurrentItem</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N15331.doc-xquery11-PositionalVar" 
name="noid_N15331.doc-xquery11-PositionalVar"></a><ins class="diff-chg">[47]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">PositionalVar</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"at" "$"</ins> <a 
href="#doc-xquery11-VarName"><ins class="diff-chg">VarName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N15333.doc-xquery11-PreviousItem" 
name="noid_N15333.doc-xquery11-PreviousItem"></a><ins class="diff-chg">[57]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">PreviousItem</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N15336.doc-xquery11-NextItem" 
name="noid_N15336.doc-xquery11-NextItem"></a><ins class="diff-chg">[58]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">NextItem</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a></code></td>
</tr>
</tbody>
</table>
<p><ins class="diff-chg">Like a</ins> <code><ins class="diff-chg">for</ins></code>
 <ins class="diff-chg">clause, a</ins>
<code><ins class="diff-chg">window</ins></code> <ins class="diff-chg">clause
 iterates over its</ins> <a title="binding sequence" 
href="#dt-binding-sequence"><ins class="diff-chg">binding sequence</ins></a>
 <ins class="diff-chg">and
generates a sequence of tuples. In</ins> the <del class="diff-old">type</del>
 <ins class="diff-chg">case</ins> of a
<del class="diff-old">value</del> <code><ins class="diff-chg">window</ins></code>
 <ins class="diff-chg">clause, each
tuple represents a window. [</ins> <a title="window" id="dt-window" 
name="dt-window"><ins class="diff-chg">Definition</ins></a>
:<ins class="diff-chg">A</ins> <b><ins class="diff-chg">window</ins></b>
 <ins class="diff-chg">is a sequence of
consecutive items drawn from the</ins> <a title="binding sequence" 
href="#dt-binding-sequence"><ins class="diff-chg">binding
sequence</ins></a> .]<ins class="diff-chg">Each window is
represented by at least one and at most nine</ins> bound
<ins class="diff-new">variables. The variables have user-specified
names, but their roles are as follows:</ins></p>
<ul>
<li>
<p><em><ins class="diff-new">Window-variable:</ins></em>
<ins class="diff-new">Bound</ins> to the <del class="diff-old">variable 
does not match</del> <ins class="diff-chg">sequence of items from</ins> 
the <del class="diff-old">declared</del> <a title="binding sequence" 
href="#dt-binding-sequence"><ins class="diff-chg">binding
sequence</ins></a> <ins class="diff-chg">that comprise the
window.</ins></p>
</li>
<li>
<p><em><ins class="diff-chg">Start-item:</ins></em> <ins 
class="diff-chg">(Optional) Bound to the first item in the
window.</ins></p>
</li>
<li>
<p><em><ins class="diff-chg">Start-item-position:</ins></em>
<ins class="diff-chg">(Optional) Bound to the ordinal position of
the first window item in the</ins> <a title="binding sequence" 
href="#dt-binding-sequence"><ins class="diff-chg">binding
sequence</ins></a> .<em><ins class="diff-chg">Start-item-position</ins></em>
 <ins class="diff-chg">is
a</ins> <a title="positional variable" href="#dt-positional-variable"><ins
 class="diff-chg">positional
variable</ins></a> .<ins class="diff-chg">Its</ins> type
<del class="diff-old">according</del> <ins class="diff-chg">is</ins> <code><ins
 class="diff-chg">xs:integer</ins></code> ,<ins class="diff-chg">and
its</ins> <a title="expanded QName" href="#dt-expanded-qname"><ins 
class="diff-chg">expanded QName</ins></a>
<ins class="diff-chg">must be distinct from the</ins> <a title="expanded
 QName" href="#dt-expanded-qname"><ins class="diff-chg">expanded QName</ins></a>
 <ins class="diff-chg">of</ins>
<em><ins class="diff-chg">start-item</ins></em> <ins class="diff-chg">[</ins>
 <a title="err:XQST0089" href="#ERRXQST0089"><ins class="diff-chg">err:XQST0089</ins></a>
<ins class="diff-chg">].</ins></p>
</li>
<li>
<p><em><ins class="diff-chg">Start-previous-item:</ins></em>
<ins class="diff-chg">(Optional) Bound</ins> to the <del 
class="diff-old">rules for SequenceType matching ,</del> <ins 
class="diff-chg">item in the</ins> <a title="binding sequence" 
href="#dt-binding-sequence"><ins class="diff-chg">binding
sequence</ins></a> <ins class="diff-chg">that precedes the first
item in the window (empty sequence if none).</ins></p>
</li>
<li>
<p><em><ins class="diff-chg">Start-next-item:</ins></em>
<ins class="diff-chg">(Optional) Bound to the item in the</ins>
<a title="binding sequence" href="#dt-binding-sequence"><ins 
class="diff-chg">binding sequence</ins></a> <ins class="diff-chg">that
follows the first item in the window (empty sequence if
none).</ins></p>
</li>
<li>
<p><em><ins class="diff-chg">End-item:</ins></em> <ins class="diff-chg">(Optional)
 Bound to the last item in the
window.</ins></p>
</li>
<li>
<p><em><ins class="diff-chg">End-item-position:</ins></em>
<ins class="diff-chg">(Optional) Bound to the ordinal position of
the last window item in the</ins> <a title="binding sequence" 
href="#dt-binding-sequence"><ins class="diff-chg">binding
sequence</ins></a> .<em><ins class="diff-chg">End-item-position</ins></em>
 <ins class="diff-chg">is</ins> a <a title="positional variable" 
href="#dt-positional-variable"><ins class="diff-chg">positional
variable</ins></a> .<ins class="diff-chg">Its</ins> type
<ins class="diff-new">is</ins> <code><ins class="diff-new">xs:integer</ins></code>
 ,<ins class="diff-new">and
its</ins> <a title="expanded QName" href="#dt-expanded-qname"><ins 
class="diff-new">expanded QName</ins></a>
<ins class="diff-new">must be distinct from the</ins> <a title="expanded
 QName" href="#dt-expanded-qname"><ins class="diff-new">expanded QName</ins></a>
 <ins class="diff-new">of</ins>
<em><ins class="diff-new">end-item</ins></em> <ins class="diff-new">[</ins>
 <a title="err:XQST0089" href="#ERRXQST0089"><ins class="diff-new">err:XQST0089</ins></a>
<ins class="diff-new">].</ins></p>
</li>
<li>
<p><em><ins class="diff-new">End-previous-item:</ins></em>
<ins class="diff-new">(Optional) Bound to the item in the</ins>
<a title="binding sequence" href="#dt-binding-sequence"><ins 
class="diff-new">binding sequence</ins></a> <ins class="diff-new">that
precedes the last item in the window (empty sequence if
none).</ins></p>
</li>
<li>
<p><em><ins class="diff-new">End-next-item:</ins></em> <ins 
class="diff-new">(Optional) Bound to the item in the</ins> <a 
title="binding sequence" href="#dt-binding-sequence"><ins 
class="diff-new">binding sequence</ins></a> <ins class="diff-new">that
follows the last item in the window (empty sequence if
none).</ins></p>
</li>
</ul>
<p><ins class="diff-new">All variables in a</ins> <code><ins 
class="diff-new">window</ins></code> <ins class="diff-new">clause must
have distinct names; otherwise a</ins> <a title="static error" 
href="#dt-static-error"><ins class="diff-new">static</ins>
error</a> is raised [ <del class="diff-old">err:XPTY0004</del>
<a title="err:XQST0103" href="#ERRXQST0103"><ins class="diff-chg">err:XQST0103</ins></a>
 ]. <del class="diff-old">For
example, the</del></p>
<p><ins class="diff-chg">The</ins> following <del class="diff-old">expression
 raises</del> <ins class="diff-chg">is an
example of</ins> a <del class="diff-old">type error because</del>
<code><ins class="diff-chg">window</ins></code> <ins class="diff-chg">clause
 that binds nine variables to</ins> the
<del class="diff-old">variable</del> <ins class="diff-chg">roles
listed above. In this example, the variables are named</ins>
<code><del class="diff-old">$salary</del> <ins class="diff-chg">$w</ins></code>
 ,<code><ins class="diff-chg">$s</ins></code> ,<code><ins 
class="diff-chg">$spos</ins></code> ,<code><ins class="diff-chg">$sprev</ins></code>
 ,<code><ins class="diff-chg">$snext</ins></code> ,<code><ins 
class="diff-chg">$e</ins></code> ,<code><ins class="diff-chg">$epos</ins></code>
 ,<code><ins class="diff-chg">$eprev</ins></code> ,<ins class="diff-chg">and</ins>
<code><ins class="diff-chg">$enext</ins></code> <del class="diff-old">has</del>
 <ins class="diff-chg">respectively. A</ins>
<code><ins class="diff-chg">window</ins></code> <ins class="diff-chg">clause
 always binds the window variable, but typically
binds only</ins> a <del class="diff-old">type declaration
that</del> <ins class="diff-chg">subset of the other
variables.</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
for tumbling window $w in (2, 4, 6, 8, 10)
start $s at $spos previous $sprev next $snext when true() end $e at
$epos previous $eprev next $enext when true()
</ins>
</pre></div>
<p><ins class="diff-chg">Windows are created by iterating over the
items in the</ins> <a title="binding sequence" 
href="#dt-binding-sequence"><ins class="diff-chg">binding
sequence</ins></a> ,<ins class="diff-chg">in order, identifying the
start item and the end item of each window by evaluating the</ins>
<a href="#doc-xquery11-WindowStartCondition"><ins class="diff-chg">WindowStartCondition</ins></a>
 <ins class="diff-chg">and
the</ins> <a href="#doc-xquery11-WindowEndCondition"><ins 
class="diff-chg">WindowEndCondition</ins></a> .<ins class="diff-chg">Each
of
 these conditions</ins> is <del class="diff-old">not</del>
satisfied <del class="diff-old">by</del> <ins class="diff-chg">if</ins> 
the <a title="effective boolean value" href="#dt-ebv"><ins 
class="diff-new">effective boolean</ins> value</a>
<ins class="diff-new">of the expression following the</ins>
<code><ins class="diff-new">when</ins></code> <ins class="diff-new">keyword
 is</ins> <code><ins class="diff-new">true</ins></code> .<ins 
class="diff-new">The start item
of the window is an item</ins> that <ins class="diff-new">satisfies
the</ins> <a href="#doc-xquery11-WindowStartCondition"><ins 
class="diff-new">WindowStartCondition</ins></a> <ins class="diff-new">(see</ins>
 <a href="#id-tumbling-windows"><b><ins class="diff-new">3.9.4.1 
Tumbling Windows</ins></b></a> <ins class="diff-new">and</ins> <a 
href="#id-sliding-windows"><b><ins class="diff-new">3.9.4.2 Sliding 
Windows</ins></b></a> <ins class="diff-new">for a more complete 
explanation.) The end item of the
window</ins> is <ins class="diff-new">the first item in the</ins>
<a title="binding sequence" href="#dt-binding-sequence"><ins 
class="diff-new">binding sequence</ins></a> ,<ins class="diff-new">beginning
 with the start item, that satisfies the</ins>
<a href="#doc-xquery11-WindowEndCondition"><ins class="diff-new">WindowEndCondition</ins></a>
 <ins class="diff-new">(again, see</ins> <a href="#id-tumbling-windows"><b><ins
 class="diff-new">3.9.4.1 Tumbling
Windows</ins></b></a> <ins class="diff-new">and</ins> <a 
href="#id-sliding-windows"><b><ins class="diff-new">3.9.4.2 Sliding
Windows</ins></b></a> <ins class="diff-new">for more details.) Each
window contains its start item, its end item, and all items that
occur between them in the</ins> <a title="binding sequence" 
href="#dt-binding-sequence"><ins class="diff-new">binding
sequence</ins></a> .<ins class="diff-new">If the end item is the
start item, then the window contains only one item. If a start item
is identified, but no following item in the</ins> <a title="binding 
sequence" href="#dt-binding-sequence"><ins class="diff-new">binding 
sequence</ins></a> <ins class="diff-new">satisfies the</ins> <a 
href="#doc-xquery11-WindowEndCondition"><ins class="diff-new">WindowEndCondition</ins></a>
 ,<ins class="diff-new">then
the</ins> <code><ins class="diff-new">only</ins></code> <ins 
class="diff-new">keyword determines whether a window is generated:
if</ins> <code><ins class="diff-new">only end</ins></code>
<ins class="diff-new">is specified, then no window is generated;
otherwise, the end item is set to the last item in the</ins>
<a title="binding sequence" href="#dt-binding-sequence"><ins 
class="diff-new">binding sequence</ins></a> <ins class="diff-new">and a
window is generated.</ins></p>
<p><ins class="diff-new">In the above example, the</ins> <a 
href="#doc-xquery11-WindowStartCondition"><ins class="diff-new">WindowStartCondition</ins></a>
 <ins class="diff-new">and</ins> <a 
href="#doc-xquery11-WindowEndCondition"><ins class="diff-new">WindowEndCondition</ins></a>
 <ins class="diff-new">are
both</ins> <code><ins class="diff-new">true()</ins></code>
,<ins class="diff-new">which causes each tuple in the</ins>
<a title="binding sequence" href="#dt-binding-sequence"><ins 
class="diff-new">binding sequence</ins></a> <ins class="diff-new">to be
in a separate window. Typically, the</ins> <a 
href="#doc-xquery11-WindowStartCondition"><ins class="diff-new">WindowStartCondition</ins></a>
 <ins class="diff-new">and</ins> <a 
href="#doc-xquery11-WindowEndCondition"><ins class="diff-new">WindowEndCondition</ins></a>
 <ins class="diff-new">are
expressed in terms of</ins> bound <ins class="diff-new">variables.
For example, the following</ins> <a 
href="#doc-xquery11-WindowStartCondition"><ins class="diff-new">WindowStartCondition</ins></a>
 <ins class="diff-new">might be used</ins> to <ins class="diff-new">start
 a new
window for every item in</ins> the <del class="diff-old">variable:</del>
 <a title="binding sequence" href="#dt-binding-sequence"><ins 
class="diff-chg">binding
sequence</ins></a> <ins class="diff-chg">that is larger than both
the previous item and the following item:</ins></p>
<div class="exampleInner">
<pre><del class="diff-old">let $salary as xs:decimal :=  "cat"
return $salary * 2
</del>
<ins class="diff-chg">start $s previous $sprev next $snext 
   when $s &gt; $sprev and $s &gt; $snext
</ins>
</pre></div>
<p><del class="diff-old">Each variable</del> <ins class="diff-chg">The 
scoping rules for the variables</ins> bound
<del class="diff-old">in</del> <ins class="diff-chg">by</ins> a
<code><del class="diff-old">for</del> <ins class="diff-chg">window</ins></code>
 clause <del class="diff-old">may
have an associated positional variable</del> <ins class="diff-chg">are 
as follows:</ins></p>
<ul>
<li>
<p><ins class="diff-chg">In the</ins> <code><ins class="diff-chg">when</ins></code>
 <ins class="diff-chg">-expression of
the</ins> <a href="#doc-xquery11-WindowStartCondition"><ins 
class="diff-chg">WindowStartCondition</ins></a> ,<ins class="diff-chg">the
 following variables (identified here by their roles)
are in scope (if bound):</ins> <em><ins class="diff-chg">start-item, 
start-item-position, start-previous-item,
start-next-item.</ins></em></p>
</li>
<li>
<p><ins class="diff-chg">In the</ins> <code><ins class="diff-chg">when</ins></code>
 <ins class="diff-chg">-expression of
the</ins> <a href="#doc-xquery11-WindowEndCondition"><ins 
class="diff-chg">WindowEndCondition</ins></a> ,<ins class="diff-chg">the
following variables (identified here by their roles) are in scope
(if bound):</ins> <em><ins class="diff-chg">start-item,
start-item-position, start-previous-item, start-next-item,
end-item, end-item-position, end-previous-item,
end-next-item.</ins></em></p>
</li>
<li>
<p><ins class="diff-chg">In the clauses of the FLWOR
expression</ins> that <del class="diff-old">is bound at</del>
<ins class="diff-chg">follow</ins> the <del class="diff-old">same
time. The name</del> <code><ins class="diff-chg">window</ins></code> <ins
 class="diff-chg">clause, all
nine</ins> of the <del class="diff-old">positional variable is
preceded</del> <ins class="diff-chg">variables bound</ins> by the
<code><ins class="diff-new">window</ins></code> <ins class="diff-new">clause
 (including</ins> <em><ins class="diff-new">window-variable</ins></em> <ins
 class="diff-new">) are
in scope (if bound).</ins></p>
</li>
</ul>
<p><ins class="diff-new">In a</ins> <code><ins class="diff-new">window</ins></code>
 <ins class="diff-new">clause,
the</ins> keyword <code><del class="diff-old">at . The positional
variable always has an implied type</del> <ins class="diff-chg">tumbling</ins></code>
 <ins class="diff-chg">or</ins>
<code><ins class="diff-chg">sliding</ins></code> <ins class="diff-chg">determines
 the way in which the starting item</ins> of
<ins class="diff-new">each window is identified, as explained in
the following sections.</ins></p>
<div class="div4">
<h5><a id="id-tumbling-windows" name="id-tumbling-windows"></a><ins 
class="diff-new">3.9.4.1 Tumbling
Windows</ins></h5>
<p><ins class="diff-new">If the window type is</ins>
<code><del class="diff-old">xs:integer . As</del> <ins class="diff-chg">tumbling</ins></code>
 ,<ins class="diff-chg">then
windows never overlap. The search for the start of the first window
begins at the beginning of the</ins> <a title="binding sequence" 
href="#dt-binding-sequence"><ins class="diff-chg">binding
sequence</ins></a> .<ins class="diff-chg">After each window is
generated, the search for the start of the next window begins with
the item in the</ins> <a title="binding sequence" 
href="#dt-binding-sequence"><ins class="diff-chg">binding
sequence</ins></a> <ins class="diff-chg">that occurs after the
ending item of the last generated window. Thus, no item that occurs
in one window can occur in another window drawn from the same</ins>
<a title="binding sequence" href="#dt-binding-sequence"><ins 
class="diff-chg">binding sequence</ins></a> .<ins class="diff-chg">In</ins>
 a <del class="diff-old">variable iterates
over</del> <ins class="diff-chg">tumbling window clause,</ins> the
<code><ins class="diff-new">end</ins></code> <ins class="diff-new">clause
 is optional; if it is omitted, the</ins>
<code><ins class="diff-new">start</ins></code> <ins class="diff-new">clause
 is applied to identify all potential
starting</ins> items in <del class="diff-old">its</del> <ins 
class="diff-chg">the</ins> <a title="binding sequence" 
href="#dt-binding-sequence">binding sequence</a> , <del class="diff-old">its
 positional variable iterates over the integers</del>
<ins class="diff-chg">and a window is constructed for each starting
item, including all items from</ins> that <del class="diff-old">represent</del>
 <ins class="diff-chg">starting item up
to</ins> the <del class="diff-old">ordinal positions</del>
<ins class="diff-chg">item before the next window's starting item,
or the end</ins> of <del class="diff-old">those</del> <ins 
class="diff-chg">the</ins> <a title="binding sequence" 
href="#dt-binding-sequence"><ins class="diff-chg">binding
sequence</ins></a> ,<ins class="diff-chg">whichever comes
first.</ins></p>
<p><ins class="diff-chg">The following examples illustrate the use
of tumbling windows.</ins></p>
<ul>
<li>
<p><ins class="diff-chg">Show non-overlapping windows of three
items.</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
for tumbling window $w in (2, 4, 6, 8, 10, 12, 14)
    start at $s when fn:true()
    only end at $e when $e - $s eq 2
return &lt;window&gt;{ $w }&lt;/window&gt;
</ins>
</pre></div>
<p><ins class="diff-chg">Result of the above query:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
&lt;window&gt;2 4 6&lt;/window&gt;
&lt;window&gt;8 10 12&lt;/window&gt;
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-chg">Show averages of non-overlapping
three-item windows.</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
for tumbling window $w in (2, 4, 6, 8, 10, 12, 14)
    start at $s when fn:true()
    only end at $e when $e - $s eq 2
return avg($w)
</ins>
</pre></div>
<p><ins class="diff-chg">Result of the above query:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
4 10
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-chg">Show first and last</ins> items in
<ins class="diff-new">each window of three items.</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
for tumbling window $w in (2, 4, 6, 8, 10, 12, 14)
    start $first at $s when fn:true()
    only end $last at $e when $e - $s eq 2
return &lt;window&gt;{ $first, $last }&lt;/window&gt;
</ins>
</pre></div>
<p><ins class="diff-new">Result of</ins> the <del class="diff-old">binding
 sequence,</del> <ins class="diff-chg">above
query:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
&lt;window&gt;2 6&lt;/window&gt;
&lt;window&gt;8 12&lt;/window&gt;
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-chg">Show non-overlapping windows of up to
three items (illustrates</ins> <code><ins class="diff-chg">end</ins></code>
 <ins class="diff-chg">clause without
the</ins> <code><ins class="diff-chg">only</ins></code> <ins 
class="diff-chg">keyword).</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
for tumbling window $w in (2, 4, 6, 8, 10, 12, 14)
    start at $s when fn:true()
    end at $e when $e - $s eq 2
return &lt;window&gt;{ $w }&lt;/window&gt;
</ins>
</pre></div>
<p><ins class="diff-chg">Result of the above query:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
&lt;window&gt;2 4 6&lt;/window&gt;
&lt;window&gt;8 10 12&lt;/window&gt;
&lt;window&gt;14&lt;/window&gt;
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-chg">Show non-overlapping windows of up to
three items (illustrates use of</ins> <code><ins class="diff-chg">start</ins></code>
 <ins class="diff-chg">without
explicit</ins> <code><ins class="diff-chg">end</ins></code>
<ins class="diff-chg">).</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
for tumbling window $w in (2, 4, 6, 8, 10, 12, 14)
    start at $s when $s mod 3 = 1
return &lt;window&gt;{ $w }&lt;/window&gt;
</ins>
</pre></div>
<p><ins class="diff-chg">Result of the above query:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
&lt;window&gt;2 4 6&lt;/window&gt;
&lt;window&gt;8 10 12&lt;/window&gt;
&lt;window&gt;14&lt;/window&gt;
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-chg">Show non-overlapping sequences</ins>
starting with <del class="diff-old">1. The expanded QName</del>
<ins class="diff-chg">a number divisible by 3.</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
for tumbling window $w in (2, 4, 6, 8, 10, 12, 14)
    start $first when $first mod 3 = 0
return &lt;window&gt;{ $w }&lt;/window&gt;
</ins>
</pre></div>
<p><ins class="diff-chg">Result of the above query:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
&lt;window&gt;6 8 10&lt;/window&gt;
&lt;window&gt;12 14&lt;/window&gt;
</ins>
</pre></div>
</li>
</ul>
</div>
<div class="div4">
<h5><a id="id-sliding-windows" name="id-sliding-windows"></a><ins 
class="diff-chg">3.9.4.2 Sliding
Windows</ins></h5>
<p><ins class="diff-chg">If the window type is</ins>
<code><ins class="diff-chg">sliding window</ins></code>
,<ins class="diff-chg">then windows may overlap. Every item in
the</ins> <a title="binding sequence" href="#dt-binding-sequence"><ins 
class="diff-chg">binding
sequence</ins></a> <ins class="diff-chg">that satisfies the</ins>
<a href="#doc-xquery11-WindowStartCondition"><ins class="diff-chg">WindowStartCondition</ins></a>
 <ins class="diff-chg">is
the starting item</ins> of a <del class="diff-old">positional
variable must</del> <ins class="diff-chg">new window. Thus, a given
item may</ins> be <del class="diff-old">distinct</del> <ins 
class="diff-chg">found in multiple windows drawn</ins> from the
<del class="diff-old">expanded QName</del> <ins class="diff-chg">same</ins>
 <a title="binding sequence" href="#dt-binding-sequence"><ins 
class="diff-chg">binding
sequence</ins></a> .</p>
<p><ins class="diff-chg">The following examples illustrate the use
of sliding windows.</ins></p>
<ul>
<li>
<p><ins class="diff-chg">Show windows of three items.</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
for sliding window $w in (2, 4, 6, 8, 10, 12, 14)
    start at $s when fn:true()
    only end at $e when $e - $s eq 2
return &lt;window&gt;{ $w }&lt;/window&gt;
</ins>
</pre></div>
<p><ins class="diff-chg">Result</ins> of the <del class="diff-old">variable
 with which it is associated [ err:XQST0089
].</del> <ins class="diff-chg">above query:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
&lt;window&gt;2 4 6&lt;/window&gt;
&lt;window&gt;4 6 8&lt;/window&gt;
&lt;window&gt;6 8 10&lt;/window&gt;
&lt;window&gt;8 10 12&lt;/window&gt;
&lt;window&gt;10 12 14&lt;/window&gt;
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-chg">Show moving averages of three
items.</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">for sliding window $w in (2, 4, 6, 8, 10, 12, 14)
    start at $s when fn:true()
    only end at $e when $e - $s eq 2
return avg($w)
</ins>
</pre></div>
<p><del class="diff-old">Positional variables are illustrated
by</del> <ins class="diff-chg">Result of</ins> the <del class="diff-old">following</del>
 <ins class="diff-chg">above
query:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
4 6 8 10 12
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-chg">Show overlapping windows of up to three
items (illustrates</ins> <code><del class="diff-old">for</del>
<ins class="diff-chg">end</ins></code> <del class="diff-old">clause:</del>
 <ins class="diff-chg">clause without
the</ins> <code><ins class="diff-chg">only</ins></code> <ins 
class="diff-chg">keyword).</ins></p>
<div class="exampleInner">
<pre><del class="diff-old">for $car at $i in ("Ford", "Chevy"),
    $pet at $j in ("Cat", "Dog")
</del>
<ins class="diff-chg">for sliding window $w in (2, 4, 6, 8, 10, 12, 14)
    start at $s when fn:true()
    end at $e when $e - $s eq 2
return &lt;window&gt;{ $w }&lt;/window&gt;
</ins>
</pre></div>
<p><ins class="diff-new">Result of the above query:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
&lt;window&gt;2 4 6&lt;/window&gt;
&lt;window&gt;4 6 8&lt;/window&gt;
&lt;window&gt;6 8 10&lt;/window&gt;
&lt;window&gt;8 10 12&lt;/window&gt;
&lt;window&gt;10 12 14&lt;/window&gt;
&lt;window&gt;12 14&lt;/window&gt;
&lt;window&gt;14&lt;/window&gt;
</ins>
</pre></div>
</li>
</ul>
</div>
<div class="div4">
<h5><a id="id-effects-of-window-clauses" 
name="id-effects-of-window-clauses"></a><ins class="diff-new">3.9.4.3
Effects of Window Clauses on the Tuple Stream</ins></h5>
<p><ins class="diff-new">The effects of a</ins> <code><ins 
class="diff-new">window</ins></code> <ins class="diff-new">clause on the
tuple stream are similar to the effects of a</ins>
<code><ins class="diff-new">for</ins></code> <ins class="diff-new">clause.
 As described in</ins> <a href="#id-windows"><b><ins class="diff-new">3.9.4
 Window
Clause</ins></b></a> ,<ins class="diff-new">a</ins>
<code><ins class="diff-new">window</ins></code> <ins class="diff-new">clause
 generates zero or more windows, each of which is
represented by at least one and at most nine bound
variables.</ins></p>
<p><ins class="diff-new">If the</ins> <code><ins class="diff-new">window</ins></code>
 <ins class="diff-new">clause is the
initial clause in a FLWOR expression, the bound variables that
describe each window become an output tuple. These tuples form the
initial tuple stream that serves as input to the next clause of the
FLWOR expression.</ins> If <a title="ordering mode" 
href="#dt-ordering-mode">ordering mode</a> is <code>ordered</code> , the
<ins class="diff-new">order of tuples in the</ins> tuple stream
<del class="diff-old">generated by</del> <ins class="diff-chg">is</ins> 
the <del class="diff-old">above</del>
<ins class="diff-chg">order in which their start items appear in
the</ins> <a title="binding sequence" href="#dt-binding-sequence"><ins 
class="diff-chg">binding
sequence</ins></a> <ins class="diff-chg">; otherwise the order of
the tuple stream is</ins> <a title="implementation dependent" 
href="#dt-implementation-dependent"><ins class="diff-chg">implementation-dependent</ins></a>
 .<ins class="diff-chg">The cardinality of the tuple stream is equal to 
the
number of windows.</ins></p>
<p><ins class="diff-chg">If a</ins> <code><del class="diff-old">for</del>
 <ins class="diff-chg">window</ins></code>
clause is <del class="diff-old">as follows: ($i = 1, $car = "Ford",
$j = 1, $pet = "Cat") ($i = 1, $car = "Ford", $j = 2, $pet = "Dog")
($i = 2, $car = "Chevy", $j = 1, $pet = "Cat") ($i = 2, $car =
"Chevy", $j = 2, $pet = "Dog")</del> <ins class="diff-chg">an
intermediate clause in a FLWOR expression, each input tuple
generates zero or more output tuples, each consisting of the
original bound variables of the input tuple plus the new bound
variables that represent one of the generated windows. For each
tuple</ins> <em><ins class="diff-chg">T</ins></em> <ins class="diff-chg">in
 the input tuple stream, the output tuple stream will
contain</ins> <em><ins class="diff-chg">N</ins> <sub><ins 
class="diff-chg">T</ins></sub></em> <ins class="diff-chg">tuples,
where</ins> <em><ins class="diff-chg">N</ins> <sub><ins class="diff-chg">T</ins></sub></em>
 <ins class="diff-chg">is the number
of windows generated by the</ins> <code><ins class="diff-chg">window</ins></code>
 <ins class="diff-chg">clause, given
the bindings in the input tuple</ins> <em><ins class="diff-chg">T</ins></em>
 .<ins class="diff-chg">Input tuples for
which no windows are generated are not represented in the output
tuple stream.</ins> If <a title="ordering mode" href="#dt-ordering-mode">ordering
 mode</a> is <code><ins class="diff-new">ordered</ins></code> ,<ins 
class="diff-new">the order of
tuples in the output stream is determined primarily by the order of
the input tuples from which they were derived, and secondarily by
the order in which their start items appear in the</ins> <a 
title="binding sequence" href="#dt-binding-sequence"><ins 
class="diff-new">binding sequence</ins></a> .<ins class="diff-new">If</ins>
 <a title="ordering mode" href="#dt-ordering-mode"><ins class="diff-new">ordering
 mode</ins></a>
<ins class="diff-new">is</ins> <code>unordered</code> , the order
of <ins class="diff-new">tuples in</ins> the <del class="diff-old">tuple</del>
 <ins class="diff-chg">output</ins> stream is
<a title="implementation dependent" href="#dt-implementation-dependent">implementation-dependent</a>
 .
<del class="diff-old">In addition, if</del></p>
<p><ins class="diff-chg">The following example illustrates</ins> a
<code><del class="diff-old">for</del> <ins class="diff-chg">window</ins></code>
 clause <del class="diff-old">contains subexpressions</del> that <ins 
class="diff-new">is the initial clause in a FLWOR expression. The 
example
is based on input data that consists of a sequence of closing stock
prices for a specific company. For this example we assume the
following input data (assume that the</ins> <code><ins class="diff-new">price</ins></code>
 <ins class="diff-new">elements have a
validated type of</ins> <code><ins class="diff-new">xs:decimal</ins></code>
 <ins class="diff-new">):</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
&lt;stock&gt;
  &lt;closing&gt; &lt;date&gt;2008-01-01&lt;/date&gt; &lt;price&gt;105&lt;/price&gt; &lt;/closing
  &lt;closing&gt; &lt;date&gt;2008-01-02&lt;/date&gt; &lt;price&gt;101&lt;/price&gt; &lt;/closing
  &lt;closing&gt; &lt;date&gt;2008-01-03&lt;/date&gt; &lt;price&gt;102&lt;/price&gt; &lt;/closing
  &lt;closing&gt; &lt;date&gt;2008-01-04&lt;/date&gt; &lt;price&gt;103&lt;/price&gt; &lt;/closing
  &lt;closing&gt; &lt;date&gt;2008-01-05&lt;/date&gt; &lt;price&gt;102&lt;/price&gt; &lt;/closing
  &lt;closing&gt; &lt;date&gt;2008-01-06&lt;/date&gt; &lt;price&gt;104&lt;/price&gt; &lt;/closing
&lt;/stock&gt;
</ins>
</pre></div>
<p><ins class="diff-new">A user wishes to find "run-ups,"
which</ins> are <del class="diff-old">affected by ordering mode
,</del> <ins class="diff-chg">defined as sequences of dates that
begin with a "low" and end with a "high" price (that is,</ins> the
<del class="diff-old">association</del> <ins class="diff-chg">stock
price begins to rise on the first day</ins> of <del class="diff-old">positional</del>
 <ins class="diff-chg">the run-up, and
continues to rise or remain even through the last day of the
run-up.) The following query uses a tumbling window to find run-ups
in the input data:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
for tumbling window $w in //closing
   start $first next $second when $first/price &lt; $second/price
   end $last next $beyond when $last/price &gt; $beyond/price
return
   &lt;run-up&gt;
      &lt;start-date&gt;{fn:data($first/date)}&lt;/start-date&gt;
      &lt;start-price&gt;{fn:data($first/price)}&lt;/start-price&gt;
      &lt;end-date&gt;{fn:data($last/date)}&lt;/end-date&gt;
      &lt;end-price&gt;{fn:data($last/price)}&lt;/end-price&gt;
   &lt;/run-up&gt;
</ins>
</pre></div>
<p><ins class="diff-chg">For our sample input data, this</ins>
<code><ins class="diff-chg">tumbling window</ins></code>
<ins class="diff-chg">clause generates a tuple stream consisting of
two tuples, each representing a window and containing five
bound</ins> variables <ins class="diff-new">named</ins>
<code><ins class="diff-new">$w</ins></code> ,<code><ins class="diff-new">$first</ins></code>
 ,<code><ins class="diff-new">$second</ins></code> ,<code><ins 
class="diff-new">$last</ins></code> ,<ins class="diff-new">and</ins>
<code><ins class="diff-new">$beyond</ins></code> .<ins class="diff-new">The</ins>
 <code><ins class="diff-new">return</ins></code> <ins class="diff-new">clause
 is
evaluated for each of these tuples, generating the following query
result:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
&lt;run-up&gt;
   &lt;start-date&gt;2008-01-02&lt;/start-date&gt;
   &lt;start-price&gt;101&lt;/start-price&gt;
   &lt;end-date&gt;2008-01-04&lt;/start-date&gt;
   &lt;end-price&gt;103&lt;/end-price&gt;
&lt;/run-up&gt;
&lt;run-up&gt;
   &lt;start-date&gt;2008-01-05&lt;/start-date&gt;
   &lt;start-price&gt;102&lt;/start-price&gt;
   &lt;end-date&gt;2008-01-06&lt;/start-date&gt;
   &lt;end-price&gt;104&lt;/end-price&gt;
&lt;/run-up&gt;
</ins>
</pre></div>
<p><ins class="diff-new">The following example illustrates a</ins>
<code><ins class="diff-new">window</ins></code> <ins class="diff-new">clause
 that is an intermediate clause in a FLWOR
expression. In this example, the input data contains closing stock
prices for several different companies, each identified by a
three-letter symbol. We assume the following input data (again
assuming that the type of the</ins> <code><ins class="diff-new">price</ins></code>
 <ins class="diff-new">element
is</ins> <code><ins class="diff-new">xs:decimal</ins></code>
<ins class="diff-new">):</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
&lt;stocks&gt;
  &lt;closing&gt; &lt;symbol&gt;ABC&lt;/symbol&gt; &lt;date&gt;2008-01-01&lt;/date&gt; &lt;price&gt;105&lt;/price&gt; &lt;/closing&gt;
  &lt;closing&gt; &lt;symbol&gt;DEF&lt;/symbol&gt; &lt;date&gt;2008-01-01&lt;/date&gt; &lt;price&gt;057&lt;/price&gt; &lt;/closing&gt;
  &lt;closing&gt; &lt;symbol&gt;ABC&lt;/symbol&gt; &lt;date&gt;2008-01-02&lt;/date&gt; &lt;price&gt;101&lt;/price&gt; &lt;/closing&gt;
  &lt;closing&gt; &lt;symbol&gt;DEF&lt;/symbol&gt; &lt;date&gt;2008-01-02&lt;/date&gt; &lt;price&gt;054&lt;/price&gt; &lt;/closing&gt;
  &lt;closing&gt; &lt;symbol&gt;ABC&lt;/symbol&gt; &lt;date&gt;2008-01-03&lt;/date&gt; &lt;price&gt;102&lt;/price&gt; &lt;/closing&gt;
  &lt;closing&gt; &lt;symbol&gt;DEF&lt;/symbol&gt; &lt;date&gt;2008-01-03&lt;/date&gt; &lt;price&gt;056&lt;/price&gt; &lt;/closing&gt;
  &lt;closing&gt; &lt;symbol&gt;ABC&lt;/symbol&gt; &lt;date&gt;2008-01-04&lt;/date&gt; &lt;price&gt;103&lt;/price&gt; &lt;/closing&gt;
  &lt;closing&gt; &lt;symbol&gt;DEF&lt;/symbol&gt; &lt;date&gt;2008-01-04&lt;/date&gt; &lt;price&gt;052&lt;/price&gt; &lt;/closing&gt;
  &lt;closing&gt; &lt;symbol&gt;ABC&lt;/symbol&gt; &lt;date&gt;2008-01-05&lt;/date&gt; &lt;price&gt;101&lt;/price&gt; &lt;/closing&gt;
  &lt;closing&gt; &lt;symbol&gt;DEF&lt;/symbol&gt; &lt;date&gt;2008-01-05&lt;/date&gt; &lt;price&gt;055&lt;/price&gt; &lt;/closing&gt;
  &lt;closing&gt; &lt;symbol&gt;ABC&lt;/symbol&gt; &lt;date&gt;2008-01-06&lt;/date&gt; &lt;price&gt;104&lt;/price&gt; &lt;/closing&gt;
  &lt;closing&gt; &lt;symbol&gt;DEF&lt;/symbol&gt; &lt;date&gt;2008-01-06&lt;/date&gt; &lt;price&gt;059&lt;/price&gt; &lt;/closing&gt;
&lt;/stocks&gt;
</ins>
</pre></div>
<p><ins class="diff-new">As in the previous example, we want to
find "run-ups," which are defined as sequences of dates that
begin</ins> with <del class="diff-old">items returned</del>
<ins class="diff-chg">a "low" and end with a "high" price for a
specific company. In this example, however, the input data consists
of stock prices for multiple companies. Therefore it is necessary
to isolate the stock prices of each company before forming windows.
This can be accomplished</ins> by <del class="diff-old">these
subexpressions</del> <ins class="diff-chg">an initial</ins>
<code><ins class="diff-chg">for</ins></code> <ins class="diff-chg">and</ins>
 <code><ins class="diff-chg">let</ins></code>
<ins class="diff-chg">clause, followed by a</ins> <code><ins 
class="diff-chg">window</ins></code> <ins class="diff-chg">clause, as
follows:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
for $symbol in fn:distinct-values(//symbol)
let $closings := //closing[symbol = $symbol]
for tumbling window $w in $closings
   start $first next $second when $first/price &lt; $second/price
   end $last next $beyond when $last/price &gt; $beyond/price
return
   &lt;run-up symbol="{$symbol}"&gt;
      &lt;start-date&gt;{fn:data($first/date)}&lt;/start-date&gt;
      &lt;start-price&gt;{fn:data($first/price)}&lt;/start-price&gt;
      &lt;end-date&gt;{fn:data($last/date)}&lt;/end-date&gt;
      &lt;end-price&gt;{fn:data($last/price)}&lt;/end-price&gt;
   &lt;/run-up&gt;
</ins>
</pre></div>
<div class="note">
<p class="prefix"><b><ins class="diff-chg">Note:</ins></b></p>
<p><ins class="diff-chg">In the above example, the</ins>
<code><ins class="diff-chg">for</ins></code> <ins class="diff-chg">and</ins>
 <code><ins class="diff-chg">let</ins></code>
<ins class="diff-chg">clauses could be rewritten as
follows:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
for $closings in //closing
let $symbol := $closings/symbol
group by $symbol
</ins>
</pre></div>
<p><ins class="diff-chg">The</ins> <code><ins class="diff-chg">group by</ins></code>
 <ins class="diff-chg">clause</ins>
is <del class="diff-old">implementation-dependent if ordering
mode</del> <ins class="diff-chg">described in</ins> <a 
href="#id-group-by"><b><ins class="diff-chg">3.9.7 Group By
Clause</ins></b></a> .</p>
</div>
<p><ins class="diff-chg">The</ins> <code><ins class="diff-chg">for</ins></code>
 <ins class="diff-chg">and</ins>
<code><ins class="diff-chg">let</ins></code> <ins class="diff-chg">clauses
 in this query generate an initial tuple stream
consisting of two tuples. In the first tuple,</ins>
<code><ins class="diff-chg">$symbol</ins></code> is <ins 
class="diff-new">bound to "ABC" and</ins> <code><del class="diff-old">unordered</del>
 <ins class="diff-chg">$closings</ins></code> <ins class="diff-chg">is 
bound to
the sequence of</ins> <code><ins class="diff-chg">closing</ins></code> <ins
 class="diff-chg">elements for
company ABC. In the second tuple,</ins> <code><ins class="diff-chg">$symbol</ins></code>
 <ins class="diff-chg">is bound to
"DEF" and</ins> <code><ins class="diff-chg">$closings</ins></code>
<ins class="diff-chg">is bound to the sequence of</ins>
<code><ins class="diff-chg">closing</ins></code> <ins class="diff-chg">elements
 for company DEF.</ins></p>
<p><ins class="diff-chg">The</ins> <code><ins class="diff-chg">window</ins></code>
 <ins class="diff-chg">clause
operates on this initial tuple stream, generating two windows for
the first tuple and two windows for the second tuple. The result is
a tuple stream consisting of four tuples, each with the following
bound variables:</ins> <code><ins class="diff-chg">$symbol</ins></code> ,<code><ins
 class="diff-chg">$closings</ins></code> ,<code><ins class="diff-chg">$w</ins></code>
 ,<code><ins class="diff-chg">$first</ins></code> ,<code><ins 
class="diff-chg">$second</ins></code> ,<code><ins class="diff-chg">$last</ins></code>
 ,<ins class="diff-chg">and</ins>
<code><ins class="diff-chg">$beyond</ins></code> . <ins class="diff-new">The</ins>
 <code><ins class="diff-new">return</ins></code> <ins class="diff-new">clause
 is then
evaluated for each of these tuples, generating the following query
result:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">&lt;run-up symbol="ABC"&gt;
   &lt;start-date&gt;2008-01-02&lt;/start-date&gt;
   &lt;start-price&gt;101&lt;/start-price&gt;
   &lt;end-date&gt;2008-01-04&lt;/start-date&gt;
   &lt;end-price&gt;103&lt;/end-price&gt;
&lt;/run-up&gt;
&lt;run-up symbol="ABC"&gt;
   &lt;start-date&gt;2008-01-05&lt;/start-date&gt;
   &lt;start-price&gt;101&lt;/start-price&gt;
   &lt;end-date&gt;2008-01-06&lt;/start-date&gt;
   &lt;end-price&gt;104&lt;/end-price&gt;
&lt;/run-up&gt;
&lt;run-up symbol="DEF"&gt;
   &lt;start-date&gt;2008-01-02&lt;/start-date&gt;
   &lt;start-price&gt;54&lt;/start-price&gt;
   &lt;end-date&gt;2008-01-03&lt;/start-date&gt;
   &lt;end-price&gt;56&lt;/end-price&gt;
&lt;/run-up&gt;
&lt;run-up symbol="DEF"&gt;
   &lt;start-date&gt;2008-01-04&lt;/start-date&gt;
   &lt;start-price&gt;52&lt;/start-price&gt;
   &lt;end-date&gt;2008-01-06&lt;/start-date&gt;
   &lt;end-price&gt;59&lt;/end-price&gt;
&lt;/run-up&gt;
</ins>
</pre></div>
</div>
</div>
<div class="div3">
<h4><a id="id-where" name="id-where"></a> <del class="diff-old">3.8.2</del>
 <ins class="diff-chg">3.9.5</ins> Where
Clause</h4>
<h5><a id="N15709" name="N15709"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="noid_N156B0.doc-xquery11-WhereClause" 
name="noid_N156B0.doc-xquery11-WhereClause"></a> <ins class="diff-new">[60]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">WhereClause</ins></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"where"</ins> <a 
href="#doc-xquery11-ExprSingle"><ins class="diff-new">ExprSingle</ins></a></code></td>
</tr>
</tbody>
</table>
<p><del class="diff-old">The optional</del> <ins class="diff-chg">A</ins>
 <code>where</code> clause serves as a filter for
the tuples <del class="diff-old">of variable bindings generated by
the for and let clauses.</del> <ins class="diff-chg">in its input
tuple stream.</ins> The expression in the <code>where</code>
clause, called the <b>where-expression</b> , is evaluated once for
each of these tuples. If the <a title="effective boolean value" 
href="#dt-ebv">effective boolean value</a> of the where-expression
is <code>true</code> , the tuple is retained <del class="diff-old">and 
its variable bindings are used</del> in <del class="diff-old">an 
execution of</del> the <del class="diff-old">return
clause. If the effective boolean value of the where-expression is
false ,</del> <ins class="diff-chg">output tuple stream;
otherwise</ins> the tuple is discarded. <del class="diff-old">The
effective boolean value</del></p>
<p><ins class="diff-chg">Examples:</ins></p>
<ul>
<li>
<p><ins class="diff-chg">This example illustrates the effect</ins>
of <del class="diff-old">an expression is defined in</del>
<ins class="diff-chg">a</ins> <code><ins class="diff-chg">where</ins></code>
 <ins class="diff-chg">clause on a
tuple stream:</ins></p>
<p><ins class="diff-chg">Input tuple stream:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
($a = 5, $b = 11)
($a = 91, $b = 42)
($a = 17, $b = 30)
($a = 85, $b = 63)
</ins>
</pre>
<del class="diff-old">2.4.3 Effective Boolean Value</del></div>
<p><del class="diff-old">.</del> <code><ins class="diff-chg">where</ins></code>
 <ins class="diff-chg">clause:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
where $a &gt; $b
</ins>
</pre></div>
<p><ins class="diff-chg">Output tuple stream:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">($a = 91, $b = 42)
($a = 85, $b = 63)
</ins>
</pre></div>
</li>
<li>
<p>The following <del class="diff-old">expression</del> <ins 
class="diff-chg">query</ins> illustrates how a <code>where</code> clause
might be <del class="diff-old">applied to</del> <ins class="diff-chg">used
 with</ins> a <a title="positional variable" 
href="#dt-positional-variable">positional variable <del class="diff-old">in
 order</del></a> to perform sampling on an input
sequence. <del class="diff-old">This expression approximates the
average value in a sequence by sampling</del> <ins class="diff-chg">The 
query returns</ins> one value out of each one
hundred input values.</p>
<div class="exampleInner">
<pre><del class="diff-old">&lt;span class=
"parse-test"&gt;fn:avg(for $x at $i in $inputvalues
</del>
                <span class="diff-chg">"parse-test"&gt;for $x at $i in $inputvalues
</span>
    where $i mod 100 = 0   
<del class="diff-old">    return $x)
</del>
<ins class="diff-chg">    return $x</ins>
              

</pre></div>
</li>
</ul>
</div>
<div class="div3">
<h4><a id="id-count" name="id-count"></a> <del class="diff-old">3.8.3 
Order By and Return Clauses</del> <ins class="diff-chg">3.9.6 Count 
Clause</ins></h4>
<h5><a id="N1575C" name="N1575C"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="noid_N156FF.doc-xquery11-CountClause" 
name="noid_N156FF.doc-xquery11-CountClause"></a> <ins class="diff-new">[59]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">CountClause</ins></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"count" "$"</ins> <a 
href="#doc-xquery11-VarName"><ins class="diff-new">VarName</ins></a></code></td>
</tr>
</tbody>
</table>
<p>The <ins class="diff-new">purpose of a</ins> <code><del 
class="diff-old">return</del> <ins class="diff-chg">count</ins></code>
clause <ins class="diff-new">is to enhance the tuple stream with a
new variable that is bound, in each tuple, to the ordinal position
of that tuple in the tuple stream. The name of the new variable is
specified in the</ins> <code><ins class="diff-new">count</ins></code> <ins
 class="diff-new">clause.</ins></p>
<p><ins class="diff-new">The output tuple stream</ins> of a
<del class="diff-old">FLWOR expression</del> <code><ins class="diff-chg">count</ins></code>
 <ins class="diff-chg">clause</ins> is
<del class="diff-old">evaluated once for</del> <ins class="diff-chg">the
 same as its input tuple stream, with</ins> each
tuple <ins class="diff-new">enhanced by one additional variable
that is bound to the ordinal position of that tuple in the tuple
stream. However, if the name of the new variable is the same as the
name of an existing variable</ins> in the <ins class="diff-new">input</ins>
 tuple stream, <ins class="diff-new">the new
variable occludes (replaces) the existing variable of the same
name,</ins> and the <del class="diff-old">results</del> <ins 
class="diff-chg">number of bound variables in each tuple is
unchanged.</ins></p>
<p><ins class="diff-chg">The following examples illustrate
uses</ins> of <del class="diff-old">these evaluations are
concatenated, as if by</del> the <del class="diff-old">comma
operator ,</del> <code><ins class="diff-chg">count</ins></code>
<ins class="diff-chg">clause:</ins></p>
<ul>
<li>
<p><ins class="diff-chg">This example illustrates the effect of
a</ins> <code><ins class="diff-chg">count</ins></code> <ins 
class="diff-chg">clause on an input tuple stream:</ins></p>
<p><ins class="diff-chg">Input tuple stream:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
($name = "Bob", $age = 21)
($name = "Carol", $age = 19)
($name = "Ted", $age = 20)
($name = "Alice", $age = 22)
</ins>
</pre></div>
<p><code><ins class="diff-chg">count</ins></code> <ins class="diff-chg">clause:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
count $counter
</ins>
</pre></div>
<p><ins class="diff-chg">Output tuple stream:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
($name = "Bob", $age = 21, $counter = 1)
($name = "Carol", $age = 19, $counter = 2)
($name = "Ted", $age = 20, $counter = 3)
($name = "Alice", $age = 22, $counter = 4)
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-chg">This example illustrates how a counter
might be used</ins> to <del class="diff-old">form</del> <ins 
class="diff-chg">filter</ins> the result of <ins class="diff-new">a
query. The query ranks products in order by decreasing sales, and
returns</ins> the <del class="diff-old">FLWOR expression.</del>
<ins class="diff-chg">three products with the highest sales. Assume
that the variable</ins> <code><ins class="diff-chg">$products</ins></code>
 <ins class="diff-chg">is bound to
a sequence of</ins> <code><ins class="diff-chg">product</ins></code> <ins
 class="diff-chg">elements,
each of which has</ins> <code><ins class="diff-chg">name</ins></code> <ins
 class="diff-chg">and</ins>
<code><ins class="diff-chg">sales</ins></code> <ins class="diff-chg">child-elements.</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">for $p in $products
order by $p/sales descending
count $rank
where $rank &lt;= 3
return
   &lt;product rank="{$rank}"&gt;
      {$p/name, $p/sales}
   &lt;/product&gt;
</ins>
</pre></div>
<p><del class="diff-old">If</del> <ins class="diff-chg">The result
of this query has the following structure:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
&lt;product rank="1"&gt;
   &lt;name&gt;Toaster&lt;/name&gt;
   &lt;sales&gt;968&lt;/sales&gt;
&lt;/product&gt;
&lt;product rank="2"&gt;
   &lt;name&gt;Blender&lt;/name&gt;
   &lt;sales&gt;520&lt;/sales&gt;
&lt;/product&gt;
&lt;product rank="3"&gt;
   &lt;name&gt;Can Opener&lt;/name&gt;
   &lt;sales&gt;475&lt;/sales&gt;
&lt;/product&gt;
</ins>
</pre></div>
</li>
</ul>
</div>
<div class="div3">
<h4><a id="id-group-by" name="id-group-by"></a><ins class="diff-chg">3.9.7
 Group By Clause</ins></h4>
<h5><a id="N157B3" name="N157B3"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="noid_N15756.doc-xquery11-GroupByClause" 
name="noid_N15756.doc-xquery11-GroupByClause"></a><ins class="diff-chg">[61]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">GroupByClause</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"group" "by"</ins> <a 
href="#doc-xquery11-GroupingSpecList"><ins class="diff-chg">GroupingSpecList</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N15759.doc-xquery11-GroupingSpecList" 
name="noid_N15759.doc-xquery11-GroupingSpecList"></a><ins 
class="diff-chg">[62]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">GroupingSpecList</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-GroupingSpec"><ins class="diff-chg">GroupingSpec</ins></a>
 <ins class="diff-chg">(","</ins>
<a href="#doc-xquery11-GroupingSpec"><ins class="diff-chg">GroupingSpec</ins></a>
 <ins class="diff-chg">)*</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N1575C.doc-xquery11-GroupingSpec" 
name="noid_N1575C.doc-xquery11-GroupingSpec"></a><ins class="diff-chg">[63]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">GroupingSpec</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"$"</ins> <a 
href="#doc-xquery11-VarName"><ins class="diff-chg">VarName</ins></a>
<ins class="diff-chg">("collation"</ins> <a 
href="#doc-xquery11-URILiteral"><ins class="diff-chg">URILiteral</ins></a>
 <ins class="diff-chg">)?</ins></code></td>
</tr>
</tbody>
</table>
<p><ins class="diff-chg">A</ins> <code><ins class="diff-chg">group
by</ins></code> <ins class="diff-chg">clause generates an output
tuple stream in which each tuple represents a group of tuples from
the input tuple stream. We will refer to the tuples in the input
tuple stream as</ins> <b><ins class="diff-chg">pre-grouping
tuples</ins></b> ,<ins class="diff-chg">and the tuples in the
output tuple stream as</ins> <b><ins class="diff-chg">post-grouping
tuples</ins></b> .</p>
<p><ins class="diff-chg">The post-grouping tuples have exactly the
same variable-names as the pre-grouping tuples. The number of
post-grouping tuples is less than or equal to the number of
pre-grouping tuples. The</ins> <code><ins class="diff-chg">group
by</ins></code> <ins class="diff-chg">clause assigns each
pre-grouping tuple to a group, and generates one post-grouping
tuple for each group. Subsequent clauses in the FLWOR expression
see only the variable bindings in the post-grouping tuples;
they</ins> no <ins class="diff-new">longer have access to the
variable bindings in the pre-grouping tuples.</ins></p>
<p><ins class="diff-new">[</ins> <a title="grouping variable" 
id="dt-grouping-variable" name="dt-grouping-variable"><ins 
class="diff-new">Definition</ins></a> :<ins class="diff-new">A</ins>
<code><del class="diff-old">order</del> <ins class="diff-chg">group</ins>
 by</code> clause <ins class="diff-new">consists of the keywords</ins> <code><ins
 class="diff-new">group by</ins></code> <ins class="diff-new">followed 
by
one or more variables called</ins> <b><ins class="diff-new">grouping 
variables</ins></b> .]<ins class="diff-new">The
name of each grouping variable must be equal (by the</ins>
<code><ins class="diff-new">eq</ins></code> <ins class="diff-new">operator
 on</ins> <a title="expanded QName" href="#dt-expanded-qname"><ins 
class="diff-new">expanded
QNames</ins></a> <ins class="diff-new">) to the name of a bound
variable in the input tuple stream; otherwise a</ins> <a title="static 
error" href="#dt-static-error"><ins class="diff-new">static
error</ins></a> is <del class="diff-old">present,</del> <ins 
class="diff-chg">raised [</ins> <a title="err:XQST0094" 
href="#ERRXQST0094"><ins class="diff-chg">err:XQST0094</ins></a>
<ins class="diff-chg">].</ins></p>
<p><ins class="diff-chg">The process of group formation proceeds as
follows:</ins></p>
<ol class="enumar">
<li>
<p><ins class="diff-chg">[</ins> <a title="grouping key" 
id="dt-grouping-key" name="dt-grouping-key"><ins class="diff-chg">Definition</ins></a>
 :<ins class="diff-chg">The atomized
value of a</ins> <a title="grouping variable" 
href="#dt-grouping-variable"><ins class="diff-chg">grouping
variable</ins></a> <ins class="diff-chg">is called a</ins>
<b><ins class="diff-chg">grouping key</ins></b> .]<ins class="diff-chg">For
 each pre-grouping tuple,</ins> the <del class="diff-old">order</del> <a
 title="grouping key" href="#dt-grouping-key"><ins class="diff-chg">grouping
 keys</ins></a>
<ins class="diff-chg">are created by</ins> <a title="atomization" 
href="#dt-atomization"><ins class="diff-chg">atomizing</ins></a>
<ins class="diff-chg">the values</ins> of the <a title="grouping 
variable" href="#dt-grouping-variable"><ins class="diff-new">grouping 
variables</ins></a> .<ins class="diff-new">If
the resulting value for any</ins> <a title="grouping variable" 
href="#dt-grouping-variable"><ins class="diff-new">grouping
variable</ins></a> <ins class="diff-new">consists of more than one
item, a</ins> <a title="dynamic error" href="#dt-dynamic-error"><ins 
class="diff-new">dynamic error</ins></a>
<ins class="diff-new">is raised [</ins> <a title="err:XPTY0004" 
href="#ERRXPTY0004"><ins class="diff-new">err:XPTY0004</ins></a>
<ins class="diff-new">].</ins></p>
</li>
<li>
<p><ins class="diff-new">The input</ins> tuple stream is
<del class="diff-old">determined</del> <ins class="diff-chg">partitioned
 into groups of tuples whose grouping keys
are</ins> <a title="equivalent grouping keys" 
href="#dt-equivalent-grouping-keys"><ins class="diff-chg">equivalent</ins></a>
 .<ins class="diff-chg">[</ins>
<a title="equivalent grouping keys" id="dt-equivalent-grouping-keys" 
name="dt-equivalent-grouping-keys"><ins class="diff-chg">Definition</ins></a>
 :<ins class="diff-chg">Two
tuples</ins> <var><ins class="diff-chg">T1</ins></var> <ins 
class="diff-chg">and</ins> <var><ins class="diff-chg">T2</ins></var>
<ins class="diff-chg">have</ins> <b><ins class="diff-chg">equivalent 
grouping keys</ins></b> <ins class="diff-chg">if and only if, for each 
grouping variable</ins>
<var><ins class="diff-chg">GV</ins></var> ,<ins class="diff-chg">the 
atomized value of</ins> <var><ins class="diff-chg">GV</ins></var> <ins 
class="diff-chg">in</ins>
<var><ins class="diff-chg">T1</ins></var> <ins class="diff-chg">is
deep-equal to the atomized value of</ins> <var><ins class="diff-chg">GV</ins></var>
 <ins class="diff-chg">in</ins>
<var><ins class="diff-chg">T2</ins></var> ,<ins class="diff-chg">as
defined</ins> by <ins class="diff-new">applying</ins> the
<ins class="diff-new">function</ins> <code><del class="diff-old">for</del>
 <ins class="diff-chg">fn:deep-equal</ins></code> <del class="diff-old">and</del>
 <ins class="diff-chg">using the appropriate
collation.]</ins></p>
<div class="note">
<p class="prefix"><b><ins class="diff-chg">Note:</ins></b></p>
<p><ins class="diff-chg">The atomized grouping key will always be
either an empty sequence or a single atomic value. Defining
equivalence by reference to the</ins> <code><del class="diff-old">let</del>
 <ins class="diff-chg">fn:deep-equal</ins></code> <del class="diff-old">clauses</del>
 <ins class="diff-chg">function ensures
that the empty sequence is equivalent only to the empty sequence,
that</ins> <code><ins class="diff-chg">NaN</ins></code> <ins 
class="diff-chg">is equivalent to</ins> <code><ins class="diff-chg">NaN</ins></code>
 ,<ins class="diff-chg">that
untypedAtomic values are compared as strings,</ins> and <ins 
class="diff-new">that values for which the</ins> <code><ins 
class="diff-new">eq</ins></code> <ins class="diff-new">operator is not
defined are considered non-equivalent.</ins></p>
</div>
</li>
<li>
<p><ins class="diff-new">The appropriate collation for comparing
two grouping keys is the collation specified in the pertinent</ins>
<a href="#doc-xquery11-GroupingSpec"><ins class="diff-new">GroupingSpec</ins></a>
 <ins class="diff-new">if present,
or the default collation from the static context otherwise. If the
collation is specified</ins> by <ins class="diff-new">a relative
URI, that relative URI is resolved to an absolute URI using the
base URI in the static context. If the specified collation is not
found in statically known collations, a static error is raised
[</ins> <a title="err:XQST0076" href="#ERRXQST0076"><ins 
class="diff-new">err:XQST0076</ins></a> <ins class="diff-new">].</ins></p>
</li>
</ol>
<p><ins class="diff-new">Each group of tuples produced by the above
process results in one post-grouping tuple. The pre-grouping tuples
from which the group is derived have</ins> <em><ins class="diff-new">equivalent</ins></em>
 <a title="grouping key" href="#dt-grouping-key"><ins class="diff-new">grouping
 keys</ins></a>
,<ins class="diff-new">but these keys are not necessarily identical
(for example, the strings "Frog" and "frog" might be</ins>
<em><ins class="diff-new">equivalent</ins></em> <ins class="diff-new">according
 to the collation in use.) In the post-grouping
tuple, each</ins> <a title="grouping variable" 
href="#dt-grouping-variable"><ins class="diff-new">grouping
variable</ins></a> <ins class="diff-new">is bound to the value of
that variable in one of the pre-grouping tuples from which the
group is derived. The choice of tuple is</ins> <a title="implementation 
dependent" href="#dt-implementation-dependent"><ins class="diff-new">implementation-dependent</ins></a>
 .</p>
<table summary="Editorial note" border="1">
<tbody><tr>
<td valign="top" width="50%" align="left"><b><ins class="diff-new">Editorial
 note</ins></b></td>
<td valign="top" width="50%" align="right"><ins class="diff-new">&nbsp;</ins></td>
</tr>
<tr>
<td colspan="2" valign="top" align="left"><ins class="diff-new">Some 
members of the XQuery Working Group would prefer
that the grouping variables in the post-grouping tuple contain the
grouping key for a grouping variable in a pre-grouping tuple, which
is atomized, rather than the value of the grouping variable in a
pre-grouping tuple. We welcome feedback on this
question.</ins></td>
</tr>
</tbody></table>
<p><ins class="diff-new">In the post-grouping tuple generated for a
given group, each non-grouping variable is bound to a sequence
containing the concatenated values of that variable in all the
pre-grouping tuples that were assigned to that group. If</ins>
<a title="ordering mode" href="#dt-ordering-mode">ordering mode
<del class="diff-old">. If an</del></a> <ins class="diff-chg">is</ins> <code><ins
 class="diff-new">ordered</ins></code> ,<ins class="diff-new">the values
derived from individual tuples are concatenated in a way that
preserves the</ins> order <ins class="diff-new">of the pre-grouping
tuple stream; otherwise the ordering of these values is</ins>
<a title="implementation dependent" href="#dt-implementation-dependent"><ins
 class="diff-new">implementation-dependent</ins></a> .</p>
<div class="note">
<p class="prefix"><b><ins class="diff-new">Note:</ins></b></p>
<p><ins class="diff-new">This behavior may be surprising to SQL
programmers, since SQL reduces the equivalent of a non-grouping
variable to one representative value. Consider the following
query:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
let $x := 64000
for $c in //customer
let $d := $c/department
where $c/salary &gt; $x
group by $d
return 
 &lt;department name="{$d}"&gt;
  Number of employees earning more than ${$x} is {count($c)}
 &lt;/department&gt;
</ins>
</pre></div>
<p><ins class="diff-new">If there are three qualifying customers in
the sales department this evaluates to:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
&lt;department name="sales"&gt;
  Number of employees earning more than $64000 64000 64000 is 3
&lt;/department&gt;
</ins>
</pre></div>
<p><ins class="diff-new">In XQuery, each group is a sequence of
items that match the group</ins> by <ins class="diff-new">criteria—in a 
tree-structured language like XQuery, this
is convenient, because further structures can be built based on the
items in this sequence. Because there are three items in the
group,</ins> <code><ins class="diff-new">$x</ins></code>
<del class="diff-old">clause</del> <ins class="diff-chg">evaluates
to a sequence of three items. To reduce this to one item, use</ins>
<code><ins class="diff-chg">fn:distinct-values()</ins></code> :</p>
<div class="exampleInner">
<pre><ins class="diff-chg">
let $x := 64000
for $c in //customer
let $d := $c/department
where $c/salary &gt; $x
group by $d
return 
 &lt;department name="{$d}"&gt;
  Number of employees earning more than ${distinct-values($x)} is {count($c)}
 &lt;/department&gt;
</ins>
</pre></div>
</div>
<div class="note">
<p class="prefix"><b><ins class="diff-chg">Note:</ins></b></p>
<p><ins class="diff-chg">In general, the</ins> <a title="static type" 
href="#dt-static-type"><ins class="diff-chg">static
type</ins></a> <ins class="diff-chg">of a variable in a
post-grouping tuple</ins> is <del class="diff-old">present, it
reorders</del> <ins class="diff-chg">different from</ins> the
<a title="static type" href="#dt-static-type"><ins class="diff-new">static
 type</ins></a> <ins class="diff-new">of the
variable with the same name in the pre-grouping tuples.</ins></p>
</div>
<p><ins class="diff-new">The order in which</ins> tuples
<ins class="diff-new">appear</ins> in the <ins class="diff-new">post-grouping</ins>
 tuple stream <del class="diff-old">into</del> <ins class="diff-chg">is</ins>
 <a title="implementation dependent" href="#dt-implementation-dependent"><ins
 class="diff-chg">implementation-dependent</ins></a> .</p>
<div class="note">
<p class="prefix"><b><ins class="diff-chg">Note:</ins></b></p>
<p><ins class="diff-chg">An</ins> <code><ins class="diff-chg">order
by</ins></code> <ins class="diff-chg">clause can be used to
impose</ins> a <del class="diff-old">new,</del> value-based
<del class="diff-old">order. In either case,</del> <ins class="diff-chg">ordering
 on</ins> the <del class="diff-old">resulting
order determines</del> <ins class="diff-chg">post-grouping tuple
stream. Similarly, if it is desired to impose a value-based
ordering within a group (i.e., on</ins> the <ins class="diff-new">sequence
 of items bound to a non-grouping variable),
this can be accomplished by a nested FLWOR expression that iterates
over these items and applies an</ins> <code>order <ins class="diff-new">by</ins></code>
 <ins class="diff-new">clause. In some
cases, a value-based ordering within groups can be accomplished by
applying an</ins> <code><ins class="diff-new">order by</ins></code>
<ins class="diff-new">clause on a non-grouping variable before
applying the</ins> <code><ins class="diff-new">group
by</ins></code> <ins class="diff-new">clause.</ins></p>
</div>
<p><ins class="diff-new">A</ins> <code><ins class="diff-new">group
by</ins></code> <ins class="diff-new">clause rebinds all the
variables</ins> in <del class="diff-old">which</del> <ins 
class="diff-chg">the input tuple stream. The scopes of these variables
are not affected by</ins> the <code><del class="diff-old">return</del> <ins
 class="diff-chg">group by</ins></code>
<ins class="diff-chg">clause, but in post-grouping tuples the
values of the variables represent group properties rather than
properties of individual pre-grouping tuples.</ins></p>
<p><ins class="diff-chg">Examples:</ins></p>
<ul>
<li>
<p><ins class="diff-chg">This example illustrates the effect of
a</ins> <code><ins class="diff-chg">group by</ins></code> clause
<ins class="diff-new">on a tuple stream.</ins></p>
<p><ins class="diff-new">Input tuple stream:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
($storeno = &lt;storeno&gt;S101&lt;/storeno&gt;, $itemno = &lt;itemno&gt;P78395&lt;/itemno&gt;)
($storeno = &lt;storeno&gt;S102&lt;/storeno&gt;, $itemno = &lt;itemno&gt;P94738&lt;/itemno&gt;)
($storeno = &lt;storeno&gt;S101&lt;/storeno&gt;, $itemno = &lt;itemno&gt;P41653&lt;/itemno&gt;)
($storeno = &lt;storeno&gt;S102&lt;/storeno&gt;, $itemno = &lt;itemno&gt;P70421&lt;/itemno&gt;)
</ins>
</pre></div>
<p><code><ins class="diff-new">group by</ins></code> <ins 
class="diff-new">clause:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
group by $storeno
</ins>
</pre></div>
<p><ins class="diff-new">Output tuple stream:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
($storeno =  &lt;storeno&gt;S101&lt;/storeno&gt;, $itemno = (&lt;itemno&gt;P78395&lt;/itemno&gt;, &lt;itemno&gt;P41653&lt;itemno&gt;))
($storeno =  &lt;storeno&gt;S102&lt;/storeno&gt;, $itemno = (&lt;itemno&gt;P94738&lt;/itemno&gt;, &lt;itemno&gt;P70421&lt;/itemno&gt;))
</ins>
</pre></div>
</li>
</ul>
<ul>
<li>
<p><ins class="diff-new">This example and the ones that follow are
based on two separate sequences of elements, named</ins>
<code><ins class="diff-new">$sales</ins></code> <ins class="diff-new">and</ins>
 <code><ins class="diff-new">$products</ins></code> .<ins 
class="diff-new">We assume
that the variable</ins> <code><ins class="diff-new">$sales</ins></code> 
is <del class="diff-old">evaluated,
once</del> <ins class="diff-chg">bound to a sequence of elements
with the following structure:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
&lt;sales&gt;
   &lt;storeno&gt;S101&lt;/storeno&gt;
   &lt;itemno&gt;P78395&lt;/itemno&gt;
   &lt;qty&gt;125&lt;/qty&gt;
&lt;/sales&gt;
</ins>
</pre></div>
<p><ins class="diff-chg">We also assume that the variable</ins>
<code><ins class="diff-chg">$products</ins></code> <ins class="diff-chg">is
 bound to a sequence of elements with the following
structure:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
&lt;product&gt;
   &lt;itemno&gt;P78395&lt;/itemno&gt;
   &lt;price&gt;25.00&lt;/price&gt;
   &lt;category&gt;Men's Wear&lt;/category&gt;
&lt;/product&gt;
</ins>
</pre></div>
<p><ins class="diff-chg">The simplest kind of grouping query has a
single</ins> <a title="grouping variable" href="#dt-grouping-variable"><ins
 class="diff-chg">grouping
variable</ins></a> .<ins class="diff-chg">The query in this example
finds the total quantity of items sold by each store:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
for $s in $sales
let $storeno := $s/storeno
group by $storeno
return &lt;store number="{$storeno}" total-qty="{sum($s/qty)}"/&gt;
</ins>
</pre></div>
<p><ins class="diff-chg">The result of this query is a sequence of
elements with the following structure:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
&lt;store number="S101" total-qty="1550" /&gt;
&lt;store number="S102" total-qty="2125" /&gt;
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-chg">In a more realistic example, a user might
be interested in the total revenue generated by each store</ins>
for each <del class="diff-old">tuple, using</del> <ins class="diff-chg">product
 category. Revenue depends on both</ins> the
<del class="diff-old">variable bindings</del> <ins class="diff-chg">quantity
 sold of various items and the price of each
item. The following query joins the two input sequences and groups
the resulting tuples by two</ins> <a title="grouping variable" 
href="#dt-grouping-variable"><ins class="diff-chg">grouping
variables</ins></a> :</p>
<div class="exampleInner">
<pre><ins class="diff-chg">
for $s in $sales,
    $p in $products[itemno = $s/itemno]
let $storeno := $s/storeno,
    $category := $p/category,
    $revenue := $s/qty * $p/price
group by $storeno, $category
return
    &lt;summary storeno="{$storeno}" 
             category="{$category}" 
             revenue="{sum($revenue)}"/&gt;
</ins>
</pre></div>
<p><ins class="diff-chg">The result of this query is a sequence of
elements with the following structure:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
&lt;summary storeno="S101" category="Men's Wear" revenue="10185"/&gt;
&lt;summary storeno="S101" category="Stationery" revenue="4520"/&gt;
&lt;summary storeno="S102" category="Men's Wear" revenue="9750"/&gt;
&lt;summary storeno="S102" category="Appliances" revenue="22650"/&gt;
&lt;summary storeno="S102" category="Jewelry" revenue="30750"/&gt;
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-chg">The result of the previous example was a
"flat" list of elements. A user might prefer the query result to be
presented</ins> in the <del class="diff-old">respective tuples.
Note</del> <ins class="diff-chg">form of a hierarchical report,
grouped primarily by store (in order by store number) and
secondarily by product category. Within each store, the user might
want to see only those product categories whose total revenue
exceeds $10,000, presented in descending order by their total
revenue. This report is generated by the following query:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
for $s1 in $sales
let $storeno := $s1/storeno
group by $storeno
order by $storeno
return
  &lt;store storeno="{$storeno}"&gt;
    {for $s2 in $s1, 
         $p in $products[itemno = $s2/itemno]
     let $category := $p/category,
         $revenue := $s2/qty * $p/price
     group by $category
     let $group-revenue := sum($revenue)
     where $group-revenue &gt; 10000
     order by $group-revenue descending
     return &lt;category name="{$category}" revenue="{$group-revenue}"/&gt;
    }
  &lt;/store&gt;
</ins>
</pre></div>
<p><ins class="diff-chg">The result of this example query has the
following structure:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
&lt;store storeno="S101"&gt;
   &lt;category name="Men's Wear" revenue="10185"/&gt;
&lt;/store&gt;
&lt;store storeno="S102"&gt;
   &lt;category name="Jewelry" revenue="30750"/&gt;
   &lt;category name="Appliances" revenue="22650"/&gt;
&lt;/store&gt;
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-chg">When writing a query</ins> that
<del class="diff-old">ordering mode</del> <ins class="diff-chg">includes
 a</ins> <code><ins class="diff-chg">group
by</ins></code> <ins class="diff-chg">clause, it is important to
remember that, in each post-grouping tuple, each</ins> <a 
title="grouping variable" href="#dt-grouping-variable"><ins 
class="diff-chg">grouping variable</ins></a> <del class="diff-old">has 
no
effect on</del> <ins class="diff-chg">is bound to a single atomic
value (a</ins> <a title="grouping key" href="#dt-grouping-key"><ins 
class="diff-chg">grouping key</ins></a>
<ins class="diff-chg">), and all other variables are bound to
sequences of items derived from all the pre-grouping tuples from
which the group was formed. The following example illustrates how
to avoid a possible pitfall in writing grouping queries.</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
let $high-price := 1000
for $p in $products[price &gt; $high-price]
let $category := $p/category
group by $category
return
   &lt;category name="{$category}"&gt;
      {fn:count($p)} products have price greater than {$high-price}.
   &lt;/category&gt;
</ins>
</pre></div>
<p><ins class="diff-chg">If three products in the "Men's Wear"
category have prices greater than 1000, the result of this query
might look (in part) like this:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
&lt;category name="Men's Wear"&gt;
   3 products have price greater than 1000 1000 1000.
&lt;/category&gt;
</ins>
</pre></div>
<p><ins class="diff-chg">The repetition of "1000" in this query
result is due to the fact that</ins> <code><ins class="diff-chg">$high-price</ins></code>
 <ins class="diff-chg">is
not</ins> a <a title="grouping variable" href="#dt-grouping-variable"><ins
 class="diff-new">grouping
variable</ins></a> .<ins class="diff-new">One way to avoid this
repetition is to move the binding of</ins> <code><ins class="diff-new">$high-price</ins></code>
 <ins class="diff-new">to an
outer-level</ins> FLWOR <del class="diff-old">expression if</del>
<ins class="diff-chg">expression, as follows:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
let $high-price := 1000
return
   for $p in $products[price &gt; $high-price]
   let $category := $p/category
   group by $category
   return
      &lt;category name="{$category}"&gt;
         {fn:count($p)} products have price greater than {$high-price}.
      &lt;/category&gt;
</ins>
</pre></div>
<p><ins class="diff-chg">The result of the revised query might
contain the following element:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
&lt;category name="Men's Wear"&gt;
   3 products have price greater than 1000.
&lt;/category&gt;
</ins>
</pre></div>
</li>
</ul>
</div>
<div class="div3">
<h4><a id="id-order-by-clause" name="id-order-by-clause"></a><ins 
class="diff-chg">3.9.8 Order By
Clause</ins></h4>
<h5><a id="N15979" name="N15979"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="noid_N15913.doc-xquery11-OrderByClause" 
name="noid_N15913.doc-xquery11-OrderByClause"></a><ins class="diff-chg">[64]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">OrderByClause</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">(("order" "by") | ("stable" "order"
"by"))</ins> <a href="#doc-xquery11-OrderSpecList"><ins class="diff-chg">OrderSpecList</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N15915.doc-xquery11-OrderSpecList" 
name="noid_N15915.doc-xquery11-OrderSpecList"></a><ins class="diff-chg">[65]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">OrderSpecList</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-OrderSpec"><ins class="diff-chg">OrderSpec</ins></a>
 <ins class="diff-chg">(","</ins>
<a href="#doc-xquery11-OrderSpec"><ins class="diff-chg">OrderSpec</ins></a>
 <ins class="diff-chg">)*</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N15918.doc-xquery11-OrderSpec" 
name="noid_N15918.doc-xquery11-OrderSpec"></a><ins class="diff-chg">[66]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">OrderSpec</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ExprSingle"><ins class="diff-chg">ExprSingle</ins></a>
 <a href="#doc-xquery11-OrderModifier"><ins class="diff-chg">OrderModifier</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N1591B.doc-xquery11-OrderModifier" 
name="noid_N1591B.doc-xquery11-OrderModifier"></a><ins class="diff-chg">[67]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">OrderModifier</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">("ascending" | "descending")?
("empty" ("greatest" | "least"))? ("collation"</ins> <a 
href="#doc-xquery11-URILiteral"><ins class="diff-chg">URILiteral</ins></a>
 <ins class="diff-chg">)?</ins></code></td>
</tr>
</tbody>
</table>
<p><ins class="diff-chg">The purpose of</ins> an <code>order
by</code> clause is <del class="diff-old">present, since</del>
<ins class="diff-chg">to impose a value-based ordering on the
tuples in the tuple stream. The output tuple stream of the</ins>
<code>order by</code> <del class="diff-old">takes precedence over
ordering mode .</del> <ins class="diff-chg">clause contains the
same tuples as its input tuple stream, but the tuples may be in a
different order.</ins></p>
<p>An <code>order by</code> clause contains one or more ordering
specifications, called <a href="#doc-xquery11-OrderSpec">orderspecs</a> ,
 as shown in the
<del class="diff-old">grammar above.</del> <ins class="diff-chg">grammar.</ins>
 For each tuple in the <ins class="diff-new">input</ins> tuple stream, <del
 class="diff-old">after
filtering by the where clause,</del> the orderspecs are evaluated,
using the variable bindings in that tuple. The relative order of
two tuples is determined by comparing the values of their
orderspecs, working from left to right until a pair of unequal
values is encountered. If an orderspec specifies a <a title="collation" 
href="#dt-collation">collation</a> , that collation is
used in comparing values of type <code>xs:string</code> ,
<code>xs:anyURI</code> , or types derived from them (otherwise, the
<a title="default collation" href="#dt-def-collation">default
collation</a> is <del class="diff-old">used).</del> <ins 
class="diff-chg">used in comparing values of these types).</ins> If an
orderspec specifies a collation by a relative URI, that relative
URI is resolved to an absolute URI using the <a title="base URI" 
href="#dt-base-uri">base URI</a> in the <a title="static context" 
href="#dt-static-context">static context</a> . If an orderspec
specifies a collation that is not found in <a title="statically known 
collations" href="#dt-static-collations">statically known collations</a>
 , an error
is raised [ <a title="err:XQST0076" href="#ERRXQST0076">err:XQST0076</a>
 ].</p>
<p>The process of evaluating and comparing the orderspecs is based
on the following rules:</p>
<ul>
<li>
<p><a title="atomization" href="#dt-atomization">Atomization</a> is
applied to the result of the expression in each orderspec. If the
result of atomization is neither a single atomic value nor an empty
sequence, a <a title="type error" href="#dt-type-error">type
error</a> is raised [ <a title="err:XPTY0004" href="#ERRXPTY0004">err:XPTY0004</a>
 ].</p>
</li>
<li>
<p>If the value of an orderspec has the <a title="dynamic type" 
href="#dt-dynamic-type">dynamic type</a>
<code>xs:untypedAtomic</code> (such as character data in a
schemaless document), it is cast to the type <code>xs:string</code>
.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>Consistently treating untyped values as strings enables the
sorting process to begin without complete knowledge of the types of
all the values to be sorted.</p>
</div>
</li>
<li>
<p>All the non-empty orderspec values must be convertible to a
common type by <a title="subtype substitution" 
href="#dt-subtype-substitution">subtype substitution</a> and/or
<a title="type promotion" href="#dt-type-promotion">type
promotion</a> . The ordering is performed in the least common type
that has a <code>gt</code> operator. If two or more non-empty
orderspec values are not convertible to a common type that has a
<code>gt</code> operator, a <a title="type error" href="#dt-type-error">type
 error</a> is raised [ <a title="err:XPTY0004" href="#ERRXPTY0004">err:XPTY0004</a>
 ].</p>
<ul>
<li>
<p>Example: The orderspec values include a value of type
<code>hatsize</code> , which is derived from
<code>xs:integer</code> , and a value of type <code>shoesize</code>
, which is derived from <code>xs:decimal</code> . The least common
type reachable by subtype substitution and type promotion is
<code>xs:decimal</code> .</p>
</li>
<li>
<p>Example: The orderspec values include a value of type
<code>xs:string</code> and a value of type <code>xs:anyURI</code> .
The least common type reachable by subtype substitution and type
promotion is <code>xs:string</code> .</p>
</li>
</ul>
</li>
</ul>
<p><del class="diff-old">When two orderspec values are compared to
determine</del> <ins class="diff-chg">For the purpose of
determining</ins> their relative position in the ordering sequence,
the <em>greater-than</em> relationship <ins class="diff-new">between two
 orderspec values</ins> <em><ins class="diff-new">W</ins></em> <ins 
class="diff-new">and</ins>
<em><ins class="diff-new">V</ins></em> is defined as follows:</p>
<ul>
<li>
<p>When the orderspec specifies <code>empty least</code> ,
<del class="diff-old">a value W is considered to be greater-than a
value V if one of</del> the following <del class="diff-old">is
true:</del> <ins class="diff-chg">rules are applied in
order:</ins></p>
<ol class="enumar">
<li>
<p><ins class="diff-new">If</ins> <em>V</em> is an empty sequence
and <em>W</em> is not an empty <del class="diff-old">sequence.</del> <ins
 class="diff-chg">sequence,
then</ins> <em><ins class="diff-chg">W</ins></em> <em><ins 
class="diff-chg">greater-than</ins></em> <em><ins class="diff-chg">V</ins></em>
 <ins class="diff-chg">is true.</ins></p>
</li>
<li>
<p><ins class="diff-new">If</ins> <em>V</em> is <code>NaN
<del class="diff-old">,</del></code> and <em>W</em> is neither
<code>NaN</code> nor an empty <del class="diff-old">sequence. No
collation is specified, and</del> <ins class="diff-chg">sequence,
then</ins> <em>W <del class="diff-old">gt</del></em>
<em><ins class="diff-chg">greater-than</ins></em> <em>V</em> is
true.</p>
</li>
<li>
<p><del class="diff-old">A</del> <ins class="diff-chg">If a</ins>
specific collation <em>C</em> is specified, and <em><ins 
class="diff-new">V</ins></em> <ins class="diff-new">and</ins>
<em><ins class="diff-new">W</ins></em> <ins class="diff-new">are
both of type</ins> <code><ins class="diff-new">xs:string</ins></code> <ins
 class="diff-new">or are
convertible to</ins> <code><ins class="diff-new">xs:string</ins></code> <ins
 class="diff-new">by</ins>
<a title="subtype substitution" href="#dt-subtype-substitution"><ins 
class="diff-new">subtype
substitution</ins></a> <ins class="diff-new">and/or</ins> <a title="type
 promotion" href="#dt-type-promotion"><ins class="diff-new">type 
promotion</ins></a> ,<ins class="diff-new">then:</ins></p>
<p><ins class="diff-new">If</ins> <code>fn:compare(V, W, C)</code>
is less than <del class="diff-old">zero.</del> <ins class="diff-chg">zero,
 then</ins> <em><ins class="diff-chg">W</ins></em>
<em><ins class="diff-chg">greater-than</ins></em> <em><ins 
class="diff-chg">V</ins></em> <ins class="diff-chg">is true;
otherwise</ins> <em><ins class="diff-chg">W</ins></em>
<em><ins class="diff-chg">greater-than</ins></em> <em><ins 
class="diff-chg">V</ins></em> <ins class="diff-chg">is false.</ins></p>
</li>
<li>
<p><ins class="diff-chg">If none of the above rules apply,
then:</ins></p>
<p><ins class="diff-chg">If</ins> <code><ins class="diff-chg">W gt
V</ins></code> <ins class="diff-chg">is true, then</ins>
<em><ins class="diff-chg">W</ins></em> <em><ins class="diff-chg">greater-than</ins></em>
 <em><ins class="diff-chg">V</ins></em> <ins class="diff-chg">is true;
otherwise</ins> <em><ins class="diff-chg">W</ins></em>
<em><ins class="diff-chg">greater-than</ins></em> <em><ins 
class="diff-chg">V</ins></em> <ins class="diff-chg">is false.</ins></p>
</li>
</ol>
</li>
<li>
<p>When the orderspec specifies <code>empty greatest</code> ,
<del class="diff-old">a value W is considered to be greater-than a
value V if one of</del> the following <del class="diff-old">is
true:</del> <ins class="diff-chg">rules are applied in
order:</ins></p>
<ol class="enumar">
<li>
<p><ins class="diff-new">If</ins> <em>W</em> is an empty sequence
and <em>V</em> is not an empty <del class="diff-old">sequence.</del> <ins
 class="diff-chg">sequence,
then</ins> <em><ins class="diff-chg">W</ins></em> <em><ins 
class="diff-chg">greater-than</ins></em> <em><ins class="diff-chg">V</ins></em>
 <ins class="diff-chg">is true.</ins></p>
</li>
<li>
<p><ins class="diff-new">If</ins> <em>W</em> is <code>NaN
<del class="diff-old">,</del></code> and <em>V</em> is neither
<code>NaN</code> nor an empty <del class="diff-old">sequence. No
collation is specified, and</del> <ins class="diff-chg">sequence,
then</ins> <em>W <del class="diff-old">gt</del></em>
<em><ins class="diff-chg">greater-than</ins></em> <em>V</em> is
true.</p>
</li>
<li>
<p><del class="diff-old">A</del> <ins class="diff-chg">If a</ins>
specific collation <em>C</em> is specified, and <em><ins 
class="diff-new">V</ins></em> <ins class="diff-new">and</ins>
<em><ins class="diff-new">W</ins></em> <ins class="diff-new">are
both of type</ins> <code><ins class="diff-new">xs:string</ins></code> <ins
 class="diff-new">or are
convertible to</ins> <code><ins class="diff-new">xs:string</ins></code> <ins
 class="diff-new">by</ins>
<a title="subtype substitution" href="#dt-subtype-substitution"><ins 
class="diff-new">subtype
substitution</ins></a> <ins class="diff-new">and/or</ins> <a title="type
 promotion" href="#dt-type-promotion"><ins class="diff-new">type 
promotion</ins></a> ,<ins class="diff-new">then:</ins></p>
<p><ins class="diff-new">If</ins> <code>fn:compare(V, W, C)</code>
is less than <del class="diff-old">zero.</del> <ins class="diff-chg">zero,
 then</ins> <em><ins class="diff-chg">W</ins></em>
<em><ins class="diff-chg">greater-than</ins></em> <em><ins 
class="diff-chg">V</ins></em> <ins class="diff-chg">is true;
otherwise</ins> <em><ins class="diff-chg">W</ins></em>
<em><ins class="diff-chg">greater-than</ins></em> <em><ins 
class="diff-chg">V</ins></em> <ins class="diff-chg">is false.</ins></p>
</li>
<li>
<p><ins class="diff-chg">If none of the above rules apply,
then:</ins></p>
<p><ins class="diff-chg">If</ins> <code><ins class="diff-chg">W gt
V</ins></code> <ins class="diff-chg">is true, then</ins>
<em><ins class="diff-chg">W</ins></em> <em><ins class="diff-chg">greater-than</ins></em>
 <em><ins class="diff-chg">V</ins></em> <ins class="diff-chg">is true;
otherwise</ins> <em><ins class="diff-chg">W</ins></em>
<em><ins class="diff-chg">greater-than</ins></em> <em><ins 
class="diff-chg">V</ins></em> <ins class="diff-chg">is false.</ins></p>
</li>
</ol>
</li>
<li>
<p>When the orderspec specifies neither <code>empty least</code>
nor <code>empty greatest</code> , the <a title="default order for empty 
sequences" href="#dt-default-empty-order">default order for empty 
sequences</a> in
the <a title="static context" href="#dt-static-context">static
context</a> determines whether the rules for <code>empty
least</code> or <code>empty greatest</code> are used.</p>
</li>
</ul>
<p>If <em>T1</em> and <em>T2</em> are two tuples in the <ins 
class="diff-new">input</ins> tuple stream, and <em>V1</em> and
<em>V2</em> are the first pair of values encountered when
evaluating their orderspecs from left to right for which one value
is <em>greater-than</em> the other (as defined above), then:</p>
<ol class="enumar">
<li>
<p>If <em>V1</em> is <em>greater-than</em> <em>V2:</em> If the
orderspec specifies <code>descending</code> , then <em>T1</em>
precedes <em>T2</em> in the <ins class="diff-new">output</ins>
tuple stream; otherwise, <em>T2</em> precedes <em>T1</em> in the
<ins class="diff-new">output</ins> tuple stream.</p>
</li>
<li>
<p>If <em>V2</em> is <em>greater-than</em> <del class="diff-old">V1:</del>
 <em><ins class="diff-chg">V1</ins></em> : If
the orderspec specifies <code>descending</code> , then <em>T2</em>
precedes <em>T1</em> in the <ins class="diff-new">output</ins>
tuple stream; otherwise, <em>T1</em> precedes <em>T2</em> in the
<ins class="diff-new">output</ins> tuple stream.</p>
</li>
</ol>
<p>If neither <em>V1</em> nor <em>V2</em> is <em>greater-than</em>
the other for any pair of orderspecs for tuples <em>T1</em> and
<del class="diff-old">T2,</del> <em><ins class="diff-chg">T2</ins></em> ,
 the following rules apply.</p>
<ol class="enumar">
<li>
<p>If <code>stable</code> is specified, the original order of
<em>T1</em> and <em>T2</em> is preserved in the <ins class="diff-new">output</ins>
 tuple stream.</p>
</li>
<li>
<p>If <code>stable</code> is not specified, the order of
<em>T1</em> and <em>T2</em> in the <ins class="diff-new">output</ins> 
tuple stream is <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a> .</p>
</li>
</ol>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>If two orderspecs return the special floating-point values
positive and negative zero, neither of these values is
<em>greater-than</em> the other, since <code>+0.0 gt -0.0</code>
and <code>-0.0 gt +0.0</code> are both <code>false</code> .</p>
</div>
<p><del class="diff-old">An</del> <ins class="diff-chg">Examples:</ins></p>
<ul>
<li>
<p><ins class="diff-chg">This example illustrates the effect of
an</ins> <code>order by</code> clause <del class="diff-old">makes
it easy</del> <ins class="diff-chg">on a tuple stream. The
keyword</ins> <code><ins class="diff-chg">stable</ins></code>
<ins class="diff-chg">indicates that, when two tuples have equal
sort keys, their order in the input tuple stream is
preserved.</ins></p>
<p><ins class="diff-chg">Input tuple stream:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
($license = "PFQ519", $make = "Ford",  $value = 16500)
($license = "HAJ865", $make = "Honda", $value = 22750)
($license = "NKV473", $make = "Ford",  $value = 21650)
($license = "RCM922", $make = "Dodge", $value = 11400)
($license = "ZBX240", $make = "Ford",  $value = 16500)
($license = "KLM030", $make = "Dodge", $value = () )
</ins>
</pre></div>
<p><code><ins class="diff-chg">order by</ins></code> <ins 
class="diff-chg">clause:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
stable order by $make,
   $value descending empty least
</ins>
</pre></div>
<p><ins class="diff-chg">Output tuple stream:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
($license = "RCM922", $make = "Dodge", $value = 11400)
($license = "KLM030", $make = "Dodge", $value = () )
($license = "NKV473", $make = "Ford",  $value = 21650)
($license = "PFQ519", $make = "Ford",  $value = 16500)
($license = "ZBX240", $make = "Ford",  $value = 16500)
($license = "HAJ865", $make = "Honda", $value = 22750)
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-chg">The following example shows how an</ins>
<code><ins class="diff-chg">order by</ins></code> <ins class="diff-chg">clause
 can be used</ins> to sort the result of a
<del class="diff-old">FLWOR expression,</del> <ins class="diff-chg">query,</ins>
 even if the sort key is not included in the
<del class="diff-old">result of the expression. For example, the
following expression</del> <ins class="diff-chg">query result. This
query</ins> returns employee names in descending order by salary,
without returning the actual salaries:</p>
<div class="exampleInner">
<pre><del class="diff-old">&lt;span class=
"parse-test"&gt;for $e in $employees 
</del>
<ins class="diff-chg">for $e in $employees 
</ins>
order by $e/salary descending 
<del class="diff-old">return $e/name
</del>
<ins class="diff-chg">return $e/name
</ins>
</pre></div>
</li>
</ul>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>Since the <code>order by</code> clause in a FLWOR expression is
the only facility provided by XQuery for specifying a value
ordering, a FLWOR expression must be used in some queries where
iteration would not otherwise be necessary. For example, a list of
books with price less than 100 might be obtained by a simple
<a title="path expression" href="#dt-path-expression">path
expression</a> such as <code>$books/book[price &lt; 100]</code> .
But if these books are to be returned in alphabetic order by title,
the query must be expressed as follows:</p>
<div class="exampleInner">
<pre><del class="diff-old">&lt;span class=
"parse-test"&gt;for $b in $books/book[price &lt; 100]
</del>
<ins class="diff-chg">for $b in $books/book[price &lt; 100]
</ins>
order by $b/title
<del class="diff-old">return $b
</del>
<ins class="diff-chg">return $b
</ins>
</pre></div>
</div>
</div>
<div class="div3">
<h4><a id="id-return-clause" name="id-return-clause"></a>
<ins class="diff-new">3.9.9 Return Clause</ins></h4>
<h5><a id="N15C29" name="N15C29"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="noid_N15BC9.doc-xquery11-ReturnClause" 
name="noid_N15BC9.doc-xquery11-ReturnClause"></a><ins class="diff-new">[68]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">ReturnClause</ins></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"return"</ins> <a 
href="#doc-xquery11-ExprSingle"><ins class="diff-new">ExprSingle</ins></a></code></td>
</tr>
</tbody>
</table>
<p><ins class="diff-new">The</ins> <code><ins class="diff-new">return</ins></code>
 <ins class="diff-new">clause is the
final clause of a FLWOR expression. The</ins> <code><ins 
class="diff-new">return</ins></code> <ins class="diff-new">clause is
evaluated once for each tuple in its input tuple stream, using the
variable bindings in the respective tuples, in the order in which
these tuples appear in the input tuple stream. The results of these
evaluations are concatenated, as if by the</ins> <a title="comma 
operator" href="#dt-comma-operator"><ins class="diff-new">comma operator</ins></a>
 ,<ins class="diff-new">to form
the result of the FLWOR expression.</ins></p>
<p>The following example illustrates <ins class="diff-new">a FLWOR
expression containing several clauses. The</ins> <code><ins 
class="diff-new">for</ins></code> <ins class="diff-new">clause iterates
over all the departments in</ins> an <ins class="diff-new">input
document named</ins> <code><del class="diff-old">order by</del>
<ins class="diff-chg">depts.xml</ins></code> ,<ins class="diff-chg">binding
 the variable</ins> <code><ins class="diff-chg">$d</ins></code> <ins 
class="diff-chg">to each department
in turn. For each binding of</ins> <code><ins class="diff-chg">$d</ins></code>
 ,<ins class="diff-chg">the</ins>
<code><ins class="diff-chg">let</ins></code> clause <del 
class="diff-old">that uses several options. It causes</del> <ins 
class="diff-chg">binds variable</ins> <code><ins class="diff-chg">$e</ins></code>
 <ins class="diff-chg">to all the
employees in the given department, selected from another input
document named</ins> <code><ins class="diff-chg">emps.xml</ins></code> <ins
 class="diff-chg">(the
relationship between employees and departments is represented by
matching their</ins> <code><ins class="diff-chg">deptno</ins></code> <ins
 class="diff-chg">values). Each
tuple in the resulting tuple stream contains</ins> a <del 
class="diff-old">collection</del> <ins class="diff-chg">pair</ins> of
<del class="diff-old">books</del> <ins class="diff-chg">bindings
for</ins> <code><ins class="diff-chg">$d</ins></code> <ins 
class="diff-chg">and</ins> <code><ins class="diff-chg">$e</ins></code>
<ins class="diff-chg">(</ins> <code><ins class="diff-chg">$d</ins></code>
 <ins class="diff-chg">is bound</ins> to
<del class="diff-old">be sorted</del> <ins class="diff-chg">a
department and</ins> <code><ins class="diff-chg">$e</ins></code>
<ins class="diff-chg">is bound to a set of employees</ins> in
<del class="diff-old">primary</del> <ins class="diff-chg">that
department). The</ins> <code><ins class="diff-chg">where</ins></code> <ins
 class="diff-chg">clause filters
the tuple stream, retaining only those tuples that represent
departments having at least ten employees. The</ins> <code>order by
<del class="diff-old">title, and</del></code> <ins class="diff-chg">clause
 orders the surviving tuples</ins> in <del class="diff-old">secondary</del>
 descending order by <del class="diff-old">price. A specific collation 
is specified</del>
<ins class="diff-chg">the average salary of the employees in the
department. The</ins> <code><ins class="diff-chg">return</ins></code> <ins
 class="diff-chg">clause
constructs a new</ins> <code><ins class="diff-chg">big-dept</ins></code>
 <ins class="diff-chg">element</ins> for <ins class="diff-new">each 
surviving
tuple, containing</ins> the <del class="diff-old">title
ordering,</del> <ins class="diff-chg">department number,
headcount,</ins> and <ins class="diff-new">average
salary.</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
for $d in fn:doc("depts.xml")//dept
let $e := fn:doc("emps.xml")//emp[deptno eq $d/deptno]
where fn:count($e) &gt;= 10
order by fn:avg($e/salary) descending
return
   &lt;big-dept&gt;
      {
      $d/deptno,
      &lt;headcount&gt;{fn:count($e)}&lt;/headcount&gt;,
      &lt;avgsal&gt;{fn:avg($e/salary)}&lt;/avgsal&gt;
      }
   &lt;/big-dept&gt;
</ins>
</pre></div>
<div class="note">
<p class="prefix"><b><ins class="diff-new">Notes:</ins></b></p>
<ul>
<li>
<p><ins class="diff-new">The order in which items appear</ins> in
the <del class="diff-old">ordering by price, books with no price
are specified to occur last (as though they have</del> <ins 
class="diff-chg">result of a FLWOR expression depends on</ins> the
<del class="diff-old">least possible price). Whenever two books
with</del> <ins class="diff-chg">ordering of</ins> the <del 
class="diff-old">same title and price occur,</del> <ins class="diff-chg">input
 tuple stream to</ins> the <del class="diff-old">keyword</del> <code><del
 class="diff-old">stable</del>
<ins class="diff-chg">return</ins></code> <del class="diff-old">indicates
 that their input</del> <ins class="diff-chg">clause, which in turn is 
influenced by</ins> <code>order
<ins class="diff-new">by</ins></code> <ins class="diff-new">clauses
and by</ins> <a title="ordering mode" href="#dt-ordering-mode"><ins 
class="diff-new">ordering mode</ins></a>
.<ins class="diff-new">For example, consider the following query,
which</ins> is <del class="diff-old">preserved.</del> <ins 
class="diff-chg">based on the same two input documents as the previous
example:</ins></p>
<div class="exampleInner">
<pre><del class="diff-old">&lt;span class=
"parse-test"&gt;for $b in $books/book
stable order by $b/title 
      collation "http://www.example.org/collations/fr-ca",
   $b/price descending empty least
return $b
</del>
<ins class="diff-chg">for $d in fn:doc("depts.xml")//dept
order by $d/deptno
for $e in fn:doc("emps.xml")//emp[deptno eq $d/deptno]
return
   &lt;assignment&gt;
      {$d/deptno, $e/name}
   &lt;/assignment&gt;
</ins>
</pre></div>
<del class="diff-old">Note:</del>
<p><ins class="diff-chg">The result of this query is a sequence
of</ins> <code><ins class="diff-chg">assignment</ins></code>
<ins class="diff-chg">elements, each containing a</ins>
<code><ins class="diff-chg">deptno</ins></code> <ins class="diff-chg">element
 and a</ins> <code><ins class="diff-chg">name</ins></code> <ins 
class="diff-chg">element. The
sequence will be ordered primarily by the</ins> <code><ins 
class="diff-chg">deptno</ins></code> <ins class="diff-chg">values 
because
of the</ins> <code><ins class="diff-chg">order by</ins></code>
<ins class="diff-chg">clause. If</ins> <a title="ordering mode" 
href="#dt-ordering-mode"><ins class="diff-chg">ordering
mode</ins></a> <ins class="diff-chg">is</ins> <code><ins 
class="diff-chg">ordered</ins></code> ,<ins class="diff-chg">subsequences
of</ins> <code><ins class="diff-chg">assignment</ins></code>
<ins class="diff-chg">elements with equal</ins> <code><ins 
class="diff-chg">deptno</ins></code> <ins class="diff-chg">values will 
be
ordered by the document order of their</ins> <code><ins class="diff-chg">name</ins></code>
 <ins class="diff-chg">elements within
the</ins> <code><ins class="diff-chg">emps.xml</ins></code>
<ins class="diff-chg">document; otherwise the ordering of these
subsequences will be</ins> <a title="implementation dependent" 
href="#dt-implementation-dependent"><ins class="diff-chg">implementation-dependent</ins></a>
 .</p>
</li>
<li>
<p>Parentheses are helpful in <code>return</code> clauses that
contain comma operators, since FLWOR expressions have a higher
precedence than the comma operator. For <del class="diff-old">instance,</del>
 <ins class="diff-chg">example,</ins> the
following query raises an error because after the comma,
<code>$j</code> is no longer within the FLWOR expression, and is an
undefined variable:</p>
<div class="exampleInner">
<pre>let $i := 5,
    $j := 20 * $i
return $i, $j
</pre></div>
<p>Parentheses can be used to bring <code>$j</code> into the
<code>return</code> clause of the FLWOR expression, as the
programmer probably intended:</p>
<div class="exampleInner">
<pre>let $i := 5,
    $j := 20 * $i
return ($i, $j)
</pre></div>
</li>
</ul>
</div>
</div>
</div>
<del class="diff-old">3.8.4 Example The following example
illustrates how FLWOR expressions can be nested, and how ordering
can be specified at multiple levels of an element hierarchy. The
example query inverts a document hierarchy to transform a
bibliography into an author list. The input (bound to the variable
$bib ) is a bib element containing a list of books, each of which
in turn contains a list of authors. The example is based on the
following input: &lt;bib&gt; &lt;book&gt; &lt;title&gt;TCP/IP
Illustrated&lt;/title&gt; &lt;author&gt;Stevens&lt;/author&gt;
&lt;publisher&gt;Addison-Wesley&lt;/publisher&gt; &lt;/book&gt;
&lt;book&gt; &lt;title&gt;Advanced Programming in the Unix
Environment&lt;/title&gt; &lt;author&gt;Stevens&lt;/author&gt;
&lt;publisher&gt;Addison-Wesley&lt;/publisher&gt; &lt;/book&gt;
&lt;book&gt; &lt;title&gt;Data on the Web&lt;/title&gt;
&lt;author&gt;Abiteboul&lt;/author&gt;
&lt;author&gt;Buneman&lt;/author&gt;
&lt;author&gt;Suciu&lt;/author&gt; &lt;/book&gt; &lt;/bib&gt; The
following query transforms the input document into a list in which
each author's name appears only once, followed by a list of titles
of books written by that author. The fn:distinct-values function is
used to eliminate duplicates (by value) from a list of author
nodes. The author list, and the lists of books published by each
author, are returned in alphabetic order using the default
collation . &lt;authlist&gt; { for $a in
fn:distinct-values($bib/book/author) order by $a return
&lt;author&gt; &lt;name&gt; {$a} &lt;/name&gt; &lt;books&gt; { for
$b in $bib/book[author = $a] order by $b/title return $b/title }
&lt;/books&gt; &lt;/author&gt; } &lt;/authlist&gt; The result of
the above expression is as follows: &lt;authlist&gt; &lt;author&gt;
&lt;name&gt;Abiteboul&lt;/name&gt; &lt;books&gt; &lt;title&gt;Data
on the Web&lt;/title&gt; &lt;/books&gt; &lt;/author&gt;
&lt;author&gt; &lt;name&gt;Buneman&lt;/name&gt; &lt;books&gt;
&lt;title&gt;Data on the Web&lt;/title&gt; &lt;/books&gt;
&lt;/author&gt; &lt;author&gt; &lt;name&gt;Stevens&lt;/name&gt;
&lt;books&gt; &lt;title&gt;Advanced Programming in the Unix
Environment&lt;/title&gt; &lt;title&gt;TCP/IP
Illustrated&lt;/title&gt; &lt;/books&gt; &lt;/author&gt;
&lt;author&gt; &lt;name&gt;Suciu&lt;/name&gt; &lt;books&gt;
&lt;title&gt;Data on the Web&lt;/title&gt; &lt;/books&gt;
&lt;/author&gt; &lt;/authlist&gt;</del>
<div class="div2">
<h3><a id="id-unordered-expressions" name="id-unordered-expressions"></a>
 <del class="diff-old">3.9</del>
<ins class="diff-chg">3.10</ins> Ordered and Unordered
Expressions</h3>
<h5><a id="N15CD6" name="N15CD6"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-OrderedExpr" name="doc-xquery11-OrderedExpr"></a>
 <del class="diff-old">[91]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[132]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-OrderedExpr">OrderedExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"ordered" "{" <a href="#doc-xquery11-Expr">Expr</a>
"}"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-UnorderedExpr" name="doc-xquery11-UnorderedExpr"></a>
 <del class="diff-old">[92]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[133]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-UnorderedExpr">UnorderedExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"unordered" "{" <a href="#doc-xquery11-Expr">Expr</a>
"}"</code></td>
</tr>
</tbody>
</table>
<p>The purpose of <code>ordered</code> and <code>unordered</code>
expressions is to set the <a title="ordering mode" 
href="#dt-ordering-mode">ordering mode</a> in the <a title="static 
context" href="#dt-static-context">static context</a> to
<code>ordered</code> or <code>unordered</code> for a certain region
in a query. The specified ordering mode applies to the expression
nested inside the curly braces. For expressions where the ordering
of the result is not significant, a performance advantage may be
realized by setting the ordering mode to <code>unordered</code> ,
thereby granting the system flexibility to return the result in the
order that it finds most efficient.</p>
<p><a title="ordering mode" href="#dt-ordering-mode">Ordering
mode</a> affects the behavior of <a title="path expression" 
href="#dt-path-expression">path expressions</a> that include a "
<code>/</code> " or " <code>//</code> " operator or an <a title="axis 
step" href="#dt-axis-step">axis step</a> ; <code>union</code>
, <code>intersect</code> , and <code>except</code> expressions; the
<code>fn:id</code> and <code>fn:idref</code> functions; and
<ins class="diff-new">certain clauses within a</ins> FLWOR
<del class="diff-old">expressions that have no order by
clause.</del> <ins class="diff-chg">expression.</ins> If ordering
mode is <code>ordered</code> , node sequences returned by path
expressions, <code>union</code> , <code>intersect</code> , and
<code>except</code> expressions, and the <code>fn:id</code> and
<code>fn:idref</code> functions are in <a title="document order" 
href="#dt-document-order">document order</a> ; otherwise the order
of these return sequences is <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a> .
The effect of ordering mode on FLWOR expressions is described in
<a href="#id-xquery-for-clause"><b><del class="diff-old">3.8 FLWOR
Expressions</del> <ins class="diff-chg">3.9.2 For
Clause</ins></b></a> ,<a href="#id-effects-of-window-clauses"><b><ins 
class="diff-chg">3.9.4.3
Effects of Window Clauses on the Tuple Stream</ins></b></a>
,<ins class="diff-chg">and</ins> <a href="#id-group-by"><b><ins 
class="diff-chg">3.9.7 Group By
Clause</ins></b></a> . Ordering mode has no effect on duplicate
elimination.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>In a region of a query where ordering mode is
<code>unordered</code> , the result of an expression may be
nondeterministic if the expression invokes certain functions that
are affected by the ordering of node sequences. These functions
include <code>fn:position</code> , <code>fn:last</code> ,
<code>fn:index-of</code> , <code>fn:insert-before</code> ,
<code>fn:remove</code> , <code>fn:reverse</code> , and
<code>fn:subsequence</code> . Also, within a <a title="path expression" 
href="#dt-path-expression">path expression</a> in
an unordered region, <a title="numeric predicate" 
href="#dt-numeric-predicate">numeric predicates</a> are
nondeterministic. For example, in an ordered region, the path
expression <code>(//a/b)[5]</code> will return the fifth qualifying
<code>b</code> -element in <a title="document order" 
href="#dt-document-order">document order</a> . In an unordered region,
the same expression will return an <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a>
qualifying <code>b</code> -element.</p>
</div>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The <code>fn:id</code> and <code>fn:idref</code> functions are
described in <a href="#xpath-functions-11">[XQuery <del class="diff-old">1.0</del>
 and XPath <del class="diff-old">2.0</del>
Functions and <del class="diff-old">Operators]</del> <ins 
class="diff-chg">Operators 1.1]</ins></a> as returning their results in
<a title="document order" href="#dt-document-order">document
order</a> . Since ordering mode is a feature of XQuery, relaxation
of the ordering requirement for function results when ordering mode
is <code>unordered</code> is a feature of XQuery rather than of the
functions themselves.</p>
</div>
<p>The use of an <code>unordered</code> expression is illustrated
by the following example, which joins together two documents named
<code>parts.xml</code> and <code>suppliers.xml</code> . The example
returns the part numbers of red parts, paired with the supplier
numbers of suppliers who supply these parts. If an
<code>unordered</code> expression were not used, the resulting list
of (part number, supplier number) pairs would be required to have
an ordering that is controlled primarily by the <a title="document 
order" href="#dt-document-order">document order</a> of
<code>parts.xml</code> and secondarily by the <a title="document order" 
href="#dt-document-order">document order</a> of
<code>suppliers.xml</code> . However, this might not be the most
efficient way to process the query if the ordering of the result is
not important. An XQuery implementation might be able to process
the query more efficiently by using an index to find the red parts,
or by using <code>suppliers.xml</code> rather than
<code>parts.xml</code> to control the primary ordering of the
result. The <code>unordered</code> expression gives the query
evaluator freedom to make these kinds of optimizations.</p>
<div class="exampleInner">
<pre><del class="diff-old">unordered {
</del>
<ins class="diff-chg">unordered {
</ins>
  for $p in fn:doc("parts.xml")/parts/part[color = "Red"],
      $s in fn:doc("suppliers.xml")/suppliers/supplier
  where $p/suppno = $s/suppno  
  return
    &lt;ps&gt;
       { $p/partno, $s/suppno }
    &lt;/ps&gt;
<del class="diff-old">}
</del>
<ins class="diff-chg">}
</ins>
</pre></div>
<p>In addition to <code>ordered</code> and <code>unordered</code>
expressions, XQuery provides a function named
<code>fn:unordered</code> that operates on any sequence of items
and returns the same sequence in a nondeterministic order. A call
to the <code>fn:unordered</code> function may be thought of as
giving permission for the argument expression to be materialized in
whatever order the system finds most efficient. The
<code>fn:unordered</code> function relaxes ordering only for the
sequence that is its immediate operand, whereas an
<code>unordered</code> expression sets the <a title="ordering mode" 
href="#dt-ordering-mode">ordering mode</a> for its operand
expression and all nested expressions.</p>
</div>
<div class="div2">
<h3><a id="id-conditionals" name="id-conditionals"></a> <del 
class="diff-old">3.10</del> <ins class="diff-chg">3.11</ins> Conditional
Expressions</h3>
<p>XQuery <ins class="diff-new">1.1</ins> supports a conditional
expression based on the keywords <code>if</code> ,
<code>then</code> , and <code>else</code> .</p>
<h5><a id="N15DEA" name="N15DEA"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-IfExpr" name="doc-xquery11-IfExpr"></a>
<del class="diff-old">[45]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[76]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-IfExpr">IfExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"if" "(" <a href="#doc-xquery11-Expr">Expr</a> ")" "then"
<a href="#doc-xquery11-ExprSingle">ExprSingle</a> "else" <a 
href="#doc-xquery11-ExprSingle">ExprSingle</a></code></td>
</tr>
</tbody>
</table>
<p>The expression following the <code>if</code> keyword is called
the <b>test expression</b> , and the expressions following the
<code>then</code> and <code>else</code> keywords are called the
<b>then-expression</b> and <b>else-expression</b> ,
respectively.</p>
<p>The first step in processing a conditional expression is to find
the <a title="effective boolean value" href="#dt-ebv">effective
boolean value</a> of the test expression, as defined in <a 
href="#id-ebv"><b>2.4.3 Effective Boolean Value</b></a> .</p>
<p>The value of a conditional expression is defined as follows: If
the effective boolean value of the test expression is
<code>true</code> , the value of the then-expression is returned.
If the effective boolean value of the test expression is
<code>false</code> , the value of the else-expression is
returned.</p>
<p>Conditional expressions have a special rule for propagating
<a title="dynamic error" href="#dt-dynamic-error">dynamic
errors</a> . If the effective value of the test expression is
<code>true</code> , the conditional expression ignores (does not
raise) any dynamic errors encountered in the else-expression. In
this case, since the else-expression can have no observable effect,
it need not be evaluated. Similarly, if the effective value of the
test expression is <code>false</code> , the conditional expression
ignores any <a title="dynamic error" href="#dt-dynamic-error">dynamic 
errors</a> encountered in the
then-expression, and the then-expression need not be evaluated.</p>
<p>Here are some examples of conditional expressions:</p>
<ul>
<li>
<p>In this example, the test expression is a comparison
expression:</p>
<div class="exampleInner">
<pre>if ($widget1/unit-cost &lt; $widget2/unit-cost) 
  then $widget1
  else $widget2
</pre></div>
</li>
<li>
<p>In this example, the test expression tests for the existence of
an attribute named <code>discounted</code> , independently of its
value:</p>
<div class="exampleInner">
<pre>if ($part/@discounted) 
  then $part/wholesale 
  else $part/retail
</pre></div>
</li>
</ul>
</div>
<div class="div2">
<h3><a id="id-switch" name="id-switch"></a> <ins class="diff-new">3.12 
Switch Expression</ins></h3>
<h5><a id="N15E54" name="N15E54"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-SwitchExpr" name="doc-xquery11-SwitchExpr"></a><ins
 class="diff-new">[70]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-SwitchExpr"><ins class="diff-new">SwitchExpr</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"switch" "("</ins> <a 
href="#doc-xquery11-Expr"><ins class="diff-new">Expr</ins></a>
<ins class="diff-new">")"</ins> <a href="#doc-xquery11-SwitchCaseClause"><ins
 class="diff-new">SwitchCaseClause</ins></a> <ins class="diff-new">+
"default" "return"</ins> <a href="#doc-xquery11-ExprSingle"><ins 
class="diff-new">ExprSingle</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-SwitchCaseClause" 
name="doc-xquery11-SwitchCaseClause"></a><ins class="diff-new">[71]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-SwitchCaseClause"><ins 
class="diff-new">SwitchCaseClause</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">("case"</ins> <a 
href="#doc-xquery11-SwitchCaseOperand"><ins class="diff-new">SwitchCaseOperand</ins></a>
 <ins class="diff-new">)+
"return"</ins> <a href="#doc-xquery11-ExprSingle"><ins class="diff-new">ExprSingle</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-SwitchCaseOperand" 
name="doc-xquery11-SwitchCaseOperand"></a><ins class="diff-new">[72]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-SwitchCaseOperand"><ins 
class="diff-new">SwitchCaseOperand</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ExprSingle"><ins class="diff-new">ExprSingle</ins></a></code></td>
</tr>
</tbody>
</table>
<p><ins class="diff-new">The</ins> <b><ins class="diff-new">switch
expression</ins></b> <ins class="diff-new">chooses one of several
expressions to evaluate based on the input value.</ins></p>
<p><ins class="diff-new">In a</ins> <code><ins class="diff-new">switch</ins></code>
 <ins class="diff-new">expression,
the</ins> <code><ins class="diff-new">switch</ins></code>
<ins class="diff-new">keyword is followed by an expression enclosed
in parentheses, called the</ins> <b><ins class="diff-new">switch
operand expression</ins></b> .<ins class="diff-new">This is the
expression whose value is being compared. The remainder of
the</ins> <code><ins class="diff-new">switch</ins></code>
<ins class="diff-new">expression consists of one or more</ins>
<code><ins class="diff-new">case</ins></code> <ins class="diff-new">clauses,
 with one or more</ins> <code><ins class="diff-new">case operand 
expressions</ins></code> <ins class="diff-new">each, and a</ins> <code><ins
 class="diff-new">default</ins></code> <ins class="diff-new">clause.</ins></p>
<p><ins class="diff-new">The first step in evaluating a switch
expression is to apply atomization to the value of the switch
operand expression. If the result is a sequence of length greater
than one, a type error is raised [</ins> <a title="err:XPTY0004" 
href="#ERRXPTY0004"><ins class="diff-new">err:XPTY0004</ins></a>
<ins class="diff-new">].</ins></p>
<p><ins class="diff-new">The resulting value is matched against
each</ins> <a href="#doc-xquery11-SwitchCaseOperand"><ins 
class="diff-new">SwitchCaseOperand</ins></a> <ins class="diff-new">in
turn until a match is found or the list is exhausted. The matching
is performed as follows:</ins></p>
<ol class="enumar">
<li>
<p><ins class="diff-new">The</ins> <a 
href="#doc-xquery11-SwitchCaseOperand"><ins class="diff-new">SwitchCaseOperand</ins></a>
 <ins class="diff-new">is
evaluated.</ins></p>
</li>
<li>
<p><ins class="diff-new">The resulting value is atomized.</ins></p>
</li>
<li>
<p><ins class="diff-new">If the atomized sequence has length
greater than one, a type error is raised [</ins> <a title="err:XPTY0004"
 href="#ERRXPTY0004"><ins class="diff-new">err:XPTY0004</ins></a> <ins 
class="diff-new">].</ins></p>
</li>
<li>
<p><ins class="diff-new">The atomized value of the switch operand
expression is compared with the atomized value of the</ins>
<a href="#doc-xquery11-SwitchCaseOperand"><ins class="diff-new">SwitchCaseOperand</ins></a>
 <ins class="diff-new">using
the</ins> <code><ins class="diff-new">fn:deep-equal</ins></code>
<ins class="diff-new">function, with the default collation from the
static context.</ins></p>
</li>
</ol>
<p><ins class="diff-new">[</ins> <a title="effective case" 
id="id-effective-case-switch-expression" 
name="id-effective-case-switch-expression"><ins class="diff-new">Definition</ins></a>
 :<ins class="diff-new">The</ins>
<b><ins class="diff-new">effective case</ins></b> <ins class="diff-new">of
 a switch expression is the first case clause that
matches, using the rules given above.] The value of the switch
expression is the value of the return expression in the effective
case.</ins></p>
<p><ins class="diff-new">Switch expressions have rules regarding
the propagation of dynamic errors that take precedence over the
general rules given in</ins> <a href="#id-errors-and-opt"><b><ins 
class="diff-new">2.3.4 Errors and
Optimization</ins></b></a> .<ins class="diff-new">The return
clauses of a switch expression do not raise any dynamic errors
except in the effective case. Dynamic errors raised in the operand
expressions of the switch or the case clauses are propagated;
however, an implementation must not raise errors in the operand
expressions of case clauses that occur after the effective
case.</ins></p>
<p><ins class="diff-new">The following example shows how a switch
expression might be used:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
switch ($animal) 
   case "Cow" return "Moo"
   case "Cat" return "Meow"
   case "Duck" return "Quack"
   default return "What's that odd noise?" 
 
</ins>
</pre></div>
</div>
<div class="div2">
<h3><a id="id-quantified-expressions" name="id-quantified-expressions"></a>
 <del class="diff-old">3.11</del>
<ins class="diff-chg">3.13</ins> Quantified Expressions</h3>
<p>Quantified expressions support existential and universal
quantification. The value of a quantified expression is always
<code>true</code> or <code>false</code> .</p>
<h5><a id="N15EFB" name="N15EFB"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-QuantifiedExpr" 
name="doc-xquery11-QuantifiedExpr"></a> <del class="diff-old">[42]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[69]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-QuantifiedExpr">QuantifiedExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>("some" | "every") "$" <a href="#doc-xquery11-VarName">VarName</a>
 <a href="#doc-xquery11-TypeDeclaration">TypeDeclaration</a> ? "in" <a 
href="#doc-xquery11-ExprSingle">ExprSingle</a> ("," "$" <a 
href="#doc-xquery11-VarName">VarName</a> <a 
href="#doc-xquery11-TypeDeclaration">TypeDeclaration</a> ? "in" <a 
href="#doc-xquery11-ExprSingle">ExprSingle</a> )* "satisfies" <a 
href="#doc-xquery11-ExprSingle">ExprSingle</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N15E75.doc-xquery11-TypeDeclaration" 
name="noid_N15E75.doc-xquery11-TypeDeclaration"></a> <del 
class="diff-old">[118]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[168]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code>TypeDeclaration</code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"as" <a href="#doc-xquery11-SequenceType">SequenceType</a></code></td>
</tr>
</tbody>
</table>
<p>A <b>quantified expression</b> begins with a <b>quantifier</b> ,
which is the keyword <code>some</code> or <code>every</code> ,
followed by one or more in-clauses that are used to bind variables,
followed by the keyword <code>satisfies</code> and a test
expression. Each in-clause associates a variable with an expression
that returns a sequence of items, called the binding sequence for
that variable. The in-clauses generate tuples of variable bindings,
including a tuple for each combination of items in the binding
sequences of the respective variables. Conceptually, the test
expression is evaluated for each tuple of variable bindings.
Results depend on the <a title="effective boolean value" href="#dt-ebv">effective
 boolean value</a> of the test expressions, as
defined in <a href="#id-ebv"><b>2.4.3 Effective Boolean
Value</b></a> . The value of the quantified expression is defined
by the following rules:</p>
<ol class="enumar">
<li>
<p>If the quantifier is <code>some</code> , the quantified
expression is <code>true</code> if at least one evaluation of the
test expression has the <a title="effective boolean value" 
href="#dt-ebv">effective boolean value</a> <code>true</code> ; otherwise
the quantified expression is <code>false</code> . This rule implies
that, if the in-clauses generate zero binding tuples, the value of
the quantified expression is <code>false</code> .</p>
</li>
<li>
<p>If the quantifier is <code>every</code> , the quantified
expression is <code>true</code> if every evaluation of the test
expression has the <a title="effective boolean value" href="#dt-ebv">effective
 boolean value</a> <code>true</code> ; otherwise
the quantified expression is <code>false</code> . This rule implies
that, if the in-clauses generate zero binding tuples, the value of
the quantified expression is <code>true</code> .</p>
</li>
</ol>
<p>The scope of a variable bound in a quantified expression
comprises all subexpressions of the quantified expression that
appear after the variable binding. The scope does not include the
expression to which the variable is bound.</p>
<p class="xquery">Each variable bound in an in-clause of a
quantified expression may have an optional <a 
href="#doc-xquery11-TypeDeclaration">type declaration</a> . If the type
of a value bound to the variable does not match the declared type
according to the rules for <a title="SequenceType matching" 
href="#dt-sequencetype-matching">SequenceType matching</a> , a <a 
title="type error" href="#dt-type-error">type error</a> is raised [
<a title="err:XPTY0004" href="#ERRXPTY0004">err:XPTY0004</a> ].</p>
<p>The order in which test expressions are evaluated for the
various binding tuples is <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a> . If
the quantifier is <code>some</code> , an implementation may return
<code>true</code> as soon as it finds one binding tuple for which
the test expression has an <a title="effective boolean value" 
href="#dt-ebv">effective boolean value</a> of <code>true</code> , and it
may raise a <a title="dynamic error" href="#dt-dynamic-error">dynamic 
error</a> as soon as it finds one
binding tuple for which the test expression raises an error.
Similarly, if the quantifier is <code>every</code> , an
implementation may return <code>false</code> as soon as it finds
one binding tuple for which the test expression has an <a 
title="effective boolean value" href="#dt-ebv">effective boolean
value</a> of <code>false</code> , and it may raise a <a title="dynamic 
error" href="#dt-dynamic-error">dynamic error</a> as soon
as it finds one binding tuple for which the test expression raises
an error. As a result of these rules, the value of a quantified
expression is not deterministic in the presence of errors, as
illustrated in the examples below.</p>
<p>Here are some examples of quantified expressions:</p>
<ul>
<li>
<p>This expression is <code>true</code> if every <code>part</code>
element has a <code>discounted</code> attribute (regardless of the
values of these attributes):</p>
<div class="exampleInner">
<pre>every $part in /parts/part satisfies $part/@discounted
</pre></div>
</li>
<li>
<p>This expression is <code>true</code> if at least one
<code>employee</code> element satisfies the given comparison
expression:</p>
<div class="exampleInner">
<pre>some $emp in /emps/employee satisfies 
     ($emp/bonus &gt; 0.25 * $emp/salary)
</pre></div>
</li>
<li>
<p>In the following examples, each quantified expression evaluates
its test expression over nine tuples of variable bindings, formed
from the Cartesian product of the sequences <code>(1, 2, 3)</code>
and <code>(2, 3, 4)</code> . The expression beginning with
<code>some</code> evaluates to <code>true</code> , and the
expression beginning with <code>every</code> evaluates to
<code>false</code> .</p>
<div class="exampleInner">
<pre><del class="diff-old">&lt;span class=
"parse-test"&gt;some $x in (1, 2, 3), $y in (2, 3, 4) 
     satisfies $x + $y = 4
</del>
<ins class="diff-chg">some $x in (1, 2, 3), $y in (2, 3, 4) 
satisfies $x + $y = 4
</ins>
</pre></div>
<div class="exampleInner">
<pre><del class="diff-old">&lt;span class=
"parse-test"&gt;every $x in (1, 2, 3), $y in (2, 3, 4) 
     satisfies $x + $y = 4
</del>
<ins class="diff-chg">every $x in (1, 2, 3), $y in (2, 3, 4) 
satisfies $x + $y = 4
</ins>
</pre></div>
</li>
<li>
<p>This quantified expression may either return <code>true</code>
or raise a <a title="type error" href="#dt-type-error">type
error</a> , since its test expression returns <code>true</code> for
one variable binding and raises a <a title="type error" 
href="#dt-type-error">type error</a> for another:</p>
<div class="exampleInner">
<pre>some $x in (1, 2, "cat") satisfies $x * 2 = 4
</pre></div>
</li>
<li>
<p>This quantified expression may either return <code>false</code>
or raise a <a title="type error" href="#dt-type-error">type
error</a> , since its test expression returns <code>false</code>
for one variable binding and raises a <a title="type error" 
href="#dt-type-error">type error</a> for another:</p>
<div class="exampleInner">
<pre>every $x in (1, 2, "cat") satisfies $x * 2 = 4
</pre></div>
</li>
<li>
<p>This quantified expression contains a <a 
href="#doc-xquery11-TypeDeclaration">type declaration</a> that is not
satisfied by every item in the test expression. If the <a title="static 
typing feature" href="#dt-static-typing-feature">Static
Typing Feature</a> is implemented, this expression raises a
<a title="type error" href="#dt-type-error">type error</a> during
the <a title="static analysis phase" href="#dt-static-analysis">static 
analysis phase</a> . Otherwise, the
expression may either return <code>true</code> or raise a <a title="type
 error" href="#dt-type-error">type error</a> during the
<a title="dynamic evaluation phase" href="#dt-dynamic-evaluation">dynamic
 evaluation phase</a> .</p>
<div class="exampleInner">
<pre>some $x as xs:integer in (1, 2, "cat") satisfies $x * 2 = 4
</pre></div>
</li>
</ul>
</div>
<div class="div2">
<h3><a id="id-try-catch" name="id-try-catch"></a> <ins class="diff-new">3.14
 Try/Catch Expressions</ins></h3>
<p><ins class="diff-new">The try/catch expression provides error
handling for dynamic errors and type errors raised during dynamic
evaluation, including errors raised by the XQuery implementation
and errors explicitly raised in a query using the</ins>
<code><ins class="diff-new">fn:error()</ins></code> <ins 
class="diff-new">function.</ins></p>
<h5><a id="N16056" name="N16056"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-TryCatchExpr" name="doc-xquery11-TryCatchExpr"></a><ins
 class="diff-new">[77]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-TryCatchExpr"><ins class="diff-new">TryCatchExpr</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-TryClause"><ins class="diff-new">TryClause</ins></a>
 <a href="#doc-xquery11-CatchClause"><ins class="diff-new">CatchClause</ins></a>
 <ins class="diff-new">+</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-TryClause" name="doc-xquery11-TryClause"></a><ins
 class="diff-new">[78]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-TryClause"><ins class="diff-new">TryClause</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"try" "{"</ins> <a 
href="#doc-xquery11-TryTargetExpr"><ins class="diff-new">TryTargetExpr</ins></a>
 <ins class="diff-new">"}"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-TryTargetExpr" name="doc-xquery11-TryTargetExpr"></a><ins
 class="diff-new">[79]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-TryTargetExpr"><ins class="diff-new">TryTargetExpr</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-Expr"><ins class="diff-new">Expr</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CatchClause" name="doc-xquery11-CatchClause"></a><ins
 class="diff-new">[80]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CatchClause"><ins class="diff-new">CatchClause</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"catch"</ins> <a 
href="#doc-xquery11-CatchErrorList"><ins class="diff-new">CatchErrorList</ins></a>
 <a href="#doc-xquery11-CatchVars"><ins class="diff-new">CatchVars</ins></a>
<ins class="diff-new">? "{"</ins> <a href="#doc-xquery11-Expr"><ins 
class="diff-new">Expr</ins></a>
<ins class="diff-new">"}"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CatchErrorList" 
name="doc-xquery11-CatchErrorList"></a><ins class="diff-new">[81]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CatchErrorList"><ins class="diff-new">CatchErrorList</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-NameTest"><ins class="diff-new">NameTest</ins></a>
 <ins class="diff-new">("|"</ins>
<a href="#doc-xquery11-NameTest"><ins class="diff-new">NameTest</ins></a>
 <ins class="diff-new">)*</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CatchVars" name="doc-xquery11-CatchVars"></a><ins
 class="diff-new">[82]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CatchVars"><ins class="diff-new">CatchVars</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"("</ins> <a 
href="#doc-xquery11-CatchErrorCode"><ins class="diff-new">CatchErrorCode</ins></a>
 <ins class="diff-new">(","</ins> <a href="#doc-xquery11-CatchErrorDesc"><ins
 class="diff-new">CatchErrorDesc</ins></a> <ins class="diff-new">(","</ins>
 <a href="#doc-xquery11-CatchErrorVal"><ins class="diff-new">CatchErrorVal</ins></a>
 <ins class="diff-new">)?)?
")"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CatchErrorCode" 
name="doc-xquery11-CatchErrorCode"></a><ins class="diff-new">[83]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CatchErrorCode"><ins class="diff-new">CatchErrorCode</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"$"</ins> <a 
href="#doc-xquery11-VarName"><ins class="diff-new">VarName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CatchErrorDesc" 
name="doc-xquery11-CatchErrorDesc"></a><ins class="diff-new">[84]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CatchErrorDesc"><ins class="diff-new">CatchErrorDesc</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"$"</ins> <a 
href="#doc-xquery11-VarName"><ins class="diff-new">VarName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CatchErrorVal" name="doc-xquery11-CatchErrorVal"></a><ins
 class="diff-new">[85]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CatchErrorVal"><ins class="diff-new">CatchErrorVal</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"$"</ins> <a 
href="#doc-xquery11-VarName"><ins class="diff-new">VarName</ins></a></code></td>
</tr>
</tbody>
</table>
<p><ins class="diff-new">A try/catch expression catches</ins>
<a title="dynamic error" href="#dt-dynamic-error"><ins class="diff-new">dynamic
 errors</ins></a> <ins class="diff-new">and</ins>
<a title="type error" href="#dt-type-error"><ins class="diff-new">type 
errors</ins></a> <ins class="diff-new">raised
during dynamic evaluation for expressions that are lexically
contained within the</ins> <code><ins class="diff-new">try</ins></code> <ins
 class="diff-new">clause. If the
target expression does not raise a dynamic error or a type error,
the result of the try/catch expression is the result of the target
expression.</ins></p>
<p><ins class="diff-new">If the target expression raises a dynamic
error or a type error, the result of the try/catch expression is
obtained by evaluating the first</ins> <code><ins class="diff-new">catch</ins></code>
 <ins class="diff-new">clause that
"matches" the error value, as described below. A</ins>
<code><ins class="diff-new">catch</ins></code> <ins class="diff-new">clause
 with one or more NameTests matches any error
whose error code matches one of these NameTests. For instance, if
the error code is</ins> <code><ins class="diff-new">err:FOER0000</ins></code>
 ,<ins class="diff-new">then it
matches a</ins> <code><ins class="diff-new">catch</ins></code>
<ins class="diff-new">clause whose ErrorList is</ins>
<code><ins class="diff-new">err:FOER0000 |
err:FOER0001</ins></code> .<ins class="diff-new">Wildcards may be
used in NameTests; thus, the error code</ins> <code><ins 
class="diff-new">err:FOER0000</ins></code> <ins class="diff-new">also
matches a</ins> <code><ins class="diff-new">catch</ins></code>
<ins class="diff-new">clause whose ErrorList is</ins>
<code><ins class="diff-new">err:*</ins></code> <ins class="diff-new">or</ins>
 <code><ins class="diff-new">*:FOER0000</ins></code> <ins 
class="diff-new">or</ins>
<code><ins class="diff-new">*</ins></code> .</p>
<p><ins class="diff-new">If an error is matched, the optional
variables in the</ins> <code><ins class="diff-new">catch</ins></code> <ins
 class="diff-new">clause are
bound, in order, to the error's code, description, and value. These
variables are then in scope in the</ins> <code><ins class="diff-new">catch</ins></code>
 <ins class="diff-new">clause. The
types of these variables match the types of the corresponding
parameters in the</ins> <code><ins class="diff-new">error()</ins></code>
 <ins class="diff-new">function:</ins> <code><ins class="diff-new">ErrorCode</ins></code>
 <ins class="diff-new">has
type</ins> <code><ins class="diff-new">xs:QName</ins></code>
,<code><ins class="diff-new">ErrorDescr</ins></code> <ins 
class="diff-new">has type</ins> <code><ins class="diff-new">xs:string?</ins></code>
 ,<ins class="diff-new">and</ins>
<code><ins class="diff-new">ErrorVal</ins></code> <ins class="diff-new">has
 type</ins> <code><ins class="diff-new">item()*</ins></code> .<ins 
class="diff-new">If no</ins>
<code><ins class="diff-new">catch</ins></code> <ins class="diff-new">clause
 matches an error, the try/catch expression raises
that error. If an error is raised in a catch clause, the try/catch
expression raises that error.</ins></p>
<p><ins class="diff-new">If an error found in a</ins>
<code><ins class="diff-new">try</ins></code> <ins class="diff-new">clause
 can be detected statically, an implementation is
free to raise a static error. Static errors are not caught by the
try/catch expression.</ins></p>
<p><ins class="diff-new">If a function call occurs within a</ins>
<code><ins class="diff-new">try</ins></code> <ins class="diff-new">clause,
 errors raised by evaluating the corresponding
function are caught by the try/catch expression. If a variable
reference is used in a</ins> <code><ins class="diff-new">try</ins></code>
 <ins class="diff-new">clause, errors
raised by binding a value to the variable are not caught unless the
binding expression occurs within the</ins> <code><ins class="diff-new">try</ins></code>
 <ins class="diff-new">clause.</ins></p>
<div class="note">
<p class="prefix"><b><ins class="diff-new">Note:</ins></b></p>
<p><ins class="diff-new">The presence of a try/catch expression
does not prevent an implementation from using a lazy evaluation
strategy, nor does it prevent an optimizer performing expression
rewrites. However, if the evaluation of an expression inside a
try/catch is rewritten or deferred in this way, it must take its
try/catch context with it. Similarly, expressions that were written
outside the try/catch expression may be evaluated inside the
try/catch, but only if they retain their original try/catch
behavior. The presence of a try/catch does not change the rules
that allow the processor to evaluate expressions in such a way that
may avoid the detection of some errors.</ins></p>
</div>
<p><ins class="diff-new">Here are some examples of try/catch
expressions.</ins></p>
<ul>
<li>
<p><ins class="diff-new">A try/catch expression without a
CatchErrorList catches any error:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
try {
    $x cast as xs:integer
}
catch * {
    0
}
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-new">The CatchErrorList in this try/catch
expression specifies that only</ins> <code><ins class="diff-new">err:FORG0001</ins></code>
 <ins class="diff-new">is
caught:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
try {
    $x cast as xs:integer
}
catch err:FORG0001 {
    0
}
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-new">The CatchErrorList in this try/catch
expression specifies that errors</ins> <code><ins class="diff-new">err:FORG0001</ins></code>
 <ins class="diff-new">and</ins> <code><ins class="diff-new">err:XPTY0004</ins></code>
 <ins class="diff-new">are
caught:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
try {
    $x cast as xs:integer
}
catch err:FORG0001 | err:XPTY0004 {
    0
}
</ins>
</pre></div>
<div class="note">
<p class="prefix"><b><ins class="diff-new">Note:</ins></b></p>
<p><ins class="diff-new">In some implementations,</ins>
<code><ins class="diff-new">err:XPTY0004</ins></code> <ins 
class="diff-new">is detected during static evaluation; it can only be
caught if it is raised during dynamic evaluation.</ins></p>
</div>
</li>
<li>
<p><ins class="diff-new">This try/catch expression shows how to
bind variables to the error code, error description, and error
value. Since the CatchErrorList is a wildcard, it catches any
error:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
try {
    fn:error(fn:QName('http://www.w3.org/2005/xqt-errors', 'err:FOER0000'))
}
catch * ($errcode, $errdesc, $errval) {
    $errcode, $errdesc
}
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-new">Errors raised by using the result of a
try/catch expression are not caught, since they are outside the
scope of the</ins> <code><ins class="diff-new">try</ins></code>
<ins class="diff-new">expression.</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
declare function local:thrice($x as xs:integer) as xs:integer
{
    3*$x
};
local:thrice(try { "oops" } catch * { 3 } )
</ins>
</pre></div>
<p><ins class="diff-new">In this example, the try block succeeds,
returning the string "oops", which is not a valid argument to the
function.</ins></p>
</li>
</ul>
</div>
<div class="div2">
<h3><a id="id-expressions-on-datatypes" 
name="id-expressions-on-datatypes"></a> <del class="diff-old">3.12</del>
<ins class="diff-chg">3.15</ins> Expressions on SequenceTypes</h3>
<p><span class="xquery">In addition to their use in function
parameters and results,</span> <a title="sequence type" 
href="#dt-sequence-type">sequence types</a> are used in <code>instance
of</code> , <span class="xquery"><code>typeswitch</code> ,</span>
<code>cast</code> , <code>castable</code> , and <code>treat</code>
expressions.</p>
<div class="div3">
<h4><a id="id-instance-of" name="id-instance-of"></a> <del 
class="diff-old">3.12.1</del> <ins class="diff-chg">3.15.1</ins> 
Instance
Of</h4>
<h5><a id="N161B1" name="N161B1"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-InstanceofExpr" 
name="doc-xquery11-InstanceofExpr"></a> <del class="diff-old">[54]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[94]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-InstanceofExpr">InstanceofExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-TreatExpr">TreatExpr</a> (
"instance" "of" <a href="#doc-xquery11-SequenceType">SequenceType</a> )?</code></td>
</tr>
</tbody>
</table>
<p>The boolean operator <code>instance of</code> returns
<code>true</code> if the value of its first operand matches the
<a href="#doc-xquery11-SequenceType">SequenceType</a> in its second
operand, according to the rules for <a title="SequenceType matching" 
href="#dt-sequencetype-matching">SequenceType matching</a> ; otherwise
it returns <code>false</code> . For example:</p>
<ul>
<li>
<p><code>5 instance of xs:integer</code></p>
<p>This example returns <code>true</code> because the given value
is an instance of the given type.</p>
</li>
<li>
<p><code>5 instance of xs:decimal</code></p>
<p>This example returns <code>true</code> because the given value
is an integer literal, and <code>xs:integer</code> is derived by
restriction from <code>xs:decimal</code> .</p>
</li>
<li>
<p><code>&lt;a&gt;{5}&lt;/a&gt; instance of xs:integer</code></p>
<p>This example returns <code>false</code> because the given value
is an element rather than an integer.</p>
</li>
<li>
<p><code>(5, 6) instance of xs:integer+</code></p>
<p>This example returns <code>true</code> because the given
sequence contains two integers, and is a valid instance of the
specified type.</p>
</li>
<li>
<p><code>. instance of element()</code></p>
<p>This example returns <code>true</code> if the context item is an
element node or <code>false</code> if the context item is defined
but is not an element node. If the context item is undefined, a
<a title="dynamic error" href="#dt-dynamic-error">dynamic error</a>
is raised [ <a title="err:XPDY0002" href="#ERRXPDY0002">err:XPDY0002</a>
 ].</p>
</li>
</ul>
</div>
<div class="div3">
<h4><a id="id-typeswitch" name="id-typeswitch"></a> <del 
class="diff-old">3.12.2</del> <ins class="diff-chg">3.15.2</ins>
Typeswitch</h4>
<h5><a id="N1622F" name="N1622F"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-TypeswitchExpr" 
name="doc-xquery11-TypeswitchExpr"></a> <del class="diff-old">[43]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[73]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-TypeswitchExpr">TypeswitchExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"typeswitch" "(" <a href="#doc-xquery11-Expr">Expr</a>
")" <a href="#doc-xquery11-CaseClause">CaseClause</a> + "default"
("$" <a href="#doc-xquery11-VarName">VarName</a> )? "return"
<a href="#doc-xquery11-ExprSingle">ExprSingle</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CaseClause" name="doc-xquery11-CaseClause"></a> <del
 class="diff-old">[44]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[74]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CaseClause">CaseClause</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"case" ("$" <a href="#doc-xquery11-VarName">VarName</a>
"as")? <del class="diff-old">SequenceType</del> <a 
href="#doc-xquery11-SequenceTypeUnion"><ins class="diff-chg">SequenceTypeUnion</ins></a>
 "return" <a href="#doc-xquery11-ExprSingle">ExprSingle</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-SequenceTypeUnion" 
name="doc-xquery11-SequenceTypeUnion"></a> <ins class="diff-new">[75]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-SequenceTypeUnion"><ins 
class="diff-new">SequenceTypeUnion</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-SequenceType"><ins class="diff-new">SequenceType</ins></a>
 <ins class="diff-new">("|"</ins>
<a href="#doc-xquery11-SequenceType"><ins class="diff-new">SequenceType</ins></a>
 <ins class="diff-new">)*</ins></code></td>
</tr>
</tbody>
</table>
<p class="xquery">The <b>typeswitch</b> expression chooses one of
several expressions to evaluate based on the <a title="dynamic type" 
href="#dt-dynamic-type">dynamic type</a> of an input
value.</p>
<p class="xquery">In a <code>typeswitch</code> expression, the
<code>typeswitch</code> keyword is followed by an expression
enclosed in parentheses, called the <b>operand expression</b> .
This is the expression whose type is being tested. The remainder of
the <code>typeswitch</code> expression consists of one or more
<code>case</code> clauses and a <code>default</code> clause.</p>
<p class="xquery">Each <code>case</code> clause specifies
<del class="diff-old">a</del> <ins class="diff-chg">one or
more</ins> <a href="#doc-xquery11-SequenceType">SequenceType</a>
<ins class="diff-new">s</ins> followed by a <code>return</code>
expression. [ <a title="effective case" id="dt-effective-case" 
name="dt-effective-case">Definition</a> : The <b>effective case</b>
in a <code>typeswitch</code> expression is the first
<code>case</code> clause <del class="diff-old">such that</del>
<ins class="diff-chg">in which</ins> the value of the operand
expression matches <del class="diff-old">the</del> <ins class="diff-chg">a</ins>
 <a href="#doc-xquery11-SequenceType">SequenceType</a> in the <a 
href="#doc-xquery11-SequenceType"><ins class="diff-new">SequenceTypeUnion</ins></a>
 <ins class="diff-new">of
the</ins> <code>case</code> clause, using the rules of <a 
title="SequenceType matching" href="#dt-sequencetype-matching">SequenceType
 matching</a> .] The value
of the <code>typeswitch</code> expression is the value of the
<code>return</code> expression in the effective case. If the value
of the operand expression does not match any <a 
href="#doc-xquery11-SequenceType">SequenceType</a> named in a
<code>case</code> clause, the value of the <code>typeswitch</code>
expression is the value of the <code>return</code> expression in
the <code>default</code> clause.</p>
<p>In a <code>case</code> or <code>default</code> clause, if the
value to be returned depends on the value of the operand
expression, the clause must specify a variable name. Within the
<code>return</code> expression of the <code>case</code> or
<code>default</code> clause, this variable name is bound to the
value of the operand expression. Inside a <code>case</code> clause,
the <a title="static type" href="#dt-static-type">static type</a>
of the variable is the <ins class="diff-chg">union of the</ins>
<a href="#doc-xquery11-SequenceType">SequenceType</a> <ins 
class="diff-new">s</ins> named in the <del class="diff-old">case
clause.</del> <a href="#doc-xquery11-SequenceType"><ins class="diff-chg">SequenceTypeUnion</ins></a>
 . Inside a
<code>default</code> clause, the static type of the variable is the
same as the static type of the operand expression. If the value to
be returned by a <code>case</code> or <code>default</code> clause
does not depend on the value of the operand expression, the clause
need not specify a variable.</p>
<p>The scope of a variable binding in a <code>case</code> or
<code>default</code> clause comprises that clause. It is not an
error for more than one <code>case</code> or <code>default</code>
clause in the same <code>typeswitch</code> expression to bind
variables with the same name.</p>
<p>A special rule applies to propagation of <a title="dynamic error" 
href="#dt-dynamic-error">dynamic errors</a> by
<code>typeswitch</code> expressions. A <code>typeswitch</code>
expression ignores (does not raise) any dynamic errors encountered
in <code>case</code> clauses other than the <a title="effective case" 
href="#dt-effective-case">effective case</a> .
Dynamic errors encountered in the <code>default</code> clause are
raised only if there is no <a title="effective case" 
href="#dt-effective-case">effective case</a> .</p>
<p class="xquery">The following example shows how a
<code>typeswitch</code> expression might be used to process an
expression in a way that depends on its <a title="dynamic type" 
href="#dt-dynamic-type">dynamic type</a> .</p>
<div class="exampleInner">
<pre><del class="diff-old">&lt;span class=
"parse-test"&gt;typeswitch($customer/billing-address)
</del>
<ins class="diff-chg">typeswitch($customer/billing-address)
</ins>
   case $a as element(*, USAddress) return $a/state
   case $a as element(*, CanadaAddress) return $a/province
   case $a as element(*, JapanAddress) return $a/prefecture
<del class="diff-old">   default return "unknown"
</del>
<ins class="diff-chg">   default return "unknown"
</ins>
</pre></div>
<p><ins class="diff-chg">The following example shows a union of
sequence types in a single case:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
typeswitch($customer/billing-address)
   case $a as element(*, USAddress) 
            | element(*, AustraliaAddress) 
            | element(*, MexicoAddress)
     return $a/state
   case $a as element(*, CanadaAddress) 
     return $a/province
   case $a as element(*, JapanAddress)
     return $a/prefecture
   default
     return "unknown"
</ins>
</pre></div>
</div>
<div class="div3">
<h4><a id="id-cast" name="id-cast"></a> <del class="diff-old">3.12.3</del>
 <ins class="diff-chg">3.15.3</ins>
Cast</h4>
<h5><a id="N16354" name="N16354"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CastExpr" name="doc-xquery11-CastExpr"></a>
<del class="diff-old">[57]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[97]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CastExpr">CastExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-UnaryExpr">UnaryExpr</a> ( "cast"
"as" <a href="#doc-xquery11-SingleType">SingleType</a>
)?</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-SingleType" name="doc-xquery11-SingleType"></a> <del
 class="diff-old">[117]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[167]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-SingleType">SingleType</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-AtomicType">AtomicType</a>
"?"?</code></td>
</tr>
</tbody>
</table>
<p>Occasionally it is necessary to convert a value to a specific
datatype. For this purpose, XQuery <ins class="diff-new">1.1</ins>
provides a <code>cast</code> expression that creates a new value of
a specific type based on an existing value. A <code>cast</code>
expression takes two operands: an <b>input expression</b> and a
<b>target type</b> . The type of the input expression is called the
<b>input type</b> . The target type must be an atomic type that is
in the <a title="in-scope schema type" href="#dt-is-types">in-scope
schema types</a> [ <a title="err:XPST0051" href="#ERRXPST0051">err:XPST0051</a>
 ]. In addition, the target type
cannot be <code>xs:NOTATION</code> or <code>xs:anyAtomicType</code>
[ <a title="err:XPST0080" href="#ERRXPST0080">err:XPST0080</a> ].
The optional occurrence indicator " <code>?</code> " denotes that
an empty sequence is permitted. If the target type has no namespace
prefix, it is considered to be in the <a title="default element/type 
namespace" href="#dt-def-elemtype-ns">default
element/type namespace</a> . The semantics of the <code>cast</code>
expression are as follows:</p>
<ol class="enumar">
<li>
<p><a title="atomization" href="#dt-atomization">Atomization</a> is
performed on the input expression.</p>
</li>
<li>
<p>If the result of atomization is a sequence of more than one
atomic value, a <a title="type error" href="#dt-type-error">type
error</a> is raised [ <a title="err:XPTY0004" href="#ERRXPTY0004">err:XPTY0004</a>
 ].</p>
</li>
<li>
<p>If the result of atomization is an empty sequence:</p>
<ol class="enumla">
<li>
<p>If <code>?</code> is specified after the target type, the result
of the <code>cast</code> expression is an empty sequence.</p>
</li>
<li>
<p>If <code>?</code> is not specified after the target type, a
<a title="type error" href="#dt-type-error">type error</a> is
raised [ <a title="err:XPTY0004" href="#ERRXPTY0004">err:XPTY0004</a> ].</p>
</li>
</ol>
</li>
<li>
<p>If the result of atomization is a single atomic value, the
result of the cast expression depends on the input type and the
target type. In general, the cast expression attempts to create a
new value of the target type based on the input value. Only certain
combinations of input type and target type are supported. A summary
of the rules are listed <del class="diff-old">below— the</del>
<ins class="diff-chg">below—the</ins> normative definition of these
rules is given in <a href="#xpath-functions-11">[XQuery <del 
class="diff-old">1.0</del> and XPath <del class="diff-old">2.0</del>
Functions and <del class="diff-old">Operators]</del> <ins 
class="diff-chg">Operators 1.1]</ins></a> . For the purpose of these
rules, an implementation may determine that one type is derived by
restriction from another type either by examining the <a title="in-scope
 schema definitions" href="#dt-issd">in-scope schema
definitions</a> or by using an alternative, <a title="implementation 
dependent" href="#dt-implementation-dependent">implementation-dependent</a>
mechanism such as a data dictionary.</p>
<ol class="enumla">
<li>
<p><code>cast</code> is supported for the combinations of input
type and target type listed in <a 
href="http://www.w3.org/TR/xpath-functions/#casting-from-primitive-to-primitive">
Section 17.1 Casting from primitive types to primitive types</a>
<sup><small>FO</small></sup> . For each of these combinations, both
the input type and the target type are primitive <a title="schema type" 
href="#dt-schema-type">schema types</a> . For
example, a value of type <code>xs:string</code> can be cast into
the schema type <code>xs:decimal</code> . For each of these
built-in combinations, the semantics of casting are specified in
<a href="#xpath-functions-11">[XQuery <del class="diff-old">1.0</del> 
and XPath <del class="diff-old">2.0</del>
Functions and <del class="diff-old">Operators] . If the target type
of a cast expression is xs:QName , or is a type that is derived
from xs:QName or xs:NOTATION , and if the base type of the input is
not the same as the base type of the target type, then the input
expression must be a string literal [ err:XPTY0004 ]. Note: The
reason for this rule is that construction of an instance of one of
these target types from a string requires knowledge about namespace
bindings. If the input expression is a non-literal string, it might
be derived from an input document whose namespace bindings are
different from the statically known namespaces</del> <ins 
class="diff-chg">Operators 1.1]</ins></a> .</p>
</li>
<li>
<p><code>cast</code> is supported if the input type is a
non-primitive atomic type that is derived by restriction from the
target type. In this case, the input value is mapped into the value
space of the target type, unchanged except for its type. For
example, if <code>shoesize</code> is derived by restriction from
<code>xs:integer</code> , a value of type <code>shoesize</code> can
be cast into the schema type <code>xs:integer</code> .</p>
</li>
<li>
<p><code>cast</code> is supported if the target type is a
non-primitive atomic type and the input type is
<code>xs:string</code> or <code>xs:untypedAtomic</code> . The input
value is first converted to a value in the lexical space of the
target type by applying the whitespace normalization rules for the
target type (as defined in <a href="#XMLSchema">[XML Schema]</a>
<del class="diff-old">); a dynamic error [err:FORG0001] is raised
if the resulting lexical value does not satisfy the pattern facet
of the target type.</del> <ins class="diff-chg">).</ins> The
lexical value is then converted to the value space of the target
type using the schema-defined rules for the target <del class="diff-old">type;
 a dynamic error [err:FORG0001] is raised if</del>
<ins class="diff-chg">type. If</ins> the <del class="diff-old">resulting</del>
 <ins class="diff-chg">input</ins> value
<del class="diff-old">does not</del> <ins class="diff-chg">fails
to</ins> satisfy <del class="diff-old">all the facets</del>
<ins class="diff-chg">some facet</ins> of the target <del 
class="diff-old">type.</del> <ins class="diff-chg">type, a</ins>
<a title="dynamic error" href="#dt-dynamic-error"><ins class="diff-chg">dynamic
 error</ins></a> <ins class="diff-chg">may be
raised as specified in</ins> <a href="#xpath-functions-11"><ins 
class="diff-chg">[XQuery and XPath
Functions and Operators 1.1]</ins></a> .</p>
</li>
<li>
<p><code>cast</code> is supported if the target type is a
non-primitive atomic type that is derived by restriction from the
input type. The input value must satisfy all the facets of the
target type (in the case of the pattern facet, this is checked by
generating a string representation of the input value, using the
rules for casting to <code>xs:string</code> ). The resulting value
is the same as the input value, but with a different <a title="dynamic 
type" href="#dt-dynamic-type">dynamic type</a> .</p>
</li>
<li>
<p>If a primitive type P1 can be cast into a primitive type P2,
then any type derived by restriction from P1 can be cast into any
type derived by restriction from P2, provided that the facets of
the target type are satisfied. First the input value is cast to P1
using rule (b) above. Next, the value of type P1 is cast to the
type P2, using rule (a) above. Finally, the value of type P2 is
cast to the target type, using rule (d) above.</p>
</li>
<li>
<p>For any combination of input type and target type that is not in
the above list, a <code>cast</code> expression raises a <a title="type 
error" href="#dt-type-error">type error</a> [ <a title="err:XPTY0004" 
href="#ERRXPTY0004">err:XPTY0004</a> ].</p>
</li>
</ol>
</li>
</ol>
<p>If casting from the input type to the target type is supported
but nevertheless it is not possible to cast the input value into
the value space of the target type, a <a title="dynamic error" 
href="#dt-dynamic-error">dynamic error</a> is raised.
[err:FORG0001] This includes the case when any facet of the target
type is not satisfied. For example, the expression
<code>"2003-02-31" cast as xs:date</code> would raise a <a 
title="dynamic error" href="#dt-dynamic-error">dynamic error</a> .</p>
</div>
<div class="div3">
<h4><a id="id-castable" name="id-castable"></a> <del class="diff-old">3.12.4</del>
 <ins class="diff-chg">3.15.4</ins>
Castable</h4>
<h5><a id="N16452" name="N16452"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CastableExpr" name="doc-xquery11-CastableExpr"></a>
 <del class="diff-old">[56]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[96]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CastableExpr">CastableExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-CastExpr">CastExpr</a> (
"castable" "as" <a href="#doc-xquery11-SingleType">SingleType</a>
)?</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N16320.doc-xquery11-SingleType" 
name="noid_N16320.doc-xquery11-SingleType"></a> <del class="diff-old">[117]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[167]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code>SingleType</code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-AtomicType">AtomicType</a>
"?"?</code></td>
</tr>
</tbody>
</table>
<p>XQuery <ins class="diff-new">1.1</ins> provides an expression
that tests whether a given value is castable into a given target
type. The target type must be an atomic type that is in the
<a title="in-scope schema type" href="#dt-is-types">in-scope schema
types</a> [ <a title="err:XPST0051" href="#ERRXPST0051">err:XPST0051</a>
 ]. In addition, the target type
cannot be <code>xs:NOTATION</code> or <code>xs:anyAtomicType</code>
[ <a title="err:XPST0080" href="#ERRXPST0080">err:XPST0080</a> ].
The optional occurrence indicator " <code>?</code> " denotes that
an empty sequence is permitted.</p>
<p>The expression <code><del class="diff-old">V</del> <ins 
class="diff-chg">E</ins> castable as T</code> returns <code>true</code>
if the <del class="diff-old">value</del> <ins class="diff-chg">result of
 evaluating</ins> <code><del class="diff-old">V</del> <ins 
class="diff-chg">E</ins></code> can be
successfully cast into the target type <code>T</code> by using a
<code>cast</code> expression; otherwise it returns
<code>false</code> . <ins class="diff-new">If evaluation of</ins>
<code><ins class="diff-new">E</ins></code> <ins class="diff-new">fails 
with a dynamic error, the</ins> <code><ins class="diff-new">castable</ins></code>
 <ins class="diff-new">expression
as a whole fails.</ins> The <code>castable</code> expression can be
used as a <a title="" href="#dt-predicate">predicate</a> to avoid
errors at evaluation time. It can also be used to select an
appropriate type for processing of a given value, as illustrated in
the following example:</p>
<div class="exampleInner">
<pre>if ($x castable as hatsize) 
   then $x cast as hatsize 
   else if ($x castable as IQ) 
   then $x cast as IQ 
   else $x cast as xs:string
</pre></div>
</div>
<del class="diff-old">Note: If the target type of a castable
expression is xs:QName , or is a type that is derived from xs:QName
or xs:NOTATION , and the input argument of the expression is of
type xs:string but it is not a literal string, the result of the
castable expression is false .</del>
<div class="div3">
<h4><a id="id-constructor-functions" name="id-constructor-functions"></a>
 <del class="diff-old">3.12.5</del>
<ins class="diff-chg">3.15.5</ins> Constructor Functions</h4>
<p>For every atomic type in the <a title="in-scope schema type" 
href="#dt-is-types">in-scope schema types</a> (except
<code>xs:NOTATION</code> and <code>xs:anyAtomicType</code> , which
are not instantiable), a <b>constructor function</b> is implicitly
defined. In each case, the name of the constructor function is the
same as the name of its target type (including namespace). The
signature of the constructor function for type <em>T</em> is as
follows:</p>
<div class="exampleInner">
<pre><ins class="diff-chg">T($arg as xs:anyAtomicType?) as T?
</ins>
</pre></div>
<p>[ <a title="constructor function" id="dt-constructor-function" 
name="dt-constructor-function">Definition</a> : The <b>constructor
function</b> for a given type is used to convert instances of other
atomic types into the given type. The semantics of the constructor
function call <code>T($arg)</code> are defined to be equivalent to
the expression <code>(($arg) cast as T?)</code> .]</p>
<p>The <del class="diff-old">constructor functions for xs:QName and
for types derived from xs:QName and xs:NOTATION require their
arguments to be string literals or to have a base type that is the
same as the base type of the target type; otherwise a type error [
err:XPTY0004 ] is raised. This rule is consistent with the
semantics of cast expressions for these types, as defined in 3.12.3
Cast . The</del> following examples illustrate the use of
constructor functions:</p>
<ul>
<li>
<p>This example is equivalent to <code>("2000-01-01" cast as
xs:date?)</code> .</p>
<div class="exampleInner">
<pre>xs:date("2000-01-01")
</pre></div>
</li>
<li>
<p>This example is equivalent to <code>(($floatvalue * 0.2E-5) cast
as xs:decimal?)</code> .</p>
<div class="exampleInner">
<pre>xs:decimal($floatvalue * 0.2E-5)
</pre></div>
</li>
<li>
<p>This example returns a <code>xs:dayTimeDuration</code> value
equal to 21 days. It is equivalent to <code>("P21D" cast as
xs:dayTimeDuration?)</code> .</p>
<div class="exampleInner">
<pre>xs:dayTimeDuration("P21D")
</pre></div>
</li>
<li>
<p>If <code>usa:zipcode</code> is a user-defined atomic type in the
<a title="in-scope schema type" href="#dt-is-types">in-scope schema
types</a> , then the following expression is equivalent to the
expression <code>("12345" cast as usa:zipcode?)</code> .</p>
<div class="exampleInner">
<pre>usa:zipcode("12345")
</pre></div>
</li>
</ul>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>An instance of an atomic type that is not in a namespace can be
constructed in either of the following ways:</p>
<ul>
<li>
<p>By using a <code>cast</code> expression, if the <a title="default 
element/type namespace" href="#dt-def-elemtype-ns">default
element/type namespace</a> is "none". <span class="xquery">(See
<a href="#id-default-namespace"><b><del class="diff-old">4.13</del>
<ins class="diff-chg">4.14</ins> Default Namespace
Declaration</b></a> for how to undeclare the <a title="default 
element/type namespace" href="#dt-def-elemtype-ns">default
element/type namespace</a> ).</span></p>
<div class="exampleInner">
<pre>17 cast as apple
</pre></div>
</li>
<li>
<p>By using a constructor function, if the <a title="default function 
namespace" href="#dt-def-fn-ns">default function
namespace</a> is "none". <span class="xquery">(See <a 
href="#id-default-namespace"><b><del class="diff-old">4.13</del>
<ins class="diff-chg">4.14</ins> Default Namespace
Declaration</b></a> for how to undeclare the <a title="default function 
namespace" href="#dt-def-fn-ns">default function
namespace</a> ).</span></p>
<div class="exampleInner">
<pre>apple(17)
</pre></div>
</li>
</ul>
</div>
</div>
<div class="div3">
<h4><a id="id-treat" name="id-treat"></a> <del class="diff-old">3.12.6</del>
 <ins class="diff-chg">3.15.6</ins>
Treat</h4>
<h5><a id="N1654E" name="N1654E"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-TreatExpr" name="doc-xquery11-TreatExpr"></a> <del
 class="diff-old">[55]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[95]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-TreatExpr">TreatExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-CastableExpr">CastableExpr</a> (
"treat" "as" <a href="#doc-xquery11-SequenceType">SequenceType</a>
)?</code></td>
</tr>
</tbody>
</table>
<p>XQuery <ins class="diff-new">1.1</ins> provides an expression
called <code>treat</code> that can be used to modify the <a 
title="static type" href="#dt-static-type">static type</a> of its
operand.</p>
<p>Like <code>cast</code> , the <code>treat</code> expression takes
two operands: an expression and a <a href="#doc-xquery11-SequenceType">SequenceType</a>
 . Unlike
<code>cast</code> , however, <code>treat</code> does not change the
<a title="dynamic type" href="#dt-dynamic-type">dynamic type</a> or
value of its operand. Instead, the purpose of <code>treat</code> is
to ensure that an expression has an expected dynamic type at
evaluation time.</p>
<p>The semantics of <em><code>expr1</code></em> <code>treat
as</code> <em><code>type1</code></em> are as follows:</p>
<ul>
<li>
<p>During static analysis:</p>
<p>The <a title="static type" href="#dt-static-type">static
type</a> of the <code>treat</code> expression is
<em><code>type1</code> <del class="diff-old">.</del></em>
<ins class="diff-chg">.</ins> This enables the expression to be
used as an argument of a function that requires a parameter of
<em><code>type1</code> <del class="diff-old">.</del></em>
<ins class="diff-chg">.</ins></p>
</li>
<li>
<p>During expression evaluation:</p>
<p>If <em><code>expr1</code></em> matches <em><code>type1</code>
<del class="diff-old">,</del></em> <ins class="diff-chg">,</ins>
using the rules for <a title="SequenceType matching" 
href="#dt-sequencetype-matching">SequenceType matching</a> , the
<code>treat</code> expression returns the value of
<em><code>expr1</code></em> ; otherwise, it raises a <a title="dynamic 
error" href="#dt-dynamic-error">dynamic error</a> [
<a title="err:XPDY0050" href="#ERRXPDY0050">err:XPDY0050</a> ]. If
the value of <em><code>expr1</code></em> is returned, its identity
is preserved. The <code>treat</code> expression ensures that the
value of its expression operand conforms to the expected type at
run-time.</p>
</li>
<li>
<p>Example:</p>
<div class="exampleInner">
<pre>$myaddress treat as element(*, USAddress)
</pre></div>
<p>The <a title="static type" href="#dt-static-type">static
type</a> of <code>$myaddress</code> may be <code>element(*,
Address)</code> , a less specific type than <code>element(*,
USAddress)</code> . However, at run-time, the value of
<code>$myaddress</code> must match the type <code>element(*,
USAddress)</code> using rules for <a title="SequenceType matching" 
href="#dt-sequencetype-matching">SequenceType matching</a> ;
otherwise a <a title="dynamic error" href="#dt-dynamic-error">dynamic 
error</a> is raised [ <a title="err:XPDY0050" href="#ERRXPDY0050">err:XPDY0050</a>
 ].</p>
</li>
</ul>
</div>
</div>
<div class="div2">
<h3><a id="id-validate" name="id-validate"></a> <del class="diff-old">3.13</del>
 <ins class="diff-chg">3.16</ins> Validate
Expressions</h3>
<h5><a id="N1660E" name="N1660E"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ValidateExpr" name="doc-xquery11-ValidateExpr"></a>
 <del class="diff-old">[63]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[103]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ValidateExpr">ValidateExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"validate" <ins class="diff-chg">(</ins> <a 
href="#doc-xquery11-ValidationMode">ValidationMode</a> <del 
class="diff-old">?</del> <ins class="diff-chg">| ("type"</ins> <a 
href="#doc-xquery11-TypeName"><ins class="diff-chg">TypeName</ins></a>
<ins class="diff-chg">))?</ins> "{" <a href="#doc-xquery11-Expr">Expr</a>
 "}"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ValidationMode" 
name="doc-xquery11-ValidationMode"></a> <del class="diff-old">[64]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[104]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ValidationMode">ValidationMode</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"lax" | "strict"</code></td>
</tr>
</tbody>
</table>
<p>A <code>validate</code> expression can be used to validate a
document node or an element node with respect to the <a title="in-scope 
schema definitions" href="#dt-issd">in-scope schema
definitions</a> , using the schema validation process defined in
<a href="#XMLSchema">[XML Schema]</a> . If the operand of a
<code>validate</code> expression does not evaluate to exactly one
document or element node, a <a title="type error" href="#dt-type-error">type
 error</a> is raised [ <a title="err:XQTY0030" href="#ERRXQTY0030">err:XQTY0030</a>
 ]. In this specification, the
node that is the operand of a <code>validate</code> expression is
called the <b>operand node</b> .</p>
<p>A <code>validate</code> expression returns a new node with its
own identity and with no parent. The new node and its descendants
are given <a title="type annotation" href="#dt-type-annotation">type 
annotations</a> that are generated by
applying a validation process to the operand node. In some cases,
default values may also be generated by the validation process.</p>
<p>A <code>validate</code> expression may optionally specify a
<a href="#doc-xquery11-ValidationMode">validation mode</a> . The
default <a href="#doc-xquery11-ValidationMode">validation mode</a>
<span><ins class="diff-new">(applicable when no type name is
provided)</ins></span> is <code>strict</code> .</p>
<p><ins class="diff-new">A</ins> <code><ins class="diff-new">validate</ins></code>
 <ins class="diff-new">expression
may optionally specify a</ins> <a href="#doc-xquery11-TypeName"><ins 
class="diff-new">TypeName</ins></a>
.<ins class="diff-new">This type name must be found in the</ins>
<a title="in-scope schema definitions" href="#dt-issd"><ins 
class="diff-new">in-scope schema definitions</ins></a> <ins 
class="diff-new">; if it is not, a</ins> <a title="static error" 
href="#dt-static-error"><ins class="diff-new">static error</ins></a>
<ins class="diff-new">is raised [</ins> <a title="err:XQST0104" 
href="#ERRXQST0104"><ins class="diff-new">err:XQST0104</ins></a>
<ins class="diff-new">]. If the type name is unprefixed, it is
interpreted as a name in the default namespace for elements and
types.</ins></p>
<p>The result of a <code>validate</code> expression is defined by
the following rules.</p>
<ol class="enumar">
<li>
<p>If the operand node is a document node, its children must
consist of exactly one element node and zero or more comment and
processing instruction nodes, in any order; otherwise, a <a 
title="dynamic error" href="#dt-dynamic-error">dynamic error</a> [
<a title="err:XQDY0061" href="#ERRXQDY0061">err:XQDY0061</a> ] is
raised.</p>
</li>
<li>
<p>The operand node is converted to an XML Information Set (
<a href="#XINFO">[XML Infoset]</a> ) according to the "Infoset
Mapping" rules defined in <del class="diff-old">[XQuery/XPath</del>
<a href="#xpath-datamodel-11"><ins class="diff-chg">[XQuery and
XPath</ins> Data Model <del class="diff-old">(XDM)]</del>
<ins class="diff-chg">(XDM) 1.1]</ins></a> . Note that this process
discards any existing <a title="type annotation" 
href="#dt-type-annotation">type annotations</a> . <span>Validity
assessment is carried out on the root element information item of
the resulting Infoset, using the <a title="in-scope schema definitions" 
href="#dt-issd">in-scope schema
definitions</a> as the effective schema. The process of validation
applies recursively to contained elements and attributes to the
extent required by the effective schema. <del class="diff-old">During 
validity assessment,</del></span></p>
</li>
<li>
<p><ins class="diff-chg">If a type name is provided,
schema-validity assessment is carried out according to</ins> the
<del class="diff-old">following special</del> rules <del 
class="diff-old">are</del> <ins class="diff-chg">defined</ins> in
<del class="diff-old">effect:</del> <a href="#XMLSchema"><ins 
class="diff-chg">[XML Schema]</ins></a>
,<ins class="diff-chg">section 3.3.4 "Element Declaration
Validation Rules", clauses 1.2 and 2, using this type definition as
the "processor-stipulated type definition" for
validation.</ins></p>
</li>
<li>
<p><span><ins class="diff-chg">When no type name is
provided:</ins></span></p>
<ol class="enumla">
<li>
<p>If <a href="#doc-xquery11-ValidationMode">validation mode</a> is
<code>strict</code> , then there must be a top-level element
declaration in the <a title="in-scope element declarations" 
href="#dt-is-elems">in-scope element declarations</a> that matches the
root element information item in the Infoset, and schema-validity
assessment is carried out using that declaration in accordance with
item 2 of <a href="#XMLSchema">[XML Schema]</a> Part 1, section
5.2, "Assessing Schema-Validity." If there is no such element
declaration, a <a title="dynamic error" href="#dt-dynamic-error">dynamic
 error</a> is raised [ <a title="err:XQDY0084" href="#ERRXQDY0084">err:XQDY0084</a>
 ].</p>
</li>
<li>
<p>If <a href="#doc-xquery11-ValidationMode">validation mode</a> is
<code>lax</code> , then schema-validity assessment is carried out
in accordance with item 3 of <a href="#XMLSchema">[XML Schema]</a>
Part 1, section 5.2, "Assessing Schema-Validity."</p>
<p>If <a href="#doc-xquery11-ValidationMode">validation mode</a> is
<code>lax</code> and the root element information item has neither
a top-level element declaration nor an <code>xsi:type</code>
attribute, <a href="#XMLSchema">[XML Schema]</a> defines the
recursive checking of children and attributes as optional. During
processing of an XQuery <code>validate</code> expression, this
recursive checking is required.</p>
</li>
<li>
<p>If the operand node is an element node, the validation rules
named "Validation Root Valid (ID/IDREF)" <del class="diff-old">and
"Identity-constraint Satisfied" are</del> <ins class="diff-chg">is</ins>
 not applied. This means that document-level
constraints relating to uniqueness and referential integrity are
not enforced.</p>
</li>
<li>
<p>There is no check that the document contains unparsed entities
whose names match the values of nodes of type
<code>xs:ENTITY</code> or <code>xs:ENTITIES</code> .</p>
</li>
<li>
<p>There is no check that the document contains notations whose
names match the values of nodes of type <code>xs:NOTATION</code>
.</p>
</li>
</ol>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>Validity assessment is affected by the presence or absence of
<code>xsi:type</code> attributes on the elements being validated,
and may generate new information items such as default
attributes.</p>
</div>
</li>
<li>
<p><span>The <del class="diff-old">next step depends on</del>
<ins class="diff-chg">outcome of the</ins> validation <del 
class="diff-old">mode and</del> <ins class="diff-chg">expression
depends</ins> on the</span> <code>validity</code> property of the
root element information item in the PSVI that results from the
validation process.</p>
<ol class="enumla">
<li>
<p>If the <code>validity</code> property of the root element
information item is <code>valid <del class="diff-old">(for any
validation mode ),</del></code> , or if <a 
href="#doc-xquery11-ValidationMode">validation mode</a> is
<code>lax</code> and the <code>validity</code> property of the root
element information item is <code>notKnown</code> , the PSVI is
converted back into an <a title="XDM instance" 
href="#dt-data-model-instance">XDM instance</a> as described in
<del class="diff-old">[XQuery/XPath</del> <a href="#xpath-datamodel-11"><ins
 class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> Section 3.3, "Construction from a
PSVI". The resulting node (a new node of the same kind as the
operand node) is returned as the result of the
<code>validate</code> expression.</p>
</li>
<li>
<p>Otherwise, a <a title="dynamic error" href="#dt-dynamic-error">dynamic
 error</a> is raised [ <a title="err:XQDY0027" href="#ERRXQDY0027">err:XQDY0027</a>
 ].</p>
</li>
</ol>
</li>
</ol>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The effect of these rules is as <del class="diff-old">follows:</del> <ins
 class="diff-chg">follows,
where</ins> <span><ins class="diff-chg">the</ins> <em><ins 
class="diff-chg">validated element</ins></em> <ins class="diff-chg">means
either
 the operand node or (if the operand node is a document node)
its element child.</ins></span> :</p>
<ul>
<li>
<p>If <a href="#doc-xquery11-ValidationMode">validation mode</a> is
<code>strict</code> , the validated element must have a top-level
element declaration in the effective schema, and must conform to
this declaration.</p>
</li>
<li>
<p>If <a href="#doc-xquery11-ValidationMode">validation mode</a> is
<code>lax</code> , the validated element must conform to its
top-level element declaration if such a declaration exists in the
effective schema. If <a href="#doc-xquery11-ValidationMode">validation 
mode</a> is
<code>lax</code> and there is no top-level element declaration for
the element, and the element has an <code>xsi:type</code>
attribute, then the <code>xsi:type</code> attribute must name a
top-level type definition in the effective schema, and the element
must conform to that type. <del class="diff-old">The validated
element corresponds either to the operand node or (if</del></p>
</li>
<li>
<p><span><ins class="diff-chg">If a type name is specified in</ins>
the <del class="diff-old">operand node</del> <ins class="diff-chg">validate
 expression, no attempt</ins> is <del class="diff-old">a document node)</del>
 <ins class="diff-chg">made</ins>
to <del class="diff-old">its</del> <ins class="diff-chg">locate
an</ins> element <del class="diff-old">child.</del> <ins 
class="diff-chg">declaration matching the name of the validated element;
the element can have any name, and its content is validated against
the named type.</ins></span></p>
</li>
</ul>
</div>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>During conversion of the PSVI into an <a title="XDM instance" 
href="#dt-data-model-instance">XDM instance</a> after validation,
any element information items whose validity property is
<code>notKnown</code> are converted into element nodes with
<a title="type annotation" href="#dt-type-annotation">type
annotation</a> <code>xs:anyType</code> , and any attribute
information items whose validity property is <code>notKnown</code>
are converted into attribute nodes with <a title="type annotation" 
href="#dt-type-annotation">type annotation</a>
<code>xs:untypedAtomic</code> , as described in <a 
href="http://www.w3.org/TR/xpath-datamodel/#PSVI2NodeTypes">Section
3.3.1.1 Element and Attribute Node Type Names</a>
<sup><small>DM</small></sup> .</p>
</div>
</div>
<div class="div2">
<h3><a id="id-extension-expressions" name="id-extension-expressions"></a>
 <del class="diff-old">3.14</del>
<ins class="diff-chg">3.17</ins> Extension Expressions</h3>
<p>[ <a title="extension expression" id="dt-extension-expression" 
name="dt-extension-expression">Definition</a> : An <b>extension
expression</b> is an expression whose semantics are <a 
title="implementation defined" href="#dt-implementation-defined">implementation-defined</a>
 .]
Typically a particular extension will be recognized by some
implementations and not by others. The syntax is designed so that
extension expressions can be successfully parsed by all
implementations, and so that fallback behavior can be defined for
implementations that do not recognize a particular extension.</p>
<h5><a id="N167BA" name="N167BA"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ExtensionExpr" name="doc-xquery11-ExtensionExpr"></a>
 <del class="diff-old">[65]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[105]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ExtensionExpr">ExtensionExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-Pragma">Pragma</a> + "{" <a 
href="#doc-xquery11-Expr">Expr</a> ? "}"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-Pragma" name="doc-xquery11-Pragma"></a>
<del class="diff-old">[66]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[106]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-Pragma">Pragma</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"(#" <a href="#prod-xquery11-S">S</a> ? <del class="diff-old">QName</del>
 <a href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a> (
 <a href="#prod-xquery11-S">S</a>
<a href="#doc-xquery11-PragmaContents">PragmaContents</a> )?
"#)"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-PragmaContents" 
name="doc-xquery11-PragmaContents"></a> <del class="diff-old">[67]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[107]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-PragmaContents">PragmaContents</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>( <a href="#prod-xquery11-Char">Char</a> * - (Char* '#)'
Char*))</code></td>
</tr>
</tbody>
</table>
<p>An extension expression consists of one or more <b>pragmas</b> ,
followed by an expression enclosed in curly braces. [ <a title="pragma" 
id="dt-pragma" name="dt-pragma">Definition</a> : A
<b>pragma</b> is denoted by the delimiters <code>(#</code> and
<code>#)</code> , and consists of an identifying <del class="diff-old">QName</del>
 <ins class="diff-chg">EQName</ins> followed
by <a title="implementation defined" href="#dt-implementation-defined">implementation-defined</a>
 content.]
The content of a pragma may consist of any string of characters
that does not contain the ending delimiter <code>#)</code> .
<del class="diff-old">The QName</del> <ins class="diff-chg">If the
EQName</ins> of a pragma <ins class="diff-new">is a</ins> <a 
title="lexical QName" href="#dt-qname"><ins class="diff-new">lexical
QName</ins></a> ,<ins class="diff-new">it</ins> must resolve to a
namespace URI and local name, using the <a title="statically known 
namespaces" href="#dt-static-namespaces">statically known namespaces</a>
 [ <a title="err:XPST0081" href="#ERRXPST0081">err:XPST0081</a> ].</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>Since there is no default namespace for pragmas, a <del 
class="diff-old">pragma QName</del> <ins class="diff-chg">pragma's
EQName</ins> must <del class="diff-old">include</del> <ins 
class="diff-chg">provide a</ins> <a href="#doc-xquery11-URILiteral"><ins
 class="diff-chg">URILiteral</ins></a> <ins class="diff-chg">or</ins> a
namespace prefix.</p>
</div>
<p>Each implementation recognizes an <a title="implementation defined" 
href="#dt-implementation-defined">implementation-defined</a> set of
namespace URIs used to denote pragmas.</p>
<p>If the namespace <del class="diff-old">part</del> <ins 
class="diff-chg">URI</ins> of a <del class="diff-old">pragma</del>
<ins class="diff-chg">pragma's</ins> <a title="expanded QName" 
href="#dt-expanded-qname"><ins class="diff-chg">expanded</ins>
QName</a> is not recognized by the implementation as a pragma
namespace, then the pragma is ignored. If all the pragmas in an
<a href="#doc-xquery11-ExtensionExpr">ExtensionExpr</a> are
ignored, then the value of the <a href="#doc-xquery11-ExtensionExpr">ExtensionExpr</a>
 is the value of the
expression enclosed in curly braces; if this expression is absent,
then a <a title="static error" href="#dt-static-error">static
error</a> is raised [ <a title="err:XQST0079" href="#ERRXQST0079">err:XQST0079</a>
 ].</p>
<p>If an implementation recognizes the namespace of one or more
pragmas in an <a href="#doc-xquery11-ExtensionExpr">ExtensionExpr</a> , 
then the value of
the <a href="#doc-xquery11-ExtensionExpr">ExtensionExpr</a> ,
including its error behavior, is <a title="implementation defined" 
href="#dt-implementation-defined">implementation-defined</a> . For
example, an implementation that recognizes the namespace of a
<del class="diff-old">pragma QName,</del> <ins class="diff-chg">pragma's</ins>
 <a title="expanded QName" href="#dt-expanded-qname"><ins 
class="diff-chg">expanded QName</ins></a>
, but does not recognize the local part of the <del class="diff-old">QName,</del>
 <ins class="diff-chg">name,</ins> might
choose either to raise an error or to ignore the pragma.</p>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> [ <a title="err:XQST0013" href="#ERRXQST0013">err:XQST0013</a>
 ] if an implementation recognizes a
pragma but determines that its content is invalid.</p>
<p>If an implementation recognizes a pragma, it must report any
static errors in the following expression even if it will not
evaluate that expression (however, static type errors are raised
only if the <a title="static typing feature" 
href="#dt-static-typing-feature">Static Typing Feature</a> is in
effect.)</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The following examples illustrate three ways in which extension
expressions might be used.</p>
<ul>
<li>
<p>A pragma can be used to furnish a hint for how to evaluate the
following expression, without actually changing the result. For
example:</p>
<div class="exampleInner">
<pre>declare namespace exq = "http://example.org/XQueryImplementation";
   (# exq:use-index #)
      { $bib/book/author[name='Berners-Lee'] }
</pre></div>
<p>An implementation that recognizes the <code>exq:use-index</code>
pragma might use an index to evaluate the expression that follows.
An implementation that does not recognize this pragma would
evaluate the expression in its normal way.</p>
</li>
<li>
<p>A pragma might be used to modify the semantics of the following
expression in ways that would not (in the absence of the pragma) be
conformant with this specification. For example, a pragma might be
used to permit comparison of <code>xs:duration</code> values using
implementation-defined semantics (this would normally be an error).
Such changes to the language semantics must be scoped to the
expression contained within the curly braces following the
pragma.</p>
</li>
<li>
<p>A pragma might contain syntactic constructs that are evaluated
in place of the following expression. In this case, the following
expression itself (if it is present) provides a fallback for use by
implementations that do not recognize the pragma. For example:</p>
<div class="exampleInner">
<pre>declare namespace exq = "http://example.org/XQueryImplementation";
   for $x in
      (# exq:distinct //city by @country #)
      { //city[not(@country = preceding::city/@country)] }
   return f:show-city($x)
</pre></div>
<p>Here an implementation that recognizes the pragma will return
the result of evaluating the proprietary syntax <code>exq:distinct
//city by @country</code> , while an implementation that does not
recognize the pragma will instead return the result of the
expression <code>//city[not(@country =
preceding::city/@country)]</code> . If no fallback expression is
required, or if none is feasible, then the expression between the
curly braces may be omitted, in which case implementations that do
not recognize the pragma will raise a <a title="static error" 
href="#dt-static-error">static error</a> .</p>
</li>
</ul>
</div>
</div>
</div>
<div class="div1">
<h2><a id="id-query-prolog" name="id-query-prolog"></a> 4 Modules
and Prologs</h2>
<h5><a id="N168A1" name="N168A1"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-Module" name="doc-xquery11-Module"></a>
[1]&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-Module">Module</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-VersionDecl">VersionDecl</a> ? (
<a href="#doc-xquery11-LibraryModule">LibraryModule</a> | <a 
href="#doc-xquery11-MainModule">MainModule</a> )</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-MainModule" name="doc-xquery11-MainModule"></a> 
[3]&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-MainModule">MainModule</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-Prolog">Prolog</a> <a 
href="#doc-xquery11-QueryBody">QueryBody</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-LibraryModule" name="doc-xquery11-LibraryModule"></a>
 [4]&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-LibraryModule">LibraryModule</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-ModuleDecl">ModuleDecl</a>
<a href="#doc-xquery11-Prolog">Prolog</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-Prolog" name="doc-xquery11-Prolog"></a>
[6]&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-Prolog">Prolog</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>(( <a href="#doc-xquery11-DefaultNamespaceDecl">DefaultNamespaceDecl</a>
 |
<a href="#doc-xquery11-Setter">Setter</a> | <a 
href="#doc-xquery11-NamespaceDecl">NamespaceDecl</a> | <a 
href="#doc-xquery11-Import">Import</a> ) <a 
href="#doc-xquery11-Separator">Separator</a> )* (( <del class="diff-old">VarDecl</del>
 <a href="#prod-xquery11-ContextItemDecl"><ins class="diff-chg">ContextItemDecl</ins></a>
 | <del class="diff-old">FunctionDecl</del> <a 
href="#doc-xquery11-AnnotatedDecl"><ins class="diff-chg">AnnotatedDecl</ins></a>
 | <a href="#doc-xquery11-OptionDecl">OptionDecl</a> ) <a 
href="#doc-xquery11-Separator">Separator</a> )*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-Setter" name="doc-xquery11-Setter"></a>
<del class="diff-old">[7]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[8]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-Setter">Setter</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-BoundarySpaceDecl">BoundarySpaceDecl</a>
 | <a href="#doc-xquery11-DefaultCollationDecl">DefaultCollationDecl</a>
 |
<a href="#doc-xquery11-BaseURIDecl">BaseURIDecl</a> | <a 
href="#doc-xquery11-ConstructionDecl">ConstructionDecl</a> | <a 
href="#doc-xquery11-OrderingModeDecl">OrderingModeDecl</a> | <a 
href="#doc-xquery11-EmptyOrderDecl">EmptyOrderDecl</a> | <a 
href="#doc-xquery11-CopyNamespacesDecl">CopyNamespacesDecl</a>
<ins class="diff-new">|</ins> <a href="#doc-xquery11-DecimalFormatDecl"><ins
 class="diff-new">DecimalFormatDecl</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-Import" name="doc-xquery11-Import"></a>
<del class="diff-old">[8]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[20]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-Import">Import</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-SchemaImport">SchemaImport</a> |
<a href="#doc-xquery11-ModuleImport">ModuleImport</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-Separator" name="doc-xquery11-Separator"></a> <del
 class="diff-old">[9]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[7]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-Separator">Separator</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>";"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-QueryBody" name="doc-xquery11-QueryBody"></a> <del
 class="diff-old">[30]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[38]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-QueryBody">QueryBody</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-Expr">Expr</a></code></td>
</tr>
</tbody>
</table>
<p>A query can be assembled from one or more fragments called
<b>modules</b> . [ <a title="module" id="dt-module" name="dt-module">Definition</a>
 : A <b>module</b> is a fragment of
XQuery code that conforms to the <a href="#doc-xquery11-Module">Module</a>
 grammar and can independently
undergo the <a title="static analysis phase" href="#dt-static-analysis">static
 analysis phase</a> described in
<a href="#id-expression-processing"><b>2.2.3 Expression
Processing</b></a> . Each module is either a <a title="main module" 
href="#dt-main-module">main module</a> or a <a title="library module" 
href="#dt-library-module">library module</a>
.]</p>
<p>[ <a title="main module" id="dt-main-module" name="dt-main-module">Definition</a>
 : A <b>main module</b> consists of
a <a title="Prolog" href="#dt-prolog">Prolog</a> followed by a
<a title="query body" href="#dt-queryBody">Query Body</a> .] A
query has exactly one main module. In a main module, the <a title="query
 body" href="#dt-queryBody">Query Body</a> can be evaluated,
and its value is the result of the query.</p>
<p>[ <a title="library module" id="dt-library-module" 
name="dt-library-module">Definition</a> : A module that does not contain
a <a title="query body" href="#dt-queryBody">Query Body</a> is
called a <b>library module</b> . A library module consists of a
<a title="module declaration" href="#dt-module-declaration">module
declaration</a> followed by a <a title="Prolog" href="#dt-prolog">Prolog</a>
 .] A library module cannot be evaluated
directly; instead, it provides function and variable declarations
that can be imported into other modules.</p>
<p>The XQuery syntax does not allow a <a title="module" 
href="#dt-module">module</a> to contain both a <a title="module 
declaration" href="#dt-module-declaration">module
declaration</a> and a <a title="query body" href="#dt-queryBody">Query 
Body</a> .</p>
<p>[ <a title="Prolog" id="dt-prolog" name="dt-prolog">Definition</a> : A
 <b>Prolog</b> is a series of
declarations and imports that define the processing environment for
the <a title="module" href="#dt-module">module</a> that contains
the Prolog.] Each declaration or import is followed by a semicolon.
A Prolog is organized into two parts.</p>
<p>The first part of the Prolog consists of setters, imports,
namespace declarations, and default namespace declarations. [
<a title="setter" id="dt-setter" name="dt-setter">Definition</a> :
<b>Setters</b> are declarations that set the value of some property
that affects query processing, such as construction mode, ordering
mode, or default collation.] Namespace declarations and default
namespace declarations affect the interpretation of <a title="lexical 
QName" href="#dt-qname"><ins class="diff-new">lexical</ins> QNames</a> 
within the query. Imports are
used to import definitions from schemas and modules. [ <a title="target 
namespace" id="dt-target-namespace" name="dt-target-namespace">Definition</a>
 : Each imported schema or
module is identified by its <b>target namespace</b> , which is the
namespace of the objects (such as elements or functions) that are
defined by the schema or module.]</p>
<p>The second part of the Prolog consists of declarations of
variables, functions, and options. These declarations appear at the
end of the Prolog because they may be affected by declarations and
imports in the first part of the Prolog.</p>
<p>[ <a title="query body" id="dt-queryBody" name="dt-queryBody">Definition</a>
 : The <b>Query Body</b> , if present,
consists of an expression that defines the result of the query.]
Evaluation of expressions is described in <a href="#id-expressions"><b>3
 Expressions</b></a> . A module can be
evaluated only if it has a Query Body.</p>
<div class="div2">
<h3><a id="id-version-declaration" name="id-version-declaration"></a> 
4.1 Version Declaration</h3>
<h5><a id="N16A11" name="N16A11"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-VersionDecl" name="doc-xquery11-VersionDecl"></a>
 [2]&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-VersionDecl">VersionDecl</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"xquery" <del class="diff-old">"version"</del>
<ins class="diff-chg">(("encoding"</ins> <a 
href="#doc-xquery11-StringLiteral"><ins class="diff-chg">StringLiteral</ins></a>
 <ins class="diff-chg">) |
("version"</ins> <a href="#doc-xquery11-StringLiteral">StringLiteral</a>
 ("encoding"
<a href="#doc-xquery11-StringLiteral">StringLiteral</a> <del 
class="diff-old">)?</del> <ins class="diff-chg">)?))</ins> <a 
href="#doc-xquery11-Separator">Separator</a></code></td>
</tr>
</tbody>
</table>
<p>[ <a title="version declaration" id="dt-version-declaration" 
name="dt-version-declaration">Definition</a> : <del class="diff-old">Any
 module may contain a</del> <ins class="diff-chg">A</ins> <b>version 
declaration <del class="diff-old">.
If present, the version declaration occurs at the beginning of the
module and identifies</del></b> <ins class="diff-chg">can
identify</ins> the applicable XQuery syntax and semantics for
<del class="diff-old">the</del> <ins class="diff-chg">a</ins>
<a title="module" href="#dt-module">module <del class="diff-old">.]</del></a>
 , <ins class="diff-chg">as well as its
encoding.]</ins> The version number "1.0" indicates a requirement
that the module must be processed by an <del class="diff-old">implementation</del>
 <a title="XQuery 1.0 Processor" href="#dt-xquery-10-processor"><ins 
class="diff-chg">XQuery 1.0
processor</ins></a> <ins class="diff-chg">; the version number
"1.1" indicates a requirement</ins> that <del class="diff-old">supports</del>
 <ins class="diff-chg">the module must be
processed by an</ins> <a title="XQuery 1.1 Processor" 
href="#dt-xquery-11-processor">XQuery <del class="diff-old">Version
1.0.</del> <ins class="diff-chg">1.1 processor</ins></a> . If the
version declaration is not <del class="diff-old">present,</del>
<ins class="diff-chg">present or</ins> the version is <del 
class="diff-old">presumed to be "1.0". An</del> <ins class="diff-chg">not
included
 in the declaration, an</ins> XQuery <del class="diff-old">implementation</del>
 <ins class="diff-chg">1.1 processor
assumes a version of "1.1". If an XQuery 1.1 processor processes a
module labeled with a version of "1.0", it</ins> must <ins 
class="diff-new">either</ins> raise a static error [ <a 
title="err:XQST0031" href="#ERRXQST0031">err:XQST0031</a> <del 
class="diff-old">] when processing a</del> <ins class="diff-chg">], or
attempt to process the</ins> module <del class="diff-old">labeled</del> 
with <del class="diff-old">a version that
the implementation does not support. It is the intent of the</del>
<ins class="diff-chg">an</ins> XQuery <del class="diff-old">working
group to give later versions of this specification numbers</del>
<ins class="diff-chg">1.0 processor.</ins> <span><ins class="diff-chg">If
 any version number</ins> other than <del class="diff-old">"1.0", but 
this intent does not indicate</del>
<ins class="diff-chg">1.1 or 1.0 is encountered,</ins> a
<del class="diff-old">commitment to produce any future versions of
XQuery, nor if any are produced, to use any particular numbering
scheme.</del> <ins class="diff-chg">static error [</ins> <a 
title="err:XQST0031" href="#ERRXQST0031"><ins class="diff-chg">err:XQST0031</ins></a>
 <ins class="diff-chg">] is
raised.</ins></span></p>
<p>[ <a title="encoding declaration" id="dt-encoding-declaration" 
name="dt-encoding-declaration">Definition</a> : If present, a
version declaration may optionally include an <b>encoding
declaration</b> . The value of the string literal following the
keyword <code>encoding</code> is an encoding name, and must conform
to the definition of <code>EncName</code> specified in <a href="#XML">[XML
 1.0]</a> [ <a title="err:XQST0087" href="#ERRXQST0087">err:XQST0087</a>
 ]. The purpose of an encoding
declaration is to allow the writer of a query to provide a string
that indicates how the query is encoded, such as "
<code>UTF-8</code> ", " <code>UTF-16</code> ", or "
<code>US-ASCII</code> ".] Since the encoding of a query may change
as the query moves from one environment to another, there can be no
guarantee that the encoding declaration is correct.</p>
<p>The handling of an encoding declaration is <a title="implementation 
dependent" href="#dt-implementation-dependent">implementation-dependent</a>
 . If an
implementation has <em>a priori</em> knowledge of the encoding of a
query, it may use this knowledge and disregard the encoding
declaration. The semantics of a query are not affected by the
presence or absence of an encoding declaration.</p>
<p>If a version declaration is present, no <a 
href="#doc-xquery11-Comment">Comment</a> may occur before the end of the
version declaration. If such a <a href="#doc-xquery11-Comment">Comment</a>
 is present, the result is
<a title="implementation dependent" href="#dt-implementation-dependent">implementation-dependent</a>
 .</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>The effect of a Comment before the end of a version declaration
is implementation-dependent because it may suppress query
processing by interfering with detection of the encoding
declaration.</p>
</div>
<p>The following examples illustrate version declarations:</p>
<div class="exampleInner">
<pre>xquery version "1.0";
</pre></div>
<div class="exampleInner">
<pre>xquery version "1.0" encoding "utf-8";
</pre></div>
</div>
<div class="div2">
<h3><a id="id-module-declaration" name="id-module-declaration"></a>
4.2 Module Declaration</h3>
<h5><a id="N16AA3" name="N16AA3"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ModuleDecl" name="doc-xquery11-ModuleDecl"></a> 
[5]&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-ModuleDecl">ModuleDecl</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"module" "namespace" <a href="#prod-xquery11-NCName">NCName</a>
 "=" <a href="#doc-xquery11-URILiteral">URILiteral</a> <a 
href="#doc-xquery11-Separator">Separator</a></code></td>
</tr>
</tbody>
</table>
<p>[ <a title="module declaration" id="dt-module-declaration" 
name="dt-module-declaration">Definition</a> : A <b>module
declaration</b> serves to identify a <a title="module" href="#dt-module">module</a>
 as a <a title="library module" href="#dt-library-module">library module</a>
 . A module declaration
begins with the keyword <code>module</code> and contains a
namespace prefix and a <a href="#doc-xquery11-URILiteral">URILiteral</a>
 .] The URILiteral must be
of nonzero length [ <a title="err:XQST0088" href="#ERRXQST0088">err:XQST0088</a>
 ]. The URILiteral identifies the
<a title="target namespace" href="#dt-target-namespace">target
namespace</a> of the library module, which is the namespace for all
variables and functions exported by the library module. The name of
every variable and function declared in a library module must have
a namespace URI that is the same as the target namespace of the
module; otherwise a <a title="static error" href="#dt-static-error">static
 error</a> is raised [ <a title="err:XQST0048" href="#ERRXQST0048">err:XQST0048</a>
 ]. In the
<a title="statically known namespaces" href="#dt-static-namespaces">statically
 known namespaces</a> of the
library module, the namespace prefix specified in the module
declaration is bound to the module's target namespace.</p>
<p>The namespace prefix specified in a module declaration must not
be <code>xml</code> or <code>xmlns</code> [ <a title="err:XQST0070" 
href="#ERRXQST0070">err:XQST0070</a> ], and must not be the same as
any namespace prefix bound in the same module by a <a title="schema 
import" href="#dt-schema-import">schema import</a> , by a
<a title="namespace declaration" href="#dt-namespace-declaration">namespace
 declaration</a> , or by a
<a title="module import" href="#dt-module-import">module import</a>
with a different target namespace [ <a title="err:XQST0033" 
href="#ERRXQST0033">err:XQST0033</a> ].</p>
<p>Any <a title="module" href="#dt-module">module</a> may import
one or more library modules by means of a <a title="module import" 
href="#dt-module-import">module import</a> that specifies the
target namespace of the library modules to be imported. When a
module imports one or more library modules, the variables and
functions declared in the imported modules are added to the
<a title="static context" href="#dt-static-context">static
context</a> and (where applicable) to the <a title="dynamic context" 
href="#dt-dynamic-context">dynamic context</a> of
the importing module.</p>
<p>The following is an example of a module declaration:</p>
<div class="exampleInner">
<pre>module namespace math = "http://example.org/math-functions";
</pre></div>
</div>
<div class="div2">
<h3><a id="id-boundary-space-decls" name="id-boundary-space-decls"></a> 
4.3 Boundary-space Declaration</h3>
<h5><a id="N16B27" name="N16B27"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-BoundarySpaceDecl" 
name="doc-xquery11-BoundarySpaceDecl"></a> <del class="diff-old">[11]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[9]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-BoundarySpaceDecl">BoundarySpaceDecl</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"declare" "boundary-space" ("preserve" |
"strip")</code></td>
</tr>
</tbody>
</table>
<p>[ <a title="boundary-space declaration" id="dt-boundary-space-decl" 
name="dt-boundary-space-decl">Definition</a> : A <b>boundary-space
declaration</b> sets the <a title="boundary-space policy" 
href="#dt-boundary-space-policy">boundary-space policy</a> in the
<a title="static context" href="#dt-static-context">static
context</a> , overriding any implementation-defined default.
Boundary-space policy controls whether <a title="boundary whitespace" 
href="#dt-boundary-whitespace">boundary
whitespace</a> is preserved by element constructors during
processing of the query.] If boundary-space policy is
<code>preserve</code> , boundary whitespace is preserved. If
boundary-space policy is <code>strip</code> , boundary whitespace
is stripped (deleted). A further discussion of whitespace in
constructed elements can be found in <a href="#id-whitespace"><b><del 
class="diff-old">3.7.1.4</del> <ins class="diff-chg">3.8.1.4</ins> 
Boundary Whitespace</b></a> .</p>
<p>The following example illustrates a boundary-space
declaration:</p>
<div class="exampleInner">
<pre>declare boundary-space preserve;
</pre></div>
<p>If a Prolog contains more than one boundary-space declaration, a
<a title="static error" href="#dt-static-error">static error</a> is
raised [ <a title="err:XQST0068" href="#ERRXQST0068">err:XQST0068</a> ].</p>
</div>
<div class="div2">
<h3><a id="id-default-collation-declaration" 
name="id-default-collation-declaration"></a> 4.4 Default Collation
Declaration</h3>
<h5><a id="N16B65" name="N16B65"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-DefaultCollationDecl" 
name="doc-xquery11-DefaultCollationDecl"></a> <del class="diff-old">[19]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[10]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-DefaultCollationDecl">DefaultCollationDecl</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"declare" "default" "collation" <a 
href="#doc-xquery11-URILiteral">URILiteral</a></code></td>
</tr>
</tbody>
</table>
<p>[ <a title="default collation declaration" 
id="dt-default-collation-decl" name="dt-default-collation-decl">Definition</a>
 : A <b>default collation
declaration</b> sets the value of the <a title="default collation" 
href="#dt-def-collation">default collation</a> in the <a title="static 
context" href="#dt-static-context">static context</a> ,
overriding any implementation-defined default.] The default
collation is the collation that is used by functions and operators
that require a collation if no other collation is specified. For
example, the <code>gt</code> operator on strings is defined by a
call to the <code>fn:compare</code> function, which takes an
optional collation parameter. Since the <code>gt</code> operator
does not specify a collation, the <code>fn:compare</code> function
implements <code>gt</code> by using the default collation.</p>
<p>If neither the implementation nor the Prolog specifies a default
collation, the Unicode codepoint collation (
<code>http://www.w3.org/2005/xpath-functions/collation/codepoint</code>
) is used.</p>
<p>The following example illustrates a default collation
declaration:</p>
<div class="exampleInner">
<pre>declare default collation
<del class="diff-old">         "http://example.org/languages/Icelandic";
</del>
<ins class="diff-chg">  "http://example.org/languages/Icelandic";
</ins>
</pre></div>
<p>If a default collation declaration specifies a collation by a
relative URI, that relative URI is resolved to an absolute URI
using the <a title="base URI" href="#dt-base-uri">base URI</a> in
the <a title="static context" href="#dt-static-context">static
context</a> . If a Prolog contains more than one default collation
declaration, or the value specified by a default collation
declaration (after resolution of a relative URI, if necessary) is
not present in <a title="statically known collations" 
href="#dt-static-collations">statically known collations</a> , a
<a title="static error" href="#dt-static-error">static error</a> is
raised [ <a title="err:XQST0038" href="#ERRXQST0038">err:XQST0038</a> ].</p>
</div>
<div class="div2">
<h3><a id="id-base-uri-decl" name="id-base-uri-decl"></a> 4.5 Base
URI Declaration</h3>
<h5><a id="N16BBC" name="N16BBC"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-BaseURIDecl" name="doc-xquery11-BaseURIDecl"></a>
 <del class="diff-old">[20]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[11]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-BaseURIDecl">BaseURIDecl</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"declare" "base-uri" <a href="#doc-xquery11-URILiteral">URILiteral</a></code></td>
</tr>
</tbody>
</table>
<p>[ <a title="base URI declaration" id="dt-base-uri-decl" 
name="dt-base-uri-decl">Definition</a> : A <b>base URI declaration</b>
specifies the <a title="base URI" href="#dt-base-uri">base URI</a>
property of the <a title="static context" href="#dt-static-context">static
 context</a> . The <a title="base URI" href="#dt-base-uri">base URI</a> 
property is used when resolving
relative URIs within a <a title="module" href="#dt-module">module</a> .]
 For example, the <code>fn:doc</code>
function resolves a relative URI using the base URI of the calling
module.</p>
<p>The following is an example of a base URI declaration:</p>
<div class="exampleInner">
<pre>declare base-uri "http://example.org";
</pre></div>
<p>If a Prolog contains more than one base URI declaration, a
<a title="static error" href="#dt-static-error">static error</a> is
raised [ <a title="err:XQST0032" href="#ERRXQST0032">err:XQST0032</a> ].</p>
<p>In the terminology of <a href="#RFC3986">[RFC3986]</a> Section
5.1, the URILiteral of the base URI declaration is considered to be
a "base URI embedded in content". If no base URI declaration is
present, the <a title="base URI" href="#dt-base-uri">base URI</a>
in the <a title="static context" href="#dt-static-context">static
context</a> is established according to the principles outlined in
<a href="#RFC3986">[RFC3986]</a> Section 5.1—that is, it defaults
first to the base URI of the encapsulating entity, then to the URI
used to retrieve the entity, and finally to an
implementation-defined default. If the URILiteral in the base URI
declaration is a relative URI, then it is made absolute by
resolving it with respect to this same hierarchy. For example, if
the URILiteral in the base URI declaration is <code>../data/</code>
, and the query is contained in a file whose URI is
<code>file:///C:/temp/queries/query.xq</code> , then the <a title="base 
URI" href="#dt-base-uri">base URI</a> in the <a title="static context" 
href="#dt-static-context">static context</a> is
<code>file:///C:/temp/data/</code> .</p>
<p>It is not intrinsically an error if this process fails to
establish an absolute base URI; however, the <a title="base URI" 
href="#dt-base-uri">base URI</a> in the <a title="static context" 
href="#dt-static-context">static context</a> is then <del 
class="diff-old">undefined, and</del> <a title="undefined" 
href="#dt-undefined"><ins class="diff-chg">undefined</ins></a>
<ins class="diff-chg">[</ins> <a title="err:XPST0001" 
href="#ERRXPST0001"><ins class="diff-chg">err:XPST0001</ins></a>
<ins class="diff-chg">]. When the base URI in the static context
is</ins> <a title="undefined" href="#dt-undefined"><ins class="diff-chg">undefined</ins></a>
 , any attempt to use its value
<del class="diff-old">may</del> <ins class="diff-chg">to resolve a
relative URI reference will</ins> result in an error [ <a 
title="err:XPST0001" href="#ERRXPST0001">err:XPST0001</a> ]. <ins 
class="diff-new">When the base URI of a constructed node is taken from
the base URI in the static context and the latter is</ins>
<a title="undefined" href="#dt-undefined"><ins class="diff-new">undefined</ins></a>
 ,<ins class="diff-new">then the
base-uri property of the constructed node is empty.</ins></p>
</div>
<div class="div2">
<h3><a id="id-construction-declaration" 
name="id-construction-declaration"></a> 4.6 Construction
Declaration</h3>
<h5><a id="N16C3F" name="N16C3F"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ConstructionDecl" 
name="doc-xquery11-ConstructionDecl"></a> <del class="diff-old">[25]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[12]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ConstructionDecl">ConstructionDecl</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"declare" "construction" ("strip" |
"preserve")</code></td>
</tr>
</tbody>
</table>
<p>[ <a title="construction declaration" id="dt-construction-decl" 
name="dt-construction-decl">Definition</a> : A <b>construction
declaration</b> sets the <a title="construction mode" 
href="#dt-construction-mode">construction mode</a> in the <a 
title="static context" href="#dt-static-context">static context</a> ,
overriding any implementation-defined default.] The construction
mode governs the behavior of element and document node
constructors. If construction mode is <code>preserve</code> , the
type of a constructed element node is <code>xs:anyType</code> , and
all attribute and element nodes copied during node construction
retain their original types. If construction mode is
<code>strip</code> , the type of a constructed element node is
<code>xs:untyped</code> ; all element nodes copied during node
construction receive the type <code>xs:untyped</code> , and all
attribute nodes copied during node construction receive the type
<code>xs:untypedAtomic</code> .</p>
<p>The following example illustrates a construction
declaration:</p>
<div class="exampleInner">
<pre>declare construction strip;
</pre></div>
<p>If a Prolog specifies more than one construction declaration, a
<a title="static error" href="#dt-static-error">static error</a> is
raised [ <a title="err:XQST0067" href="#ERRXQST0067">err:XQST0067</a> ].</p>
</div>
<div class="div2">
<h3><a id="id-default-ordering-decl" name="id-default-ordering-decl"></a>
 4.7 Ordering Mode Declaration</h3>
<h5><a id="N16C82" name="N16C82"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-OrderingModeDecl" 
name="doc-xquery11-OrderingModeDecl"></a> <del class="diff-old">[14]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[13]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-OrderingModeDecl">OrderingModeDecl</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"declare" "ordering" ("ordered" |
"unordered")</code></td>
</tr>
</tbody>
</table>
<p>[ <a title="ordering mode declaration" id="dt-ordering-mode-decl" 
name="dt-ordering-mode-decl">Definition</a>
: An <b>ordering mode declaration</b> sets the <a title="ordering mode" 
href="#dt-ordering-mode">ordering mode</a> in the
<a title="static context" href="#dt-static-context">static
context</a> , overriding any implementation-defined default.] This
ordering mode applies to all expressions in a <a title="module" 
href="#dt-module">module</a> (including both the <a title="Prolog" 
href="#dt-prolog">Prolog</a> and the <a title="query body" 
href="#dt-queryBody">Query Body</a> , if any), unless overridden by an
<code>ordered</code> or <code>unordered</code> expression.</p>
<p><a title="ordering mode" href="#dt-ordering-mode">Ordering
mode</a> affects the behavior of <a title="path expression" 
href="#dt-path-expression">path expressions</a> that include a "
<code>/</code> " or " <code>//</code> " operator or an <a title="axis 
step" href="#dt-axis-step">axis step</a> ; <code>union</code>
, <code>intersect</code> , and <code>except</code> expressions; and
FLWOR expressions that have no <code>order by</code> clause. If
ordering mode is <code>ordered</code> , node sequences returned by
path, <code>union</code> , <code>intersect</code> , and
<code>except</code> expressions are in <a title="document order" 
href="#dt-document-order">document order</a> ; otherwise the order
of these return sequences is <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a> .
The effect of ordering mode on FLWOR expressions is described in
<a href="#id-flwor-expressions"><b><del class="diff-old">3.8</del>
<ins class="diff-chg">3.9</ins> FLWOR Expressions</b></a> .</p>
<p>The following example illustrates an ordering mode
declaration:</p>
<div class="exampleInner">
<pre>declare ordering unordered;
</pre></div>
<p>If a Prolog contains more than one ordering mode declaration, a
<a title="static error" href="#dt-static-error">static error</a> is
raised [ <a title="err:XQST0065" href="#ERRXQST0065">err:XQST0065</a> ].</p>
</div>
<div class="div2">
<h3><a id="id-empty-order-decl" name="id-empty-order-decl"></a> 4.8
Empty Order Declaration</h3>
<h5><a id="N16CFC" name="N16CFC"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-EmptyOrderDecl" 
name="doc-xquery11-EmptyOrderDecl"></a> <del class="diff-old">[15]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[14]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-EmptyOrderDecl">EmptyOrderDecl</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"declare" "default" "order" "empty" ("greatest" |
"least")</code></td>
</tr>
</tbody>
</table>
<p>[ <a title="empty order declaration" id="dt-empty-order-decl" 
name="dt-empty-order-decl">Definition</a> : An <b>empty order
declaration</b> sets the <a title="default order for empty sequences" 
href="#dt-default-empty-order">default order for empty sequences</a> in
the <a title="static context" href="#dt-static-context">static
context,</a> overriding any implementation-defined default. This
declaration controls the processing of empty sequences and
<code>NaN</code> values as ordering keys in an <code>order
by</code> clause in a FLWOR expression.] An individual <code>order
by</code> clause may override the default order for empty sequences
by specifying <code>empty greatest</code> or <code>empty
least</code> .</p>
<p>The following example illustrates an empty order
declaration:</p>
<div class="exampleInner">
<pre>declare default order empty least;
</pre></div>
<p>If a Prolog contains more than one empty order declaration, a
<a title="static error" href="#dt-static-error">static error</a> is
raised [ <a title="err:XQST0069" href="#ERRXQST0069">err:XQST0069</a> ].</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>It is important to distinguish an <a title="empty order declaration" 
href="#dt-empty-order-decl">empty order
declaration</a> from an <a title="ordering mode declaration" 
href="#dt-ordering-mode-decl">ordering mode declaration</a> . An
<a title="empty order declaration" href="#dt-empty-order-decl">empty 
order declaration</a> applies only
when an <code>order by</code> clause is present, and specifies how
empty sequences are treated by the <code>order by</code> clause
(unless overridden). An <a title="ordering mode declaration" 
href="#dt-ordering-mode-decl">ordering mode declaration</a> , on the
other hand, applies only in the absence of an <code>order by</code>
clause.</p>
</div>
</div>
<div class="div2">
<h3><a id="id-copy-namespaces-decl" name="id-copy-namespaces-decl"></a> 
4.9 Copy-Namespaces Declaration</h3>
<h5><a id="N16D58" name="N16D58"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-CopyNamespacesDecl" 
name="doc-xquery11-CopyNamespacesDecl"></a> <del class="diff-old">[16]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[15]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-CopyNamespacesDecl">CopyNamespacesDecl</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"declare" "copy-namespaces" <a 
href="#doc-xquery11-PreserveMode">PreserveMode</a> "," <a 
href="#doc-xquery11-InheritMode">InheritMode</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-PreserveMode" name="doc-xquery11-PreserveMode"></a>
 <del class="diff-old">[17]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[16]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-PreserveMode">PreserveMode</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"preserve" | "no-preserve"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-InheritMode" name="doc-xquery11-InheritMode"></a>
 <del class="diff-old">[18]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[17]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-InheritMode">InheritMode</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"inherit" | "no-inherit"</code></td>
</tr>
</tbody>
</table>
<p>[ <a title="copy-namespaces declaration" id="dt-copy-namespaces-decl"
 name="dt-copy-namespaces-decl">Definition</a> : A <b>copy-namespaces
declaration</b> sets the value of <a title="copy-namespaces mode" 
href="#dt-copy-namespaces-mode">copy-namespaces mode</a> in the
<a title="static context" href="#dt-static-context">static
context</a> , overriding any implementation-defined default.
Copy-namespaces mode controls the namespace bindings that are
assigned when an existing element node is copied by an element
constructor or document constructor.] Handling of namespace
bindings by element constructors is described in <a 
href="#id-element-constructor"><b><del class="diff-old">3.7.1</del>
<ins class="diff-chg">3.8.1</ins> Direct Element
Constructors</b></a> .</p>
<p>The following example illustrates a copy-namespaces
declaration:</p>
<div class="exampleInner">
<pre>declare copy-namespaces preserve, no-inherit;
</pre></div>
<p>If a Prolog contains more than one copy-namespaces declaration,
a <a title="static error" href="#dt-static-error">static error</a>
is raised [ <a title="err:XQST0055" href="#ERRXQST0055">err:XQST0055</a>
 ].</p>
</div>
<div class="div2">
<h3><a id="id-decimal-format-decl" name="id-decimal-format-decl"></a> 
4.10 <ins class="diff-new">Decimal-Format Declaration</ins></h3>
<h5><a id="N16DA6" name="N16DA6"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-DecimalFormatDecl" 
name="doc-xquery11-DecimalFormatDecl"></a><ins class="diff-new">[18]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-DecimalFormatDecl"><ins 
class="diff-new">DecimalFormatDecl</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"declare" (("decimal-format"</ins>
<a href="#doc-xquery11-EQName"><ins class="diff-new">EQName</ins></a> <ins
 class="diff-new">) | ("default"
"decimal-format")) (</ins> <a href="#doc-xquery11-DFPropertyName"><ins 
class="diff-new">DFPropertyName</ins></a> <ins class="diff-new">"="</ins>
<a href="#doc-xquery11-StringLiteral"><ins class="diff-new">StringLiteral</ins></a>
 <ins class="diff-new">)*</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-DFPropertyName" 
name="doc-xquery11-DFPropertyName"></a><ins class="diff-new">[19]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-DFPropertyName"><ins class="diff-new">DFPropertyName</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"decimal-separator" |
"grouping-separator" | "infinity" | "minus-sign" | "NaN" |
"percent" | "per-mille" | "zero-digit" | "digit" |
"pattern-separator"</ins></code></td>
</tr>
</tbody>
</table>
<p><ins class="diff-new">[</ins> <a title="decimal-format declaration" 
id="dt-decimal-format-decl" name="dt-decimal-format-decl"><ins 
class="diff-new">Definition</ins></a>
:<ins class="diff-new">A</ins> <b><ins class="diff-new">decimal-format 
declaration</ins></b> <ins class="diff-new">defines</ins> <a 
title="statically known decimal formats" 
href="#dt-static-decimal-formats"><ins class="diff-new">statically known
decimal formats</ins></a> ,<ins class="diff-new">which define the
properties used to format numbers using the</ins> <code><ins 
class="diff-new">fn:format-number()</ins></code> <ins class="diff-new">function],
 as described in</ins> <a href="#xpath-functions-11"><ins 
class="diff-new">[XQuery and XPath
Functions and Operators 1.1]</ins></a> .</p>
<p><ins class="diff-new">It is a</ins> <a title="static error" 
href="#dt-static-error"><ins class="diff-new">static
error</ins></a> <ins class="diff-new">for a query prolog to contain
two decimal formats with the same name, or to contain two default
decimal formats. [</ins> <a title="err:XQST0111" href="#ERRXQST0111"><ins
 class="diff-new">err:XQST0111</ins></a>
<ins class="diff-new">]. It is a</ins> <a title="static error" 
href="#dt-static-error"><ins class="diff-new">static
error</ins></a> <ins class="diff-new">for a decimal-format to
specify a value that is not legal for a given property, as
described in</ins> <a title="statically known decimal formats" 
href="#dt-static-decimal-formats"><ins class="diff-new">statically
known decimal formats</ins></a> <ins class="diff-new">[</ins>
<a title="err:XQST0097" href="#ERRXQST0097"><ins class="diff-new">err:XQST0097</ins></a>
 <ins class="diff-new">]. It is
a</ins> <a title="static error" href="#dt-static-error"><ins 
class="diff-new">static error</ins></a> <ins class="diff-new">if, for 
any
named or unnamed decimal format, the properties representing
characters used in a picture string do not each have distinct
values. These properties are</ins> <a title="decimal-separator" 
href="#id-static-decimal-separator"><ins class="diff-new">decimal-separator-sign</ins></a>
 ,<a title="grouping-separator" 
href="#id-static-decimal-format-grouping-separator"><ins 
class="diff-new">grouping-separator</ins></a> ,<a title="percent-sign" 
href="#id-static-decimal-format-percent-sign"><ins class="diff-new">percent-sign</ins></a>
 ,<a title="per-mille-sign" 
href="#id-static-decimal-format-per-mille-sign"><ins class="diff-new">per-mille-sign</ins></a>
 ,<a title="zero-digit" href="#id-static-decimal-format-zero-digit"><ins
 class="diff-new">zero-digit</ins></a> ,<a title="digit-sign" 
href="#id-static-decimal-format-digit-sign"><ins class="diff-new">digit-sign</ins></a>
 ,<ins class="diff-new">and</ins>
<a title="pattern-separator-sign" 
href="#id-static-decimal-format-pattern-separator-sign"><ins 
class="diff-new">pattern-separator-sign</ins></a> <ins class="diff-new">[</ins>
 <a title="err:XQST0098" href="#ERRXQST0098"><ins class="diff-new">err:XQST0098</ins></a>
<ins class="diff-new">].</ins></p>
</div>
<div class="div2">
<h3><a id="id-schema-import" name="id-schema-import"></a><ins 
class="diff-new">4.11</ins> Schema
Import</h3>
<h5><a id="N16E1C" name="N16E1C"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-SchemaImport" name="doc-xquery11-SchemaImport"></a>
 [21]&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-SchemaImport">SchemaImport</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"import" "schema" <a href="#doc-xquery11-SchemaPrefix">SchemaPrefix</a>
 ? <a href="#doc-xquery11-URILiteral">URILiteral</a> ("at" <a 
href="#doc-xquery11-URILiteral">URILiteral</a> ("," <a 
href="#doc-xquery11-URILiteral">URILiteral</a> )*)?</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-SchemaPrefix" name="doc-xquery11-SchemaPrefix"></a>
 [22]&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-SchemaPrefix">SchemaPrefix</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>("namespace" <a href="#prod-xquery11-NCName">NCName</a>
"=") | ("default" "element" "namespace")</code></td>
</tr>
</tbody>
</table>
<p>[ <a title="schema import" id="dt-schema-import" 
name="dt-schema-import">Definition</a> : A <b>schema import</b> imports
the element declarations, attribute declarations, and type
definitions from a schema into the <a title="in-scope schema 
definitions" href="#dt-issd">in-scope schema
definitions <del class="diff-old">.]</del></a> . <span><ins 
class="diff-chg">For each user-defined atomic type in the schema, schema
import also adds a corresponding</ins> <a title="constructor function" 
href="#dt-constructor-function"><ins class="diff-chg">constructor 
function</ins></a> .</span><ins class="diff-chg">]</ins> The schema to 
be imported is identified by its
<a title="target namespace" href="#dt-target-namespace">target
namespace</a> . The schema import may bind a namespace prefix to
the target namespace of the imported schema, or may declare that
target namespace to be the <a title="default element/type namespace" 
href="#dt-def-elemtype-ns">default
element/type namespace</a> . The schema import may also provide
optional hints for locating the schema.</p>
<p>The namespace prefix specified in a schema import must not be
<code>xml</code> or <code>xmlns</code> [ <a title="err:XQST0070" 
href="#ERRXQST0070">err:XQST0070</a> ], and must not be the same as
any namespace prefix bound in the same module by another schema
import, a <a title="module import" href="#dt-module-import">module
import</a> , a <a title="namespace declaration" 
href="#dt-namespace-declaration">namespace declaration</a> , or a
<a title="module import" href="#dt-module-import">module
declaration</a> [ <a title="err:XQST0033" href="#ERRXQST0033">err:XQST0033</a>
 ]. <ins class="diff-new">It is a
static error if the expanded QName and arity of a constructor
function are respectively equal to the expanded QName and arity of
a function declared in the importing module or in another imported
module (even if the declarations are consistent) [</ins> <a 
title="err:XQST0034" href="#ERRXQST0034"><ins class="diff-new">err:XQST0034</ins></a>
 <ins class="diff-new">].</ins></p>
<p>The first <a href="#doc-xquery11-URILiteral">URILiteral</a> in a
schema import specifies the target namespace of the schema to be
imported. The URILiterals that follow the <code>at</code> keyword
are optional location hints, and can be interpreted or disregarded
in an implementation-dependent way. Multiple location hints might
be used to indicate more than one possible place to look for the
schema or multiple physical resources to be assembled to form the
schema.</p>
<p>A schema import that specifies a zero-length string as target
namespace is considered to import a schema that has no target
namespace. Such a schema import <del class="diff-old">may</del>
<ins class="diff-chg">must</ins> not bind a namespace prefix [
<a title="err:XQST0057" href="#ERRXQST0057">err:XQST0057</a> ], but
it may set the default element/type namespace to a zero-length
string (representing "no namespace"), thus enabling the definitions
in the imported namespace to be referenced. If the default
element/type namespace is not set to "no namespace", there is no
way to reference the definitions in an imported schema that has no
target namespace.</p>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> [ <a title="err:XQST0058" href="#ERRXQST0058">err:XQST0058</a>
 ] if more than one schema import in
the same <a title="Prolog" href="#dt-prolog">Prolog</a> specifies
the same target namespace. It is a <a title="static error" 
href="#dt-static-error">static error</a> [ <a title="err:XQST0059" 
href="#ERRXQST0059">err:XQST0059</a> ] if the implementation is not able
to process a schema import by finding a valid schema with the
specified target namespace. It is a <a title="static error" 
href="#dt-static-error">static error</a> [ <a title="err:XQST0035" 
href="#ERRXQST0035">err:XQST0035</a> ] if multiple imported schemas, or
multiple physical resources within one schema, contain definitions
for the same name in the same symbol space (for example, two
definitions for the same element name, even if the definitions are
consistent). However, it is not an error to import the schema with
target namespace <code>http://www.w3.org/2001/XMLSchema</code>
(predeclared prefix <code>xs</code> ), even though the built-in
types defined in this schema are implicitly included in the
<a title="in-scope schema type" href="#dt-is-types">in-scope schema
types.</a></p>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> [ <a title="err:XQST0012" href="#ERRXQST0012">err:XQST0012</a>
 ] if the set of definitions
contained in all schemas imported by a Prolog do not satisfy the
conditions for schema validity specified in Sections 3 and 5 of
<a href="#XMLSchema">[XML Schema]</a> Part 1--i.e., each definition
must be valid, complete, and unique.</p>
<p>The following example imports a schema, specifying both its
target namespace and its location, and binding the prefix
<code>soap</code> to the target namespace:</p>
<div class="exampleInner">
<pre>import schema namespace soap="http://www.w3.org/2003/05/soap-envelope"
at "http://www.w3.org/2003/05/soap-envelope/";
</pre></div>
<p>The following example imports a schema by specifying only its
target namespace, and makes it the default element/type
namespace:</p>
<div class="exampleInner">
<pre>import schema default element namespace "http://example.org/abc";
</pre></div>
<p>The following example imports a schema that has no target
namespace, providing a location hint, and sets the default
element/type namespace to "no namespace" so that the definitions in
the imported schema can be referenced:</p>
<div class="exampleInner">
<pre>import schema default element namespace "" 
at "http://example.org/xyz.xsd";
</pre></div>
<p>The following example imports a schema that has no target
namespace and sets the default element/type namespace to "no
namespace". Since no location hint is provided, it is up to the
implementation to find the schema to be imported.</p>
<div class="exampleInner">
<pre>import schema default element namespace "";
</pre></div>
</div>
<div class="div2">
<h3><a id="id-module-import" name="id-module-import"></a>
<del class="diff-old">4.11</del> <ins class="diff-chg">4.12</ins>
Module Import</h3>
<h5><a id="N16EF0" name="N16EF0"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ModuleImport" name="doc-xquery11-ModuleImport"></a>
 [23]&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-ModuleImport">ModuleImport</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"import" "module" ("namespace" <a href="#prod-xquery11-NCName">NCName</a>
 "=")? <a href="#doc-xquery11-URILiteral">URILiteral</a> ("at" <a 
href="#doc-xquery11-URILiteral">URILiteral</a> ("," <a 
href="#doc-xquery11-URILiteral">URILiteral</a> )*)?</code></td>
</tr>
</tbody>
</table>
<p>[ <a title="module import" id="dt-module-import" 
name="dt-module-import">Definition</a> : A <b>module import</b> imports
the <del class="diff-old">function</del> <span><ins class="diff-chg">variable</ins>
 declarations and <del class="diff-old">variable</del> <ins 
class="diff-chg">public
function</ins> declarations</span> from one or more <a title="library 
module" href="#dt-library-module">library modules</a> into
the <a title="function signature" href="#dt-function-signature">function
 signatures</a> and <a title="in-scope variables" 
href="#dt-in-scope-variables">in-scope
variables</a> of the importing <a title="module" href="#dt-module">module</a>
 .] Each module import names a <a title="target namespace" 
href="#dt-target-namespace">target namespace</a>
and imports an <a title="implementation defined" 
href="#dt-implementation-defined">implementation-defined</a> set of
modules that share this target namespace. The module import may
bind a namespace prefix to the target namespace, and it may provide
optional hints for locating the modules to be imported.</p>
<p>The namespace prefix specified in a module import must not be
<code>xml</code> or <code>xmlns</code> [ <a title="err:XQST0070" 
href="#ERRXQST0070">err:XQST0070</a> ], and must not be the same as
any namespace prefix bound in the same module by another module
import, a <a title="schema import" href="#dt-schema-import">schema
import</a> , a <a title="namespace declaration" 
href="#dt-namespace-declaration">namespace declaration</a> , or a
<a title="module declaration" href="#dt-module-declaration">module
declaration</a> with a different target namespace [ <a 
title="err:XQST0033" href="#ERRXQST0033">err:XQST0033</a> ].</p>
<p>The first <a href="#doc-xquery11-URILiteral">URILiteral</a> in a
module import must be of nonzero length [ <a title="err:XQST0088" 
href="#ERRXQST0088">err:XQST0088</a> ], and specifies the target
namespace of the modules to be imported. The URILiterals that
follow the <code>at</code> keyword are optional location hints, and
can be interpreted or disregarded in an <a title="implementation 
defined" href="#dt-implementation-defined">implementation-defined</a> 
way.</p>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> [ <a title="err:XQST0047" href="#ERRXQST0047">err:XQST0047</a>
 ] if more than one module import in
a <a title="Prolog" href="#dt-prolog">Prolog</a> specifies the same
target namespace. It is a <a title="static error" 
href="#dt-static-error">static error</a> [ <a title="err:XQST0059" 
href="#ERRXQST0059">err:XQST0059</a> ] if the implementation is not able
to process a module import by finding a valid module definition
with the specified target namespace. It is a <a title="static error" 
href="#dt-static-error">static error</a> if the
<a title="expanded QName" href="#dt-expanded-qname">expanded
QName</a> and arity of a function declared in an imported module
are respectively equal to the <a title="expanded QName" 
href="#dt-expanded-qname">expanded QName</a> and arity of a function
declared in the importing module or in another imported module
(even if the declarations are consistent) [ <a title="err:XQST0034" 
href="#ERRXQST0034">err:XQST0034</a> ]. It is a <a title="static error" 
href="#dt-static-error">static error</a> if the
<a title="expanded QName" href="#dt-expanded-qname">expanded
QName</a> of a variable declared in an imported module is equal (as
defined by the <code>eq</code> operator) to the <a title="expanded 
QName" href="#dt-expanded-qname">expanded QName</a> of a
variable declared in the importing module or in another imported
module (even if the declarations are consistent) [ <a 
title="err:XQST0049" href="#ERRXQST0049">err:XQST0049</a> ].</p>
<p>Each <a title="module" href="#dt-module">module</a> has its own
<a title="static context" href="#dt-static-context">static
context</a> . A <a title="module import" href="#dt-module-import">module
 import</a> imports only functions and
variable declarations; it does not import other objects from the
imported modules, such as <a title="in-scope schema definitions" 
href="#dt-issd">in-scope schema definitions</a> or <a title="statically 
known namespaces" href="#dt-static-namespaces">statically known 
namespaces</a> . Module
imports are not transitive—that is, importing a module provides
access only to function and variable declarations contained
directly in the imported module. For example, if module A imports
module B, and module B imports module C, module A does not have
access to the functions and variables declared in module C.</p>
<p>A module may import its own target namespace (this is
interpreted as importing an <a title="implementation defined" 
href="#dt-implementation-defined">implementation-defined</a> set of
other modules that share its target namespace.) <del class="diff-old">However,
 it is a static error [ err:XQST0073 ] if the
graph of module imports contains a cycle (that is, if there exists
a sequence of modules M 1 ... M n such that each M i imports M i+1
and M n imports M 1 ), unless all the modules in the cycle share a
common namespace.</del></p>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> [ <a title="err:XQST0036" href="#ERRXQST0036">err:XQST0036</a>
 ] to import a module if the
<del class="diff-old">importing module's</del> <a title="in-scope schema
 definitions" href="#dt-issd">in-scope schema
<del class="diff-old">types</del> <ins class="diff-chg">definitions</ins></a>
 <ins class="diff-new">of the
importing module</ins> do not include <del class="diff-old">definitions 
for</del> <ins class="diff-chg">all of</ins>
the <ins class="diff-new">following:</ins></p>
<ol class="enumar">
<li>
<p><ins class="diff-new">An</ins> <a title="in-scope schema type" 
href="#dt-is-types"><ins class="diff-new">in-scope</ins> schema
type <del class="diff-old">names</del></a> <ins class="diff-chg">for 
each type-name</ins> that <del class="diff-old">appear</del> <ins 
class="diff-chg">appears:</ins></p>
<ol class="enumla">
<li>
<p>in the <del class="diff-old">declarations</del> <ins class="diff-chg">type</ins>
 of <del class="diff-old">variables</del>
<ins class="diff-chg">a variable that is declared in the imported
module</ins> and <del class="diff-old">functions (whether</del>
<ins class="diff-chg">referenced</ins> in <del class="diff-old">an
argument type</del> <ins class="diff-chg">the importing module,
OR</ins></p>
</li>
<li>
<p><ins class="diff-chg">in a parameter-type</ins> or <del 
class="diff-old">return type)</del> <ins class="diff-chg">result-type of
a function</ins> that <del class="diff-old">are present</del>
<ins class="diff-chg">is declared</ins> in the imported module and
<del class="diff-old">are</del> referenced in the importing
module.</p>
</li>
</ol>
</li>
<li>
<p><ins class="diff-new">An</ins> <a title="in-scope element 
declarations" href="#dt-is-elems"><ins class="diff-new">in-scope element
 declaration</ins></a> <ins class="diff-new">for each element-name</ins>
 <code><ins class="diff-new">EN</ins></code> <ins class="diff-new">such
that:</ins></p>
<ol class="enumla">
<li>
<p><code><ins class="diff-new">schema-element(EN)</ins></code>
<ins class="diff-new">appears in the declared type of a variable in
the imported module, and that variable is referenced in the
importing module, OR</ins></p>
</li>
<li>
<p><code><ins class="diff-new">schema-element(EN)</ins></code>
<ins class="diff-new">appears in a parameter-type or result-type of
a function declared in the imported module, and that function is
referenced in the importing module.</ins></p>
</li>
</ol>
</li>
<li>
<p><ins class="diff-new">An</ins> <a title="in-scope attribute 
declarations" href="#dt-is-attrs"><ins class="diff-new">in-scope 
attribute declaration</ins></a> <ins class="diff-new">for each 
attribute-name</ins> <code><ins class="diff-new">AN</ins></code> <ins 
class="diff-new">such
that:</ins></p>
<ol class="enumla">
<li>
<p><code><ins class="diff-new">schema-attribute(AN)</ins></code>
<ins class="diff-new">appears in the declared type of a variable in
the imported module, and that variable is referenced in the
importing module, OR</ins></p>
</li>
<li>
<p><code><ins class="diff-new">schema-attribute(AN)</ins></code>
<ins class="diff-new">appears in a parameter-type or result-type of
a function declared in the imported module, and that function is
referenced in the importing module.</ins></p>
</li>
</ol>
</li>
</ol>
<p>To illustrate the above rules, suppose that a certain schema
defines a type named <code>triangle</code> . Suppose that a library
module imports the schema, binds its target namespace to the prefix
<code>geometry</code> , and declares a function with the following
<a title="function signature" href="#dt-function-signature">function 
signature</a> :
<code>math:area($t as geometry:triangle) as xs:double</code> . If a
query wishes to use this function, it must import <em>both</em> the
library module and the schema on which it is based. Importing the
library module alone would not provide access to the definition of
the type <code>geometry:triangle</code> used in the signature of
the <code>area</code> function.</p>
<p><del class="diff-old">[ Definition : A</del> <ins class="diff-chg">The
 following example illustrates a</ins> module
<del class="diff-old">M 1 directly depends on another</del>
<ins class="diff-chg">import:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-chg">
import module namespace math =
  "http://example.org/math-functions";
</ins>
</pre></div>
<div class="div3">
<h4><a id="id-module-handling-module-uris" 
name="id-module-handling-module-uris"></a><ins class="diff-chg">4.12.1
Module URIs</ins></h4>
<p><ins class="diff-chg">Module URIs should be treated in the same
way as other namespace URIs.</ins></p>
<p><ins class="diff-chg">To maximize interoperability, query
authors should use a string that is a legal absolute IRI.</ins></p>
<p><ins class="diff-chg">Implementions must accept any string of
Unicode characters. Module URIs are compared using the Unicode
codepoint collation rather than any concept of semantic
equivalence.</ins></p>
<p><ins class="diff-chg">Implementations may provide mechanisms
allowing the</ins> module <del class="diff-old">M 2
(different</del> <ins class="diff-chg">URI to be used as input to a
process that delivers the module as a resource, for example a
catalog, module repository, or URI resolver. For interoperability,
such mechanisms should not prevent the user</ins> from <del 
class="diff-old">M 1 ) if</del> <ins class="diff-chg">choosing an
arbitrary URI for naming</ins> a <del class="diff-old">variable</del> <ins
 class="diff-chg">module.</ins></p>
<p><ins class="diff-chg">Similarly, implementations may perform
syntactic transformations on the module URI to obtain the names of
related resources, for example to implement a convention relating
the name</ins> or <ins class="diff-new">location of compiled code
to the module URI; but again, such mechanisms should not prevent
the user from choosing an arbitrary module URI.</ins></p>
<p><ins class="diff-new">As with other namespace URIs, it is common
practice to use module URIs whose scheme is "http" and whose
authority part uses a DNS domain name under the control of the
user.</ins></p>
<p><ins class="diff-new">The specifications allow, and some users
might consider it good practice, for the module URI of a</ins>
function <del class="diff-old">declared</del> <ins class="diff-chg">library
 to be the same as the namespace URI of the XML
vocabulary manipulated by the functions</ins> in <del class="diff-old">M
 1 depends</del> <ins class="diff-chg">that
library.</ins></p>
</div>
<div class="div3">
<h4><a id="id-module-handling-multiple-same" 
name="id-module-handling-multiple-same"></a> <del class="diff-old">on</del>
 <ins class="diff-chg">4.12.2 Multiple Modules
with the same Module URI</ins></h4>
<p><ins class="diff-chg">Several different modules with the same
Module URI can be used in the same query. The names of global
variables and functions must be unique within the query as</ins> a
<del class="diff-old">variable or function</del> <ins class="diff-chg">whole:
 that is, if two modules with the same module URI
are used in the same query, the names of their global variables and
functions must not overlap.</ins></p>
<p><ins class="diff-chg">If one module contains an "import module"
declaration for the module URI M, then all global variables and
functions</ins> declared in <del class="diff-old">M 2 .] It</del>
<ins class="diff-chg">participating modules whose module URI</ins>
is <del class="diff-old">a static error [ err:XQST0093 ]</del>
<ins class="diff-chg">M must be accessible in the importing module,
regardless whether the participation of the imported module was
directly due</ins> to <del class="diff-old">import</del>
<ins class="diff-chg">this "import module" declaration.</ins></p>
<p><ins class="diff-chg">There must be only one instance of</ins> a
<del class="diff-old">module M 1</del> <ins class="diff-chg">global
variable with any given name. For example,</ins> if <ins 
class="diff-new">a global variable V is initialized using an element
constructor, then</ins> there <del class="diff-old">exists</del>
<ins class="diff-chg">must be only one instance of this element,
even if the module in which V is declared is imported by several
other modules.</ins></p>
<p><ins class="diff-chg">In an environment where</ins> a
<del class="diff-old">sequence</del> <ins class="diff-chg">group</ins> 
of modules <del class="diff-old">M 1 ... M i
... M 1 such that each</del> <ins class="diff-chg">can be compiled
as a unit, an implementation may consider a</ins> module
<del class="diff-old">directly depends</del> <ins class="diff-chg">used 
in the compiled unit distinct from another instance
of the same module imported from elsewhere in the query.</ins></p>
</div>
<div class="div3">
<h4><a id="id-module-handling-location-uris" 
name="id-module-handling-location-uris"></a> <del class="diff-old">on</del>
 <ins class="diff-chg">4.12.3 Location
URIs</ins></h4>
<p><ins class="diff-chg">The term "location URIs" refers to</ins>
the <del class="diff-old">next</del> <ins class="diff-chg">URIs in
the "at" clause of an "import module" declaration.</ins></p>
<p><ins class="diff-chg">Products should (by default or at user
option) take account of all the location URIs in an "import module"
declaration, treating each location URI as a reference to a module
with the specified</ins> module <ins class="diff-new">URI. Location
URIs should be made absolute with respect to the static base URI of
the query module containing the "import module" declaration where
they appear. The mapping from location URIs to module source code
or compiled code MAY be done</ins> in <ins class="diff-new">any way
convenient to</ins> the <del class="diff-old">sequence (informally,
if M 1 depends on itself through some chain</del> <ins class="diff-chg">implementation.
 If possible given the product's
architecture, security requirements, etc, the product should allow
this to fetch the source code</ins> of <ins class="diff-new">the</ins> 
module <del class="diff-old">dependencies.)</del> <ins class="diff-chg">to
 use the
standard web mechanisms for dereferencing URIs in standard schemes
such as the "http" URI scheme.</ins></p>
<p><del class="diff-old">The following example illustrates</del>
<ins class="diff-chg">When the same absolutized location URI is
used more than once, either in the same "import module" declaration
or in different "import module" declarations within the same query,
a single copy of the resource containing the module is loaded. When
different absolutized location URIs are used, each results in</ins>
a <ins class="diff-new">single</ins> module <del class="diff-old">import:</del>
 <ins class="diff-chg">being loaded, unless
the implementation is able to determine that the different URIs are
references to the same resource. #### No error due to duplicate
variable or functions names should arise from the same module being
imported more than once, so long as the absolute location URI is
the same in each case.</ins></p>
<p><ins class="diff-chg">Implementations must report a static error
if a location URI cannot be resolved after all available recovery
strategies have been exhausted.</ins></p>
<del class="diff-old">import module namespace math =
"http://example.org/math-functions";</del></div>
<div class="div3">
<h4><a id="id-module-handling-cycles" name="id-module-handling-cycles"></a>
 <ins class="diff-new">4.12.4
Cycles</ins></h4>
<p><ins class="diff-new">It is not an error to have a cycle in the
import graph, either at the level of module URIs or at the level of
location URIs. The only rules concerning cycles are the rules for
functions and variables declared in different modules.</ins></p>
</div>
</div>
<div class="div2">
<h3><a id="id-namespace-declaration" name="id-namespace-declaration"></a>
 <del class="diff-old">4.12</del>
<ins class="diff-chg">4.13</ins> Namespace Declaration</h3>
<h5><a id="N1705E" name="N1705E"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-NamespaceDecl" name="doc-xquery11-NamespaceDecl"></a>
 <del class="diff-old">[10]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[24]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-NamespaceDecl">NamespaceDecl</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"declare" "namespace" <a href="#prod-xquery11-NCName">NCName</a>
 "=" <a href="#doc-xquery11-URILiteral">URILiteral</a></code></td>
</tr>
</tbody>
</table>
<p>[ <a title="namespace declaration" id="dt-namespace-declaration" 
name="dt-namespace-declaration">Definition</a> : A <b>namespace
declaration</b> declares a namespace prefix and associates it with
a namespace URI, adding the (prefix, URI) pair to the set of
<a title="statically known namespaces" href="#dt-static-namespaces">statically
 known namespaces</a> .] The
namespace declaration is in scope throughout the query in which it
is declared, unless it is overridden by a <a title="namespace 
declaration attribute" href="#dt-namespace-decl-attr">namespace 
declaration attribute</a> in a
<a title="direct element constructor" href="#dt-direct-elem-const">direct
 element constructor</a> .</p>
<p>If the URILiteral part of a namespace declaration is a
zero-length string, any existing namespace binding for the given
prefix is removed from the <a title="statically known namespaces" 
href="#dt-static-namespaces">statically known namespaces</a> . This
feature provides a way to remove predeclared namespace prefixes
such as <code>local</code> .</p>
<p>The following query illustrates a namespace declaration:</p>
<div class="exampleInner">
<pre>declare namespace foo = "http://example.org";
&lt;foo:bar&gt; Lentils &lt;/foo:bar&gt;
</pre></div>
<p>In the query result, the newly created node is in the namespace
associated with the namespace URI <code>http://example.org</code>
.</p>
<p>The namespace prefix specified in a namespace declaration must
not be <code>xml</code> or <code>xmlns</code> [ <a title="err:XQST0070" 
href="#ERRXQST0070">err:XQST0070</a> <del class="diff-old">], and</del> <ins
 class="diff-chg">]. The namespace URI
specified in a namespace declaration must not be</ins>
<code><ins class="diff-chg">http://www.w3.org/XML/1998/namespace</ins></code>
<ins class="diff-chg">or</ins> <code><ins class="diff-chg">http://www.w3.org/2000/xmlns/</ins></code>
 <ins class="diff-chg">[</ins> <a title="err:XQST0070" 
href="#ERRXQST0070"><ins class="diff-chg">err:XQST0070</ins></a>
<ins class="diff-chg">]. The namespace prefix specified in a
namespace declaration</ins> must not be the same as any namespace
prefix bound in the same module by a <a title="module import" 
href="#dt-module-import">module import</a> , <a title="schema import" 
href="#dt-schema-import">schema import</a> , <a title="module import" 
href="#dt-module-import">module declaration</a> ,
or another namespace declaration [ <a title="err:XQST0033" 
href="#ERRXQST0033">err:XQST0033</a> ].</p>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> [ <a title="err:XPST0081" href="#ERRXPST0081">err:XPST0081</a>
 ] if an expression contains a
<a title="lexical QName" href="#dt-qname"><ins class="diff-new">lexical</ins>
 QName</a> with a namespace prefix that is
not in the <a title="statically known namespaces" 
href="#dt-static-namespaces">statically known namespaces</a> .</p>
<p>XQuery has several predeclared namespace prefixes that are
present in the <a title="statically known namespaces" 
href="#dt-static-namespaces">statically known namespaces</a> before each
query is processed. These prefixes may be used without an explicit
declaration. They may be overridden by <a title="namespace declaration" 
href="#dt-namespace-declaration">namespace
declarations</a> in a <a title="Prolog" href="#dt-prolog">Prolog</a> or 
by <a title="namespace declaration attribute" 
href="#dt-namespace-decl-attr">namespace declaration attributes</a> on
constructed elements (however, the prefix <code>xml</code>
<del class="diff-old">may</del> <ins class="diff-chg">must</ins>
not be redeclared, and no other prefix may be bound to the
namespace URI associated with the prefix <code>xml</code> [
<a title="err:XQST0070" href="#ERRXQST0070">err:XQST0070</a> ]).
The predeclared namespace prefixes are as follows:</p>
<ul>
<li>
<p><code>xml = http://www.w3.org/XML/1998/namespace</code></p>
</li>
<li>
<p><code>xs = http://www.w3.org/2001/XMLSchema</code></p>
</li>
<li>
<p><code>xsi = http://www.w3.org/2001/XMLSchema-instance</code></p>
</li>
<li>
<p><code>fn = http://www.w3.org/2005/xpath-functions</code></p>
</li>
<li>
<p><code>local =
http://www.w3.org/2005/xquery-local-functions</code> (see <a 
href="#FunctionDeclns"><b><del class="diff-old">4.15</del> <ins 
class="diff-chg">4.18</ins> Function Declaration</b></a> .)</p>
</li>
</ul>
<p>Additional predeclared namespace prefixes may be added to the
<a title="statically known namespaces" href="#dt-static-namespaces">statically
 known namespaces</a> by an
implementation.</p>
<p>When element or attribute names are compared, they are
considered identical if the local parts and namespace URIs match on
a codepoint basis. Namespace prefixes need not be identical for two
names to match, as illustrated by the following example:</p>
<div class="exampleInner">
<pre>declare namespace xx = "http://example.org";
let $i := &lt;foo:bar xmlns:foo = "http://example.org"&gt;
              &lt;foo:bing&gt; Lentils &lt;/foo:bing&gt;
          &lt;/foo:bar&gt;
return $i/xx:bing
</pre></div>
<p>Although the namespace prefixes <code>xx</code> and
<code>foo</code> differ, both are bound to the namespace URI
<code>"http://example.org"</code> . Since <code>xx:bing</code> and
<code>foo:bing</code> have the same local name and the same
namespace URI, they match. The output of the above query is as
follows.</p>
<div class="exampleInner">
<pre>&lt;foo:bing xmlns:foo = "http://example.org"&gt; Lentils &lt;/foo:bing&gt;
</pre></div>
</div>
<div class="div2">
<h3><a id="id-default-namespace" name="id-default-namespace"></a>
<del class="diff-old">4.13</del> <ins class="diff-chg">4.14</ins>
Default Namespace Declaration</h3>
<h5><a id="N1713C" name="N1713C"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-DefaultNamespaceDecl" 
name="doc-xquery11-DefaultNamespaceDecl"></a> <del class="diff-old">[12]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[25]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-DefaultNamespaceDecl">DefaultNamespaceDecl</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"declare" "default" ("element" | "function") "namespace"
<a href="#doc-xquery11-URILiteral">URILiteral</a></code></td>
</tr>
</tbody>
</table>
<p><b>Default namespace declarations</b> can be used in a <a 
title="Prolog" href="#dt-prolog">Prolog</a> to facilitate the use of
unprefixed QNames. The following kinds of default namespace
declarations are supported:</p>
<ul>
<li>
<p>A <b>default element/type namespace declaration</b> declares a
namespace URI that is associated with unprefixed names of elements
and types. This declaration is recorded as the <a title="default 
element/type namespace" href="#dt-def-elemtype-ns">default
element/type namespace</a> in the <a title="static context" 
href="#dt-static-context">static context</a> . A <a title="Prolog" 
href="#dt-prolog">Prolog</a> may contain at most one default
element/type namespace declaration [ <a title="err:XQST0066" 
href="#ERRXQST0066">err:XQST0066</a> ]. If the <a 
href="#doc-xquery11-URILiteral">URILiteral</a> in a default element/type
namespace declaration is a zero-length string, the <a title="default 
element/type namespace" href="#dt-def-elemtype-ns">default
element/type namespace</a> is undeclared (set to "none"), and
unprefixed names of elements and types are considered to be in no
namespace. The following example illustrates the declaration of a
default namespace for elements and types:</p>
<div class="exampleInner">
<pre>declare default element namespace "http://example.org/names";
</pre></div>
<p>A default element/type namespace declaration may be overridden
by a <a title="namespace declaration attribute" 
href="#dt-namespace-decl-attr">namespace declaration attribute</a> in a
<a title="direct element constructor" href="#dt-direct-elem-const">direct
 element constructor</a> .</p>
<p>If no default element/type namespace declaration is present,
unprefixed element and type names are in no namespace (however, an
implementation may define a different default as specified in
<a href="#id-xq-static-context-components"><b>C.1 Static Context
Components</b></a> .)</p>
</li>
<li>
<p>A <b>default function namespace declaration</b> declares a
namespace URI that is associated with unprefixed function names in
function calls and function declarations. This declaration is
recorded as the <a title="default function namespace" 
href="#dt-def-fn-ns">default function namespace</a> in the <a 
title="static context" href="#dt-static-context">static context</a> . A
<a title="Prolog" href="#dt-prolog">Prolog</a> may contain at most
one default function namespace declaration [ <a title="err:XQST0066" 
href="#ERRXQST0066">err:XQST0066</a> ]. If the
StringLiteral in a default function namespace declaration is a
zero-length string, the default function namespace is undeclared
(set to "none"). In that case, any functions that are associated
with a namespace can be called only by using an explicit namespace
prefix.</p>
<p>If no default function namespace declaration is present, the
default function namespace is the namespace of XPath/XQuery
functions, <code>http://www.w3.org/2005/xpath-functions</code>
(however, an implementation may define a different default as
specified in <a href="#id-xq-static-context-components"><b>C.1
Static Context Components</b></a> .)</p>
<p>The following example illustrates the declaration of a default
function namespace:</p>
<div class="exampleInner">
<pre>declare default function namespace 
     "http://example.org/math-functions";
</pre></div>
<p>The effect of declaring a default function namespace is that all
functions in the default function namespace, including
implicitly-declared <a title="constructor function" 
href="#dt-constructor-function">constructor functions</a> , can be
invoked without specifying a namespace prefix. When a function call
uses a function name with no prefix, the local name of the function
must match a function (including implicitly-declared <a 
title="constructor function" href="#dt-constructor-function">constructor
functions</a> ) in the default function namespace [ <a 
title="err:XPST0017" href="#ERRXPST0017">err:XPST0017</a> ].</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>Only <a title="constructor function" href="#dt-constructor-function">constructor
 functions</a> can be in no
namespace.</p>
</div>
</li>
</ul>
<p>Unprefixed attribute names and variable names are in no
namespace.</p>
</div>
<div class="div2">
<h3><a id="id-annotations" name="id-annotations"></a> <del 
class="diff-old">4.14 Variable Declaration</del> <ins class="diff-chg">4.15
 Annotations</ins></h3>
<h5><a id="N171C9" name="N171C9"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-AnnotatedDecl" name="doc-xquery11-AnnotatedDecl"></a>
 <del class="diff-old">[24]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[26]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">VarDecl</del> <a 
href="#prod-xquery11-AnnotatedDecl"><ins class="diff-chg">AnnotatedDecl</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"declare" <del class="diff-old">"variable" "$"
QName</del> <a href="#doc-xquery11-Annotation"><ins class="diff-chg">Annotation</ins></a>
 <del class="diff-old">TypeDeclaration</del> <ins class="diff-chg">* (</ins>
<a href="#doc-xquery11-VarDecl"><ins class="diff-chg">VarDecl</ins></a> <del
 class="diff-old">? ((":="
ExprSingle</del> <ins class="diff-chg">|</ins> <a 
href="#doc-xquery11-FunctionDecl"><ins class="diff-chg">FunctionDecl</ins></a>
 ) <del class="diff-old">|
"external")</del></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-Annotation" name="doc-xquery11-Annotation"></a> <del
 class="diff-old">[88]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[27]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">VarName</del> <a 
href="#prod-xquery11-Annotation"><ins class="diff-chg">Annotation</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">QName</del> <ins class="diff-chg">"%"</ins>
 <a href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a> <del
 class="diff-old">[118]&nbsp;&nbsp;&nbsp; TypeDeclaration</del>
<ins class="diff-chg">("("</ins> <a href="#doc-xquery11-Literal"><ins 
class="diff-chg">Literal</ins></a>
<del class="diff-old">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp; "as"
SequenceType</del> <ins class="diff-chg">(","</ins> <a 
href="#doc-xquery11-Literal"><ins class="diff-chg">Literal</ins></a>
<ins class="diff-chg">)* ")")?</ins></code></td>
</tr>
</tbody>
</table>
<p><del class="diff-old">A variable declaration adds the static
type of a variable</del> <ins class="diff-chg">XQuery uses
annotations</ins> to <del class="diff-old">the in-scope variables
,</del> <ins class="diff-chg">declare properties associated with
functions</ins> and <del class="diff-old">may also add</del>
<ins class="diff-chg">variables. For instance,</ins> a <del 
class="diff-old">value for the variable to the variable values . If the
expanded QName of the variable is equal (as defined by the</del>
<ins class="diff-chg">function may be declared</ins>
<code><del class="diff-old">eq</del> <ins class="diff-chg">%public</ins></code>
 ,<code><ins class="diff-chg">%private</ins></code> ,<code><ins 
class="diff-chg">%deterministic</ins></code> <del class="diff-old">operator)
 to the name of another variable</del>
<ins class="diff-chg">or</ins> <code><ins class="diff-chg">%nondeterministic</ins></code>
 .<ins class="diff-chg">The semantics associated with these properties 
are
described</ins> in <del class="diff-old">in-scope variables , a
static error is raised [ err:XQST0049 ].</del> <a href="#FunctionDeclns"><b><ins
 class="diff-chg">4.18 Function
Declaration</ins></b></a> .</p>
<p><ins class="diff-new">Annotations are</ins> <code><ins 
class="diff-new">(QName, value)</ins></code> <ins class="diff-new">pairs.</ins>
 If <del class="diff-old">a variable
declaration includes a type, that type is added to the static
context as</del> the <del class="diff-old">type</del> <ins 
class="diff-chg">EQName</ins> of the <del class="diff-old">variable.
If</del> <ins class="diff-chg">annotation is</ins> a <del 
class="diff-old">variable declaration includes an expression but not an
explicit type,</del> <a title="lexical QName" href="#dt-qname"><ins 
class="diff-chg">lexical QName</ins></a> , the
<del class="diff-old">type</del> <ins class="diff-chg">prefix</ins>
of the <del class="diff-old">variable</del> <ins class="diff-chg">QName</ins>
 is <del class="diff-old">inferred from
static analysis of</del> <ins class="diff-chg">resolved using</ins>
the <del class="diff-old">expression and</del> <ins class="diff-chg">statically
 known namespaces; if no prefix</ins> is
<del class="diff-old">added to the static context . If a variable
declaration includes both a type and an expression, the value
returned by the expression must match the declared type according
to</del> <ins class="diff-chg">present,</ins> the <del class="diff-old">rules
 for SequenceType matching ; otherwise a type
error</del> <ins class="diff-chg">name</ins> is <del class="diff-old">raised
 [ err:XPTY0004 ]. [ Definition : If a variable
declaration includes an expression,</del> <ins class="diff-chg">in</ins>
 the <del class="diff-old">expression is called
an initializing expression .]</del> <a title="default function 
namespace" href="#dt-def-fn-ns"><ins class="diff-chg">default function 
namespace</ins></a> . The <del class="diff-old">initializing expression 
for a given variable must be
evaluated before the evaluation</del> <ins class="diff-chg">XQuery
family</ins> of <del class="diff-old">any expression that
references the variable. The static context for an initializing
expression includes all functions that are declared or imported
anywhere in the Prolog , but it includes only those variables and
namespaces that are declared or imported earlier</del> <ins 
class="diff-chg">languages define annotations</ins> in the <del 
class="diff-old">Prolog than the variable that is being initialized. [
Definition : A variable</del> <code><del class="diff-old">$x
depends on a variable $y</del> <ins class="diff-chg">fn</ins></code> <del
 class="diff-old">or a
function</del> <ins class="diff-chg">namespace. Assuming this the
default element namespace is</ins> <code><del class="diff-old">f2
if a reference to</del> <ins class="diff-chg">fn</ins></code>
,<ins class="diff-chg">the annotations</ins> <code><del class="diff-old">$y</del>
 <ins class="diff-chg">%private</ins></code>
<del class="diff-old">or</del> <ins class="diff-chg">and</ins>
<code><del class="diff-old">f2</del> <ins class="diff-chg">%fn:private</ins></code>
 <del class="diff-old">appears</del> <ins class="diff-chg">both have the
 same
annotation name.</ins></p>
<p><ins class="diff-chg">Implementations can add their own
annotations, which should not be</ins> in the <del class="diff-old">initializing
 expression of</del> <code><del class="diff-old">$x , or</del> <ins 
class="diff-chg">fn</ins></code>
<ins class="diff-chg">namespace. For instance,</ins> if <del 
class="diff-old">there exists a variable</del> <ins class="diff-chg">the</ins>
 <code><del class="diff-old">$z</del>
<ins class="diff-chg">eg</ins></code> <del class="diff-old">or</del> <ins
 class="diff-chg">prefix is bound to</ins>
a <del class="diff-old">function</del> <ins class="diff-chg">namespace 
associated with a particular implementation,
it could define annotations like</ins> <code><del class="diff-old">f3</del>
 <ins class="diff-chg">eg:sequential</ins></code> .<ins class="diff-chg">The
semantics
 and error handling associated with</ins> such <del class="diff-old">that</del>
 <ins class="diff-chg">annotations are beyond
the scope of this specification.</ins></p>
<p><ins class="diff-chg">An annotation always has a value. If no
explicit value is provided, the value is</ins> <code><del 
class="diff-old">$x depends on</del> <ins class="diff-chg">fn:true()</ins></code>
 .<ins class="diff-chg">For
instance, the annotation</ins> <code><del class="diff-old">$z</del>
<ins class="diff-chg">%private</ins></code> <del class="diff-old">or</del>
 <ins class="diff-chg">sets the value of
the</ins> <code><del class="diff-old">f3</del> <ins class="diff-chg">private</ins></code>
 <del class="diff-old">and</del>
<ins class="diff-chg">property to</ins> <code><del class="diff-old">$z 
or</del> <ins class="diff-chg">true</ins></code>
.<ins class="diff-chg">An annotation can provide values explicitly
using a parenthesized list of</ins> <a title="" href="#id-literals"><ins
 class="diff-chg">literals</ins></a>
.<ins class="diff-chg">For instance, the annotation</ins>
<code><del class="diff-old">f3</del> <ins class="diff-chg">%java:method("java.lang.Math.sin")</ins></code>
<del class="diff-old">depends on</del> <ins class="diff-chg">sets
the value of the</ins> <code><del class="diff-old">$y</del>
<ins class="diff-chg">java:method</ins></code> <del class="diff-old">or</del>
 <ins class="diff-chg">property to the string
value</ins> <code><del class="diff-old">f2 .]</del> <ins 
class="diff-chg">java.lang.Math.sin</ins></code> .</p>
<del class="diff-old">[ Definition : A function</del></div>
<div class="div2">
<h3><a id="id-variable-declarations" name="id-variable-declarations"></a>
 <ins class="diff-chg">4.16 Variable
Declaration</ins></h3>
<h5><a id="N17253" name="N17253"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="noid_N17029.doc-xquery11-AnnotatedDecl" 
name="noid_N17029.doc-xquery11-AnnotatedDecl"></a><ins class="diff-chg">[26]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">f1</del> <ins class="diff-chg">AnnotatedDecl</ins></code>
 <del class="diff-old">depends
on a variable</del></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">$y</del> <ins class="diff-chg">"declare"</ins>
 <a href="#doc-xquery11-Annotation"><ins class="diff-chg">Annotation</ins></a>
 <ins class="diff-chg">* (</ins>
<a href="#doc-xquery11-VarDecl"><ins class="diff-chg">VarDecl</ins></a> <ins
 class="diff-chg">|</ins> <a href="#doc-xquery11-FunctionDecl"><ins 
class="diff-chg">FunctionDecl</ins></a> <ins class="diff-chg">)</ins></code>
 <del class="diff-old">or a
function</del></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N1702C.doc-xquery11-Annotation" 
name="noid_N1702C.doc-xquery11-Annotation"></a> <ins class="diff-chg">[27]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">f2</del> <ins class="diff-chg">Annotation</ins></code>
 <del class="diff-old">if a
reference to</del></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">$y</del> <ins class="diff-chg">"%"</ins>
 <a href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a> <ins
 class="diff-chg">("("</ins>
<a href="#doc-xquery11-Literal"><ins class="diff-chg">Literal</ins></a> <ins
 class="diff-chg">(","</ins>
<a href="#doc-xquery11-Literal"><ins class="diff-chg">Literal</ins></a> <ins
 class="diff-chg">)*
")")?</ins></code> <del class="diff-old">or</del></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-VarDecl" name="doc-xquery11-VarDecl"></a>
<ins class="diff-chg">[28]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">f2</del> <a 
href="#prod-xquery11-VarDecl"><ins class="diff-chg">VarDecl</ins></a></code>
 <del class="diff-old">appears
in the body of f1 , or if there exists a variable</del></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">$z</del> <ins class="diff-chg">"variable"
 "$"</ins> <a href="#doc-xquery11-VarName"><ins class="diff-chg">VarName</ins></a>
<a href="#doc-xquery11-TypeDeclaration"><ins class="diff-chg">TypeDeclaration</ins></a>
 <ins class="diff-chg">?
((":="</ins> <a href="#doc-xquery11-VarValue"><ins class="diff-chg">VarValue</ins></a>
 <ins class="diff-chg">) | ("external"
(":="</ins> <a href="#doc-xquery11-VarDefaultValue"><ins 
class="diff-chg">VarDefaultValue</ins></a> <ins class="diff-chg">)?))</ins></code>
 <del class="diff-old">or a
function</del></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N17033.doc-xquery11-VarName" 
name="noid_N17033.doc-xquery11-VarName"></a> <ins class="diff-chg">[129]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">f3</del> <ins class="diff-chg">VarName</ins></code>
 <del class="diff-old">such
that</del></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">f1</del> <a href="#doc-xquery11-EQName"><ins
 class="diff-chg">EQName</ins></a></code> <del class="diff-old">depends</del></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N17036.doc-xquery11-TypeDeclaration" 
name="noid_N17036.doc-xquery11-TypeDeclaration"></a> <del 
class="diff-old">on</del> <ins class="diff-chg">[168]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">$z</del> <ins class="diff-chg">TypeDeclaration</ins></code>
 <del class="diff-old">or</del></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">f3</del> <ins class="diff-chg">"as"</ins>
 <a href="#doc-xquery11-SequenceType"><ins class="diff-chg">SequenceType</ins></a></code>
 <del class="diff-old">and</del></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-VarValue" name="doc-xquery11-VarValue"></a>
<ins class="diff-chg">[29]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">$z</del> <a 
href="#prod-xquery11-VarValue"><ins class="diff-chg">VarValue</ins></a></code>
 <del class="diff-old">or</del></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">f3</del> <a 
href="#doc-xquery11-ExprSingle"><ins class="diff-chg">ExprSingle</ins></a></code>
 <del class="diff-old">depends</del></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-VarDefaultValue" 
name="doc-xquery11-VarDefaultValue"></a> <del class="diff-old">on</del>
<ins class="diff-chg">[30]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">$y</del> <a 
href="#prod-xquery11-VarDefaultValue"><ins class="diff-chg">VarDefaultValue</ins></a></code>
 <del class="diff-old">or</del></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">f2 .] If a variable depends on
itself, a static error is raised [ err:XQST0054</del> <a 
href="#doc-xquery11-ExprSingle"><ins class="diff-chg">ExprSingle</ins></a>
 <del class="diff-old">].</del></code></td>
</tr>
</tbody>
</table>
<p><del class="diff-old">If the</del> <ins class="diff-chg">A</ins>
<b>variable declaration <del class="diff-old">includes</del></b>
<ins class="diff-chg">adds</ins> the <del class="diff-old">keyword
external ,</del> <a title="static type" href="#dt-static-type"><ins 
class="diff-chg">static type</ins></a>
<ins class="diff-chg">of</ins> a <del class="diff-old">value must
be provided for the</del> variable <del class="diff-old">by the
external environment before</del> <ins class="diff-chg">to</ins>
the <del class="diff-old">query can be evaluated. If an external
variable declaration</del> <a title="in-scope variables" 
href="#dt-in-scope-variables"><ins class="diff-chg">in-scope
variables</ins></a> ,<ins class="diff-chg">and may</ins> also
<del class="diff-old">includes</del> <ins class="diff-chg">add</ins> a <del
 class="diff-old">declared type,
the</del> value <del class="diff-old">provided by the external
environment must match</del> <ins class="diff-chg">for</ins> the
<del class="diff-old">declared type according</del> <ins 
class="diff-chg">variable</ins> to the <del class="diff-old">rules for
SequenceType matching (see</del> <a title="variable values" 
href="#dt-variable-values"><ins class="diff-chg">variable
values</ins></a> .</p>
<div class="note">
<p class="prefix"><b><del class="diff-old">2.2.5 Consistency
Constraints</del> <ins class="diff-chg">Note:</ins></b> <del 
class="diff-old">). If an external</del></p>
<p><ins class="diff-chg">A</ins> <b>variable declaration
<del class="diff-old">does not include</del></b> <ins class="diff-chg">always
 refers to</ins> a <del class="diff-old">declared
type, the type and</del> <ins class="diff-chg">declaration of</ins>
a <del class="diff-old">matching value must be provided by the
external environment at evaluation time.</del> <ins class="diff-chg">variable
 in a Prolog.</ins> The <del class="diff-old">static type</del> <ins 
class="diff-chg">binding</ins> of
<del class="diff-old">such</del> a variable <del class="diff-old">is 
considered to be item()* . Any reference</del> to a
<ins class="diff-new">value in a query expression, such as a FLWOR
expression, is known as a</ins> <b>variable <del class="diff-old">that 
was declared external , but was</del> <ins class="diff-chg">binding</ins></b>
 ,<ins class="diff-chg">and does</ins>
not <del class="diff-old">bound</del> <ins class="diff-chg">make
the variable visible</ins> to <ins class="diff-new">an importing
module.</ins></p>
</div>
<p><ins class="diff-new">During static analysis,</ins> a
<del class="diff-old">value</del> <ins class="diff-chg">variable
declaration causes a pair</ins> <code><ins class="diff-chg">(expanded 
QName N, type T)</ins></code> <ins class="diff-chg">to be added to the</ins>
 <a title="in-scope variables" href="#dt-in-scope-variables"><ins 
class="diff-chg">in-scope
variables</ins></a> .<ins class="diff-chg">The expanded QName N is
the</ins> <code><ins class="diff-chg">VarName</ins></code>
.<ins class="diff-chg">If N is equal (as defined</ins> by the
<del class="diff-old">external environment, raises</del>
<ins class="diff-chg">eq operator) to the expanded QName of another
variable in in-scope variables,</ins> a <del class="diff-old">dynamic</del>
 <a title="static error" href="#dt-static-error"><ins class="diff-chg">static</ins>
 error</a>
<ins class="diff-new">is raised</ins> [ <del class="diff-old">err:XPDY0002</del>
 <a title="err:XQST0049" href="#ERRXQST0049"><ins class="diff-chg">err:XQST0049</ins></a>
 ].</p>
<p>All variable names declared in a library module must (when
expanded) be in the target namespace of the library module [
<a title="err:XQST0048" href="#ERRXQST0048">err:XQST0048</a> ].
When a library module is imported, variables declared in the
imported module are added to the in-scope variables of the
importing module.</p>
<p>Variable names that have no namespace prefix are in no
namespace. Variable declarations that have no namespace prefix may
appear only in a main module.</p>
<p><del class="diff-old">The term variable declaration always
refers to a declaration of a variable in a Prolog . The binding of
a variable to a value in a query expression, such as a FLWOR
expression, is known as a variable binding , and does not make the
variable visible to an importing module.</del> Here are some
examples of variable declarations:</p>
<ul>
<li>
<p>The following declaration specifies both the type and the value
of a variable. This declaration causes the type
<code>xs:integer</code> to be associated with variable
<code>$x</code> in the <a title="static context" 
href="#dt-static-context">static context</a> , and the value
<code>7</code> to be associated with variable <code>$x</code> in
the <a title="dynamic context" href="#dt-dynamic-context">dynamic
context</a> .</p>
<div class="exampleInner">
<pre>declare variable $x as xs:integer := 7;
</pre></div>
</li>
<li>
<p>The following declaration specifies a value but not a type. The
<a title="static type" href="#dt-static-type">static type</a> of
the variable is inferred from the static type of its value. In this
case, the variable <code>$x</code> has a static type of
<code>xs:decimal</code> , inferred from its value which is 7.5.</p>
<div class="exampleInner">
<pre>declare variable $x := 7.5;
</pre></div>
</li>
<li>
<p>The following declaration specifies a type but not a value. The
keyword <code>external</code> indicates that the value of the
variable will be provided by the external environment. At
evaluation time, if the variable <code>$x</code> in the <a 
title="dynamic context" href="#dt-dynamic-context">dynamic context</a>
does not have a value of type <code>xs:integer</code> , a <a title="type
 error" href="#dt-type-error">type error</a> is raised.</p>
<div class="exampleInner">
<pre>declare variable $x as xs:integer external;
</pre></div>
</li>
<li>
<p>The following declaration specifies neither a type nor a value.
It simply declares that the query depends on the existence of a
variable named <code>$x</code> , whose type and value will be
provided by the external environment. During query analysis, the
type of <code>$x</code> is considered to be <code>item()*</code> .
During query evaluation, the <a title="dynamic context" 
href="#dt-dynamic-context">dynamic context</a> must include a type and a
value for <code>$x</code> , and its value must be compatible with
its type.</p>
<div class="exampleInner">
<pre>declare variable $x external;
</pre></div>
</li>
<li>
<p>The following declaration, which might appear in a library
module, declares a variable whose name includes a namespace
prefix:</p>
<div class="exampleInner">
<pre>declare variable $math:pi as xs:double := 3.14159E0;
</pre></div>
</li>
<li>
<p><ins class="diff-new">This is an example of an external variable
declaration that provides a</ins> <code><ins class="diff-new">VarDefaultValue</ins></code>
 :</p>
<div class="exampleInner">
<pre><ins class="diff-new">
declare variable $x as xs:integer external := 47;
</ins>
</pre></div>
</li>
</ul>
<p><ins class="diff-new">The syntax for variable declarations
allows annotations, but XQuery 1.1 does not define annotations that
apply to variable declarations. An implementation can provide
annotations it needs. For instance, an implemenation that supports
volatile external variables might allow them to be declared using
an annotation:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
declare %eg:volatile variable $time as xs:time external;
</ins>
</pre></div>
<p><ins class="diff-new">The type of the declared variable is as
follows:</ins></p>
<ul>
<li>
<p><ins class="diff-new">If</ins> <code><ins class="diff-new">TypeDeclaration</ins></code>
 <ins class="diff-new">is
present, then the</ins> <code><ins class="diff-new">SequenceType</ins></code>
 <ins class="diff-new">in
the</ins> <code><ins class="diff-new">TypeDeclaration</ins></code>
<ins class="diff-new">; otherwise</ins></p>
</li>
<li>
<p><ins class="diff-new">If the Static Typing Feature is in effect
and</ins> <code><ins class="diff-new">VarValue</ins></code>
<ins class="diff-new">is present, then the static type inferred
from static analysis of the expression</ins> <code><ins class="diff-new">VarValue</ins></code>
 <ins class="diff-new">;</ins></p>
<div class="note">
<p class="prefix"><b><ins class="diff-new">Note:</ins></b></p>
<p><ins class="diff-new">Type inference might not be computable
until after the check for circular dependencies, described below,
is complete.</ins></p>
</div>
</li>
<li>
<p><ins class="diff-new">Otherwise,</ins> <code><ins class="diff-new">item()*</ins></code>
 .</p>
</li>
</ul>
<p><ins class="diff-new">[</ins> <a title="initializing expression" 
id="dt-initializing-expression" name="dt-initializing-expression"><ins 
class="diff-new">Definition</ins></a> :<ins class="diff-new">If a
variable declaration includes an expression (</ins>
<code><ins class="diff-new">VarValue</ins></code> <ins class="diff-new">or</ins>
 <code><ins class="diff-new">VarDefaultValue</ins></code> <ins 
class="diff-new">),
the expression is called an</ins> <b><ins class="diff-new">initializing 
expression.</ins></b> <ins class="diff-new">The static context for an 
initializing expression
includes all functions, variables, and namespaces that are declared
or imported anywhere in the Prolog, other than the variable being
declared.]</ins></p>
<p><ins class="diff-new">[</ins> <a title="depends on a variable" 
id="dt-depends-on-variable" name="dt-depends-on-variable"><ins 
class="diff-new">Definition</ins></a>
:<ins class="diff-new">An expression</ins> <code><ins class="diff-new">E</ins></code>
 <b><ins class="diff-new">depends on a
variable</ins></b> <code><ins class="diff-new">V</ins></code>
<ins class="diff-new">if any of the following is true:</ins></p>
<table>
<tbody>
<tr>
<td>
<ul>
<li>
<p><code><ins class="diff-new">E</ins></code> <ins class="diff-new">is a
 variable reference bound to variable</ins>
<code><ins class="diff-new">V</ins></code></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <a title="depends on a 
variable" href="#dt-depends-on-variable"><ins class="diff-new">depends 
on a variable</ins></a> <ins class="diff-new">whose initializer depends 
on</ins> <code><ins class="diff-new">V</ins></code></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <a title="expression 
depends on" href="#dt-depends-on-context-item"><ins class="diff-new">depends
 on the
context item</ins></a> <ins class="diff-new">and the initializer of
the context item</ins> <a title="depends on a variable" 
href="#dt-depends-on-variable"><ins class="diff-new">depends
on</ins></a> <code><ins class="diff-new">V</ins></code></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <a title="depends on a 
function" href="#dt-depends-on-function"><ins class="diff-new">depends 
on a function</ins></a> <ins class="diff-new">whose body</ins> <a 
title="depends on a variable" href="#dt-depends-on-variable"><ins 
class="diff-new">depends
on</ins></a> <code><ins class="diff-new">V</ins></code></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <ins class="diff-new">contains
 (directly or indirectly) an expression
that</ins> <a title="depends on a variable" 
href="#dt-depends-on-variable"><ins class="diff-new">depends
on</ins></a> <code><ins class="diff-new">V</ins></code></p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><ins class="diff-new">]</ins></p>
<p><ins class="diff-new">If the initializer of a variable</ins>
<code><ins class="diff-new">V</ins></code> <a title="depends on a 
variable" href="#dt-depends-on-variable"><ins class="diff-new">depends 
on</ins></a> <code><ins class="diff-new">V</ins></code> ,<ins 
class="diff-new">a static error is
raised, a</ins> <a title="static error" href="#dt-static-error"><ins 
class="diff-new">static error</ins></a>
<ins class="diff-new">is raised [</ins> <a title="err:XQST0054" 
href="#ERRXQST0054"><ins class="diff-new">err:XQST0054</ins></a>
<ins class="diff-new">].</ins></p>
<p><ins class="diff-new">During query evaluation, each variable
declaration causes a pair</ins> <code><ins class="diff-new">(expanded 
QName N, value V)</ins></code> <ins class="diff-new">to be added to the</ins>
 <a title="Prolog" href="#dt-prolog"><ins class="diff-new">Prolog</ins></a>
 <a title="variable values" href="#dt-variable-values"><ins 
class="diff-new">variable values</ins></a> .<ins class="diff-new">The
expanded QName N is the</ins> <code><ins class="diff-new">VarName</ins></code>
 .<ins class="diff-new">The value V
is as follows:</ins></p>
<ul>
<li>
<p><ins class="diff-new">If</ins> <code><ins class="diff-new">VarValue</ins></code>
 <ins class="diff-new">is
specified, then V is the result of evaluating</ins>
<code><ins class="diff-new">VarValue</ins></code> <ins class="diff-new">as
 described below.</ins></p>
</li>
<li>
<p><ins class="diff-new">If</ins> <code><ins class="diff-new">external</ins></code>
 <ins class="diff-new">is
specified, then:</ins></p>
<ul>
<li>
<p><ins class="diff-new">if a value is provided for the variable by
the external environment, then V is that value. The means by which
typed values of external variables are provided by the external
environment is implementation-defined.</ins></p>
</li>
<li>
<p><ins class="diff-new">if no value is provided for the variable
by the external environment, and</ins> <code><ins class="diff-new">VarDefaultValue</ins></code>
 <ins class="diff-new">is
specified, then V is the result of evaluating</ins>
<code><ins class="diff-new">VarDefaultValue</ins></code>
<ins class="diff-new">as described below.</ins></p>
</li>
<li>
<p><ins class="diff-new">If no value is provided for the variable
by the external environment, and</ins> <code><ins class="diff-new">VarDefaultValue</ins></code>
 <ins class="diff-new">is
not specified, then a</ins> <a title="dynamic error" 
href="#dt-dynamic-error"><ins class="diff-new">dynamic error</ins></a>
<ins class="diff-new">is raised [</ins> <a title="err:XPDY0002" 
href="#ERRXPDY0002"><ins class="diff-new">err:XPDY0002</ins></a>
<ins class="diff-new">].</ins></p>
<p><ins class="diff-new">It is implementation-dependent whether
this error is raised if the evaluation of the query does not
reference the value of the variable.</ins></p>
</li>
</ul>
<p><ins class="diff-new">In all cases the value V must match the
type T according to the rules for SequenceType matching; otherwise
a</ins> <a title="type error" href="#dt-type-error"><ins 
class="diff-new">type error</ins></a> <ins class="diff-new">is raised
[</ins> <a title="err:XPTY0004" href="#ERRXPTY0004"><ins 
class="diff-new">err:XPTY0004</ins></a> <ins class="diff-new">].</ins></p>
<p><ins class="diff-new">If</ins> <code><ins class="diff-new">VarValue</ins></code>
 <ins class="diff-new">or</ins>
<code><ins class="diff-new">VarDefaultValue</ins></code>
<ins class="diff-new">is evaluated, the dynamic context for the
evaluation is as follows:</ins></p>
<ul>
<li>
<p><ins class="diff-new">The</ins> <a title="variable values" 
href="#dt-variable-values"><ins class="diff-new">variable
values</ins></a> <ins class="diff-new">contain the values of all
variables present in the static context.</ins></p>
<div class="note">
<p class="prefix"><b><ins class="diff-new">Note:</ins></b></p>
<p><ins class="diff-new">A cyclic dependency between variables is a
static error, so it is always possible to evaluate all the
variables that V depends on before evaluating V.)</ins></p>
</div>
</li>
<li>
<p><ins class="diff-new">The function implementations contains the
implementation of each function present in the static
context</ins></p>
</li>
<li>
<p><ins class="diff-new">All other properties of the dynamic
context, including the context item, position, and size, are the
same as for the evaluation of the</ins> <code><ins class="diff-new">QueryBody</ins></code>
 <ins class="diff-new">of the main
module.</ins></p>
</li>
</ul>
</li>
</ul>
</div>
<div class="div2">
<h3><a id="id-context-item-declarations" 
name="id-context-item-declarations"></a><ins class="diff-new">4.17
Context Item Declaration</ins></h3>
<h5><a id="N17495" name="N17495"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="noid_N17278.doc-xquery11-ContextItemDecl" 
name="noid_N17278.doc-xquery11-ContextItemDecl"></a><ins 
class="diff-new">[31]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">ContextItemDecl</ins></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"declare" "context" "item"
("as"</ins> <a href="#doc-xquery11-ItemType"><ins class="diff-new">ItemType</ins></a>
 <ins class="diff-new">)? ((":="</ins>
<a href="#doc-xquery11-VarValue"><ins class="diff-new">VarValue</ins></a>
 <ins class="diff-new">) | ("external"
(":="</ins> <a href="#doc-xquery11-VarDefaultValue"><ins 
class="diff-new">VarDefaultValue</ins></a> <ins class="diff-new">)?))</ins></code></td>
</tr>
</tbody>
</table>
<p><ins class="diff-new">A context item declaration allows a query
to specify the</ins> <a title="static type" href="#dt-static-type"><ins 
class="diff-new">static type</ins></a>
,<ins class="diff-new">value, or default value for the initial
context item.</ins></p>
<p><ins class="diff-new">In a library module, a context item
declaration specifies only the static type. Specifying a</ins>
<a href="#doc-xquery11-VarValue"><ins class="diff-new">VarValue</ins></a>
 <ins class="diff-new">or</ins>
<a href="#doc-xquery11-VarDefaultValue"><ins class="diff-new">VarDefaultValue</ins></a>
 <ins class="diff-new">for a
context item declaration in a library module is a static error
[</ins> <a title="err:XQST0113" href="#ERRXQST0113"><ins 
class="diff-new">err:XQST0113</ins></a> <ins class="diff-new">].</ins></p>
<p><ins class="diff-new">In every module that does not contain a
context item declaration, the effect is as if the
declaration</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
declare context item as item() external;
</ins>
</pre></div>
<p><ins class="diff-new">appeared in that module.</ins></p>
<p><ins class="diff-new">During static analysis, the context item
declaration has the effect of setting the context item static type
in the static context. The context item static type is set to</ins>
<code><ins class="diff-new">ItemType</ins></code> <ins class="diff-new">if
 specified, or to</ins> <code><ins class="diff-new">item()</ins></code> <ins
 class="diff-new">otherwise.</ins></p>
<p><ins class="diff-new">If a module contains more than one context
item declaration, a static error is raised [</ins> <a 
title="err:XQST0099" href="#ERRXQST0099"><ins class="diff-new">err:XQST0099</ins></a>
 <ins class="diff-new">].</ins></p>
<p><ins class="diff-new">The static context for an initializing
expression includes all functions, variables, and namespaces that
are declared or imported anywhere in the Prolog.</ins></p>
<p><ins class="diff-new">[</ins> <a title="expression depends on" 
id="dt-depends-on-context-item" name="dt-depends-on-context-item"><ins 
class="diff-new">Definition</ins></a> :<ins class="diff-new">An
expression</ins> <code><ins class="diff-new">E</ins></code>
<b><ins class="diff-new">depends on the context item</ins></b>
<ins class="diff-new">if any of the following is true:</ins></p>
<table>
<tbody>
<tr>
<td>
<ul>
<li>
<p><code><ins class="diff-new">E</ins></code> <ins class="diff-new">is 
"."</ins></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <ins class="diff-new">is 
"/", or any path expression beginning with "/" or
"//"</ins></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <ins class="diff-new">is</ins>
 <code><ins class="diff-new">position()</ins></code> <ins 
class="diff-new">or</ins>
<code><ins class="diff-new">last()</ins></code></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <ins class="diff-new">is 
an axis step (including an abbreviated axis step such
as '..' or '@x')</ins></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <ins class="diff-new">is a
 call to a built-in function that takes the context
item as an implicit argument</ins></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <ins class="diff-new">has a
 subexpression that depends on the context item,
and</ins> <code><ins class="diff-new">E</ins></code> <ins 
class="diff-new">does not bind the context item for that
subexpression</ins></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <a title="depends on a 
variable" href="#dt-depends-on-variable"><ins class="diff-new">depends 
on</ins></a> <ins class="diff-new">a variable
whose initializer</ins> <a title="expression depends on" 
href="#dt-depends-on-context-item"><ins class="diff-new">depends
on</ins></a> <ins class="diff-new">the context item</ins></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <a title="depends on a 
function" href="#dt-depends-on-function"><ins class="diff-new">depends 
on</ins></a> <ins class="diff-new">a function
whose body</ins> <a title="expression depends on" 
href="#dt-depends-on-context-item"><ins class="diff-new">depends
on</ins></a> <ins class="diff-new">the context item</ins></p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><ins class="diff-new">]</ins></p>
<p><ins class="diff-new">If the initializer of the context
item</ins> <a title="expression depends on" 
href="#dt-depends-on-context-item"><ins class="diff-new">depends
on</ins></a> <ins class="diff-new">the context item, a static error
is raised [</ins> <a title="err:XQST0107" href="#ERRXQST0107"><ins 
class="diff-new">err:XQST0107</ins></a>
<ins class="diff-new">].</ins></p>
<p><ins class="diff-new">During query evaluation, the context item
in the dynamic context for the evaluation of the</ins>
<code><ins class="diff-new">QueryBody</ins></code> <ins class="diff-new">in
 the main module, and for the initializing expression
of every variable declaration in every module, is set as
follows:</ins></p>
<ul>
<li>
<p><ins class="diff-new">If</ins> <code><ins class="diff-new">VarValue</ins></code>
 <ins class="diff-new">is
specified, then the result of evaluating</ins> <code><ins 
class="diff-new">VarValue</ins></code> <ins class="diff-new">as 
described
below.</ins></p>
</li>
<li>
<p><ins class="diff-new">If</ins> <code><ins class="diff-new">external</ins></code>
 <ins class="diff-new">is
specified, then:</ins></p>
<ul>
<li>
<p><ins class="diff-new">if a value is provided for the context
item by the external environment, then that value.</ins></p>
<p><ins class="diff-new">The means by which an external value is
provided by the external environment is
implementation-defined.</ins></p>
</li>
<li>
<p><ins class="diff-new">if no value is provided for the context
item by the external environment, and</ins> <code><ins class="diff-new">VarDefaultValue</ins></code>
 <ins class="diff-new">is
specified, then the result of evaluating</ins> <code><ins 
class="diff-new">VarDefaultValue</ins></code> <ins class="diff-new">as
described below.</ins></p>
</li>
<li>
<p><ins class="diff-new">if no value is provided for the context
item by the external environment, and</ins> <code><ins class="diff-new">VarDefaultValue</ins></code>
 <ins class="diff-new">is
not specified, then the context item is</ins> <a title="undefined" 
href="#dt-undefined"><ins class="diff-new">undefined</ins></a>
,<ins class="diff-new">and a dynamic error is raised [</ins>
<a title="err:XPDY0002" href="#ERRXPDY0002"><ins class="diff-new">err:XPDY0002</ins></a>
 <ins class="diff-new">] if the
context item is referenced in the query.</ins></p>
</li>
</ul>
</li>
</ul>
<p><ins class="diff-new">In all cases where the context item has a
value, that value must match the type</ins> <code><ins class="diff-new">T</ins></code>
 <ins class="diff-new">according to the
rules for SequenceType matching; otherwise a type error is raised
[</ins> <a title="err:XPTY0004" href="#ERRXPTY0004"><ins 
class="diff-new">err:XPTY0004</ins></a> <ins class="diff-new">]. If more
than one module contains a context item declaration, the context
item must match the type declared in each one.</ins></p>
<p><ins class="diff-new">If</ins> <code><ins class="diff-new">VarValue</ins></code>
 <ins class="diff-new">or</ins>
<code><ins class="diff-new">VarDefaultValue</ins></code>
<ins class="diff-new">is evaluated, the dynamic context for the
evaluation is as follows:</ins></p>
<ul>
<li>
<p><ins class="diff-new">The variable values contains the values of
all variables present in the static context</ins></p>
</li>
<li>
<p><ins class="diff-new">The context item, position, and size
are</ins> <a title="undefined" href="#dt-undefined"><ins 
class="diff-new">undefined</ins></a></p>
</li>
<li>
<p><ins class="diff-new">Function implementations includes an
implementation of each function present in the static context of
the expression</ins></p>
</li>
<li>
<p><ins class="diff-new">All other properties of the dynamic
context are the same as for the evaluation of the</ins>
<code><ins class="diff-new">QueryBody</ins></code> <ins class="diff-new">of
 the main module.</ins></p>
</li>
</ul>
<p><ins class="diff-new">Here are some examples of context item
declarations.</ins></p>
<ul>
<li>
<p><ins class="diff-new">Declare the type of the context
item:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
declare namespace env="http://www.w3.org/2003/05/soap-envelope";
declare context item as element(env:Envelope) external;
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-new">Declare a default context item, which is a
system log in a default location. If the system log is in a
different location, it can be specified in the external
environment:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
declare context item as element(sys:log) external := doc("/var/xlogs/sysevent.xml");
</ins>
</pre></div>
</li>
<li>
<p><ins class="diff-new">Declare the context item to always point
to a particular collection:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
declare context item := collection("docs");
</ins>
</pre></div>
</li>
</ul>
</div>
<div class="div2">
<h3><a id="FunctionDeclns" name="FunctionDeclns"></a> <del 
class="diff-old">4.15</del> <ins class="diff-chg">4.18</ins> Function
Declaration</h3>
<p>In addition to the built-in functions described in <a 
href="#xpath-functions-11">[XQuery <del class="diff-old">1.0</del> and
XPath <del class="diff-old">2.0</del> Functions and <del 
class="diff-old">Operators]</del> <ins class="diff-chg">Operators
1.1]</ins></a> , XQuery allows users to declare functions of their
own. A function declaration specifies the name of the function, the
names and datatypes of the parameters, and the datatype of the
result. All datatypes are specified using the syntax described in
<a href="#id-types"><b>2.5 Types</b></a> . A function declaration
causes the declared function to be added to the <a title="function 
signature" href="#dt-function-signature">function
signatures</a> of the <a title="module" href="#dt-module">module</a> in 
which it appears.</p>
<h5><a id="N175CF" name="N175CF"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="noid_N17401.doc-xquery11-AnnotatedDecl" 
name="noid_N17401.doc-xquery11-AnnotatedDecl"></a>
[26]&nbsp;&nbsp;&nbsp;</td>
<td><code><ins class="diff-new">AnnotatedDecl</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"declare"</ins> <a 
href="#doc-xquery11-Annotation"><ins class="diff-chg">Annotation</ins></a>
 <ins class="diff-chg">* (</ins>
<a href="#doc-xquery11-VarDecl"><ins class="diff-chg">VarDecl</ins></a> <ins
 class="diff-chg">|</ins> <a href="#doc-xquery11-FunctionDecl"><ins 
class="diff-chg">FunctionDecl</ins></a> <ins class="diff-chg">)</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N17404.doc-xquery11-Annotation" 
name="noid_N17404.doc-xquery11-Annotation"></a><ins class="diff-chg">[27]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">Annotation</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"%"</ins> <a href="#doc-xquery11-EQName"><ins
 class="diff-chg">EQName</ins></a>
<ins class="diff-chg">("("</ins> <a href="#doc-xquery11-Literal"><ins 
class="diff-chg">Literal</ins></a>
<ins class="diff-chg">(","</ins> <a href="#doc-xquery11-Literal"><ins 
class="diff-chg">Literal</ins></a>
<ins class="diff-chg">)* ")")?</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-FunctionDecl" name="doc-xquery11-FunctionDecl"></a><ins
 class="diff-chg">[32]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-FunctionDecl">FunctionDecl</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">"declare"</del> "function"
<del class="diff-old">QName</del> <a href="#doc-xquery11-EQName"><ins 
class="diff-chg">EQName</ins></a> "("
<a href="#doc-xquery11-ParamList">ParamList</a> ? ")" ("as"
<a href="#doc-xquery11-SequenceType">SequenceType</a> )? (
<del class="diff-old">EnclosedExpr</del> <a 
href="#doc-xquery11-FunctionBody"><ins class="diff-chg">FunctionBody</ins></a>
 | "external")</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-ParamList" name="doc-xquery11-ParamList"></a> <del
 class="diff-old">[27]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[33]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ParamList">ParamList</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-Param">Param</a> ("," <a 
href="#doc-xquery11-Param">Param</a> )*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-Param" name="doc-xquery11-Param"></a>
<del class="diff-old">[28]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[34]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-Param">Param</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"$" <del class="diff-old">QName</del> <a 
href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a>
<a href="#doc-xquery11-TypeDeclaration">TypeDeclaration</a>
?</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-FunctionBody" name="doc-xquery11-FunctionBody"></a>
 <del class="diff-old">[118]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[35]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">TypeDeclaration</del> <a 
href="#prod-xquery11-FunctionBody"><ins class="diff-chg">FunctionBody</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-EnclosedExpr"><ins class="diff-new">EnclosedExpr</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="noid_N17417.doc-xquery11-TypeDeclaration" 
name="noid_N17417.doc-xquery11-TypeDeclaration"></a><ins 
class="diff-new">[168]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">TypeDeclaration</ins></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code>"as" <a href="#doc-xquery11-SequenceType">SequenceType</a></code></td>
</tr>
</tbody>
</table>
<p>A function declaration specifies whether a function is <a 
title="user-defined function" href="#dt-udf">user-defined</a> or
<a title="external function" href="#dt-external-function">external</a> .</p>
<p>[ <a title="user-defined function" id="dt-udf" name="dt-udf">Definition</a>
 : <del class="diff-old">For a</del>
<b><del class="diff-old">user-defined function , the function
declaration includes an expression called the</del> <ins 
class="diff-chg">User defined functions</ins></b> <ins class="diff-chg">are
 functions that contain a</ins> <b>function body
<del class="diff-old">that defines how</del></b> , <ins class="diff-chg">which
 provides</ins> the <del class="diff-old">result</del> <ins 
class="diff-chg">implementation</ins>
of the function <del class="diff-old">is computed from its
parameters.].</del> <ins class="diff-chg">as an XQuery
expression.]</ins> The <a title="static context" 
href="#dt-static-context">static context</a> for a function body
includes all <del class="diff-old">functions that are declared or
imported anywhere in the Prolog , but it includes only those
variables</del> <ins class="diff-chg">functions, variables,</ins>
and namespaces that are declared or imported <del class="diff-old">earlier</del>
 <ins class="diff-chg">anywhere</ins> in
the <a title="Prolog" href="#dt-prolog">Prolog <del class="diff-old">than</del></a>
 , <ins class="diff-chg">including</ins>
the function <del class="diff-old">that is</del> being <del 
class="diff-old">defined.</del> <ins class="diff-chg">declared.</ins></p>
<p>[ <a title="external function" id="dt-external-function" 
name="dt-external-function">Definition</a> : <b>External functions</b>
are functions that are implemented outside the query environment.]
For example, an XQuery implementation might provide a set of
external functions in addition to the core function library
described in <a href="#xpath-functions-11">[XQuery <del class="diff-old">1.0</del>
 and XPath <del class="diff-old">2.0</del>
Functions and <del class="diff-old">Operators]</del> <ins 
class="diff-chg">Operators 1.1]</ins></a> . External functions are
identified by the keyword <code>external</code> . The purpose of a
function declaration for an external function is to declare the
datatypes of the function parameters and result, for use in type
checking of the query that contains or imports the function
declaration.</p>
<p><ins class="diff-new">A function declaration may use function
annotations to specify that a function is</ins> <code><ins 
class="diff-new">%private</ins></code> <ins class="diff-new">or</ins>
<code><ins class="diff-new">%public</ins></code> <ins class="diff-new">(which
 is the default). [</ins> <a title="private function" 
id="dt-private-function" name="dt-private-function"><ins 
class="diff-new">Definition</ins></a>
:<ins class="diff-new">A</ins> <b><ins class="diff-new">private
function</ins></b> <ins class="diff-new">is hidden from</ins>
<a title="module import" href="#dt-module-import"><ins class="diff-new">module
 import</ins></a> ,<ins class="diff-new">which can
not import it into the</ins> <a title="function signature" 
href="#dt-function-signature"><ins class="diff-new">function
signatures</ins></a> <ins class="diff-new">of another module. ]
[</ins> <a title="public function" id="dt-public-function" 
name="dt-public-function"><ins class="diff-new">Definition</ins></a>
:<ins class="diff-new">A</ins> <b><ins class="diff-new">public
function</ins></b> <ins class="diff-new">is accessible to</ins>
<a title="module import" href="#dt-module-import"><ins class="diff-new">module
 import</ins></a> ,<ins class="diff-new">which can
import it into the</ins> <a title="function signature" 
href="#dt-function-signature"><ins class="diff-new">function
signatures</ins></a> <ins class="diff-new">of another module. ] It
is a</ins> <a title="static error" href="#dt-static-error"><ins 
class="diff-new">static error</ins></a>
<ins class="diff-new">[</ins> <a title="err:XQST0106" 
href="#ERRXQST0106"><ins class="diff-new">err:XQST0106</ins></a>
<ins class="diff-new">] if a function's annotations contain more
than one annotation named</ins> <code><ins class="diff-new">%private</ins></code>
 <ins class="diff-new">or</ins>
<code><ins class="diff-new">%public</ins></code> .</p>
<p><ins class="diff-new">A function declaration may use function
annotations to specify that an external function is</ins>
<code><ins class="diff-new">%deterministic</ins></code> <ins 
class="diff-new">(which is the default) or</ins> <code><ins 
class="diff-new">%nondeterministic</ins></code> .<ins class="diff-new">[</ins>
 <a title="deterministic function" id="dt-deterministic-function" 
name="dt-deterministic-function"><ins class="diff-new">Definition</ins></a>
 :<ins class="diff-new">A</ins>
<b><ins class="diff-new">deterministic function</ins></b>
<ins class="diff-new">is a function that always evaluates to the
same result if it is invoked with the same arguments.] [</ins>
<a title="nondeterministic function" id="dt-nondeterministic-function" 
name="dt-nondeterministic-function"><ins class="diff-new">Definition</ins></a>
 :<ins class="diff-new">A</ins>
<b><ins class="diff-new">nondeterministic function</ins></b>
<ins class="diff-new">is a function that is not guaranteed to
always return the same result when it is invoked with the same
arguments.]. It is a</ins> <a title="static error" 
href="#dt-static-error"><ins class="diff-new">static error</ins></a>
<ins class="diff-new">[</ins> <a title="err:XQST0106" 
href="#ERRXQST0106"><ins class="diff-new">err:XQST0106</ins></a>
<ins class="diff-new">] if a function's annotations contain more
than one annotation named</ins> <code><ins class="diff-new">%deterministic</ins></code>
 <ins class="diff-new">or</ins> <code><ins class="diff-new">%nondeterministic</ins></code>
 .<ins class="diff-new">An
XQuery processor can use static analysis to determine whether a
user-defined function is deterministic (the syntax of function
declarations does not allow a user-defined function to be declared
deterministic or nondeterministic).</ins></p>
<p><ins class="diff-new">When rewriting expressions into equivalent
expressions, as described in</ins> <a href="#id-errors-and-opt"><b><ins 
class="diff-new">2.3.4 Errors and
Optimization</ins></b></a> ,<ins class="diff-new">a conforming
XQuery implementation must ensure that each run-time invocation of
a nondeterministic function in the original expression results in
exactly one run-time invocation of the function in the rewritten
expression. For instance, suppose the</ins> <code><ins class="diff-new">random()</ins></code>
 <ins class="diff-new">function is
declared to be nondeterministic:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
declare %nondeterministic function my:random( ) as xs:integer external;
</ins>
</pre></div>
<p><ins class="diff-new">Given the above declaration, this
expression:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
let $r := my:random( )
return
   if ($r &gt; 0 and $r &lt; 10) then "Yes" else "No"
</ins>
</pre></div>
<p><ins class="diff-new">must not be rewritten as</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
if (my:random( ) &gt; 0 and my:random( ) &lt; 10) then "Yes" else "No"
</ins>
</pre></div>
<p><ins class="diff-new">Similarly, this expression:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
for $i in 1 to 10
return my:random( )
</ins>
</pre></div>
<p><ins class="diff-new">must not be rewritten as</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
let $r := my:random( )
return
     for $i in 1 to 10
     return $r
</ins>
</pre></div>
<p>An XQuery implementation may provide a facility whereby external
functions can be implemented using a host programming language, but
it is not required to do so. If such a facility is provided, the
protocols by which parameters are passed to an external function,
and the result of the function is returned to the invoking query,
are <a title="implementation defined" href="#dt-implementation-defined">implementation-defined</a>
 . An XQuery
implementation may augment the type system of <del class="diff-old">[XQuery/XPath</del>
 <a href="#xpath-datamodel-11"><ins class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> with additional types that are
designed to facilitate exchange of data with host programming
languages, or it may provide mechanisms for the user to define such
types. For example, a type might be provided that encapsulates an
object returned by an external function, such as an SQL database
connection. These additional types, if defined, are considered to
be derived by restriction from <code>xs:anyAtomicType</code> .</p>
<p><ins class="diff-new">An implementation can define annotations,
in its own namespace, to support functionality beyond the scope of
this specification. For instance, an implementation that supports
external Java functions might use an annotation to associate a Java
function with an XQuery external function:</ins></p>
<div class="exampleInner">
<pre><ins class="diff-new">
declare %java:method("java.lang.Math.sin") function math:sin($a) external;
</ins>
</pre></div>
<p>Every user-defined function must be in a namespace--that is,
every declared function name must (when expanded) have a non-null
namespace URI [ <a title="err:XQST0060" href="#ERRXQST0060">err:XQST0060</a>
 ]. If the function name in a
function declaration has no namespace prefix, it is considered to
be in the <a title="default function namespace" href="#dt-def-fn-ns">default
 function namespace</a> . Every function
name declared in a <a title="library module" href="#dt-library-module">library
 module</a> must (when expanded) be in
the <a title="target namespace" href="#dt-target-namespace">target
namespace</a> of the library module [ <a title="err:XQST0048" 
href="#ERRXQST0048">err:XQST0048</a> ]. It is a <a title="static error" 
href="#dt-static-error">static error</a> [ <a title="err:XQST0045" 
href="#ERRXQST0045">err:XQST0045</a> ] if the function name in a
function declaration (when expanded) is in any of the following
namespaces:</p>
<ul>
<li>
<p><code>http://www.w3.org/XML/1998/namespace</code></p>
</li>
<li>
<p><code>http://www.w3.org/2001/XMLSchema</code></p>
</li>
<li>
<p><code>http://www.w3.org/2001/XMLSchema-instance</code></p>
</li>
<li>
<p><code>http://www.w3.org/2005/xpath-functions</code></p>
</li>
</ul>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> [ <a title="err:XQST0034" href="#ERRXQST0034">err:XQST0034</a>
 ] if the <a title="expanded QName" href="#dt-expanded-qname">expanded 
QName</a> and arity (number of
arguments) of the declared function are equal (as defined by the
<code>eq</code> operator) to the <a title="expanded QName" 
href="#dt-expanded-qname">expanded QName</a> and arity of another
function in <a title="function signature" href="#dt-function-signature">function
 signatures</a> .</p>
<p>In order to allow main modules to declare functions for local
use within the module without defining a new namespace, XQuery
predefines the namespace prefix <code>local</code> to the namespace
<code>http://www.w3.org/2005/xquery-local-functions</code> . It is
suggested (but not required) that this namespace be used for
defining local functions.</p>
<p>If a function parameter is declared using a name but no type,
its default type is <code>item()*</code> . If the result type is
omitted from a function declaration, its default result type is
<code>item()*</code> .</p>
<p>The parameters of a function declaration are considered to be
variables whose scope is the function body. It is an <a title="static 
error" href="#dt-static-error">static error</a> [ <a 
title="err:XQST0039" href="#ERRXQST0039">err:XQST0039</a> ] for a
function declaration to have more than one parameter with the same
name. The type of a function parameter can be any type that can be
expressed as a <a title="sequence type" href="#dt-sequence-type">sequence
 type</a> .</p>
<p>The following example illustrates the declaration and use of a
local function that accepts a sequence of <code>employee</code>
elements, summarizes them by department, and returns a sequence of
<code>dept</code> elements.</p>
<ul>
<li>
<p>Using a function, prepare a summary of employees that are
located in Denver.</p>
<div class="exampleInner">
<pre>declare function local:summary($emps as element(employee)*) 
   as element(dept)*
{
   for $d in fn:distinct-values($emps/deptno)
   let $e := $emps[deptno = $d]
   return
      &lt;dept&gt;
         &lt;deptno&gt;{$d}&lt;/deptno&gt;
         &lt;headcount&gt; {fn:count($e)} &lt;/headcount&gt;
         &lt;payroll&gt; {fn:sum($e/salary)} &lt;/payroll&gt;
      &lt;/dept&gt;
};
local:summary(fn:doc("acme_corp.xml")//employee[location = "Denver"])
</pre></div>
</li>
</ul>
<p>Rules for converting function arguments to their declared
parameter types, and for converting the result of a function to its
declared result type, are described in <a href="#id-function-calls"><b>3.1.5
 Function Calls</b></a> .</p>
<p>A function declaration may be recursive—that is, it may
reference itself. Mutually recursive functions, whose bodies
reference each other, are also allowed. The following example
declares a recursive function that computes the maximum depth of a
node hierarchy, and calls the function to find the maximum depth of
a particular document. In its declaration, the user-declared
function <code>local:depth</code> calls the built-in functions
<code>empty</code> and <code>max</code> , which are in the default
function namespace.</p>
<ul>
<li>
<p>Find the maximum depth of the document named
<code>partlist.xml</code> .</p>
<div class="exampleInner">
<pre>declare function local:depth($e as node()) as xs:integer
{
   (: A node with no children has depth 1 :)
   (: Otherwise, add 1 to max depth of children :)
   if (fn:empty($e/*)) then 1
   else fn:max(for $c in $e/* return local:depth($c)) + 1
};
local:depth(fn:doc("partlist.xml"))
</pre></div>
</li>
</ul>
<p>Since a <a title="constructor function" 
href="#dt-constructor-function">constructor function</a> is effectively
declared for every user-defined atomic type in the <a title="in-scope 
schema type" href="#dt-is-types">in-scope schema
types</a> , a <a title="static error" href="#dt-static-error">static 
error</a> [ <a title="err:XQST0034" href="#ERRXQST0034">err:XQST0034</a>
 ] is raised if the Prolog attempts
to declare a single-parameter function with the same <a title="expanded 
QName" href="#dt-expanded-qname">expanded QName</a> as
any of these types.</p>
<p><ins class="diff-new">[</ins> <a title="depends on a function" 
id="dt-depends-on-function" name="dt-depends-on-function"><ins 
class="diff-new">Definition</ins></a>
:<ins class="diff-new">An expression</ins> <code><ins class="diff-new">E</ins></code>
 <b><ins class="diff-new">depends on a
function</ins></b> <ins class="diff-new">if any of the following is
true:</ins></p>
<table>
<tbody>
<tr>
<td>
<ul>
<li>
<p><code><ins class="diff-new">E</ins></code> <ins class="diff-new">is a
 call on function</ins> <code><ins class="diff-new">F</ins></code></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <a title="depends on a 
function" href="#dt-depends-on-function"><ins class="diff-new">depends 
on a function</ins></a> <ins class="diff-new">whose body</ins> <a 
title="depends on a function" href="#dt-depends-on-function"><ins 
class="diff-new">depends
on</ins></a> <code><ins class="diff-new">F</ins></code> .</p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <a title="expression 
depends on" href="#dt-depends-on-context-item"><ins class="diff-new">depends
 on the
context item</ins></a> <ins class="diff-new">and the initializer of
the context item</ins> <a title="depends on a function" 
href="#dt-depends-on-function"><ins class="diff-new">depends
on</ins></a> <code><ins class="diff-new">F</ins></code></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <a title="depends on a 
variable" href="#dt-depends-on-variable"><ins class="diff-new">depends 
on a variable</ins></a> <ins class="diff-new">whose initializer</ins> <a
 title="depends on a function" href="#dt-depends-on-function"><ins 
class="diff-new">depends
on</ins></a> <code><ins class="diff-new">F</ins></code></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <ins class="diff-new">contains
 (directly or indirectly) an expression
that</ins> <a title="depends on a function" 
href="#dt-depends-on-function"><ins class="diff-new">depends
on</ins></a> <code><ins class="diff-new">F</ins></code></p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><ins class="diff-new">]</ins></p>
</div>
<div class="div2">
<h3><a id="id-option-declaration" name="id-option-declaration"></a>
<del class="diff-old">4.16</del> <ins class="diff-chg">4.19</ins>
Option Declaration</h3>
<p>[ <a title="option declaration" id="dt-option-declaration" 
name="dt-option-declaration">Definition</a> : An <b>option
declaration</b> declares an option that affects the behavior of a
particular implementation. Each option consists of an identifying
<del class="diff-old">QName</del> <ins class="diff-chg">EQName</ins> and
 a StringLiteral.]</p>
<h5><a id="N17845" name="N17845"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="doc-xquery11-OptionDecl" name="doc-xquery11-OptionDecl"></a> <del
 class="diff-old">[13]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[37]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-OptionDecl">OptionDecl</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"declare" "option" <del class="diff-old">QName</del>
<a href="#doc-xquery11-EQName"><ins class="diff-chg">EQName</ins></a> <a
 href="#doc-xquery11-StringLiteral">StringLiteral</a></code></td>
</tr>
</tbody>
</table>
<p>Typically, a particular option will be recognized by some
implementations and not by others. The syntax is designed so that
option declarations can be successfully parsed by all
implementations.</p>
<p><del class="diff-old">The QName</del> <ins class="diff-chg">If
the EQName</ins> of an option <ins class="diff-new">is a</ins>
<a title="lexical QName" href="#dt-qname"><ins class="diff-new">lexical 
QName</ins></a> ,<ins class="diff-new">it</ins>
must resolve to a namespace URI and local name, using the <a 
title="statically known namespaces" href="#dt-static-namespaces">statically
 known namespaces</a> [ <a title="err:XPST0081" href="#ERRXPST0081">err:XPST0081</a>
 ].</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>There is no default namespace for options.</p>
</div>
<p>Each implementation recognizes an <a title="implementation defined" 
href="#dt-implementation-defined">implementation-defined</a> set of
namespace URIs used to denote option declarations.</p>
<p>If the namespace part of the <ins class="diff-new">expanded</ins> 
QName is not a namespace recognized by
the implementation as one used to denote option declarations, then
the option declaration is ignored.</p>
<p>Otherwise, the effect of the option declaration, including its
error behavior, is <a title="implementation defined" 
href="#dt-implementation-defined">implementation-defined</a> . For
example, if the local part of the QName is not recognized, or if
the StringLiteral does not conform to the rules defined by the
implementation for the particular option declaration, the
implementation may choose whether to report an error, ignore the
option declaration, or take some other action.</p>
<p>Implementations may impose rules on where particular option
declarations may appear relative to variable declarations and
function declarations, and the interpretation of an option
declaration may depend on its position.</p>
<p>An option declaration must not be used to change the syntax
accepted by the processor, or to suppress the detection of
<a title="static error" href="#dt-static-error">static <del 
class="diff-old">errors.</del> <ins class="diff-chg">errors</ins></a> .
However, it may be used without restriction to modify the semantics
of the query. The scope of the option declaration is <a 
title="implementation defined" href="#dt-implementation-defined">implementation-defined</a>
 —for
example, an option declaration might apply to the whole query, to
the current module, or to the immediately following function
declaration.</p>
<p>The following examples illustrate several possible uses for
option declarations:</p>
<ul>
<li>
<p>This option declaration might be used to <del class="diff-old">set a 
serialization parameter: declare namespace exq =
"http://example.org/XQueryImplementation"; declare option
exq:output "encoding = iso-8859-1"; This option declaration might
be used to</del> specify how comments in source documents returned
by the <code>fn:doc()</code> function should be handled:</p>
<div class="exampleInner">
<pre>declare option exq:strip-comments "true";
</pre></div>
</li>
<li>
<p>This option declaration might be used to associate a namespace
used in function names with a Java class:</p>
<div class="exampleInner">
<pre>declare namespace math = "http://example.org/MathLibrary";
declare option exq:java-class "math = java.lang.Math";
</pre></div>
</li>
</ul>
</div>
</div>
<div class="div1">
<h2><a id="id-xquery-conformance" name="id-xquery-conformance"></a>
5 Conformance</h2>
<div class="note">
<p class="prefix"><b><ins class="diff-new">Note:</ins></b></p>
<p><ins class="diff-new">The XQuery Working Group has not yet
determined conformance criteria for XQuery 1.1; in particular, we
have not decided which of the new features of XQuery 1.1 are
optional. This section currently contains the conformance criteria
for XQuery 1.0, with two modifications: (1) support for all axes is
now required, (2) conformance criteria for syntax extensions are
given.</ins></p>
</div>
<p>This section defines the conformance criteria for an XQuery
processor. In this section, the following terms are used to
indicate the requirement levels defined in <a href="#RFC2119">[RFC
2119]</a> . [ <a title="must" id="must" name="must">Definition</a>
: <b>MUST</b> means that the item is an absolute requirement of the
specification.] [ <a title="may" id="may" name="may">Definition</a>
: <b>MAY</b> means that an item is truly optional.] [ <a title="should" 
id="should" name="should">Definition</a> : <b>SHOULD</b>
means that there may exist valid reasons in particular
circumstances to ignore a particular item, but the full
implications must be understood and carefully weighed before
choosing a different course.]</p>
<p>An XQuery processor that claims to conform to this specification
<a title="must" href="#must">MUST</a> include a claim of Minimal
Conformance as defined in <a href="#id-minimal-conformance"><b>5.1
Minimal Conformance</b></a> . In addition to a claim of Minimal
Conformance, it <a title="may" href="#may">MAY</a> claim
conformance to one or more optional features defined in <a 
href="#id-conform-optional-features"><b>5.2 Optional Features</b></a>
.</p>
<div class="div2">
<h3><a id="id-minimal-conformance" name="id-minimal-conformance"></a> 
5.1 Minimal Conformance</h3>
<p>Minimal Conformance to this specification <a title="must" 
href="#must">MUST</a> include all of the following items:</p>
<ol class="enumar">
<li>
<p>Support for everything specified in this document except those
features specified in <a href="#id-conform-optional-features"><b>5.2 
Optional Features</b></a> to
be optional. If an implementation does not provide a given optional
feature, it <a title="must" href="#must">MUST</a> implement any
requirements specified in <a href="#id-conform-optional-features"><b>5.2
 Optional Features</b></a>
for implementations that do not provide that feature.</p>
</li>
<li>
<p>A definition of every item specified to be <a title="implementation 
defined" href="#dt-implementation-defined">implementation-defined</a> , 
unless
that item is part of an optional feature that is not supported by
the implementation. A list of <a title="implementation defined" 
href="#dt-implementation-defined">implementation-defined</a> items
can be found in <a href="#id-impl-defined-items"><b>D
Implementation-Defined Items</b></a> .</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>Implementations are not required to define items specified to be
<a title="implementation dependent" href="#dt-implementation-dependent">implementation-dependent</a>
 .</p>
</div>
</li>
<li>
<p>Support for <del class="diff-old">[XQuery/XPath</del> <a 
href="#xpath-datamodel-11"><ins class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> , as specified in <a href="#id-data-model-conformance"><b>5.3
 Data Model Conformance</b></a>
.</p>
</li>
<li>
<p>Support for all functions defined in <a href="#xpath-functions-11">[XQuery
 <del class="diff-old">1.0</del> and
XPath <del class="diff-old">2.0</del> Functions and <del 
class="diff-old">Operators]</del> <ins class="diff-chg">Operators
1.1]</ins></a> .</p>
</li>
</ol>
</div>
<div class="div2">
<h3><a id="id-conform-optional-features" 
name="id-conform-optional-features"></a> 5.2 Optional Features</h3>
<div class="div3">
<h4><a id="id-schema-import-feature" name="id-schema-import-feature"></a>
 5.2.1 Schema Import Feature</h4>
<p>[ <a title="schema import feature" id="dt-schema-import-feature" 
name="dt-schema-import-feature">Definition</a> : The <b>Schema
Import Feature</b> permits the query Prolog to contain a <a 
title="schema import" href="#dt-schema-import">schema import</a> .]</p>
<p>If an XQuery implementation does not support the Schema Import
Feature, it <a title="must" href="#must">MUST</a> raise a static
error [ <a title="err:XQST0009" href="#ERRXQST0009">err:XQST0009</a> ] 
if it encounters a schema
import.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>If an implementation does not support the Schema Import Feature,
the <a title="in-scope schema type" href="#dt-is-types">in-scope
schema types</a> consist only of built-in and <a title="implementation 
defined" href="#dt-implementation-defined">implementation-defined</a> 
schema type
definitions, as described in <a href="#id-xq-static-context-components"><b>C.1
 Static Context
Components</b></a> .</p>
</div>
</div>
<div class="div3">
<h4><a id="id-schema-validation-feature" 
name="id-schema-validation-feature"></a> 5.2.2 Schema Validation
Feature</h4>
<p>[ <a title="schema validation feature" 
id="dt-schema-validation-feature" name="dt-schema-validation-feature">Definition</a>
 : The <b>Schema
Validation Feature</b> permits a query to contain a
<code>validate</code> expression (see <a href="#id-validate"><b><del 
class="diff-old">3.13</del> <ins class="diff-chg">3.16</ins> Validate 
Expressions</b></a> .)]</p>
<p>If an XQuery implementation does not support the Schema
Validation Feature, it <a title="must" href="#must">MUST</a> raise
a static error [ <a title="err:XQST0075" href="#ERRXQST0075">err:XQST0075</a>
 ] if it encounters a
<code>validate</code> expression.</p>
</div>
<div class="div3">
<h4><a id="id-static-typing-feature" name="id-static-typing-feature"></a>
 5.2.3 Static Typing Feature</h4>
<p>[ <a title="static typing feature" id="dt-static-typing-feature" 
name="dt-static-typing-feature">Definition</a> : The <b>Static
Typing Feature</b> <del class="diff-old">provides support for the
static semantics defined in [XQuery 1.0 and XPath 2.0 Formal
Semantics] , and</del> requires implementations to <del class="diff-old">detect
 and</del> report <ins class="diff-chg">all</ins>
<a title="type error" href="#dt-type-error">type errors</a> during
the <a title="static analysis phase" href="#dt-static-analysis">static 
analysis phase</a> .]</p>
<p>If an implementation <del class="diff-old">does not
support</del> <ins class="diff-chg">supports</ins> the <a title="static 
typing feature" href="#dt-static-typing-feature">Static
Typing Feature</a> , <del class="diff-old">but can nevertheless
determine during the static analysis phase that an expression, if
evaluated, will necessarily raise a type error at run time, the
implementation MAY</del> <ins class="diff-chg">then it</ins>
<a title="must" href="#must"><ins class="diff-chg">MUST</ins></a>
<del class="diff-old">raise that</del> <ins class="diff-chg">report
an</ins> error during <del class="diff-old">the</del> static
analysis <del class="diff-old">phase. The choice</del> <ins 
class="diff-chg">whenever the inferred static type</ins> of <del 
class="diff-old">whether to raise such</del> an <del class="diff-old">error
 at analysis time</del> <ins class="diff-chg">expression</ins> is <del 
class="diff-old">implementation
dependent . Note: An implementation that does</del> not <del 
class="diff-old">support</del> <ins class="diff-chg">subsumed by</ins>
the <del class="diff-old">Static Typing Feature is not</del>
required <del class="diff-old">to raise</del> type <del class="diff-old">errors
 during</del> <ins class="diff-chg">for</ins> the
<del class="diff-old">static analysis phase; however,</del>
<ins class="diff-chg">context in which</ins> it <del class="diff-old">MUST
 detect and raise non-type-related static errors
during the static analysis phase.</del> <ins class="diff-chg">appears.</ins></p>
<del class="diff-old">5.2.3.1 Static Typing Extensions</del>
<p><del class="diff-old">In some cases, the static typing rules
defined in [XQuery 1.0 and XPath 2.0 Formal Semantics] are</del>
<ins class="diff-chg">If an implementation does</ins> not
<del class="diff-old">very precise (see, for example, the type
inference rules for the ancestor axes—parent, ancestor, and
ancestor-or-self—and for the function fn:root ). Some
implementations may wish to</del> support <del class="diff-old">more 
precise static typing rules. A conforming
implementation that implements</del> the <a title="static typing 
feature" href="#dt-static-typing-feature">Static
Typing Feature</a> , <ins class="diff-chg">then it</ins> <a title="may" 
href="#may">MAY</a> <del class="diff-old">also provide one or
more static typing extensions . [ Definition : A static typing
extension is an implementation-defined type inference rule that
infers a more precise static</del> <ins class="diff-chg">report</ins> 
type <del class="diff-old">than that
inferred by</del> <ins class="diff-chg">errors during</ins> the
<del class="diff-old">type inference rules</del> <ins class="diff-chg">static
 analysis phase only</ins> in <del class="diff-old">[XQuery 1.0 and 
XPath 2.0 Formal Semantics] .] See
Section 6.1.1 Static Typing Extensions FS for a formal definition
of</del> <ins class="diff-chg">cases where</ins> the <del 
class="diff-old">constraints on</del> <ins class="diff-chg">inferred</ins>
 static <del class="diff-old">typing
extensions. 5.2.4 Full Axis Feature [ Definition : The following
axes are designated as optional axes : ancestor , ancestor-or-self
, following , following-sibling , preceding ,</del> <ins 
class="diff-chg">type</ins> and <del class="diff-old">preceding-sibling
.] [ Definition : A conforming XQuery implementation that
supports</del> the <del class="diff-old">Full Axis Feature MUST
support all the optional axes .] Conforming XQuery implementations
that do not support</del> <ins class="diff-chg">required type have
an empty intersection (that is, where evaluation of</ins> the
<del class="diff-old">Full Axis Feature</del> <ins class="diff-chg">expression
 is guaranteed to fail). It</ins> <a title="may" href="#may">MAY</a> <del
 class="diff-old">support one</del>
<ins class="diff-chg">defer some</ins> or <del class="diff-old">more 
optional axes; it is implementation-defined which
optional axes are supported by such implementations. A conforming
implementation that encounters a reference to an optional axis that
it does not support MUST raise a static error [ err:XPST0010 ].
Note: XQuery does not recognize</del> <ins class="diff-chg">all
type checking until</ins> the <del class="diff-old">namespace axis
(defined by XPath 1.0 and deprecated by XPath 2.0).</del>
<ins class="diff-chg">dynamic evaluation phase.</ins></p>
</div>
<div class="div3">
<h4><a id="id-module-feature" name="id-module-feature"></a>
<del class="diff-old">5.2.5</del> <ins class="diff-chg">5.2.4</ins>
Module Feature</h4>
<p>[ <a title="module feature" id="dt-module-feature" 
name="dt-module-feature">Definition</a> : A conforming XQuery
implementation that supports the <b>Module Feature</b> allows a
query Prolog to contain a <b>Module Import</b> and allows
<b>library modules</b> to be created.]</p>
<p>A conforming implementation that does not support the Module
Feature <a title="must" href="#must">MUST</a> raise a <a title="static 
error" href="#dt-static-error">static error</a> [ <a 
title="err:XQST0016" href="#ERRXQST0016">err:XQST0016</a> ] if it
encounters a <a title="module declaration" href="#dt-module-declaration">module
 declaration</a> or a <a title="module import" href="#dt-module-import">module
 import</a> . Since
a <a title="module declaration" href="#dt-module-declaration">module 
declaration</a> is required in a
<a title="library module" href="#dt-library-module">library
module</a> , the Module Feature is required in order to create a
<a title="library module" href="#dt-library-module">library
module</a> .</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>In the absence of the Module Feature, each query consists of a
single <a title="main module" href="#dt-main-module">main
module</a> .</p>
</div>
</div>
<div class="div3">
<h4><a id="id-serialization-feature" name="id-serialization-feature"></a>
 <del class="diff-old">5.2.6</del>
<ins class="diff-chg">5.2.5</ins> Serialization Feature</h4>
<p>[ <a title="serialization feature" id="dt-serialization-feature" 
name="dt-serialization-feature">Definition</a> : A conforming
XQuery implementation that supports the <b>Serialization
Feature</b> <a title="must" href="#must">MUST</a> provide means for
serializing the result of a query, as specified in <a 
href="#id-serialization"><b>2.2.4 Serialization</b></a> .]</p>
<p>A conforming XQuery implementation that supports the
Serialization Feature <a title="must" href="#must">MUST</a> conform
to <a href="#id-xq-serialization-parameters"><b>C.3 Serialization
Parameters</b></a> . The means by which serialization is invoked is
<a title="implementation defined" href="#dt-implementation-defined">implementation-defined</a>
 .</p>
<p>If an error is raised during the serialization process as
specified in <a href="#xslt-xquery-serialization-11">[XSLT
<del class="diff-old">2.0</del> and XQuery <del class="diff-old">1.0 
Serialization]</del> <ins class="diff-chg">Serialization 1.1]</ins></a> ,
 an conforming XQuery
implementation <a title="must" href="#must">MUST</a> report the
error to the calling environment.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>Not all implementations need to serialize. For instance, an
implementation might provide results via an XML API instead of
producing a textual representation.</p>
</div>
</div>
</div>
<div class="div2">
<h3><a id="id-data-model-conformance" name="id-data-model-conformance"></a>
 5.3 Data Model Conformance</h3>
<p>All XQuery implementations process data represented in the
<a title="data model" href="#dt-datamodel">data model</a> as
specified in <del class="diff-old">[XQuery/XPath</del> <a 
href="#xpath-datamodel-11"><ins class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> . The data model specification
relies on languages such as XQuery to specify conformance criteria
for the data model in their respective environments, and suggests
that the following issues should be considered:</p>
<ol class="enumar">
<li>
<p><em>Support for normative construction from an infoset.</em> A
conforming implementation <a title="may" href="#may">MAY</a> choose
to claim conformance to <a 
href="http://www.w3.org/TR/xpath-datamodel/#const-infoset">Section 3.2
Construction from an Infoset</a> <sup><small>DM</small></sup> ,
which defines a normative way to construct an <a title="XDM instance" 
href="#dt-data-model-instance">XDM instance</a> from
an XML document that is merely well-formed or is governed by a
DTD.</p>
</li>
<li>
<p><em>Support for normative construction from a PSVI.</em> A
conforming implementation <a title="may" href="#may">MAY</a> choose
to claim conformance to <a 
href="http://www.w3.org/TR/xpath-datamodel/#const-psvi">Section 3.3
Construction from a PSVI</a> <sup><small>DM</small></sup> , which
defines a normative way to construct an <a title="XDM instance" 
href="#dt-data-model-instance">XDM instance</a> from an XML
document that is governed by a W3C XML Schema.</p>
</li>
<li>
<p><em>Support for XML 1.0 and XML 1.1.</em> The <del class="diff-old">[XQuery/XPath</del>
 <a href="#xpath-datamodel-11"><ins class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> supports either <a href="#XML">[XML
1.0]</a> or <a href="#XML1.1">[XML 1.1]</a> . In XQuery, the choice
of which XML version to support is <a title="implementation defined" 
href="#dt-implementation-defined">implementation-defined</a> .</p>
<p>At the time of writing there is no published version of XML
Schema that references the XML 1.1 specifications. This means that
datatypes such as <code>xs:NCName</code> and <code>xs:ID</code> are
constrained by the XML 1.0 rules. It is recommended that an XQuery
1.0 processor should implement the rules defined by later versions
of XML Schema as they become available.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>For suggestions on processing XML 1.1 documents, see <a 
href="#xml11schema10">[XML 1.1 and Schema 1.0]</a> .</p>
</div>
</li>
<li>
<p><em>Ranges of data values.</em> In XQuery, the following limits
are <a title="implementation defined" href="#dt-implementation-defined">implementation-defined</a>
 :</p>
<ol class="enumla">
<li>
<p>For the <code>xs:decimal</code> type, the maximum number of
decimal digits ( <code>totalDigits</code> facet) (must be at least
18).</p>
</li>
<li>
<p>For the types <code>xs:date</code> , <code>xs:time</code> ,
<code>xs:dateTime</code> , <code>xs:gYear</code> , and
<code>xs:gYearMonth</code> : the maximum value of the year
component and the maximum number of fractional second digits (must
be at least 3).</p>
</li>
<li>
<p>For the <code>xs:duration type</code> : the maximum absolute
values of the years, months, days, hours, minutes, and seconds
components.</p>
</li>
<li>
<p>For the <code>xs:yearMonthDuration</code> type: the maximum
absolute value, expressed as an integer number of months.</p>
</li>
<li>
<p>For the <code>xs:dayTimeDuration</code> type: the maximum
absolute value, expressed as a decimal number of seconds.</p>
</li>
<li>
<p>For the types <code>xs:string</code> , <code>xs:hexBinary</code>
, <code>xs:base64Binary</code> , <code>xs:QName</code> ,
<code>xs:anyURI</code> , <code>xs:NOTATION</code> , and types
derived from them: limitations (if any) imposed by the
implementation on lengths of values.</p>
</li>
</ol>
<p>The limits listed above need not be fixed, but may depend on
environmental factors such as system resources. For example, the
length of a value of type <code>xs:string</code> may be limited by
available memory.</p>
</li>
</ol>
</div>
<div class="div2">
<h3><a id="id-syntax-extensions" name="id-syntax-extensions"></a>
<ins class="diff-new">5.4 Syntax Extensions</ins></h3>
<p><ins class="diff-new">Any syntactic extensions to XQuery
are</ins> <a title="implementation defined" 
href="#dt-implementation-defined"><ins class="diff-new">implementation-defined</ins></a>
 .<ins class="diff-new">The effect of syntactic extensions, including 
their
error behavior, is</ins> <a title="implementation defined" 
href="#dt-implementation-defined"><ins class="diff-new">implementation-defined</ins></a>
 .<ins class="diff-new">Syntactic extensions may be used without 
restriction to
modify the semantics of a XQuery expression.</ins></p>
</div>
</div>
</div>
<div class="back">
<div class="div1">
<h2><a id="nt-bnf" name="nt-bnf"></a> A XQuery <ins class="diff-new">1.1</ins>
 Grammar</h2>
<div class="div2">
<h3><a id="id-grammar" name="id-grammar"></a> A.1 EBNF</h3>
<p>The grammar of XQuery <ins class="diff-new">1.1</ins> uses the
same simple Extended Backus-Naur Form (EBNF) notation as <a href="#XML">[XML
 1.0]</a> with the following minor differences.</p>
<ul>
<li>
<p>All named symbols have a name that begins with an uppercase
letter.</p>
</li>
<li>
<p>It adds a notation for referring to productions in external
specs.</p>
</li>
<li>
<p>Comments or extra-grammatical constraints on grammar productions
are between '/*' and '*/' symbols.</p>
<ul>
<li>
<p>A 'xgc:' prefix is an extra-grammatical constraint, the details
of which are explained in <a href="#extra-grammatical-constraints"><b>A.1.2
 Extra-grammatical
Constraints</b></a></p>
</li>
<li>
<p>A 'ws:' prefix explains the whitespace rules for the production,
the details of which are explained in <a href="#whitespace-rules"><b>A.2.4
 Whitespace Rules</b></a></p>
</li>
<li>
<p>A 'gn:' prefix means a 'Grammar Note', and is meant as a
clarification for parsing rules, and is explained in <a 
href="#notes-on-parsing"><b>A.1.3 Grammar Notes</b></a> . These notes
are not normative.</p>
</li>
</ul>
</li>
</ul>
<p>The terminal symbols for this grammar include the quoted strings
used in the production rules below, and the terminal symbols
defined in section <a href="#terminal-symbols"><b>A.2.1 Terminal
Symbols</b></a> .</p>
<p>The EBNF notation is described in more detail in <a 
href="#EBNFNotation"><b>A.1.1 Notation</b></a> .</p>
<p>To increase readability, the EBNF in the main body of this
document omits some of these notational features. This appendix is
the normative version of the EBNF.</p>
<h5><a id="BNF-Grammar" name="BNF-Grammar"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-Module" name="prod-xquery11-Module"></a>
[1]&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-Module">Module</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-VersionDecl">VersionDecl</a> ? (
<a href="#prod-xquery11-LibraryModule">LibraryModule</a> | <a 
href="#prod-xquery11-MainModule">MainModule</a> )</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-VersionDecl" name="prod-xquery11-VersionDecl"></a>
 [2]&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-VersionDecl">VersionDecl</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"xquery" <del class="diff-old">"version"</del>
<ins class="diff-chg">(("encoding"</ins> <a 
href="#prod-xquery11-StringLiteral"><ins class="diff-chg">StringLiteral</ins></a>
 <ins class="diff-chg">) |
("version"</ins> <a href="#prod-xquery11-StringLiteral">StringLiteral</a>
 ("encoding"
<a href="#prod-xquery11-StringLiteral">StringLiteral</a>
<del class="diff-old">)?</del> <ins class="diff-chg">)?))</ins>
<a href="#prod-xquery11-Separator">Separator</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-MainModule" name="prod-xquery11-MainModule"></a>
 [3]&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-MainModule">MainModule</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-Prolog">Prolog</a> <a 
href="#prod-xquery11-QueryBody">QueryBody</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-LibraryModule" 
name="prod-xquery11-LibraryModule"></a> [4]&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-LibraryModule">LibraryModule</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-ModuleDecl">ModuleDecl</a>
<a href="#prod-xquery11-Prolog">Prolog</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ModuleDecl" name="prod-xquery11-ModuleDecl"></a>
 [5]&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-ModuleDecl">ModuleDecl</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"module" "namespace" <a href="#prod-xquery11-NCName">NCName</a>
 "=" <a href="#prod-xquery11-URILiteral">URILiteral</a> <a 
href="#prod-xquery11-Separator">Separator</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-Prolog" name="prod-xquery11-Prolog"></a>
[6]&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-Prolog">Prolog</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>(( <a href="#prod-xquery11-DefaultNamespaceDecl">DefaultNamespaceDecl</a>
 |
<a href="#prod-xquery11-Setter">Setter</a> | <a 
href="#prod-xquery11-NamespaceDecl">NamespaceDecl</a> | <a 
href="#prod-xquery11-Import">Import</a> ) <a 
href="#prod-xquery11-Separator">Separator</a> )* (( <del 
class="diff-old">VarDecl</del> <a href="#prod-xquery11-ContextItemDecl"><ins
 class="diff-chg">ContextItemDecl</ins></a> | <del class="diff-old">FunctionDecl</del>
 <a href="#prod-xquery11-AnnotatedDecl"><ins class="diff-chg">AnnotatedDecl</ins></a>
 | <a href="#prod-xquery11-OptionDecl">OptionDecl</a> ) <a 
href="#prod-xquery11-Separator">Separator</a> )*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-Separator" name="prod-xquery11-Separator"></a> 
[7]&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">Setter</del> <a 
href="#doc-xquery11-Separator"><ins class="diff-chg">Separator</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">BoundarySpaceDecl |
DefaultCollationDecl | BaseURIDecl | ConstructionDecl |
OrderingModeDecl | EmptyOrderDecl | CopyNamespacesDecl</del>
<ins class="diff-chg">";"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-Setter" name="prod-xquery11-Setter"></a>
[8]&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">Import</del> <a 
href="#doc-xquery11-Setter"><ins class="diff-chg">Setter</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">SchemaImport</del> <a 
href="#prod-xquery11-BoundarySpaceDecl"><ins class="diff-chg">BoundarySpaceDecl</ins></a>
 | <del class="diff-old">ModuleImport</del> <a 
href="#prod-xquery11-DefaultCollationDecl"><ins class="diff-chg">DefaultCollationDecl</ins></a>
 <ins class="diff-chg">|</ins> <a href="#prod-xquery11-BaseURIDecl"><ins
 class="diff-chg">BaseURIDecl</ins></a> <ins class="diff-chg">|</ins>
<a href="#prod-xquery11-ConstructionDecl"><ins class="diff-chg">ConstructionDecl</ins></a>
 <ins class="diff-chg">|</ins>
<a href="#prod-xquery11-OrderingModeDecl"><ins class="diff-chg">OrderingModeDecl</ins></a>
 <ins class="diff-chg">|</ins>
<a href="#prod-xquery11-EmptyOrderDecl"><ins class="diff-chg">EmptyOrderDecl</ins></a>
 <ins class="diff-chg">|</ins>
<a href="#prod-xquery11-CopyNamespacesDecl"><ins class="diff-chg">CopyNamespacesDecl</ins></a>
 <ins class="diff-chg">|</ins> <a 
href="#prod-xquery11-DecimalFormatDecl"><ins class="diff-chg">DecimalFormatDecl</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-BoundarySpaceDecl" 
name="prod-xquery11-BoundarySpaceDecl"></a> [9]&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">Separator</del> <a 
href="#doc-xquery11-BoundarySpaceDecl"><ins class="diff-chg">BoundarySpaceDecl</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">";"</del> <ins class="diff-chg">"declare"
 "boundary-space" ("preserve" |
"strip")</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-DefaultCollationDecl" 
name="prod-xquery11-DefaultCollationDecl"></a>
[10]&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">NamespaceDecl</del> <a 
href="#doc-xquery11-DefaultCollationDecl"><ins class="diff-chg">DefaultCollationDecl</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"declare" <del class="diff-old">"namespace" NCName
"="</del> <ins class="diff-chg">"default" "collation"</ins>
<a href="#prod-xquery11-URILiteral">URILiteral</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-BaseURIDecl" name="prod-xquery11-BaseURIDecl"></a>
 [11]&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">BoundarySpaceDecl</del> <a 
href="#doc-xquery11-BaseURIDecl"><ins class="diff-chg">BaseURIDecl</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"declare" <del class="diff-old">"boundary-space"
("preserve" | "strip")</del> <ins class="diff-chg">"base-uri"</ins>
<a href="#prod-xquery11-URILiteral"><ins class="diff-chg">URILiteral</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ConstructionDecl" 
name="prod-xquery11-ConstructionDecl"></a> [12]&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">DefaultNamespaceDecl</del> <a 
href="#doc-xquery11-ConstructionDecl"><ins class="diff-chg">ConstructionDecl</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"declare" <del class="diff-old">"default"
("element"</del> <ins class="diff-chg">"construction"
("strip"</ins> | <del class="diff-old">"function") "namespace"
URILiteral</del> <ins class="diff-chg">"preserve")</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-OrderingModeDecl" 
name="prod-xquery11-OrderingModeDecl"></a> [13]&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">OptionDecl</del> <a 
href="#doc-xquery11-OrderingModeDecl"><ins class="diff-chg">OrderingModeDecl</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"declare" <del class="diff-old">"option" QName
StringLiteral</del> <ins class="diff-chg">"ordering" ("ordered" |
"unordered")</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-EmptyOrderDecl" 
name="prod-xquery11-EmptyOrderDecl"></a> [14]&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">OrderingModeDecl</del> <a 
href="#doc-xquery11-EmptyOrderDecl"><ins class="diff-chg">EmptyOrderDecl</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"declare" <del class="diff-old">"ordering"
("ordered"</del> <ins class="diff-chg">"default" "order" "empty"
("greatest"</ins> | <del class="diff-old">"unordered")</del>
<ins class="diff-chg">"least")</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CopyNamespacesDecl" 
name="prod-xquery11-CopyNamespacesDecl"></a> [15]&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">EmptyOrderDecl</del> <a 
href="#doc-xquery11-CopyNamespacesDecl"><ins class="diff-chg">CopyNamespacesDecl</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"declare" <del class="diff-old">"default" "order" "empty"
("greatest" | "least")</del> <ins class="diff-chg">"copy-namespaces"</ins>
 <a href="#prod-xquery11-PreserveMode"><ins class="diff-chg">PreserveMode</ins></a>
 <ins class="diff-chg">","</ins>
<a href="#prod-xquery11-InheritMode"><ins class="diff-chg">InheritMode</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-PreserveMode" name="prod-xquery11-PreserveMode"></a>
 [16]&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">CopyNamespacesDecl</del> <a 
href="#doc-xquery11-PreserveMode"><ins class="diff-chg">PreserveMode</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">"declare" "copy-namespaces"
PreserveMode "," InheritMode</del> <ins class="diff-chg">"preserve"
| "no-preserve"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-InheritMode" name="prod-xquery11-InheritMode"></a>
 [17]&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">PreserveMode</del> <a 
href="#doc-xquery11-InheritMode"><ins class="diff-chg">InheritMode</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">"preserve"</del> <ins class="diff-chg">"inherit"</ins>
 | <del class="diff-old">"no-preserve"</del> <ins class="diff-chg">"no-inherit"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-DecimalFormatDecl" 
name="prod-xquery11-DecimalFormatDecl"></a> [18]&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">InheritMode</del> <a 
href="#doc-xquery11-DecimalFormatDecl"><ins class="diff-chg">DecimalFormatDecl</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">"inherit"</del> <ins class="diff-chg">"declare"
 (("decimal-format"</ins> <a href="#prod-xquery11-EQName"><ins 
class="diff-chg">EQName</ins></a>
<ins class="diff-chg">)</ins> | <del class="diff-old">"no-inherit"</del>
 <ins class="diff-chg">("default"
"decimal-format")) (</ins> <a href="#prod-xquery11-DFPropertyName"><ins 
class="diff-chg">DFPropertyName</ins></a> <ins class="diff-chg">"="</ins>
<a href="#prod-xquery11-StringLiteral"><ins class="diff-chg">StringLiteral</ins></a>
 <ins class="diff-chg">)*</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-DFPropertyName" 
name="prod-xquery11-DFPropertyName"></a> [19]&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">DefaultCollationDecl</del> <a 
href="#doc-xquery11-DFPropertyName"><ins class="diff-chg">DFPropertyName</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">"declare" "default" "collation"
URILiteral</del> <ins class="diff-chg">"decimal-separator" |
"grouping-separator" | "infinity" | "minus-sign" | "NaN" |
"percent" | "per-mille" | "zero-digit" | "digit" |
"pattern-separator"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-Import" name="prod-xquery11-Import"></a>
[20]&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">BaseURIDecl</del> <a 
href="#doc-xquery11-Import"><ins class="diff-chg">Import</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">"declare" "base-uri"
URILiteral</del> <a href="#prod-xquery11-SchemaImport"><ins 
class="diff-chg">SchemaImport</ins></a> <ins class="diff-chg">|</ins>
<a href="#prod-xquery11-ModuleImport"><ins class="diff-chg">ModuleImport</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-SchemaImport" name="prod-xquery11-SchemaImport"></a>
 [21]&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-SchemaImport">SchemaImport</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"import" "schema" <a href="#prod-xquery11-SchemaPrefix">SchemaPrefix</a>
 ? <a href="#prod-xquery11-URILiteral">URILiteral</a> ("at" <a 
href="#prod-xquery11-URILiteral">URILiteral</a> ("," <a 
href="#prod-xquery11-URILiteral">URILiteral</a> )*)?</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-SchemaPrefix" name="prod-xquery11-SchemaPrefix"></a>
 [22]&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-SchemaPrefix">SchemaPrefix</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>("namespace" <a href="#prod-xquery11-NCName">NCName</a>
"=") | ("default" "element" "namespace")</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ModuleImport" name="prod-xquery11-ModuleImport"></a>
 [23]&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#doc-xquery11-ModuleImport">ModuleImport</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"import" "module" ("namespace" <a href="#prod-xquery11-NCName">NCName</a>
 "=")? <a href="#prod-xquery11-URILiteral">URILiteral</a> ("at" <a 
href="#prod-xquery11-URILiteral">URILiteral</a> ("," <a 
href="#prod-xquery11-URILiteral">URILiteral</a> )*)?</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-NamespaceDecl" 
name="prod-xquery11-NamespaceDecl"></a> [24]&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">VarDecl</del> <a 
href="#doc-xquery11-NamespaceDecl"><ins class="diff-chg">NamespaceDecl</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"declare" "namespace"</ins>
<a href="#prod-xquery11-NCName"><ins class="diff-chg">NCName</ins></a> <ins
 class="diff-chg">"="</ins>
<a href="#prod-xquery11-URILiteral"><ins class="diff-chg">URILiteral</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-DefaultNamespaceDecl" 
name="prod-xquery11-DefaultNamespaceDecl"></a><ins class="diff-chg">[25]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-DefaultNamespaceDecl"><ins 
class="diff-chg">DefaultNamespaceDecl</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"declare" <ins class="diff-new">"default" ("element" |
"function") "namespace"</ins> <a href="#prod-xquery11-URILiteral"><ins 
class="diff-new">URILiteral</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-AnnotatedDecl" 
name="prod-xquery11-AnnotatedDecl"></a><ins class="diff-new">[26]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-AnnotatedDecl"><ins class="diff-new">AnnotatedDecl</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"declare"</ins> <a 
href="#prod-xquery11-Annotation"><ins class="diff-new">Annotation</ins></a>
 <ins class="diff-new">* (</ins>
<a href="#prod-xquery11-VarDecl"><ins class="diff-new">VarDecl</ins></a>
 <ins class="diff-new">|</ins> <a href="#prod-xquery11-FunctionDecl"><ins
 class="diff-new">FunctionDecl</ins></a> <ins class="diff-new">)</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-Annotation" name="prod-xquery11-Annotation"></a><ins
 class="diff-new">[27]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-Annotation"><ins class="diff-new">Annotation</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"%"</ins> <a 
href="#prod-xquery11-EQName"><ins class="diff-new">EQName</ins></a>
<ins class="diff-new">("("</ins> <a href="#prod-xquery11-Literal"><ins 
class="diff-new">Literal</ins></a>
<ins class="diff-new">(","</ins> <a href="#prod-xquery11-Literal"><ins 
class="diff-new">Literal</ins></a>
<ins class="diff-new">)* ")")?</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-VarDecl" name="prod-xquery11-VarDecl"></a><ins 
class="diff-new">[28]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-VarDecl"><ins class="diff-new">VarDecl</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code>"variable" "$" <del class="diff-old">QName</del> <a 
href="#prod-xquery11-VarName"><ins class="diff-chg">VarName</ins></a>
<a href="#prod-xquery11-TypeDeclaration">TypeDeclaration</a> ?
((":=" <del class="diff-old">ExprSingle</del> <a 
href="#prod-xquery11-VarValue"><ins class="diff-chg">VarValue</ins></a>
) | <del class="diff-old">"external")</del> <ins class="diff-chg">("external"
 (":="</ins> <a href="#prod-xquery11-VarDefaultValue"><ins 
class="diff-chg">VarDefaultValue</ins></a> <ins class="diff-chg">)?))</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-VarValue" name="prod-xquery11-VarValue"></a> <del
 class="diff-old">[25]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[29]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">ConstructionDecl</del> <a 
href="#doc-xquery11-VarValue"><ins class="diff-chg">VarValue</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ExprSingle"><ins class="diff-chg">ExprSingle</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-VarDefaultValue" 
name="prod-xquery11-VarDefaultValue"></a><ins class="diff-chg">[30]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-VarDefaultValue"><ins class="diff-chg">VarDefaultValue</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ExprSingle"><ins class="diff-chg">ExprSingle</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ContextItemDecl" 
name="prod-xquery11-ContextItemDecl"></a> <ins class="diff-new">[31]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">ContextItemDecl</ins></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"declare" <del class="diff-old">"construction"
("strip"</del> <ins class="diff-chg">"context" "item" ("as"</ins>
<a href="#prod-xquery11-ItemType"><ins class="diff-chg">ItemType</ins></a>
 <ins class="diff-chg">)? ((":="</ins>
<a href="#prod-xquery11-VarValue"><ins class="diff-chg">VarValue</ins></a>
 <ins class="diff-chg">)</ins> |
<del class="diff-old">"preserve")</del> <ins class="diff-chg">("external"
 (":="</ins> <a href="#prod-xquery11-VarDefaultValue"><ins 
class="diff-chg">VarDefaultValue</ins></a> <ins class="diff-chg">)?))</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-FunctionDecl" name="prod-xquery11-FunctionDecl"></a>
 <del class="diff-old">[26]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[32]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-FunctionDecl">FunctionDecl</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">"declare"</del> "function"
<del class="diff-old">QName</del> <a href="#prod-xquery11-EQName"><ins 
class="diff-chg">EQName</ins></a> "("
<a href="#prod-xquery11-ParamList">ParamList</a> ? ")" ("as"
<a href="#prod-xquery11-SequenceType">SequenceType</a> )? (
<del class="diff-old">EnclosedExpr</del> <a 
href="#prod-xquery11-FunctionBody"><ins class="diff-chg">FunctionBody</ins></a>
 | "external")</code></td>
<td><i><ins class="diff-new">/*</ins> <span><a 
href="http://www.w3.org/TR/xquery#parse-note-reserved-function-names"><ins
 class="diff-new">
xgc: reserved-function-names</ins></a> <sup><small><ins class="diff-new">XQ</ins></small></sup></span>
 <ins class="diff-new">*/</ins></i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ParamList" name="prod-xquery11-ParamList"></a> <del
 class="diff-old">[27]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[33]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ParamList">ParamList</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-Param">Param</a> ("," <a 
href="#prod-xquery11-Param">Param</a> )*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-Param" name="prod-xquery11-Param"></a>
<del class="diff-old">[28]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[34]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-Param">Param</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"$" <del class="diff-old">QName</del> <a 
href="#prod-xquery11-EQName"><ins class="diff-chg">EQName</ins></a>
<a href="#prod-xquery11-TypeDeclaration">TypeDeclaration</a>
?</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-FunctionBody" name="prod-xquery11-FunctionBody"></a>
 <del class="diff-old">[29]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[35]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-FunctionBody"><ins class="diff-chg">FunctionBody</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-EnclosedExpr"><ins class="diff-chg">EnclosedExpr</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-EnclosedExpr" name="prod-xquery11-EnclosedExpr"></a><ins
 class="diff-chg">[36]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-EnclosedExpr">EnclosedExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"{" <a href="#prod-xquery11-Expr">Expr</a>
"}"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-OptionDecl" name="prod-xquery11-OptionDecl"></a>
 <del class="diff-old">[30]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[37]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-OptionDecl"><ins class="diff-chg">OptionDecl</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"declare" "option"</ins> <a 
href="#prod-xquery11-EQName"><ins class="diff-chg">EQName</ins></a>
<a href="#prod-xquery11-StringLiteral"><ins class="diff-chg">StringLiteral</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-QueryBody" name="prod-xquery11-QueryBody"></a><ins
 class="diff-chg">[38]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-QueryBody">QueryBody</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-Expr">Expr</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-Expr" name="prod-xquery11-Expr"></a>
<del class="diff-old">[31]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[39]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-Expr">Expr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-ExprSingle">ExprSingle</a> (","
<a href="#prod-xquery11-ExprSingle">ExprSingle</a> )*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ExprSingle" name="prod-xquery11-ExprSingle"></a>
 <del class="diff-old">[32]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[40]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ExprSingle">ExprSingle</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-FLWORExpr">FLWORExpr</a><br>
| <a href="#prod-xquery11-QuantifiedExpr">QuantifiedExpr</a><br>
| <a href="#prod-xquery11-SwitchExpr"><ins class="diff-chg">SwitchExpr</ins></a><br>
<ins class="diff-chg">|</ins> <a href="#prod-xquery11-TypeswitchExpr">TypeswitchExpr</a><br>
| <a href="#prod-xquery11-IfExpr">IfExpr</a><br>
| <a href="#prod-xquery11-TryCatchExpr"><ins class="diff-chg">TryCatchExpr</ins></a><br>
<ins class="diff-chg">|</ins> <a href="#prod-xquery11-OrExpr">OrExpr</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-FLWORExpr" name="prod-xquery11-FLWORExpr"></a> <del
 class="diff-old">[33]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[41]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-FLWORExpr">FLWORExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">(</del> <a 
href="#prod-xquery11-InitialClause"><ins class="diff-chg">InitialClause</ins></a>
 <a href="#prod-xquery11-IntermediateClause"><ins class="diff-chg">IntermediateClause</ins></a>
 <ins class="diff-chg">*</ins> <a href="#prod-xquery11-ReturnClause"><ins
 class="diff-chg">ReturnClause</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-InitialClause" 
name="prod-xquery11-InitialClause"></a><ins class="diff-chg">[42]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-InitialClause"><ins class="diff-chg">InitialClause</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ForClause">ForClause</a> |
<a href="#prod-xquery11-LetClause">LetClause</a> <del class="diff-old">)+</del>
 <ins class="diff-chg">|</ins> <a href="#prod-xquery11-WindowClause"><ins
 class="diff-chg">WindowClause</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-IntermediateClause" 
name="prod-xquery11-IntermediateClause"></a><ins class="diff-chg">[43]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-IntermediateClause"><ins 
class="diff-chg">IntermediateClause</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-InitialClause"><ins class="diff-chg">InitialClause</ins></a>
 <ins class="diff-chg">|</ins>
<a href="#prod-xquery11-WhereClause">WhereClause</a> <del 
class="diff-old">?</del> <ins class="diff-chg">|</ins> <a 
href="#prod-xquery11-GroupByClause"><ins class="diff-chg">GroupByClause</ins></a>
 <ins class="diff-chg">|</ins>
<a href="#prod-xquery11-OrderByClause">OrderByClause</a>
<del class="diff-old">? "return" ExprSingle</del> <ins class="diff-chg">|</ins>
 <a href="#prod-xquery11-CountClause"><ins class="diff-chg">CountClause</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ForClause" name="prod-xquery11-ForClause"></a> <del
 class="diff-old">[34]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[44]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ForClause">ForClause</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"for" <del class="diff-old">"$" VarName
TypeDeclaration</del> <a href="#prod-xquery11-ForBinding"><ins 
class="diff-chg">ForBinding</ins></a> <del class="diff-old">?
PositionalVar</del> <ins class="diff-chg">(","</ins> <a 
href="#prod-xquery11-ForBinding"><ins class="diff-chg">ForBinding</ins></a>
 <del class="diff-old">? "in"
ExprSingle</del> <ins class="diff-chg">)*</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ForBinding" name="prod-xquery11-ForBinding"></a>
 <del class="diff-old">(","</del>
<ins class="diff-chg">[45]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">ForBinding</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code>"$" <a href="#prod-xquery11-VarName">VarName</a> <a 
href="#prod-xquery11-TypeDeclaration">TypeDeclaration</a> ? <a 
href="#prod-xquery11-AllowingEmpty"><ins class="diff-chg">AllowingEmpty</ins></a>
 <ins class="diff-chg">?</ins>
<a href="#prod-xquery11-PositionalVar">PositionalVar</a> ? "in"
<a href="#prod-xquery11-ExprSingle">ExprSingle</a> <del class="diff-old">)*</del></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-AllowingEmpty" 
name="prod-xquery11-AllowingEmpty"></a> <del class="diff-old">[35]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[46]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-AllowingEmpty"><ins class="diff-chg">AllowingEmpty</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"allowing"
"empty"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-PositionalVar" 
name="prod-xquery11-PositionalVar"></a><ins class="diff-chg">[47]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-PositionalVar">PositionalVar</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"at" "$" <a href="#prod-xquery11-VarName">VarName</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-LetClause" name="prod-xquery11-LetClause"></a> <del
 class="diff-old">[36]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[48]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-LetClause">LetClause</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"let" <a href="#prod-xquery11-LetBinding"><ins 
class="diff-new">LetBinding</ins></a> <ins class="diff-new">(","</ins>
<a href="#prod-xquery11-LetBinding"><ins class="diff-new">LetBinding</ins></a>
 <ins class="diff-new">)*</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-LetBinding" name="prod-xquery11-LetBinding"></a><ins
 class="diff-new">[49]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">LetBinding</ins></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code>"$" <a href="#prod-xquery11-VarName">VarName</a> <a 
href="#prod-xquery11-TypeDeclaration">TypeDeclaration</a> ? ":="
<a href="#prod-xquery11-ExprSingle">ExprSingle</a> <del class="diff-old">(","</del></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-WindowClause" name="prod-xquery11-WindowClause"></a>
 <ins class="diff-chg">[50]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-WindowClause"><ins class="diff-chg">WindowClause</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"for" (</ins> <a 
href="#prod-xquery11-TumblingWindowClause"><ins class="diff-chg">TumblingWindowClause</ins></a>
 <ins class="diff-chg">|</ins> <a 
href="#prod-xquery11-SlidingWindowClause"><ins class="diff-chg">SlidingWindowClause</ins></a>
 <ins class="diff-chg">)</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-TumblingWindowClause" 
name="prod-xquery11-TumblingWindowClause"></a><ins class="diff-chg">[51]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-TumblingWindowClause"><ins 
class="diff-chg">TumblingWindowClause</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"tumbling" "window"</ins> "$"
<a href="#prod-xquery11-VarName">VarName</a> <a 
href="#prod-xquery11-TypeDeclaration">TypeDeclaration</a> ? <del 
class="diff-old">":="</del> <ins class="diff-chg">"in"</ins> <a 
href="#prod-xquery11-ExprSingle">ExprSingle</a> <del class="diff-old">)*</del>
 <a href="#prod-xquery11-WindowStartCondition"><ins class="diff-chg">WindowStartCondition</ins></a>
 <a href="#prod-xquery11-WindowEndCondition"><ins class="diff-chg">WindowEndCondition</ins></a>
 <ins class="diff-chg">?</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-SlidingWindowClause" 
name="prod-xquery11-SlidingWindowClause"></a> <del class="diff-old">[37]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[52]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-SlidingWindowClause"><ins 
class="diff-chg">SlidingWindowClause</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"sliding" "window" "$"</ins>
<a href="#prod-xquery11-VarName"><ins class="diff-chg">VarName</ins></a>
 <a href="#prod-xquery11-TypeDeclaration"><ins class="diff-chg">TypeDeclaration</ins></a>
 <ins class="diff-chg">?
"in"</ins> <a href="#prod-xquery11-ExprSingle"><ins class="diff-chg">ExprSingle</ins></a>
 <a href="#prod-xquery11-WindowStartCondition"><ins class="diff-chg">WindowStartCondition</ins></a>
 <a href="#prod-xquery11-WindowEndCondition"><ins class="diff-chg">WindowEndCondition</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-WindowStartCondition" 
name="prod-xquery11-WindowStartCondition"></a><ins class="diff-chg">[53]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-WindowStartCondition"><ins 
class="diff-chg">WindowStartCondition</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"start"</ins> <a 
href="#prod-xquery11-WindowVars"><ins class="diff-chg">WindowVars</ins></a>
 <ins class="diff-chg">"when"</ins>
<a href="#prod-xquery11-ExprSingle"><ins class="diff-chg">ExprSingle</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-WindowEndCondition" 
name="prod-xquery11-WindowEndCondition"></a><ins class="diff-chg">[54]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-WindowEndCondition"><ins 
class="diff-chg">WindowEndCondition</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"only"? "end"</ins> <a 
href="#prod-xquery11-WindowVars"><ins class="diff-chg">WindowVars</ins></a>
 <ins class="diff-chg">"when"</ins>
<a href="#prod-xquery11-ExprSingle"><ins class="diff-chg">ExprSingle</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-WindowVars" name="prod-xquery11-WindowVars"></a><ins
 class="diff-chg">[55]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-WindowVars"><ins class="diff-chg">WindowVars</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">("$"</ins> <a 
href="#prod-xquery11-CurrentItem"><ins class="diff-chg">CurrentItem</ins></a>
 <ins class="diff-chg">)?</ins>
<a href="#prod-xquery11-PositionalVar"><ins class="diff-chg">PositionalVar</ins></a>
 <ins class="diff-chg">?
("previous" "$"</ins> <a href="#prod-xquery11-PreviousItem"><ins 
class="diff-chg">PreviousItem</ins></a> <ins class="diff-chg">)? ("next"
"$"</ins> <a href="#prod-xquery11-NextItem"><ins class="diff-chg">NextItem</ins></a>
 <ins class="diff-chg">)?</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CurrentItem" name="prod-xquery11-CurrentItem"></a><ins
 class="diff-chg">[56]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CurrentItem"><ins class="diff-chg">CurrentItem</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-EQName"><ins class="diff-chg">EQName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-PreviousItem" name="prod-xquery11-PreviousItem"></a><ins
 class="diff-chg">[57]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-PreviousItem"><ins class="diff-chg">PreviousItem</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-EQName"><ins class="diff-chg">EQName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-NextItem" name="prod-xquery11-NextItem"></a><ins
 class="diff-chg">[58]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-NextItem"><ins class="diff-chg">NextItem</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-EQName"><ins class="diff-chg">EQName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CountClause" name="prod-xquery11-CountClause"></a><ins
 class="diff-chg">[59]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CountClause"><ins class="diff-chg">CountClause</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"count" "$"</ins> <a 
href="#prod-xquery11-VarName"><ins class="diff-chg">VarName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-WhereClause" name="prod-xquery11-WhereClause"></a><ins
 class="diff-chg">[60]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-WhereClause">WhereClause</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"where" <a href="#prod-xquery11-ExprSingle">ExprSingle</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-GroupByClause" 
name="prod-xquery11-GroupByClause"></a> <del class="diff-old">[38]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[61]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-GroupByClause"><ins class="diff-chg">GroupByClause</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"group" "by"</ins> <a 
href="#prod-xquery11-GroupingSpecList"><ins class="diff-chg">GroupingSpecList</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-GroupingSpecList" 
name="prod-xquery11-GroupingSpecList"></a><ins class="diff-chg">[62]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-GroupingSpecList"><ins class="diff-chg">GroupingSpecList</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-GroupingSpec"><ins class="diff-chg">GroupingSpec</ins></a>
 <ins class="diff-chg">(","</ins>
<a href="#prod-xquery11-GroupingSpec"><ins class="diff-chg">GroupingSpec</ins></a>
 <ins class="diff-chg">)*</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-GroupingSpec" name="prod-xquery11-GroupingSpec"></a><ins
 class="diff-chg">[63]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-GroupingSpec"><ins class="diff-chg">GroupingSpec</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"$"</ins> <a 
href="#prod-xquery11-VarName"><ins class="diff-chg">VarName</ins></a>
<ins class="diff-chg">("collation"</ins> <a 
href="#prod-xquery11-URILiteral"><ins class="diff-chg">URILiteral</ins></a>
 <ins class="diff-chg">)?</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-OrderByClause" 
name="prod-xquery11-OrderByClause"></a><ins class="diff-chg">[64]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-OrderByClause">OrderByClause</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>(("order" "by") | ("stable" "order" "by")) <a 
href="#prod-xquery11-OrderSpecList">OrderSpecList</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-OrderSpecList" 
name="prod-xquery11-OrderSpecList"></a> <del class="diff-old">[39]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[65]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-OrderSpecList">OrderSpecList</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-OrderSpec">OrderSpec</a> (","
<a href="#prod-xquery11-OrderSpec">OrderSpec</a> )*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-OrderSpec" name="prod-xquery11-OrderSpec"></a> <del
 class="diff-old">[40]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[66]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-OrderSpec">OrderSpec</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-ExprSingle">ExprSingle</a>
<a href="#prod-xquery11-OrderModifier">OrderModifier</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-OrderModifier" 
name="prod-xquery11-OrderModifier"></a> <del class="diff-old">[41]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[67]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-OrderModifier">OrderModifier</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>("ascending" | "descending")? ("empty" ("greatest" |
"least"))? ("collation" <a href="#prod-xquery11-URILiteral">URILiteral</a>
 )?</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ReturnClause" name="prod-xquery11-ReturnClause"></a>
 <del class="diff-old">[42]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[68]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ReturnClause"><ins class="diff-chg">ReturnClause</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"return"</ins> <a 
href="#prod-xquery11-ExprSingle"><ins class="diff-chg">ExprSingle</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-QuantifiedExpr" 
name="prod-xquery11-QuantifiedExpr"></a><ins class="diff-chg">[69]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-QuantifiedExpr">QuantifiedExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>("some" | "every") "$" <a href="#prod-xquery11-VarName">VarName</a>
 <a href="#prod-xquery11-TypeDeclaration">TypeDeclaration</a> ? "in"
<a href="#prod-xquery11-ExprSingle">ExprSingle</a> ("," "$"
<a href="#prod-xquery11-VarName">VarName</a> <a 
href="#prod-xquery11-TypeDeclaration">TypeDeclaration</a> ? "in"
<a href="#prod-xquery11-ExprSingle">ExprSingle</a> )* "satisfies"
<a href="#prod-xquery11-ExprSingle">ExprSingle</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-SwitchExpr" name="prod-xquery11-SwitchExpr"></a>
 <del class="diff-old">[43]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[70]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-SwitchExpr"><ins class="diff-chg">SwitchExpr</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"switch" "("</ins> <a 
href="#prod-xquery11-Expr"><ins class="diff-chg">Expr</ins></a>
<ins class="diff-chg">")"</ins> <a 
href="#prod-xquery11-SwitchCaseClause"><ins class="diff-chg">SwitchCaseClause</ins></a>
 <ins class="diff-chg">+
"default" "return"</ins> <a href="#prod-xquery11-ExprSingle"><ins 
class="diff-chg">ExprSingle</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-SwitchCaseClause" 
name="prod-xquery11-SwitchCaseClause"></a><ins class="diff-chg">[71]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-SwitchCaseClause"><ins class="diff-chg">SwitchCaseClause</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">("case"</ins> <a 
href="#prod-xquery11-SwitchCaseOperand"><ins class="diff-chg">SwitchCaseOperand</ins></a>
 <ins class="diff-chg">)+
"return"</ins> <a href="#prod-xquery11-ExprSingle"><ins class="diff-chg">ExprSingle</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-SwitchCaseOperand" 
name="prod-xquery11-SwitchCaseOperand"></a><ins class="diff-chg">[72]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-SwitchCaseOperand"><ins 
class="diff-chg">SwitchCaseOperand</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ExprSingle"><ins class="diff-chg">ExprSingle</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-TypeswitchExpr" 
name="prod-xquery11-TypeswitchExpr"></a><ins class="diff-chg">[73]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-TypeswitchExpr">TypeswitchExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"typeswitch" "(" <a href="#prod-xquery11-Expr">Expr</a>
")" <a href="#prod-xquery11-CaseClause">CaseClause</a> + "default"
("$" <a href="#prod-xquery11-VarName">VarName</a> )? "return"
<a href="#prod-xquery11-ExprSingle">ExprSingle</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CaseClause" name="prod-xquery11-CaseClause"></a>
 <del class="diff-old">[44]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[74]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CaseClause">CaseClause</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"case" ("$" <a href="#prod-xquery11-VarName">VarName</a>
"as")? <del class="diff-old">SequenceType</del> <a 
href="#prod-xquery11-SequenceTypeUnion"><ins class="diff-chg">SequenceTypeUnion</ins></a>
 "return" <a href="#prod-xquery11-ExprSingle">ExprSingle</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-SequenceTypeUnion" 
name="prod-xquery11-SequenceTypeUnion"></a> <del class="diff-old">[45]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[75]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-SequenceTypeUnion"><ins 
class="diff-chg">SequenceTypeUnion</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-SequenceType"><ins class="diff-chg">SequenceType</ins></a>
 <ins class="diff-chg">("|"</ins>
<a href="#prod-xquery11-SequenceType"><ins class="diff-chg">SequenceType</ins></a>
 <ins class="diff-chg">)*</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-IfExpr" name="prod-xquery11-IfExpr"></a><ins 
class="diff-chg">[76]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-IfExpr">IfExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"if" "(" <a href="#prod-xquery11-Expr">Expr</a> ")"
"then" <a href="#prod-xquery11-ExprSingle">ExprSingle</a> "else"
<a href="#prod-xquery11-ExprSingle">ExprSingle</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-TryCatchExpr" name="prod-xquery11-TryCatchExpr"></a>
 <del class="diff-old">[46]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[77]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-TryCatchExpr"><ins class="diff-chg">TryCatchExpr</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-TryClause"><ins class="diff-chg">TryClause</ins></a>
 <a href="#prod-xquery11-CatchClause"><ins class="diff-chg">CatchClause</ins></a>
 <ins class="diff-chg">+</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-TryClause" name="prod-xquery11-TryClause"></a><ins
 class="diff-chg">[78]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-TryClause"><ins class="diff-chg">TryClause</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"try" "{"</ins> <a 
href="#prod-xquery11-TryTargetExpr"><ins class="diff-chg">TryTargetExpr</ins></a>
 <ins class="diff-chg">"}"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-TryTargetExpr" 
name="prod-xquery11-TryTargetExpr"></a><ins class="diff-chg">[79]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-TryTargetExpr"><ins class="diff-chg">TryTargetExpr</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-Expr"><ins class="diff-chg">Expr</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CatchClause" name="prod-xquery11-CatchClause"></a><ins
 class="diff-chg">[80]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CatchClause"><ins class="diff-chg">CatchClause</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"catch"</ins> <a 
href="#prod-xquery11-CatchErrorList"><ins class="diff-chg">CatchErrorList</ins></a>
 <a href="#prod-xquery11-CatchVars"><ins class="diff-chg">CatchVars</ins></a>
 <ins class="diff-chg">? "{"</ins>
<a href="#prod-xquery11-Expr"><ins class="diff-chg">Expr</ins></a>
<ins class="diff-chg">"}"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CatchErrorList" 
name="prod-xquery11-CatchErrorList"></a><ins class="diff-chg">[81]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CatchErrorList"><ins class="diff-chg">CatchErrorList</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-NameTest"><ins class="diff-chg">NameTest</ins></a>
 <ins class="diff-chg">("|"</ins>
<a href="#prod-xquery11-NameTest"><ins class="diff-chg">NameTest</ins></a>
 <ins class="diff-chg">)*</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CatchVars" name="prod-xquery11-CatchVars"></a><ins
 class="diff-chg">[82]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CatchVars"><ins class="diff-chg">CatchVars</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"("</ins> <a 
href="#prod-xquery11-CatchErrorCode"><ins class="diff-chg">CatchErrorCode</ins></a>
 <ins class="diff-chg">(","</ins> <a 
href="#prod-xquery11-CatchErrorDesc"><ins class="diff-chg">CatchErrorDesc</ins></a>
 <ins class="diff-chg">(","</ins> <a href="#prod-xquery11-CatchErrorVal"><ins
 class="diff-chg">CatchErrorVal</ins></a> <ins class="diff-chg">)?)?
")"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CatchErrorCode" 
name="prod-xquery11-CatchErrorCode"></a><ins class="diff-chg">[83]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CatchErrorCode"><ins class="diff-chg">CatchErrorCode</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"$"</ins> <a 
href="#prod-xquery11-VarName"><ins class="diff-chg">VarName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CatchErrorDesc" 
name="prod-xquery11-CatchErrorDesc"></a><ins class="diff-chg">[84]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CatchErrorDesc"><ins class="diff-chg">CatchErrorDesc</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"$"</ins> <a 
href="#prod-xquery11-VarName"><ins class="diff-chg">VarName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CatchErrorVal" 
name="prod-xquery11-CatchErrorVal"></a><ins class="diff-chg">[85]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CatchErrorVal"><ins class="diff-chg">CatchErrorVal</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"$"</ins> <a 
href="#prod-xquery11-VarName"><ins class="diff-chg">VarName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-OrExpr" name="prod-xquery11-OrExpr"></a><ins 
class="diff-chg">[86]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-OrExpr">OrExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-AndExpr">AndExpr</a> ( "or"
<a href="#prod-xquery11-AndExpr">AndExpr</a> )*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-AndExpr" name="prod-xquery11-AndExpr"></a>
<del class="diff-old">[47]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[87]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-AndExpr">AndExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-ComparisonExpr">ComparisonExpr</a> ( 
"and" <a href="#prod-xquery11-ComparisonExpr">ComparisonExpr</a> )*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ComparisonExpr" 
name="prod-xquery11-ComparisonExpr"></a> <del class="diff-old">[48]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[88]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ComparisonExpr">ComparisonExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-RangeExpr">RangeExpr</a> ( (
<a href="#prod-xquery11-ValueComp">ValueComp</a><br>
| <a href="#prod-xquery11-GeneralComp">GeneralComp</a><br>
| <a href="#prod-xquery11-NodeComp">NodeComp</a> ) <a 
href="#prod-xquery11-RangeExpr">RangeExpr</a> )?</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-RangeExpr" name="prod-xquery11-RangeExpr"></a> <del
 class="diff-old">[49]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[89]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-RangeExpr">RangeExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-AdditiveExpr">AdditiveExpr</a> (
"to" <a href="#prod-xquery11-AdditiveExpr">AdditiveExpr</a>
)?</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-AdditiveExpr" name="prod-xquery11-AdditiveExpr"></a>
 <del class="diff-old">[50]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[90]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-AdditiveExpr">AdditiveExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-MultiplicativeExpr">MultiplicativeExpr</a>
 ( ("+" |
"-") <a href="#prod-xquery11-MultiplicativeExpr">MultiplicativeExpr</a>
)*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-MultiplicativeExpr" 
name="prod-xquery11-MultiplicativeExpr"></a> <del class="diff-old">[51]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[91]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-MultiplicativeExpr">MultiplicativeExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-UnionExpr">UnionExpr</a> ( ("*" |
"div" | "idiv" | "mod") <a href="#prod-xquery11-UnionExpr">UnionExpr</a>
 )*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-UnionExpr" name="prod-xquery11-UnionExpr"></a> <del
 class="diff-old">[52]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[92]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-UnionExpr">UnionExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-IntersectExceptExpr">IntersectExceptExpr</a>
 (
("union" | "|") <a href="#prod-xquery11-IntersectExceptExpr">IntersectExceptExpr</a>
)*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-IntersectExceptExpr" 
name="prod-xquery11-IntersectExceptExpr"></a> <del class="diff-old">[53]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[93]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-IntersectExceptExpr">IntersectExceptExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-InstanceofExpr">InstanceofExpr</a> ( 
("intersect" |
"except") <a href="#prod-xquery11-InstanceofExpr">InstanceofExpr</a> )*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-InstanceofExpr" 
name="prod-xquery11-InstanceofExpr"></a> <del class="diff-old">[54]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[94]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-InstanceofExpr">InstanceofExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-TreatExpr">TreatExpr</a> (
"instance" "of" <a href="#prod-xquery11-SequenceType">SequenceType</a> 
)?</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-TreatExpr" name="prod-xquery11-TreatExpr"></a> <del
 class="diff-old">[55]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[95]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-TreatExpr">TreatExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-CastableExpr">CastableExpr</a> (
"treat" "as" <a href="#prod-xquery11-SequenceType">SequenceType</a>
)?</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CastableExpr" name="prod-xquery11-CastableExpr"></a>
 <del class="diff-old">[56]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[96]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CastableExpr">CastableExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-CastExpr">CastExpr</a> (
"castable" "as" <a href="#prod-xquery11-SingleType">SingleType</a>
)?</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CastExpr" name="prod-xquery11-CastExpr"></a> <del
 class="diff-old">[57]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[97]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CastExpr">CastExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-UnaryExpr">UnaryExpr</a> ( "cast"
"as" <a href="#prod-xquery11-SingleType">SingleType</a>
)?</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-UnaryExpr" name="prod-xquery11-UnaryExpr"></a> <del
 class="diff-old">[58]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[98]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-UnaryExpr">UnaryExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>("-" | "+")* <a href="#prod-xquery11-ValueExpr">ValueExpr</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ValueExpr" name="prod-xquery11-ValueExpr"></a> <del
 class="diff-old">[59]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[99]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ValueExpr">ValueExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-ValidateExpr">ValidateExpr</a> |
<a href="#prod-xquery11-PathExpr">PathExpr</a> | <a 
href="#prod-xquery11-ExtensionExpr">ExtensionExpr</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-GeneralComp" name="prod-xquery11-GeneralComp"></a>
 <del class="diff-old">[60]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[100]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-GeneralComp">GeneralComp</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"=" | "!=" | "&lt;" | "&lt;=" | "&gt;" |
"&gt;="</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ValueComp" name="prod-xquery11-ValueComp"></a> <del
 class="diff-old">[61]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[101]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ValueComp">ValueComp</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"eq" | "ne" | "lt" | "le" | "gt" | "ge"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-NodeComp" name="prod-xquery11-NodeComp"></a> <del
 class="diff-old">[62]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[102]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-NodeComp">NodeComp</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"is" | "&lt;&lt;" | "&gt;&gt;"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ValidateExpr" name="prod-xquery11-ValidateExpr"></a>
 <del class="diff-old">[63]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[103]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ValidateExpr">ValidateExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"validate" <ins class="diff-chg">(</ins> <a 
href="#prod-xquery11-ValidationMode">ValidationMode</a> <del 
class="diff-old">?</del> <ins class="diff-chg">| ("type"</ins> <a 
href="#prod-xquery11-TypeName"><ins class="diff-chg">TypeName</ins></a>
<ins class="diff-chg">))?</ins> "{" <a href="#prod-xquery11-Expr">Expr</a>
 "}"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ValidationMode" 
name="prod-xquery11-ValidationMode"></a> <del class="diff-old">[64]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[104]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ValidationMode">ValidationMode</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"lax" | "strict"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ExtensionExpr" 
name="prod-xquery11-ExtensionExpr"></a> <del class="diff-old">[65]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[105]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ExtensionExpr">ExtensionExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-Pragma">Pragma</a> + "{" <a 
href="#prod-xquery11-Expr">Expr</a> ? "}"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-Pragma" name="prod-xquery11-Pragma"></a>
<del class="diff-old">[66]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[106]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-Pragma">Pragma</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"(#" <a href="#prod-xquery11-S">S</a> ? <del class="diff-old">QName</del>
 <a href="#prod-xquery11-EQName"><ins class="diff-chg">EQName</ins></a> (
 <a href="#prod-xquery11-S">S</a>
<a href="#prod-xquery11-PragmaContents">PragmaContents</a> )?
"#)"</code></td>
<td><i>/* <span><a href="http://www.w3.org/TR/xquery#ws-explicit">ws: 
explicit</a>
<sup><small><ins class="diff-new">XQ</ins></small></sup></span>
*/</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-PragmaContents" 
name="prod-xquery11-PragmaContents"></a> <del class="diff-old">[67]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[107]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-PragmaContents">PragmaContents</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>( <a href="#prod-xquery11-Char">Char</a> * - (Char* '#)'
Char*))</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-PathExpr" name="prod-xquery11-PathExpr"></a> <del
 class="diff-old">[68]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[108]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-PathExpr">PathExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>("/" <a href="#prod-xquery11-RelativePathExpr">RelativePathExpr</a>
 ?)<br>
| ("//" <a href="#prod-xquery11-RelativePathExpr">RelativePathExpr</a> )<br>
| <a href="#prod-xquery11-RelativePathExpr">RelativePathExpr</a></code></td>
<td><i>/* <del class="diff-old">xgs:</del> <span><a 
href="http://www.w3.org/TR/xquery#parse-note-leading-lone-slash"><ins 
class="diff-chg">
xgc:</ins> leading-lone-slash</a> <sup><small><ins class="diff-new">XQ</ins></small></sup></span>
 */</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-RelativePathExpr" 
name="prod-xquery11-RelativePathExpr"></a> <del class="diff-old">[69]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[109]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-RelativePathExpr">RelativePathExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-StepExpr">StepExpr</a> (("/" |
"//") <a href="#prod-xquery11-StepExpr">StepExpr</a> )*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-StepExpr" name="prod-xquery11-StepExpr"></a> <del
 class="diff-old">[70]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[110]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-StepExpr">StepExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">FilterExpr</del> <a 
href="#prod-xquery11-PostfixExpr"><ins class="diff-chg">PostfixExpr</ins></a>
 | <a href="#prod-xquery11-AxisStep">AxisStep</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-AxisStep" name="prod-xquery11-AxisStep"></a> <del
 class="diff-old">[71]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[111]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-AxisStep">AxisStep</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>( <a href="#prod-xquery11-ReverseStep">ReverseStep</a> |
<a href="#prod-xquery11-ForwardStep">ForwardStep</a> ) <a 
href="#prod-xquery11-PredicateList">PredicateList</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ForwardStep" name="prod-xquery11-ForwardStep"></a>
 <del class="diff-old">[72]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[112]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ForwardStep">ForwardStep</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>( <a href="#prod-xquery11-ForwardAxis">ForwardAxis</a>
<a href="#prod-xquery11-NodeTest">NodeTest</a> ) | <a 
href="#prod-xquery11-AbbrevForwardStep">AbbrevForwardStep</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ForwardAxis" name="prod-xquery11-ForwardAxis"></a>
 <del class="diff-old">[73]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[113]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ForwardAxis">ForwardAxis</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>("child" "::")<br>
| ("descendant" "::")<br>
| ("attribute" "::")<br>
| ("self" "::")<br>
| ("descendant-or-self" "::")<br>
| ("following-sibling" "::")<br>
| ("following" "::")</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-AbbrevForwardStep" 
name="prod-xquery11-AbbrevForwardStep"></a> <del class="diff-old">[74]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[114]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-AbbrevForwardStep">AbbrevForwardStep</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"@"? <a href="#prod-xquery11-NodeTest">NodeTest</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ReverseStep" name="prod-xquery11-ReverseStep"></a>
 <del class="diff-old">[75]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[115]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ReverseStep">ReverseStep</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>( <a href="#prod-xquery11-ReverseAxis">ReverseAxis</a>
<a href="#prod-xquery11-NodeTest">NodeTest</a> ) | <a 
href="#prod-xquery11-AbbrevReverseStep">AbbrevReverseStep</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ReverseAxis" name="prod-xquery11-ReverseAxis"></a>
 <del class="diff-old">[76]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[116]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ReverseAxis">ReverseAxis</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>("parent" "::")<br>
| ("ancestor" "::")<br>
| ("preceding-sibling" "::")<br>
| ("preceding" "::")<br>
| ("ancestor-or-self" "::")</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-AbbrevReverseStep" 
name="prod-xquery11-AbbrevReverseStep"></a> <del class="diff-old">[77]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[117]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-AbbrevReverseStep">AbbrevReverseStep</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>".."</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-NodeTest" name="prod-xquery11-NodeTest"></a> <del
 class="diff-old">[78]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[118]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-NodeTest">NodeTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-KindTest">KindTest</a> | <a 
href="#prod-xquery11-NameTest">NameTest</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-NameTest" name="prod-xquery11-NameTest"></a> <del
 class="diff-old">[79]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[119]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-NameTest">NameTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">QName</del> <a 
href="#prod-xquery11-EQName"><ins class="diff-chg">EQName</ins></a> |
<a href="#prod-xquery11-Wildcard">Wildcard</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-Wildcard" name="prod-xquery11-Wildcard"></a> <del
 class="diff-old">[80]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[120]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-Wildcard">Wildcard</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"*"<br>
| ( <a href="#prod-xquery11-NCName">NCName</a> ":" "*")<br>
| ("*" ":" <a href="#prod-xquery11-NCName">NCName</a> )</code></td>
<td><i>/* <span><a href="http://www.w3.org/TR/xquery#ws-explicit">ws: 
explicit</a>
<sup><small><ins class="diff-new">XQ</ins></small></sup></span>
*/</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-PostfixExpr" name="prod-xquery11-PostfixExpr"></a>
 <del class="diff-old">[81]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[121]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><del class="diff-old">FilterExpr</del> <a 
href="#doc-xquery11-PostfixExpr"><ins class="diff-chg">PostfixExpr</ins></a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-PrimaryExpr">PrimaryExpr</a>
<del class="diff-old">PredicateList</del> <ins class="diff-chg">(</ins> <a
 href="#prod-xquery11-Predicate"><ins class="diff-chg">Predicate</ins></a>
 <ins class="diff-chg">|</ins>
<a href="#prod-xquery11-ArgumentList"><ins class="diff-chg">ArgumentList</ins></a>
 <ins class="diff-chg">)*</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ArgumentList" name="prod-xquery11-ArgumentList"></a><ins
 class="diff-chg">[122]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ArgumentList"><ins class="diff-chg">ArgumentList</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">"(" (</ins> <a 
href="#prod-xquery11-Argument"><ins class="diff-new">Argument</ins></a>
<ins class="diff-new">(","</ins> <a href="#prod-xquery11-Argument"><ins 
class="diff-new">Argument</ins></a>
<ins class="diff-new">)*)? ")"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-PredicateList" 
name="prod-xquery11-PredicateList"></a> <del class="diff-old">[82]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[123]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-PredicateList">PredicateList</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-Predicate">Predicate</a>
*</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-Predicate" name="prod-xquery11-Predicate"></a> <del
 class="diff-old">[83]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[124]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-Predicate">Predicate</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"[" <a href="#prod-xquery11-Expr">Expr</a>
"]"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-PrimaryExpr" name="prod-xquery11-PrimaryExpr"></a>
 <del class="diff-old">[84]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[125]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-PrimaryExpr">PrimaryExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-Literal">Literal</a><br>
| <a href="#prod-xquery11-VarRef">VarRef</a><br>
| <a href="#prod-xquery11-ParenthesizedExpr">ParenthesizedExpr</a><br>
| <a href="#prod-xquery11-ContextItemExpr">ContextItemExpr</a><br>
| <a href="#prod-xquery11-FunctionCall">FunctionCall</a><br>
| <a href="#prod-xquery11-OrderedExpr">OrderedExpr</a><br>
| <a href="#prod-xquery11-UnorderedExpr">UnorderedExpr</a><br>
| <a href="#prod-xquery11-Constructor">Constructor</a><br>
<ins class="diff-new">|</ins> <a href="#prod-xquery11-FunctionItemExpr"><ins
 class="diff-new">FunctionItemExpr</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-Literal" name="prod-xquery11-Literal"></a>
<del class="diff-old">[85]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[126]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-Literal">Literal</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-NumericLiteral">NumericLiteral</a> | <a
 href="#prod-xquery11-StringLiteral">StringLiteral</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-NumericLiteral" 
name="prod-xquery11-NumericLiteral"></a> <del class="diff-old">[86]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[127]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-NumericLiteral">NumericLiteral</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-IntegerLiteral">IntegerLiteral</a> | <a
 href="#prod-xquery11-DecimalLiteral">DecimalLiteral</a> | <a 
href="#prod-xquery11-DoubleLiteral">DoubleLiteral</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-VarRef" name="prod-xquery11-VarRef"></a>
<del class="diff-old">[87]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[128]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-VarRef">VarRef</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"$" <a href="#prod-xquery11-VarName">VarName</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-VarName" name="prod-xquery11-VarName"></a>
<del class="diff-old">[88]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[129]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-VarName">VarName</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">QName</del> <a 
href="#prod-xquery11-EQName"><ins class="diff-chg">EQName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ParenthesizedExpr" 
name="prod-xquery11-ParenthesizedExpr"></a> <del class="diff-old">[89]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[130]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ParenthesizedExpr">ParenthesizedExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"(" <a href="#prod-xquery11-Expr">Expr</a> ?
")"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ContextItemExpr" 
name="prod-xquery11-ContextItemExpr"></a> <del class="diff-old">[90]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[131]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ContextItemExpr">ContextItemExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"."</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-OrderedExpr" name="prod-xquery11-OrderedExpr"></a>
 <del class="diff-old">[91]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[132]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-OrderedExpr">OrderedExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"ordered" "{" <a href="#prod-xquery11-Expr">Expr</a>
"}"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-UnorderedExpr" 
name="prod-xquery11-UnorderedExpr"></a> <del class="diff-old">[92]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[133]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-UnorderedExpr">UnorderedExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"unordered" "{" <a href="#prod-xquery11-Expr">Expr</a>
"}"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-FunctionCall" name="prod-xquery11-FunctionCall"></a>
 <del class="diff-old">[93]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[134]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-FunctionCall">FunctionCall</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">QName "(" ( ExprSingle</del>
<a href="#prod-xquery11-EQName"><ins class="diff-chg">EQName</ins></a> <del
 class="diff-old">(","
ExprSingle</del> <a href="#prod-xquery11-ArgumentList"><ins 
class="diff-chg">ArgumentList</ins></a> <del class="diff-old">)*)?
")"</del></code></td>
<td><i>/* <del class="diff-old">xgs:</del> <span><a 
href="http://www.w3.org/TR/xquery#parse-note-reserved-function-names"><ins
 class="diff-chg">
xgc:</ins> reserved-function-names</a> <sup><small><ins class="diff-new">XQ</ins></small></sup></span>
 */</i></td>
</tr>
<tr valign="baseline">
<td></td>
<td></td>
<td></td>
<td></td>
<td><i>/* <span><a href="http://www.w3.org/TR/xquery#parse-note-parens">gn:
 parens</a>
<sup><small><ins class="diff-new">XQ</ins></small></sup></span>
*/</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-Argument" name="prod-xquery11-Argument"></a> <del
 class="diff-old">[94]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[135]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-Argument"><ins class="diff-chg">Argument</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-ExprSingle"><ins class="diff-chg">ExprSingle</ins></a>
 <ins class="diff-chg">|</ins>
<a href="#prod-xquery11-ArgumentPlaceholder"><ins class="diff-chg">ArgumentPlaceholder</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ArgumentPlaceholder" 
name="prod-xquery11-ArgumentPlaceholder"></a><ins class="diff-chg">[136]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ArgumentPlaceholder"><ins 
class="diff-chg">ArgumentPlaceholder</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"?"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-Constructor" name="prod-xquery11-Constructor"></a><ins
 class="diff-chg">[137]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-Constructor">Constructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-DirectConstructor">DirectConstructor</a><br>
| <a href="#prod-xquery11-ComputedConstructor">ComputedConstructor</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-DirectConstructor" 
name="prod-xquery11-DirectConstructor"></a> <del class="diff-old">[95]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[138]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-DirectConstructor">DirectConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-DirElemConstructor">DirElemConstructor</a><br>
| <a href="#prod-xquery11-DirCommentConstructor">DirCommentConstructor</a><br>

| <a href="#prod-xquery11-DirPIConstructor">DirPIConstructor</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-DirElemConstructor" 
name="prod-xquery11-DirElemConstructor"></a> <del class="diff-old">[96]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[139]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-DirElemConstructor">DirElemConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"&lt;" <a href="#prod-xquery11-QName">QName</a> <a 
href="#prod-xquery11-DirAttributeList">DirAttributeList</a> ("/&gt;" |
("&gt;" <a href="#prod-xquery11-DirElemContent">DirElemContent</a>
* "&lt;/" <a href="#prod-xquery11-QName">QName</a> <a 
href="#prod-xquery11-S">S</a> ? "&gt;"))</code></td>
<td><i>/* <span><a href="http://www.w3.org/TR/xquery#ws-explicit">ws: 
explicit</a>
<sup><small><ins class="diff-new">XQ</ins></small></sup></span>
*/</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-DirAttributeList" 
name="prod-xquery11-DirAttributeList"></a> <del class="diff-old">[97]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[140]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-DirAttributeList">DirAttributeList</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>( <a href="#prod-xquery11-S">S</a> ( <a 
href="#prod-xquery11-QName">QName</a> <a href="#prod-xquery11-S">S</a> ?
"=" <a href="#prod-xquery11-S">S</a> ? <a 
href="#prod-xquery11-DirAttributeValue">DirAttributeValue</a>
)?)*</code></td>
<td><i>/* <span><a href="http://www.w3.org/TR/xquery#ws-explicit">ws: 
explicit</a>
<sup><small><ins class="diff-new">XQ</ins></small></sup></span>
*/</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-DirAttributeValue" 
name="prod-xquery11-DirAttributeValue"></a> <del class="diff-old">[98]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[141]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-DirAttributeValue">DirAttributeValue</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>('"' ( <a href="#prod-xquery11-EscapeQuot">EscapeQuot</a>
| <a href="#prod-xquery11-QuotAttrValueContent">QuotAttrValueContent</a>
 )*
'"')<br>
| ("'" ( <a href="#prod-xquery11-EscapeApos">EscapeApos</a> |
<a href="#prod-xquery11-AposAttrValueContent">AposAttrValueContent</a> 
)*
"'")</code></td>
<td><i>/* <span><a href="http://www.w3.org/TR/xquery#ws-explicit">ws: 
explicit</a>
<sup><small><ins class="diff-new">XQ</ins></small></sup></span>
*/</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-QuotAttrValueContent" 
name="prod-xquery11-QuotAttrValueContent"></a> <del class="diff-old">[99]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[142]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-QuotAttrValueContent">QuotAttrValueContent</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-QuotAttrContentChar">QuotAttrContentChar</a><br>
| <a href="#prod-xquery11-CommonContent">CommonContent</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-AposAttrValueContent" 
name="prod-xquery11-AposAttrValueContent"></a> <del class="diff-old">[100]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[143]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-AposAttrValueContent">AposAttrValueContent</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-AposAttrContentChar">AposAttrContentChar</a><br>
| <a href="#prod-xquery11-CommonContent">CommonContent</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-DirElemContent" 
name="prod-xquery11-DirElemContent"></a> <del class="diff-old">[101]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[144]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-DirElemContent">DirElemContent</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-DirectConstructor">DirectConstructor</a><br>
| <a href="#prod-xquery11-CDataSection">CDataSection</a><br>
| <a href="#prod-xquery11-CommonContent">CommonContent</a><br>
| <a href="#prod-xquery11-ElementContentChar">ElementContentChar</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CommonContent" 
name="prod-xquery11-CommonContent"></a> <del class="diff-old">[102]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[145]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CommonContent">CommonContent</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-PredefinedEntityRef">PredefinedEntityRef</a>
 |
<a href="#prod-xquery11-CharRef">CharRef</a> | "{{" | "}}" |
<a href="#prod-xquery11-EnclosedExpr">EnclosedExpr</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-DirCommentConstructor" 
name="prod-xquery11-DirCommentConstructor"></a> <del class="diff-old">[103]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[146]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-DirCommentConstructor">DirCommentConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"&lt;!--" <a href="#prod-xquery11-DirCommentContents">DirCommentContents</a>
"--&gt;"</code></td>
<td><i>/* <span><a href="http://www.w3.org/TR/xquery#ws-explicit">ws: 
explicit</a>
<sup><small><ins class="diff-new">XQ</ins></small></sup></span>
*/</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-DirCommentContents" 
name="prod-xquery11-DirCommentContents"></a> <del class="diff-old">[104]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[147]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-DirCommentContents">DirCommentContents</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>(( <a href="#prod-xquery11-Char">Char</a> - '-') | ('-' (
<a href="#prod-xquery11-Char">Char</a> - '-')))*</code></td>
<td><i>/* <span><a href="http://www.w3.org/TR/xquery#ws-explicit">ws: 
explicit</a>
<sup><small><ins class="diff-new">XQ</ins></small></sup></span>
*/</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-DirPIConstructor" 
name="prod-xquery11-DirPIConstructor"></a> <del class="diff-old">[105]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[148]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-DirPIConstructor">DirPIConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"&lt;?" <a href="#prod-xquery11-PITarget">PITarget</a> (
<a href="#prod-xquery11-S">S</a> <a href="#prod-xquery11-DirPIContents">DirPIContents</a>
 )?
"?&gt;"</code></td>
<td><i>/* <span><a href="http://www.w3.org/TR/xquery#ws-explicit">ws: 
explicit</a>
<sup><small><ins class="diff-new">XQ</ins></small></sup></span>
*/</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-DirPIContents" 
name="prod-xquery11-DirPIContents"></a> <del class="diff-old">[106]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[149]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-DirPIContents">DirPIContents</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>( <a href="#prod-xquery11-Char">Char</a> * - (Char*
'?&gt;' Char*))</code></td>
<td><i>/* <span><a href="http://www.w3.org/TR/xquery#ws-explicit">ws: 
explicit</a>
<sup><small><ins class="diff-new">XQ</ins></small></sup></span>
*/</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CDataSection" name="prod-xquery11-CDataSection"></a>
 <del class="diff-old">[107]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[150]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CDataSection">CDataSection</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"&lt;![CDATA[" <a href="#prod-xquery11-CDataSectionContents">CDataSectionContents</a>
"]]&gt;"</code></td>
<td><i>/* <span><a href="http://www.w3.org/TR/xquery#ws-explicit">ws: 
explicit</a>
<sup><small><ins class="diff-new">XQ</ins></small></sup></span>
*/</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CDataSectionContents" 
name="prod-xquery11-CDataSectionContents"></a> <del class="diff-old">[108]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[151]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CDataSectionContents">CDataSectionContents</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>( <a href="#prod-xquery11-Char">Char</a> * - (Char*
']]&gt;' Char*))</code></td>
<td><i>/* <span><a href="http://www.w3.org/TR/xquery#ws-explicit">ws: 
explicit</a>
<sup><small><ins class="diff-new">XQ</ins></small></sup></span>
*/</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ComputedConstructor" 
name="prod-xquery11-ComputedConstructor"></a> <del class="diff-old">[109]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[152]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ComputedConstructor">ComputedConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-CompDocConstructor">CompDocConstructor</a><br>
| <a href="#prod-xquery11-CompElemConstructor">CompElemConstructor</a><br>
| <a href="#prod-xquery11-CompAttrConstructor">CompAttrConstructor</a><br>
| <a href="#prod-xquery11-CompNamespaceConstructor"><ins 
class="diff-chg">CompNamespaceConstructor</ins></a><br>
<ins class="diff-chg">|</ins> <a 
href="#prod-xquery11-CompTextConstructor">CompTextConstructor</a><br>
| <a href="#prod-xquery11-CompCommentConstructor">CompCommentConstructor</a><br>

| <a href="#prod-xquery11-CompPIConstructor">CompPIConstructor</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CompDocConstructor" 
name="prod-xquery11-CompDocConstructor"></a> <del class="diff-old">[110]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[153]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CompDocConstructor">CompDocConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"document" "{" <a href="#prod-xquery11-Expr">Expr</a>
"}"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CompElemConstructor" 
name="prod-xquery11-CompElemConstructor"></a> <del class="diff-old">[111]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[154]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CompElemConstructor">CompElemConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"element" ( <del class="diff-old">QName</del> <a 
href="#prod-xquery11-EQName"><ins class="diff-chg">EQName</ins></a> |
("{" <a href="#prod-xquery11-Expr">Expr</a> "}")) "{" <a 
href="#prod-xquery11-ContentExpr">ContentExpr</a> ? "}"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ContentExpr" name="prod-xquery11-ContentExpr"></a>
 <del class="diff-old">[112]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[155]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ContentExpr">ContentExpr</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-Expr">Expr</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CompAttrConstructor" 
name="prod-xquery11-CompAttrConstructor"></a> <del class="diff-old">[113]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[156]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CompAttrConstructor">CompAttrConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"attribute" ( <del class="diff-old">QName</del> <a 
href="#prod-xquery11-EQName"><ins class="diff-chg">EQName</ins></a> |
("{" <a href="#prod-xquery11-Expr">Expr</a> "}")) "{" <a 
href="#prod-xquery11-Expr">Expr</a> ? "}"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CompNamespaceConstructor" 
name="prod-xquery11-CompNamespaceConstructor"></a> <del class="diff-old">[114]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[157]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CompNamespaceConstructor"><ins 
class="diff-chg">CompNamespaceConstructor</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"namespace" (</ins> <a 
href="#prod-xquery11-Prefix"><ins class="diff-chg">Prefix</ins></a>
<ins class="diff-chg">| ("{"</ins> <a href="#prod-xquery11-PrefixExpr"><ins
 class="diff-chg">PrefixExpr</ins></a> <ins class="diff-chg">"}"))
"{"</ins> <a href="#prod-xquery11-URIExpr"><ins class="diff-chg">URIExpr</ins></a>
 <ins class="diff-chg">?
"}"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-Prefix" name="prod-xquery11-Prefix"></a><ins 
class="diff-chg">[158]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">Prefix</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-NCName"><ins class="diff-chg">NCName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-PrefixExpr" name="prod-xquery11-PrefixExpr"></a><ins
 class="diff-chg">[159]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-PrefixExpr"><ins class="diff-chg">PrefixExpr</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-Expr"><ins class="diff-chg">Expr</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-URIExpr" name="prod-xquery11-URIExpr"></a><ins 
class="diff-chg">[160]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-URIExpr"><ins class="diff-chg">URIExpr</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-Expr"><ins class="diff-chg">Expr</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CompTextConstructor" 
name="prod-xquery11-CompTextConstructor"></a><ins class="diff-chg">[161]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CompTextConstructor">CompTextConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"text" "{" <a href="#prod-xquery11-Expr">Expr</a>
"}"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CompCommentConstructor" 
name="prod-xquery11-CompCommentConstructor"></a> <del class="diff-old">[115]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[162]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CompCommentConstructor">CompCommentConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"comment" "{" <a href="#prod-xquery11-Expr">Expr</a>
"}"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CompPIConstructor" 
name="prod-xquery11-CompPIConstructor"></a> <del class="diff-old">[116]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[163]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CompPIConstructor">CompPIConstructor</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"processing-instruction" ( <a href="#prod-xquery11-NCName">NCName</a>
 | ("{" <a href="#prod-xquery11-Expr">Expr</a> "}")) "{" <a 
href="#prod-xquery11-Expr">Expr</a> ? "}"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-FunctionItemExpr" 
name="prod-xquery11-FunctionItemExpr"></a> <del class="diff-old">[117]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[164]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-FunctionItemExpr"><ins class="diff-chg">FunctionItemExpr</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-LiteralFunctionItem"><ins 
class="diff-chg">LiteralFunctionItem</ins></a> <ins class="diff-chg">|</ins>
 <a href="#prod-xquery11-InlineFunction"><ins class="diff-chg">InlineFunction</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-LiteralFunctionItem" 
name="prod-xquery11-LiteralFunctionItem"></a><ins class="diff-chg">[165]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-LiteralFunctionItem"><ins 
class="diff-chg">LiteralFunctionItem</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-EQName"><ins class="diff-chg">EQName</ins></a>
 <ins class="diff-chg">"#"</ins>
<a href="#prod-xquery11-IntegerLiteral"><ins class="diff-chg">IntegerLiteral</ins></a></code></td>
<td><i><ins class="diff-chg">/*</ins> <span><a 
href="http://www.w3.org/TR/xquery#parse-note-reserved-function-names"><ins
 class="diff-chg">
xgc: reserved-function-names</ins></a> <sup><small><ins class="diff-chg">XQ</ins></small></sup></span>
 <ins class="diff-chg">*/</ins></i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-InlineFunction" 
name="prod-xquery11-InlineFunction"></a><ins class="diff-chg">[166]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-InlineFunction"><ins class="diff-chg">InlineFunction</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"function" "("</ins> <a 
href="#prod-xquery11-ParamList"><ins class="diff-chg">ParamList</ins></a>
 <ins class="diff-chg">? ")"
("as"</ins> <a href="#prod-xquery11-SequenceType"><ins class="diff-chg">SequenceType</ins></a>
 <ins class="diff-chg">)?</ins>
<a href="#prod-xquery11-EnclosedExpr"><ins class="diff-chg">EnclosedExpr</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-SingleType" name="prod-xquery11-SingleType"></a><ins
 class="diff-chg">[167]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-SingleType">SingleType</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-AtomicType">AtomicType</a>
"?"?</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-TypeDeclaration" 
name="prod-xquery11-TypeDeclaration"></a> <del class="diff-old">[118]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[168]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-TypeDeclaration">TypeDeclaration</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"as" <a href="#prod-xquery11-SequenceType">SequenceType</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-SequenceType" name="prod-xquery11-SequenceType"></a>
 <del class="diff-old">[119]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[169]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-SequenceType">SequenceType</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>("empty-sequence" "(" ")")<br>
| ( <a href="#prod-xquery11-ItemType">ItemType</a> <a 
href="#prod-xquery11-OccurrenceIndicator">OccurrenceIndicator</a>
?)</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-OccurrenceIndicator" 
name="prod-xquery11-OccurrenceIndicator"></a> <del class="diff-old">[120]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[170]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-OccurrenceIndicator">OccurrenceIndicator</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"?" | "*" | "+"</code></td>
<td><i>/* <del class="diff-old">xgs:</del> <span><a 
href="http://www.w3.org/TR/xquery#parse-note-occurrence-indicators"><ins
 class="diff-chg">
xgc:</ins> occurrence-indicators</a> <sup><small><ins class="diff-new">XQ</ins></small></sup></span>
 */</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ItemType" name="prod-xquery11-ItemType"></a> <del
 class="diff-old">[121]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[171]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ItemType">ItemType</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-KindTest">KindTest</a> | ("item"
"(" ")") | <a href="#prod-xquery11-FunctionTest"><ins class="diff-chg">FunctionTest</ins></a>
 <ins class="diff-chg">|</ins>
<a href="#prod-xquery11-AtomicType">AtomicType</a> <ins class="diff-new">|</ins>
 <a href="#prod-xquery11-ParenthesizedItemType"><ins class="diff-new">ParenthesizedItemType</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-AtomicType" name="prod-xquery11-AtomicType"></a>
 <del class="diff-old">[122]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[172]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-AtomicType">AtomicType</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">QName</del> <a 
href="#prod-xquery11-EQName"><ins class="diff-chg">EQName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-KindTest" name="prod-xquery11-KindTest"></a> <del
 class="diff-old">[123]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[173]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-KindTest">KindTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-DocumentTest">DocumentTest</a><br>
| <a href="#prod-xquery11-ElementTest">ElementTest</a><br>
| <a href="#prod-xquery11-AttributeTest">AttributeTest</a><br>
| <a href="#prod-xquery11-SchemaElementTest">SchemaElementTest</a><br>
| <a href="#prod-xquery11-SchemaAttributeTest">SchemaAttributeTest</a><br>
| <a href="#prod-xquery11-PITest">PITest</a><br>
| <a href="#prod-xquery11-CommentTest">CommentTest</a><br>
| <a href="#prod-xquery11-TextTest">TextTest</a><br>
| <a href="#prod-xquery11-NamespaceNodeTest"><ins class="diff-chg">NamespaceNodeTest</ins></a><br>
<ins class="diff-chg">|</ins> <a href="#prod-xquery11-AnyKindTest">AnyKindTest</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-AnyKindTest" name="prod-xquery11-AnyKindTest"></a>
 <del class="diff-old">[124]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[174]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-AnyKindTest">AnyKindTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"node" "(" ")"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-DocumentTest" name="prod-xquery11-DocumentTest"></a>
 <del class="diff-old">[125]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[175]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-DocumentTest">DocumentTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"document-node" "(" ( <a href="#prod-xquery11-ElementTest">ElementTest</a>
 | <a href="#prod-xquery11-SchemaElementTest">SchemaElementTest</a> )?
")"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-TextTest" name="prod-xquery11-TextTest"></a> <del
 class="diff-old">[126]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[176]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-TextTest">TextTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"text" "(" ")"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CommentTest" name="prod-xquery11-CommentTest"></a>
 <del class="diff-old">[127]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[177]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CommentTest">CommentTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"comment" "(" ")"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-NamespaceNodeTest" 
name="prod-xquery11-NamespaceNodeTest"></a> <del class="diff-old">[128]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[178]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-new">NamespaceNodeTest</ins></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"namespace-node" "("
")"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-PITest" name="prod-xquery11-PITest"></a><ins 
class="diff-chg">[179]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-PITest">PITest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"processing-instruction" "(" ( <a href="#prod-xquery11-NCName">NCName</a>
 | <a href="#prod-xquery11-StringLiteral">StringLiteral</a> )? ")"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-AttributeTest" 
name="prod-xquery11-AttributeTest"></a> <del class="diff-old">[129]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[180]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-AttributeTest">AttributeTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"attribute" "(" ( <a 
href="#prod-xquery11-AttribNameOrWildcard">AttribNameOrWildcard</a> (","
<a href="#prod-xquery11-TypeName">TypeName</a> )?)? ")"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-AttribNameOrWildcard" 
name="prod-xquery11-AttribNameOrWildcard"></a> <del class="diff-old">[130]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[181]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-AttribNameOrWildcard">AttribNameOrWildcard</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-AttributeName">AttributeName</a>
| "*"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-SchemaAttributeTest" 
name="prod-xquery11-SchemaAttributeTest"></a> <del class="diff-old">[131]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[182]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-SchemaAttributeTest">SchemaAttributeTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"schema-attribute" "(" <a 
href="#prod-xquery11-AttributeDeclaration">AttributeDeclaration</a>
")"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-AttributeDeclaration" 
name="prod-xquery11-AttributeDeclaration"></a> <del class="diff-old">[132]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[183]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-AttributeDeclaration">AttributeDeclaration</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-AttributeName">AttributeName</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ElementTest" name="prod-xquery11-ElementTest"></a>
 <del class="diff-old">[133]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[184]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ElementTest">ElementTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"element" "(" ( <a href="#prod-xquery11-ElementNameOrWildcard">ElementNameOrWildcard</a>
("," <a href="#prod-xquery11-TypeName">TypeName</a> "?"?)?)?
")"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ElementNameOrWildcard" 
name="prod-xquery11-ElementNameOrWildcard"></a> <del class="diff-old">[134]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[185]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ElementNameOrWildcard">ElementNameOrWildcard</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-ElementName">ElementName</a> |
"*"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-SchemaElementTest" 
name="prod-xquery11-SchemaElementTest"></a> <del class="diff-old">[135]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[186]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-SchemaElementTest">SchemaElementTest</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"schema-element" "(" <a 
href="#prod-xquery11-ElementDeclaration">ElementDeclaration</a>
")"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ElementDeclaration" 
name="prod-xquery11-ElementDeclaration"></a> <del class="diff-old">[136]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[187]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ElementDeclaration">ElementDeclaration</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-ElementName">ElementName</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-AttributeName" 
name="prod-xquery11-AttributeName"></a> <del class="diff-old">[137]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[188]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-AttributeName">AttributeName</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">QName</del> <a 
href="#prod-xquery11-EQName"><ins class="diff-chg">EQName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ElementName" name="prod-xquery11-ElementName"></a>
 <del class="diff-old">[138]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[189]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ElementName">ElementName</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">QName</del> <a 
href="#prod-xquery11-EQName"><ins class="diff-chg">EQName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-TypeName" name="prod-xquery11-TypeName"></a> <del
 class="diff-old">[139]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[190]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-TypeName">TypeName</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><del class="diff-old">QName</del> <a 
href="#prod-xquery11-EQName"><ins class="diff-chg">EQName</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-FunctionTest" name="prod-xquery11-FunctionTest"></a>
 <del class="diff-old">[140]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[191]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-FunctionTest"><ins class="diff-chg">FunctionTest</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-Annotation"><ins class="diff-chg">Annotation</ins></a>
 <ins class="diff-chg">* (</ins>
<a href="#prod-xquery11-AnyFunctionTest"><ins class="diff-chg">AnyFunctionTest</ins></a><br>
<ins class="diff-chg">|</ins> <a href="#prod-xquery11-TypedFunctionTest"><ins
 class="diff-chg">TypedFunctionTest</ins></a> <ins class="diff-chg">)</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-AnyFunctionTest" 
name="prod-xquery11-AnyFunctionTest"></a><ins class="diff-chg">[192]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-AnyFunctionTest"><ins class="diff-chg">AnyFunctionTest</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"function" "(" "*"
")"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-TypedFunctionTest" 
name="prod-xquery11-TypedFunctionTest"></a><ins class="diff-chg">[193]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-TypedFunctionTest"><ins 
class="diff-chg">TypedFunctionTest</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"function" "(" (</ins> <a 
href="#prod-xquery11-SequenceType"><ins class="diff-chg">SequenceType</ins></a>
 <ins class="diff-chg">(","</ins>
<a href="#prod-xquery11-SequenceType"><ins class="diff-chg">SequenceType</ins></a>
 <ins class="diff-chg">)*)? ")"
"as"</ins> <a href="#prod-xquery11-SequenceType"><ins class="diff-chg">SequenceType</ins></a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ParenthesizedItemType" 
name="prod-xquery11-ParenthesizedItemType"></a><ins class="diff-chg">[194]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ParenthesizedItemType"><ins 
class="diff-chg">ParenthesizedItemType</ins></a></code></td>
<td><ins class="diff-chg">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><ins class="diff-chg">"("</ins> <a 
href="#prod-xquery11-ItemType"><ins class="diff-chg">ItemType</ins></a>
<ins class="diff-chg">")"</ins></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-URILiteral" name="prod-xquery11-URILiteral"></a><ins
 class="diff-chg">[195]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-URILiteral">URILiteral</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-StringLiteral">StringLiteral</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-EQName" name="prod-xquery11-EQName"></a>
<ins class="diff-new">[196]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-EQName"><ins class="diff-new">EQName</ins></a></code></td>
<td><ins class="diff-new">&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#prod-xquery11-QName"><ins class="diff-new">QName</ins></a>
 <ins class="diff-new">| (</ins> <a href="#prod-xquery11-URILiteral"><ins
 class="diff-new">URILiteral</ins></a> <ins class="diff-new">":"</ins>
<a href="#prod-xquery11-NCName"><ins class="diff-new">NCName</ins></a> <ins
 class="diff-new">)</ins></code></td>
<td><i><ins class="diff-new">/*</ins> <span><a 
href="http://www.w3.org/TR/xquery#ws-explicit"><ins class="diff-new">ws:
explicit</ins></a> <sup><small><ins class="diff-new">XQ</ins></small></sup></span>
 <ins class="diff-new">*/</ins></i></td>
</tr>
</tbody>
</table>
<div class="div3">
<h4><a id="EBNFNotation" name="EBNFNotation"></a> A.1.1
Notation</h4>
<p>The following definitions will be helpful in defining precisely
this exposition.</p>
<p>[ <a title="symbol" id="symbol" name="symbol">Definition</a> :
Each rule in the grammar defines one <b>symbol</b> , using the
following format:</p>
<div class="exampleInner">
<pre>symbol ::= expression
</pre></div>
<p>]</p>
<p>[ <a title="terminal" id="terminal" name="terminal">Definition</a> : A
 <b>terminal</b> is a symbol or string
or pattern that can appear in the right-hand side of a rule, but
never appears on the left hand side in the main grammar, although
it may appear on the left-hand side of a rule in the grammar for
terminals.] The following constructs are used to match strings of
one or more characters in a terminal:</p>
<dl>
<dt class="label">[a-zA-Z]</dt>
<dd>
<p>matches any <a href="#prod-xquery11-Char">Char</a> with a value
in the range(s) indicated (inclusive).</p>
</dd>
<dt class="label">[abc]</dt>
<dd>
<p>matches any <a href="#prod-xquery11-Char">Char</a> with a value
among the characters enumerated. <span><ins class="diff-new">Enumerations
 and ranges can be mixed in one set of
brackets.</ins></span></p>
</dd>
<dt class="label">[^abc]</dt>
<dd>
<p>matches any <a href="#prod-xquery11-Char">Char</a> with a value
not among the characters given. <span><ins class="diff-new">Enumerations
 and ranges of forbidden values can be mixed
in one set of brackets.</ins></span></p>
</dd>
<dt class="label">"string"</dt>
<dd>
<p>matches the sequence of characters that appear inside the double
quotes.</p>
</dd>
<dt class="label">'string'</dt>
<dd>
<p>matches the sequence of characters that appear inside the single
quotes.</p>
</dd>
<dt class="label">
[http://www.w3.org/TR/REC-example/#NT-Example]</dt>
<dd>
<p>matches any string matched by the production defined in the
external specification as per the provided reference.</p>
</dd>
</dl>
<p>Patterns (including the above constructs) can be combined with
grammatical operators to form more complex patterns, matching more
complex sets of character strings. In the examples that follow, A
and B represent (sub-)patterns.</p>
<dl>
<dt class="label">(A)</dt>
<dd>
<p><code>A</code> is treated as a unit and may be combined as
described in this list.</p>
</dd>
<dt class="label">A?</dt>
<dd>
<p>matches <code>A</code> or nothing; optional <code>A</code> .</p>
</dd>
<dt class="label">A B</dt>
<dd>
<p>matches <code>A</code> followed by <code>B</code> . This
operator has higher precedence than alternation; thus <code>A B | C
D</code> is identical to <code>(A B) | (C D)</code> .</p>
</dd>
<dt class="label">A | B</dt>
<dd>
<p>matches <code>A</code> or <code>B</code> but not both.</p>
</dd>
<dt class="label">A - B</dt>
<dd>
<p>matches any string that matches <code>A</code> but does not
match <code>B</code> .</p>
</dd>
<dt class="label">A+</dt>
<dd>
<p>matches one or more occurrences of <code>A</code> .
Concatenation has higher precedence than alternation; thus <code>A+
| B+</code> is identical to <code>(A+) | (B+)</code> .</p>
</dd>
</dl>
<dl>
<dt class="label">A*</dt>
<dd>
<p>matches zero or more occurrences of <code>A</code> .
Concatenation has higher precedence than alternation; thus <code>A*
| B*</code> is identical to <code>(A*) | (B*)</code></p>
</dd>
</dl>
</div>
<div class="div3">
<h4><a id="extra-grammatical-constraints" 
name="extra-grammatical-constraints"></a> A.1.2 Extra-grammatical
Constraints</h4>
<p>This section contains constraints on the EBNF productions, which
are required to parse legal sentences. The notes below are
referenced from the right side of the production, with the
notation: <em>/* xgc: &lt;id&gt; */</em> .</p>
<div class="constraint">
<p class="prefix"><a id="parse-note-leading-lone-slash" 
name="parse-note-leading-lone-slash"></a> <b>Constraint:
leading-lone-slash</b></p>
<p>A single slash may appear either as a complete path expression
or as the first part of a path expression in which it is followed
by a <a href="#doc-xquery11-RelativePathExpr">RelativePathExpr
<del class="diff-old">, which can take</del></a> . <ins class="diff-chg">In
 some cases,</ins> the <del class="diff-old">form
of</del> <ins class="diff-chg">next token after the slash is
insufficient to allow</ins> a <ins class="diff-chg">parser to
distinguish these two possibilities: the</ins> <code><ins 
class="diff-chg">*</ins></code> <ins class="diff-chg">token and keywords
like</ins> <code><ins class="diff-chg">union</ins></code>
<ins class="diff-chg">could be either an operator or a</ins>
<a href="#doc-xquery11-NameTest">NameTest</a> <del class="diff-old">("*"</del>
 <span class="xquery">, <ins class="diff-chg">and the</ins> <code><ins 
class="diff-chg">&lt;</ins></code> <ins class="diff-chg">token could be
either an operator</ins> or <ins class="diff-new">the start
of</ins> a <del class="diff-old">QName). In contexts where
operators like "*", "union", etc., can occur, parsers may have
difficulty distinguishing operators from NameTests.</del> <a 
href="#doc-xquery11-DirectConstructor"><ins class="diff-chg">DirectConstructor</ins></a></span>
 <ins class="diff-chg">.</ins> For example, without lookahead the first 
part of
the expression <del class="diff-old">"/</del> <code><ins 
class="diff-chg">/</ins> * <del class="diff-old">5", for example</del>
<ins class="diff-chg">5</ins></code> is easily taken to be a
complete expression, <del class="diff-old">"/ *",</del>
<code><ins class="diff-chg">/ *</ins></code> , which has a very
different interpretation (the child nodes of <del class="diff-old">"/").</del>
 <code><ins class="diff-chg">/</ins></code>
<ins class="diff-chg">).</ins></p>
<p><del class="diff-old">To</del> <ins class="diff-chg">Therefore
to</ins> reduce the need for lookahead, <del class="diff-old">therefore,</del>
 if the token immediately following a
slash <del class="diff-old">is "*" or</del> <ins class="diff-chg">can 
form the start of</ins> a <del class="diff-old">keyword,</del> <a 
href="#doc-xquery11-RelativePathExpr"><ins class="diff-chg">RelativePathExpr</ins></a>
 , then the slash must be the
<del class="diff-old">beginning, but not the entirety,</del>
<ins class="diff-chg">beginning</ins> of a <a 
href="#doc-xquery11-PathExpr">PathExpr <del class="diff-old">(and the
following token must be a NameTest</del></a> , not <del class="diff-old">an
 operator).</del> <ins class="diff-chg">the entirety
of it.</ins></p>
<p>A single slash may be used as the left-hand argument of an
operator by parenthesizing it: <code>(/) * 5</code> . The
expression <code>5 * /</code> , on the other hand, is legal without
parentheses.</p>
</div>
<div class="constraint">
<p class="prefix"><a id="parse-note-xml-version" 
name="parse-note-xml-version"></a> <b>Constraint: xml-version</b></p>
<p>An implementation's choice to support the <a href="#XML">[XML
1.0]</a> and <a href="#XMLNAMES">[XML Names]</a> , or <a href="#XML1.1">[XML
 1.1]</a> and <a href="#XMLNAMES11">[XML Names
1.1]</a> lexical specification determines the external document
from which to obtain the definition for this production. The EBNF
only has references to the 1.0 versions. In some cases, the XML 1.0
and XML 1.1 definitions may be exactly the same. Also please note
that these external productions follow the whitespace rules of
their respective specifications, and not the rules of this
specification, in particular <a href="#DefaultWhitespaceHandling"><b>A.2.4.1
 Default Whitespace
Handling</b></a> . Thus <code>prefix : localname</code> is not a
valid <a title="lexical QName" href="#dt-qname"><ins class="diff-new">lexical</ins>
 QName</a> for purposes of this
specification, just as it is not permitted in a XML document. Also,
comments are not permissible on either side of the colon. Also
extra-grammatical constraints such as well-formedness constraints
must be taken into account.</p>
</div>
<div class="constraint">
<p class="prefix"><a id="parse-note-reserved-function-names" 
name="parse-note-reserved-function-names"></a> <b>Constraint:
reserved-function-names</b></p>
<p>Unprefixed function names spelled the same way as language
keywords could make the language harder to recognize. For instance,
<code>if(foo)</code> could be taken either as a <a 
href="#doc-xquery11-FunctionCall">FunctionCall</a> or as the beginning
of an <a href="#doc-xquery11-IfExpr">IfExpr</a> . <del class="diff-old">Therefore
 it is not legal syntax for a user to invoke
functions with</del> <ins class="diff-chg">Therefore, an</ins>
unprefixed <del class="diff-old">names which match</del>
<ins class="diff-chg">function name must not be</ins> any of the
names in <a href="#id-reserved-fn-names"><b>A.3 Reserved Function
Names</b></a> .</p>
<p>A function named "if" can be called by binding its namespace to
a prefix and using the prefixed form: "library:if(foo)" instead of
"if(foo)".</p>
</div>
<div class="constraint">
<p class="prefix"><a id="parse-note-occurrence-indicators" 
name="parse-note-occurrence-indicators"></a> <b>Constraint:
occurrence-indicators</b></p>
<p>As written, the grammar in <a href="#nt-bnf"><b>A XQuery
<ins class="diff-new">1.1</ins> Grammar</b></a> is ambiguous for
some forms using the '+' and '*' Kleene operators. The ambiguity is
resolved as follows: these operators are tightly bound to the
<a href="#doc-xquery11-SequenceType">SequenceType</a> expression,
and have higher precedence than other uses of these symbols. Any
occurrence of '+' and '*', as well as '?', following a sequence
type is assumed to be an occurrence <del class="diff-old">indicator. 
That is, a "+", "*", or "?" immediately
following an</del> <ins class="diff-chg">indicator, which binds to
the last</ins> <a href="#doc-xquery11-ItemType">ItemType</a>
<del class="diff-old">must be an OccurrenceIndicator</del>
<ins class="diff-chg">in the</ins> <a href="#doc-xquery11-SequenceType"><ins
 class="diff-chg">SequenceType</ins></a> .</p>
<p>Thus, <code>4 treat as item() + - 5</code> must be interpreted
as <code>(4 treat as item()+) - 5</code> , taking the '+' as an
OccurrenceIndicator and the '-' as a subtraction operator. To force
the interpretation of "+" as an addition operator (and the
corresponding interpretation of the "-" as a unary minus),
parentheses may be used: the form <code>(4 treat as item()) +
-5</code> surrounds the <a href="#doc-xquery11-SequenceType">SequenceType</a>
 expression with
parentheses and leads to the desired interpretation.</p>
<p><code><ins class="diff-new">function () as xs:string
*</ins></code> <ins class="diff-new">is interpreted as</ins>
<code><ins class="diff-new">function () as (xs:string
*)</ins></code> ,<ins class="diff-new">not as</ins>
<code><ins class="diff-new">(function () as xs:string)
*</ins></code> .<ins class="diff-new">Parentheses can be used as
shown to force the latter interpretation.</ins></p>
<p>This rule has as a consequence that certain forms which would
otherwise be legal and unambiguous are not recognized: in "4 treat
as item() + 5", the "+" is taken as an <a 
href="#doc-xquery11-OccurrenceIndicator">OccurrenceIndicator</a> , and
not as an operator, which means this is not a legal expression.</p>
</div>
</div>
<div class="div3">
<h4><a id="notes-on-parsing" name="notes-on-parsing"></a> A.1.3
Grammar Notes</h4>
<p>This section contains general notes on the EBNF productions,
which may be helpful in understanding how to interpret and
implement the EBNF. These notes are not normative. The notes below
are referenced from the right side of the production, with the
notation: <em>/* gn: &lt;id&gt; */</em> .</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<dl>
<dt class="label"><a id="parse-note-parens" name="parse-note-parens"></a>
 grammar-note: parens</dt>
<dd>
<p>Look-ahead is required to distinguish <a 
href="#doc-xquery11-FunctionCall">FunctionCall</a> from a <del 
class="diff-old">QName</del> <ins class="diff-chg">EQName</ins> or
keyword followed by a <span class="xquery"><a 
href="#doc-xquery11-Pragma">Pragma</a> or</span> <a 
href="#doc-xquery11-Comment">Comment</a> . For example: <code>address (:
this may be empty :)</code> may be mistaken for a call to a
function named "address" unless this lookahead is employed. Another
example is <code>for (: whom the bell :) $tolls in 3 return
$tolls</code> , where the keyword "for" must not be mistaken for a
function name.</p>
</dd>
<dt class="label"><a id="parse-note-comments" name="parse-note-comments"></a>
 grammar-note: comments</dt>
<dd>
<p>Comments are allowed everywhere that <a title="ignorable whitespace" 
href="#IgnorableWhitespace">ignorable
whitespace</a> is allowed, and the <a href="#doc-xquery11-Comment">Comment</a>
 symbol does not <del class="diff-old">explicity</del> <ins 
class="diff-chg">explicitly</ins>
appear on the right-hand side of the grammar (except in its own
production). See <a href="#DefaultWhitespaceHandling"><b>A.2.4.1
Default Whitespace Handling</b></a> . <span class="xquery">Note
that comments are not allowed in direct constructor content, though
they are allowed in nested <a href="#doc-xquery11-EnclosedExpr">EnclosedExprs</a>
 .</span></p>
<p>A comment can contain nested comments, as long as all "(:" and
":)" patterns are balanced, no matter where they occur within the
outer comment.</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>Lexical analysis may typically handle nested comments by
incrementing a counter for each "(:" pattern, and decrementing the
counter for each ":)" pattern. The comment does not terminate until
the counter is back to zero.</p>
</div>
<p>Some illustrative examples:</p>
<ul>
<li>
<p><code>(: commenting out a (: comment :) may be confusing, but
often helpful :)</code> is a legal Comment, since balanced nesting
of comments is allowed.</p>
</li>
<li>
<p><code>"this is just a string :)"</code> is a legal expression.
However, <code>(: "this is just a string :)" :)</code> will cause a
syntax error. Likewise, <code>"this is another string (:"</code> is
a legal expression, but <code>(: "this is another string (:"
:)</code> will cause a syntax error. It is a limitation of nested
comments that literal content can cause unbalanced nesting of
comments.</p>
</li>
<li>
<p><code>for (: set up loop :) $i in $x return $i</code> is
syntactically legal, ignoring the comment.</p>
</li>
<li>
<p><code>5 instance (: strange place for a comment :) of
xs:integer</code> is also syntactically legal.</p>
</li>
<li>
<p><code>&lt;eg (: an example:)&gt;{$i//title}&lt;/eg&gt;</code> is
not syntactically legal.</p>
</li>
<li>
<p><code>&lt;eg&gt; (: an example:) &lt;/eg&gt;</code> is
syntactically legal, but the characters that look like a comment
are in fact literal element content.</p>
</li>
</ul>
</dd>
</dl>
</div>
</div>
</div>
<div class="div2">
<h3><a id="lexical-structure" name="lexical-structure"></a> A.2
Lexical structure</h3>
<p>The terminal symbols assumed by the grammar above are described
in this section.</p>
<p>Quoted strings appearing in production rules are terminal
symbols.</p>
<p>Other terminal symbols are defined in <a href="#terminal-symbols"><b>A.2.1
 Terminal Symbols</b></a> .</p>
<p class="xquery">It is <a title="implementation defined" 
href="#dt-implementation-defined">implementation-defined</a> whether the
lexical rules of <a href="#XML">[XML 1.0]</a> and <a href="#XMLNAMES">[XML
 Names]</a> are followed, or alternatively, the
lexical rules of <a href="#XML1.1">[XML 1.1]</a> and <a 
href="#XMLNAMES11">[XML Names 1.1]</a> are followed. Implementations
that support the full <a href="#XML1.1">[XML 1.1]</a> character set
<a title="should" href="#should">SHOULD</a> , for purposes of
interoperability, provide a mode that follows only the <a href="#XML">[XML
 1.0]</a> and <a href="#XMLNAMES">[XML Names]</a>
lexical rules.</p>
<p>When tokenizing, the longest possible match that is valid in the
current context is used.</p>
<p>All keywords are case sensitive. Keywords are not reserved—that
is, any <a title="lexical QName" href="#dt-qname"><ins class="diff-new">lexical</ins>
 QName</a> may duplicate a keyword except
as noted in <a href="#id-reserved-fn-names"><b>A.3 Reserved
Function Names</b></a> .</p>
<div class="div3">
<h4><a id="terminal-symbols" name="terminal-symbols"></a> A.2.1
Terminal Symbols</h4>
<h5><a id="N18D33" name="N18D33"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-IntegerLiteral" 
name="prod-xquery11-IntegerLiteral"></a> <del class="diff-old">[141]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[197]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-IntegerLiteral">IntegerLiteral</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-Digits">Digits</a></code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-DecimalLiteral" 
name="prod-xquery11-DecimalLiteral"></a> <del class="diff-old">[142]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[198]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-DecimalLiteral">DecimalLiteral</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>("." <a href="#prod-xquery11-Digits">Digits</a> ) | (
<a href="#prod-xquery11-Digits">Digits</a> "." [0-9]*)</code></td>
<td><i>/* <span><a href="http://www.w3.org/TR/xquery#ws-explicit">ws: 
explicit</a>
<sup><small><ins class="diff-new">XQ</ins></small></sup></span>
*/</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-DoubleLiteral" 
name="prod-xquery11-DoubleLiteral"></a> <del class="diff-old">[143]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[199]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-DoubleLiteral">DoubleLiteral</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>(("." <a href="#prod-xquery11-Digits">Digits</a> ) | (
<a href="#prod-xquery11-Digits">Digits</a> ("." [0-9]*)?)) [eE]
[+-]? <a href="#prod-xquery11-Digits">Digits</a></code></td>
<td><i>/* <span><a href="http://www.w3.org/TR/xquery#ws-explicit">ws: 
explicit</a>
<sup><small><ins class="diff-new">XQ</ins></small></sup></span>
*/</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-StringLiteral" 
name="prod-xquery11-StringLiteral"></a> <del class="diff-old">[144]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[200]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-StringLiteral">StringLiteral</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>('"' ( <a href="#prod-xquery11-PredefinedEntityRef">PredefinedEntityRef</a>
 |
<a href="#prod-xquery11-CharRef">CharRef</a> | <a 
href="#prod-xquery11-EscapeQuot">EscapeQuot</a> | [^"&amp;])* '"') |
("'" ( <a href="#prod-xquery11-PredefinedEntityRef">PredefinedEntityRef</a>
 |
<a href="#prod-xquery11-CharRef">CharRef</a> | <a 
href="#prod-xquery11-EscapeApos">EscapeApos</a> | [^'&amp;])*
"'")</code></td>
<td><i>/* <span><a href="http://www.w3.org/TR/xquery#ws-explicit">ws: 
explicit</a>
<sup><small><ins class="diff-new">XQ</ins></small></sup></span>
*/</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-PredefinedEntityRef" 
name="prod-xquery11-PredefinedEntityRef"></a> <del class="diff-old">[145]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[201]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-PredefinedEntityRef">PredefinedEntityRef</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"&amp;" ("lt" | "gt" | "amp" | "quot" | "apos")
";"</code></td>
<td><i>/* <span><a href="http://www.w3.org/TR/xquery#ws-explicit">ws: 
explicit</a>
<sup><small><ins class="diff-new">XQ</ins></small></sup></span>
*/</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-EscapeQuot" name="prod-xquery11-EscapeQuot"></a>
 <del class="diff-old">[146]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[202]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-EscapeQuot">EscapeQuot</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>'""'</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-EscapeApos" name="prod-xquery11-EscapeApos"></a>
 <del class="diff-old">[147]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[203]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-EscapeApos">EscapeApos</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"''"</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-ElementContentChar" 
name="prod-xquery11-ElementContentChar"></a> <del class="diff-old">[148]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[204]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-ElementContentChar">ElementContentChar</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-Char">Char</a> -
[{}&lt;&amp;]</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-QuotAttrContentChar" 
name="prod-xquery11-QuotAttrContentChar"></a> <del class="diff-old">[149]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[205]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-QuotAttrContentChar">QuotAttrContentChar</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-Char">Char</a> -
["{}&lt;&amp;]</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-AposAttrContentChar" 
name="prod-xquery11-AposAttrContentChar"></a> <del class="diff-old">[150]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[206]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-AposAttrContentChar">AposAttrContentChar</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="#prod-xquery11-Char">Char</a> -
['{}&lt;&amp;]</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-Comment" name="prod-xquery11-Comment"></a>
<del class="diff-old">[151]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[207]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-Comment">Comment</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>"(:" ( <a href="#prod-xquery11-CommentContents">CommentContents</a>
 | <a href="#prod-xquery11-Comment">Comment</a> )* ":)"</code></td>
<td><i>/* <span><a href="http://www.w3.org/TR/xquery#ws-explicit">ws: 
explicit</a>
<sup><small><ins class="diff-new">XQ</ins></small></sup></span>
*/</i></td>
</tr>
<tr valign="baseline">
<td></td>
<td></td>
<td></td>
<td></td>
<td><i>/* <span><a 
href="http://www.w3.org/TR/xquery#parse-note-comments">gn: comments</a>
<sup><small><ins class="diff-new">XQ</ins></small></sup></span>
*/</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-PITarget" name="prod-xquery11-PITarget"></a> <del
 class="diff-old">[152]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[208]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code>PITarget</code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="http://www.w3.org/TR/REC-xml#NT-PITarget">[http://www.w3.org/TR/REC-xml#NT-PITarget]</a>
<sup><small>XML</small></sup></code></td>
<td><i>/* <del class="diff-old">xgs:</del> <span><a 
href="http://www.w3.org/TR/xquery#parse-note-xml-version"><ins 
class="diff-chg">xgc:</ins> xml-version</a> <sup><small><ins 
class="diff-new">XQ</ins></small></sup></span> */</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CharRef" name="prod-xquery11-CharRef"></a>
<del class="diff-old">[153]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[209]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code>CharRef</code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="http://www.w3.org/TR/REC-xml#NT-CharRef">[http://www.w3.org/TR/REC-xml#NT-CharRef]</a>
<sup><small>XML</small></sup></code></td>
<td><i>/* <del class="diff-old">xgs:</del> <span><a 
href="http://www.w3.org/TR/xquery#parse-note-xml-version"><ins 
class="diff-chg">xgc:</ins> xml-version</a> <sup><small><ins 
class="diff-new">XQ</ins></small></sup></span> */</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-QName" name="prod-xquery11-QName"></a>
<del class="diff-old">[154]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[210]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code>QName</code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="http://www.w3.org/TR/REC-xml-names/#NT-QName">[http://www.w3.org/TR/REC-xml-names/#NT-QName]</a>
<sup><small>Names</small></sup></code></td>
<td><i>/* <del class="diff-old">xgs:</del> <span><a 
href="http://www.w3.org/TR/xquery#parse-note-xml-version"><ins 
class="diff-chg">xgc:</ins> xml-version</a> <sup><small><ins 
class="diff-new">XQ</ins></small></sup></span> */</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-NCName" name="prod-xquery11-NCName"></a>
<del class="diff-old">[155]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[211]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code>NCName</code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="http://www.w3.org/TR/REC-xml-names/#NT-NCName">[http://www.w3.org/TR/REC-xml-names/#NT-NCName]</a>
<sup><small>Names</small></sup></code></td>
<td><i>/* <del class="diff-old">xgs:</del> <span><a 
href="http://www.w3.org/TR/xquery#parse-note-xml-version"><ins 
class="diff-chg">xgc:</ins> xml-version</a> <sup><small><ins 
class="diff-new">XQ</ins></small></sup></span> */</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-S" name="prod-xquery11-S"></a> <del 
class="diff-old">[156]&nbsp;&nbsp;&nbsp;</del> <ins class="diff-chg">[212]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code>S</code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="http://www.w3.org/TR/REC-xml#NT-S">[http://www.w3.org/TR/REC-xml#NT-S]</a>
<sup><small>XML</small></sup></code></td>
<td><i>/* <del class="diff-old">xgs:</del> <span><a 
href="http://www.w3.org/TR/xquery#parse-note-xml-version"><ins 
class="diff-chg">xgc:</ins> xml-version</a> <sup><small><ins 
class="diff-new">XQ</ins></small></sup></span> */</i></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-Char" name="prod-xquery11-Char"></a>
<del class="diff-old">[157]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[213]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code>Char</code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code><a href="http://www.w3.org/TR/REC-xml#NT-Char">[http://www.w3.org/TR/REC-xml#NT-Char]</a>
<sup><small>XML</small></sup></code></td>
<td><i>/* <del class="diff-old">xgs:</del> <span><a 
href="http://www.w3.org/TR/xquery#parse-note-xml-version"><ins 
class="diff-chg">xgc:</ins> xml-version</a> <sup><small><ins 
class="diff-new">XQ</ins></small></sup></span> */</i></td>
</tr>
</tbody>
</table>
<p>The following symbols are used only in the definition of
terminal symbols; they are not terminal symbols in the grammar of
<a href="#id-grammar"><b>A.1 EBNF</b></a> .</p>
<h5><a id="N18EBA" name="N18EBA"></a></h5>
<table summary="Scrap" class="scrap">
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-Digits" name="prod-xquery11-Digits"></a>
<del class="diff-old">[158]&nbsp;&nbsp;&nbsp;</del> <ins 
class="diff-chg">[214]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-Digits">Digits</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>[0-9]+</code></td>
</tr>
</tbody>
<tbody>
<tr valign="baseline">
<td><a id="prod-xquery11-CommentContents" 
name="prod-xquery11-CommentContents"></a> <del class="diff-old">[159]&nbsp;&nbsp;&nbsp;</del>
 <ins class="diff-chg">[215]&nbsp;&nbsp;&nbsp;</ins></td>
<td><code><a href="#doc-xquery11-CommentContents">CommentContents</a></code></td>
<td>&nbsp;&nbsp;&nbsp;::=&nbsp;&nbsp;&nbsp;</td>
<td><code>( <a href="#prod-xquery11-Char">Char</a> + - (Char* ('(:'
| ':)') Char*))</code></td>
</tr>
</tbody>
</table>
</div>
<div class="div3">
<h4><a id="id-terminal-delimitation" name="id-terminal-delimitation"></a>
 A.2.2 Terminal Delimitation</h4>
<p>XQuery <del class="diff-old">1.0</del> <ins class="diff-chg">1.1</ins>
 expressions consist of <a href="#terminal-symbols">terminal symbols</a>
 and <a title="symbol separators" href="#symbolseparators">symbol 
separators</a>
.</p>
<p>Terminal symbols that are not used exclusively in <a 
href="#ws-explicit">/* ws: explicit */</a> productions are of two kinds:
delimiting and non-delimiting.</p>
<p>[ <a title="delimiting terminal symbol" id="delimiting-token" 
name="delimiting-token">Definition</a> : The <b>delimiting terminal
symbols</b> are: <a href="#prod-xquery11-S">S</a> , "-", (comma),
(semi-colon), (colon), "::", ":=", "!=", "?", "?&gt;", "/", "//",
"/&gt;", (dot), "..", <a href="#prod-xquery11-StringLiteral">StringLiteral</a>
 , "(", "(#", ")",
"[", "]", "]]&gt;", "{", "}", "@", "$", "*", <ins class="diff-new">"#",</ins>
 "#)", <ins class="diff-new">"%",</ins> "+",
"&lt;", "&lt;!--", "&lt;![CDATA[", "&lt;?", "&lt;/", "&lt;&lt;",
"&lt;=", "=", "&gt;", "--&gt;", "&gt;=", "&gt;&gt;", "|"]</p>
<p>[ <a title="non-delimiting terminal symbol" id="non-delimiting-token"
 name="non-delimiting-token">Definition</a> :
The <b>non-delimiting terminal symbols</b> are: <a 
href="#prod-xquery11-IntegerLiteral">IntegerLiteral</a> , <a 
href="#prod-xquery11-NCName">NCName</a> , <a href="#prod-xquery11-QName">QName</a>
 , <a href="#prod-xquery11-DecimalLiteral">DecimalLiteral</a> , <a 
href="#prod-xquery11-DoubleLiteral">DoubleLiteral</a> , <ins 
class="diff-new">"allowing",</ins> "ancestor", "ancestor-or-self", 
"and",
"as", "ascending", "at", "attribute", "base-uri", "boundary-space",
"by", "case", "cast", "castable", <ins class="diff-new">"catch",</ins> 
"child", "collation", "comment",
"construction", <ins class="diff-new">"context",</ins>
"copy-namespaces", <ins class="diff-new">"count", "decimal-format",
"decimal-separator",</ins> "declare", "default", "descendant",
"descendant-or-self", "descending", <ins class="diff-new">"digit",</ins>
 "div", "document", "document-node",
"element", "else", "empty", "empty-sequence", "encoding",
<ins class="diff-new">"end",</ins> "eq", "every", "except",
"external", "following", "following-sibling", "for", "function",
"ge", "greatest", <ins class="diff-new">"group",
"grouping-separator",</ins> "gt", "idiv", "if", "import", "in",
<ins class="diff-new">"infinity",</ins> "inherit", "instance",
"intersect", "is", "item", "lax", "le", "least", "let", "lt",
<ins class="diff-new">"minus-sign",</ins> "mod", "module",
"namespace", <ins class="diff-new">"namespace-node", "NaN",</ins>
"ne", <ins class="diff-new">"next",</ins> "node", "no-inherit",
"no-preserve", "of", <ins class="diff-new">"only",</ins> "option",
"or", "order", "ordered", "ordering", "parent", <ins class="diff-new">"pattern-separator",
 "percent", "per-mille",</ins>
"preceding", "preceding-sibling", "preserve", <ins class="diff-new">"previous",</ins>
 "processing-instruction", "return",
"satisfies", "schema", "schema-attribute", "schema-element",
"self", <ins class="diff-new">"sliding",</ins> "some", "stable",
<ins class="diff-new">"start",</ins> "strict", "strip", <ins 
class="diff-new">"switch",</ins> "text", "then", "to", "treat",
<ins class="diff-new">"try", "tumbling", "type",</ins>
"typeswitch", "union", "unordered", "validate", "variable",
"version", <ins class="diff-new">"when",</ins> "where", <del 
class="diff-old">"xquery"]</del> <ins class="diff-chg">"window",
"xquery", "zero-digit"]</ins></p>
<p>[ <a title="symbol separators" id="symbolseparators" 
name="symbolseparators">Definition</a> : <a title="whitespace" 
href="#Whitespace">Whitespace</a> and <a href="#doc-xquery11-Comment">Comments</a>
 function as <b>symbol
separators</b> . For the most part, they are not mentioned in the
grammar, and may occur between any two terminal symbols mentioned
in the grammar, except where that is forbidden by the <a 
href="#ws-explicit">/* ws: explicit */</a> annotation in the EBNF, or by
the <a href="#parse-note-xml-version">/* <del class="diff-old">xgs:</del>
 <ins class="diff-chg">xgc:</ins> xml-version
*/</a> <del class="diff-old">annotation. ]</del> <ins class="diff-chg">annotation.]</ins></p>
<p>It is customary to separate consecutive terminal symbols by
<a title="whitespace" href="#Whitespace">whitespace</a> and
<a href="#doc-xquery11-Comment">Comments</a> , but this is required
only when otherwise two non-delimiting symbols would be adjacent to
each other. There are two exceptions to this, that of "." and "-",
which do require a <a title="symbol separators" href="#symbolseparators">symbol
 separator</a> if they follow a QName or
NCName. Also, "." requires a separator if it precedes or follows a
numeric literal.</p>
</div>
<div class="div3">
<h4><a id="id-eol-handling" name="id-eol-handling"></a> A.2.3
End-of-Line Handling</h4>
<p>The XQuery <ins class="diff-new">1.1</ins> processor must behave
as if it normalized all line breaks on input, before parsing. The
normalization should be done according to the choice to support
either <a href="#XML">[XML 1.0]</a> or <a href="#XML1.1">[XML
1.1]</a> lexical processing.</p>
<div class="div4">
<h5><a id="id-xml10-eol-handling" name="id-xml10-eol-handling"></a>
A.2.3.1 XML 1.0 End-of-Line Handling</h5>
<p>For <a href="#XML">[XML 1.0]</a> processing, all of the
following must be translated to a single #xA character:</p>
<ol class="enumar">
<li>
<p>the two-character sequence #xD #xA</p>
</li>
<li>
<p>any #xD character that is not immediately followed by #xA.</p>
</li>
</ol>
</div>
<div class="div4">
<h5><a id="id-xml11-eol-handling" name="id-xml11-eol-handling"></a>
A.2.3.2 XML 1.1 End-of-Line Handling</h5>
<p>For <a href="#XML1.1">[XML 1.1]</a> processing, all of the
following must be translated to a single #xA character:</p>
<ol class="enumar">
<li>
<p>the two-character sequence #xD #xA</p>
</li>
<li>
<p>the two-character sequence #xD #x85</p>
</li>
<li>
<p>the single character #x85</p>
</li>
<li>
<p>the single character #x2028</p>
</li>
<li>
<p>any #xD character that is not immediately followed by #xA or
#x85.</p>
</li>
</ol>
<p class="xquery">The characters #x85 and #x2028 cannot be reliably
recognized and translated until the <a href="#doc-xquery11-VersionDecl">VersionDecl</a>
 declaration (if
present) has been read.</p>
</div>
</div>
<div class="div3">
<h4><a id="whitespace-rules" name="whitespace-rules"></a> A.2.4
Whitespace Rules</h4>
<div class="div4">
<h5><a id="DefaultWhitespaceHandling" name="DefaultWhitespaceHandling"></a>
 A.2.4.1 Default Whitespace
Handling</h5>
<p>[ <a title="whitespace" id="Whitespace" name="Whitespace">Definition</a>
 : A <b>whitespace</b> character is any
of the characters defined by <a href="http://www.w3.org/TR/REC-xml#NT-S">[http://www.w3.org/TR/REC-xml#NT-S]</a>
.]</p>
<p>[ <a title="ignorable whitespace" id="IgnorableWhitespace" 
name="IgnorableWhitespace">Definition</a> : <b>Ignorable whitespace</b>
consists of any <a title="whitespace" href="#Whitespace">whitespace</a> 
characters that may occur between
<a title="terminal" href="#terminal">terminals</a> , unless these
characters occur in the context of a production marked with a
<a href="#ExplicitWhitespaceHandling">ws:explicit</a> annotation,
in which case they can occur only where explicitly specified (see
<a href="#ExplicitWhitespaceHandling"><b>A.2.4.2 Explicit
Whitespace Handling</b></a> ).] Ignorable whitespace characters are
not significant to the semantics of an expression. Whitespace is
allowed before the first terminal and after the last terminal of a
module. Whitespace is allowed between any two <a title="terminal" 
href="#terminal">terminals</a> . <a href="#doc-xquery11-Comment">Comments</a>
 may also act as "whitespace"
to prevent two adjacent terminals from being recognized as one.
Some illustrative examples are as follows:</p>
<ul>
<li>
<p><code>foo- foo</code> results in a syntax error. "foo-" would be
recognized as a QName.</p>
</li>
<li>
<p><code>foo -foo</code> is syntactically equivalent to <code>foo -
foo</code> , two QNames separated by a subtraction operator.</p>
</li>
<li>
<p><code>foo(: This is a comment :)- foo</code> is syntactically
equivalent to <code>foo - foo</code> . This is because the comment
prevents the two adjacent terminals from being recognized as
one.</p>
</li>
<li>
<p><code>foo-foo</code> is syntactically equivalent to single
QName. This is because "-" is a valid character in a QName. When
used as an operator after the characters of a name, the "-" must be
separated from the name, e.g. by using whitespace or
parentheses.</p>
</li>
<li>
<p><code>10div 3</code> results in a syntax error.</p>
</li>
<li>
<p><code>10 div3</code> also results in a syntax error.</p>
</li>
<li>
<p><code>10div3</code> also results in a syntax error.</p>
</li>
</ul>
</div>
<div class="div4">
<h5><a id="ExplicitWhitespaceHandling" name="ExplicitWhitespaceHandling"></a>
 A.2.4.2 Explicit Whitespace
Handling</h5>
<p>Explicit whitespace notation is specified with the EBNF
productions, when it is different from the default rules, using the
notation shown below. This notation is not inherited. In other
words, if an EBNF rule is marked as /* ws: explicit */, the
notation does not automatically apply to all the 'child' EBNF
productions of that rule.</p>
<dl>
<dt class="label"><a id="ws-explicit" name="ws-explicit"></a> ws:
explicit</dt>
<dd>
<p>/* ws: explicit */ means that the EBNF notation explicitly
notates, with <code>S</code> or otherwise, where <a title="whitespace" 
href="#Whitespace">whitespace characters</a> are
allowed. In productions with the /* ws: explicit */ annotation,
<a href="#DefaultWhitespaceHandling"><b>A.2.4.1 Default Whitespace
Handling</b></a> does not apply. <a href="#doc-xquery11-Comment">Comments</a>
 are also not allowed in these
productions.</p>
</dd>
</dl>
<p id="ws-explicit-lex-states" class="xquery">For example,
whitespace is not freely allowed by the direct constructor
productions, but is specified explicitly in the grammar, in order
to be more consistent with XML.</p>
</div>
</div>
</div>
<div class="div2">
<h3><a id="id-reserved-fn-names" name="id-reserved-fn-names"></a>
A.3 Reserved Function Names</h3>
<p>The following names are not allowed as function names in an
unprefixed form because expression syntax takes precedence.</p>
<ul>
<li>
<p><code>attribute</code></p>
</li>
<li>
<p><code>comment</code></p>
</li>
<li>
<p><code>document-node</code></p>
</li>
<li>
<p><code>element</code></p>
</li>
<li>
<p><code>empty-sequence</code></p>
</li>
<li>
<p><code><ins class="diff-new">function</ins></code></p>
</li>
<li>
<p><code>if</code></p>
</li>
<li>
<p><code>item</code></p>
</li>
<li>
<p><code><ins class="diff-new">namespace-node</ins></code></p>
</li>
<li>
<p><code>node</code></p>
</li>
<li>
<p><code>processing-instruction</code></p>
</li>
<li>
<p><code>schema-attribute</code></p>
</li>
<li>
<p><code>schema-element</code></p>
</li>
<li>
<p><code><ins class="diff-new">switch</ins></code></p>
</li>
<li>
<p><code>text</code></p>
</li>
<li>
<p><code>typeswitch</code></p>
</li>
</ul>
</div>
<div class="div2">
<h3><a id="id-precedence-order" name="id-precedence-order"></a> A.4
Precedence Order <ins class="diff-new">(Non-Normative)</ins></h3>
<p>The grammar in <a href="#id-grammar"><b>A.1 EBNF</b></a>
normatively defines built-in precedence among the operators of
XQuery. These operators are summarized here to make clear the order
of their precedence from lowest to highest. <del class="diff-old">Operators
 that have a lower precedence number cannot be
contained by operators with a higher precedence number.</del> The
associativity column indicates the order in which operators of
equal precedence in an expression are applied.</p>
<table border="1">
<tbody>
<tr>
<th colspan="1">#</th>
<th colspan="1">Operator</th>
<th colspan="1">Associativity</th>
</tr>
<tr>
<td>1</td>
<td>, (comma)</td>
<td><del class="diff-old">left-to-right 2 := (assignment)
right-to-left</del> <ins class="diff-chg">either</ins></td>
</tr>
<tr>
<td><del class="diff-old">3</del> <ins class="diff-chg">2</ins></td>
<td><span class="xquery"><del class="diff-old">for</del> <a 
href="#doc-xquery11-FLWORExpr"><ins class="diff-chg">FLWOR</ins></a>
,</span> <a href="#doc-xquery11-QuantifiedExpr">some, every</a> ,
<span class="xquery"><a href="#doc-xquery11-SwitchExpr"><ins 
class="diff-new">switch</ins></a> ,</span> <span class="xquery"><a 
href="#doc-xquery11-TypeswitchExpr">typeswitch</a> ,</span> <span 
class="xquery"><a href="#doc-xquery11-TryCatchExpr"><ins 
class="diff-new">try</ins></a> ,</span> <a href="#doc-xquery11-IfExpr">if</a></td>
<td><del class="diff-old">left-to-right</del> <ins class="diff-chg">NA</ins></td>
</tr>
<tr>
<td><del class="diff-old">4</del> <ins class="diff-chg">3</ins></td>
<td><a href="#doc-xquery11-OrExpr">or</a></td>
<td><del class="diff-old">left-to-right</del> <ins class="diff-chg">either</ins></td>
</tr>
<tr>
<td><del class="diff-old">5</del> <ins class="diff-chg">4</ins></td>
<td><a href="#doc-xquery11-AndExpr">and</a></td>
<td><del class="diff-old">left-to-right</del> <ins class="diff-chg">either</ins></td>
</tr>
<tr>
<td><del class="diff-old">6</del> <ins class="diff-chg">5</ins></td>
<td><a href="#doc-xquery11-ValueComp">eq, ne, lt, le, gt, ge</a> ,
<a href="#doc-xquery11-GeneralComp">=, !=, &lt;, &lt;=, &gt;,
&gt;=</a> , <del class="diff-old">is ,</del> <a 
href="#doc-xquery11-NodeComp"><ins class="diff-chg">is,</ins> &lt;&lt;,
&gt;&gt;</a></td>
<td><del class="diff-old">left-to-right</del> <ins class="diff-chg">NA</ins></td>
</tr>
<tr>
<td><del class="diff-old">7</del> <ins class="diff-chg">6</ins></td>
<td><a href="#doc-xquery11-RangeExpr">to</a></td>
<td><del class="diff-old">left-to-right</del> <ins class="diff-chg">NA</ins></td>
</tr>
<tr>
<td><del class="diff-old">8</del> <ins class="diff-chg">7</ins></td>
<td><a href="#doc-xquery11-AdditiveExpr">+, - <ins class="diff-new">(binary)</ins></a></td>
<td>left-to-right</td>
</tr>
<tr>
<td><del class="diff-old">9</del> <ins class="diff-chg">8</ins></td>
<td><a href="#doc-xquery11-MultiplicativeExpr">*, div, idiv,
mod</a></td>
<td>left-to-right</td>
</tr>
<tr>
<td><del class="diff-old">10</del> <ins class="diff-chg">9</ins></td>
<td><a href="#doc-xquery11-UnionExpr">union, |</a></td>
<td><del class="diff-old">left-to-right</del> <ins class="diff-chg">either</ins></td>
</tr>
<tr>
<td><del class="diff-old">11</del> <ins class="diff-chg">10</ins></td>
<td><a href="#doc-xquery11-IntersectExceptExpr">intersect,
except</a></td>
<td>left-to-right</td>
</tr>
<tr>
<td><del class="diff-old">12</del> <ins class="diff-chg">11</ins></td>
<td><a href="#doc-xquery11-InstanceofExpr">instance of</a></td>
<td><del class="diff-old">left-to-right</del> <ins class="diff-chg">NA</ins></td>
</tr>
<tr>
<td><del class="diff-old">13</del> <ins class="diff-chg">12</ins></td>
<td><a href="#doc-xquery11-TreatExpr">treat <ins class="diff-new">as</ins></a></td>
<td><del class="diff-old">left-to-right</del> <ins class="diff-chg">NA</ins></td>
</tr>
<tr>
<td><del class="diff-old">14</del> <ins class="diff-chg">13</ins></td>
<td><a href="#doc-xquery11-CastableExpr">castable <ins class="diff-new">as</ins></a></td>
<td><del class="diff-old">left-to-right</del> <ins class="diff-chg">NA</ins></td>
</tr>
<tr>
<td><del class="diff-old">15</del> <ins class="diff-chg">14</ins></td>
<td><a href="#doc-xquery11-CastExpr">cast <ins class="diff-new">as</ins></a></td>
<td><del class="diff-old">left-to-right</del> <ins class="diff-chg">NA</ins></td>
</tr>
<tr>
<td><del class="diff-old">16</del> <ins class="diff-chg">15</ins></td>
<td><del class="diff-old">-(unary), +(unary)</del> <a 
href="#doc-xquery11-UnaryExpr"><ins class="diff-chg">-, +
(unary)</ins></a></td>
<td>right-to-left</td>
</tr>
<tr>
<td><del class="diff-old">17 ?, *(OccurrenceIndicator),
+(OccurrenceIndicator) left-to-right 18</del> <ins class="diff-chg">16</ins></td>
<td><a href="#doc-xquery11-PathExpr">/, //</a></td>
<td>left-to-right</td>
</tr>
<tr>
<td><del class="diff-old">19</del> <ins class="diff-chg">17</ins></td>
<td><a href="#doc-xquery11-Predicate">[ ] <del class="diff-old">, (
) , {}</del></a></td>
<td>left-to-right</td>
</tr>
</tbody>
</table>
<p><ins class="diff-new">In the "Associativity" column, "either"
indicates that all the operators at that level have the associative
property (i.e.,</ins> <code><ins class="diff-new">(A op B) op
C</ins></code> <ins class="diff-new">is equivalent to</ins>
<code><ins class="diff-new">A op (B op C)</ins></code> <ins 
class="diff-new">), so their associativity is inconsequential. "NA" (not
applicable) indicates that the EBNF does not allow an expression
that directly contains multiple operators from that precedence
level, so the question of their associativity does not
arise.</ins></p>
<div class="note">
<p class="prefix"><b><ins class="diff-new">Note:</ins></b></p>
<p><ins class="diff-new">Parentheses can be used to override the
operator precedence in the usual way. Square brackets in an
expression such as A[B] serve two roles: they act as an operator
causing B to be evaluated once for each item in the value of A, and
they act as parentheses enclosing the expression B.</ins></p>
<p class="xquery"><ins class="diff-new">Curly braces in an
expression such as validate{E} or ordered{E} perform a similar
bracketing role to the parentheses in a function call, but with the
difference in most cases that E is an Expr rather than ExprSingle,
meaning that it can use the comma operator.</ins></p>
</div>
</div>
</div>
<div class="div1">
<h2><a id="id-type-promotion-and-operator-mapping" 
name="id-type-promotion-and-operator-mapping"></a> B Type Promotion and
Operator Mapping</h2>
<div class="div2">
<h3><a id="promotion" name="promotion"></a> B.1 Type Promotion</h3>
<p>[ <a title="type promotion" id="dt-type-promotion" 
name="dt-type-promotion">Definition</a> : Under certain circumstances,
an atomic value can be promoted from one type to another. <b>Type
promotion</b> is used in evaluating function calls (see <a 
href="#id-function-calls"><b>3.1.5 Function Calls</b></a> ) <del 
class="diff-old">,</del> <span class="xquery">, <code>order by</code>
clauses (see <a href="#id-order-by-clause"><b><del class="diff-old">3.8.3</del>
 <ins class="diff-chg">3.9.8</ins> Order By
<del class="diff-old">and Return Clauses</del> <ins class="diff-chg">Clause</ins></b></a>
 ),</span> and operators that accept
numeric or string operands (see <a href="#mapping"><b>B.2 Operator
Mapping</b></a> ).] The following type promotions are
permitted:</p>
<ol class="enumar">
<li>
<p>Numeric type promotion:</p>
<ol class="enumla">
<li>
<p>A value of type <code>xs:float</code> (or any type derived by
restriction from <code>xs:float</code> ) can be promoted to the
type <code>xs:double</code> . The result is the
<code>xs:double</code> value that is the same as the original
value.</p>
</li>
<li>
<p>A value of type <code>xs:decimal</code> (or any type derived by
restriction from <code>xs:decimal</code> ) can be promoted to
either of the types <code>xs:float</code> or <code>xs:double</code>
. The result of this promotion is created by casting the original
value to the required type. This kind of promotion may cause loss
of precision.</p>
</li>
</ol>
</li>
<li>
<p>URI type promotion: A value of type <code>xs:anyURI</code> (or
any type derived by restriction from <code>xs:anyURI</code> ) can
be promoted to the type <code>xs:string</code> . The result of this
promotion is created by casting the original value to the type
<code>xs:string</code> .</p>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>Since <code>xs:anyURI</code> values can be promoted to
<code>xs:string</code> , functions and operators that compare
strings using the <a title="default collation" href="#dt-def-collation">default
 collation</a> also compare
<code>xs:anyURI</code> values using the <a title="default collation" 
href="#dt-def-collation">default collation</a>
. This ensures that orderings that include strings,
<code>xs:anyURI</code> values, or any combination of the two types
are consistent and well-defined.</p>
</div>
</li>
</ol>
<p>Note that <a title="type promotion" href="#dt-type-promotion">type 
promotion</a> is different from <a title="subtype substitution" 
href="#dt-subtype-substitution">subtype
substitution</a> . For example:</p>
<ul>
<li>
<p>A function that expects a parameter <code>$p</code> of type
<code>xs:float</code> can be invoked with a value of type
<code>xs:decimal</code> . This is an example of <a title="type 
promotion" href="#dt-type-promotion">type promotion</a> . The
value is actually converted to the expected type. Within the body
of the function, <code>$p instance of xs:decimal</code> returns
<code>false</code> .</p>
</li>
<li>
<p>A function that expects a parameter <code>$p</code> of type
<code>xs:decimal</code> can be invoked with a value of type
<code>xs:integer</code> . This is an example of <a title="subtype 
substitution" href="#dt-subtype-substitution">subtype
substitution</a> . The value retains its original type. Within the
body of the function, <code>$p instance of xs:integer</code>
returns <code>true</code> .</p>
</li>
</ul>
</div>
<div class="div2">
<h3><a id="mapping" name="mapping"></a> B.2 Operator Mapping</h3>
<p>The operator mapping tables in this section list the
combinations of types for which the various operators of XQuery
<ins class="diff-new">1.1</ins> are defined. [ <a title="operator 
function" id="dt-operator-function" name="dt-operator-function">Definition</a>
 : For each operator and valid
combination of operand types, the operator mapping tables specify a
result type and an <b>operator function</b> that implements the
semantics of the operator for the given types.] The definitions of
the operator functions are given in <a href="#xpath-functions-11">[XQuery
 <del class="diff-old">1.0</del> and
XPath <del class="diff-old">2.0</del> Functions and <del 
class="diff-old">Operators]</del> <ins class="diff-chg">Operators
1.1]</ins></a> . The result of an operator may be the raising of an
error by its operator function, as defined in <a 
href="#xpath-functions-11">[XQuery <del class="diff-old">1.0</del> and
XPath <del class="diff-old">2.0</del> Functions and <del 
class="diff-old">Operators]</del> <ins class="diff-chg">Operators
1.1]</ins></a> . In some cases, the operator function does not
implement the full semantics of a given operator. For the
definition of each operator (including its behavior for empty
sequences or sequences of length greater than one), see the
descriptive material in the main part of this document.</p>
<p>The <code>and</code> and <code>or</code> operators are defined
directly in the main body of this document, and do not occur in the
operator mapping tables.</p>
<p>If an operator in the operator mapping tables expects an operand
of type <em>ET</em> , that operator can be applied to an operand of
type <em>AT</em> if type <em>AT</em> can be converted to type
<em>ET</em> by a combination of <a title="type promotion" 
href="#dt-type-promotion">type promotion</a> and <a title="subtype 
substitution" href="#dt-subtype-substitution">subtype
substitution</a> . For example, a table entry indicates that the
<code>gt</code> operator may be applied to two <code>xs:date</code>
operands, returning <code>xs:boolean</code> . Therefore, the
<code>gt</code> operator may also be applied to two (possibly
different) subtypes of <code>xs:date</code> , also returning
<code>xs:boolean</code> .</p>
<p>[ <a title="numeric" id="dt-numeric" name="dt-numeric">Definition</a>
 : When referring to a type, the term
<b>numeric</b> denotes the types <code>xs:integer</code> ,
<code>xs:decimal</code> , <code>xs:float</code> , and
<code>xs:double</code> .] An operator whose operands and result are
designated as <a title="numeric" href="#dt-numeric">numeric</a>
might be thought of as representing four operators, one for each of
the numeric types. For example, the numeric <code>+</code> operator
might be thought of as representing the following four
operators:</p>
<table summary="Operators" width="80%" border="1">
<tbody>
<tr>
<td align="center">Operator</td>
<td align="center">First operand type</td>
<td align="center">Second operand type</td>
<td align="center">Result type</td>
</tr>
<tr>
<td align="center"><code>+</code></td>
<td align="center"><code>xs:integer</code></td>
<td align="center"><code>xs:integer</code></td>
<td align="center"><code>xs:integer</code></td>
</tr>
<tr>
<td align="center"><code>+</code></td>
<td align="center"><code>xs:decimal</code></td>
<td align="center"><code>xs:decimal</code></td>
<td align="center"><code>xs:decimal</code></td>
</tr>
<tr>
<td align="center"><code>+</code></td>
<td align="center"><code>xs:float</code></td>
<td align="center"><code>xs:float</code></td>
<td align="center"><code>xs:float</code></td>
</tr>
<tr>
<td align="center"><code>+</code></td>
<td align="center"><code>xs:double</code></td>
<td align="center"><code>xs:double</code></td>
<td align="center"><code>xs:double</code></td>
</tr>
</tbody>
</table>
<p>A numeric operator may be validly applied to an operand of type
<em>AT</em> if type <em>AT</em> can be converted to any of the four
numeric types by a combination of <a title="type promotion" 
href="#dt-type-promotion">type promotion</a> and <a title="subtype 
substitution" href="#dt-subtype-substitution">subtype
substitution</a> . If the result type of an operator is listed as
numeric, it means "the first type in the ordered list
<code>(xs:integer, xs:decimal, xs:float, xs:double)</code> into
which all operands can be converted by <a title="subtype substitution" 
href="#dt-subtype-substitution">subtype
substitution</a> and <a title="type promotion" href="#dt-type-promotion">type
 promotion</a> ." As an example, suppose
that the type <code>hatsize</code> is derived from
<code>xs:integer</code> and the type <code>shoesize</code> is
derived from <code>xs:float</code> . Then if the <code>+</code>
operator is invoked with operands of type <code>hatsize</code> and
<code>shoesize</code> , it returns a result of type
<code>xs:float</code> . Similarly, if <code>+</code> is invoked
with two operands of type <code>hatsize</code> it returns a result
of type <code>xs:integer</code> .</p>
<p>[ <a title="Gregorian" id="dt-gregorian" name="dt-gregorian">Definition</a>
 : In the operator mapping tables, the
term <b>Gregorian</b> refers to the types
<code>xs:gYearMonth</code> , <code>xs:gYear</code> ,
<code>xs:gMonthDay</code> , <code>xs:gDay</code> , and
<code>xs:gMonth</code> .] For binary operators that accept two
Gregorian-type operands, both operands must have the same type (for
example, if one operand is of type <code>xs:gDay</code> , the other
operand must be of type <code>xs:gDay</code> .)</p>
<table summary="Binary operators" class="small" border="1">
<caption>Binary Operators</caption>
<tbody>
<tr>
<th colspan="1">Operator</th>
<th colspan="1">Type(A)</th>
<th colspan="1">Type(B)</th>
<th colspan="1">Function</th>
<th colspan="1">Result type</th>
</tr>
<tr>
<td>A + B</td>
<td>numeric</td>
<td>numeric</td>
<td>op:numeric-add(A, B)</td>
<td>numeric</td>
</tr>
<tr>
<td>A + B</td>
<td>xs:date</td>
<td>xs:yearMonthDuration</td>
<td>op:add-yearMonthDuration-to-date(A, B)</td>
<td>xs:date</td>
</tr>
<tr>
<td>A + B</td>
<td>xs:yearMonthDuration</td>
<td>xs:date</td>
<td>op:add-yearMonthDuration-to-date(B, A)</td>
<td>xs:date</td>
</tr>
<tr>
<td>A + B</td>
<td>xs:date</td>
<td>xs:dayTimeDuration</td>
<td>op:add-dayTimeDuration-to-date(A, B)</td>
<td>xs:date</td>
</tr>
<tr>
<td>A + B</td>
<td>xs:dayTimeDuration</td>
<td>xs:date</td>
<td>op:add-dayTimeDuration-to-date(B, A)</td>
<td>xs:date</td>
</tr>
<tr>
<td>A + B</td>
<td>xs:time</td>
<td>xs:dayTimeDuration</td>
<td>op:add-dayTimeDuration-to-time(A, B)</td>
<td>xs:time</td>
</tr>
<tr>
<td>A + B</td>
<td>xs:dayTimeDuration</td>
<td>xs:time</td>
<td>op:add-dayTimeDuration-to-time(B, A)</td>
<td>xs:time</td>
</tr>
<tr>
<td>A + B</td>
<td>xs:dateTime</td>
<td>xs:yearMonthDuration</td>
<td>op:add-yearMonthDuration-to-dateTime(A, B)</td>
<td>xs:dateTime</td>
</tr>
<tr>
<td>A + B</td>
<td>xs:yearMonthDuration</td>
<td>xs:dateTime</td>
<td>op:add-yearMonthDuration-to-dateTime(B, A)</td>
<td>xs:dateTime</td>
</tr>
<tr>
<td>A + B</td>
<td>xs:dateTime</td>
<td>xs:dayTimeDuration</td>
<td>op:add-dayTimeDuration-to-dateTime(A, B)</td>
<td>xs:dateTime</td>
</tr>
<tr>
<td>A + B</td>
<td>xs:dayTimeDuration</td>
<td>xs:dateTime</td>
<td>op:add-dayTimeDuration-to-dateTime(B, A)</td>
<td>xs:dateTime</td>
</tr>
<tr>
<td>A + B</td>
<td>xs:yearMonthDuration</td>
<td>xs:yearMonthDuration</td>
<td>op:add-yearMonthDurations(A, B)</td>
<td>xs:yearMonthDuration</td>
</tr>
<tr>
<td>A + B</td>
<td>xs:dayTimeDuration</td>
<td>xs:dayTimeDuration</td>
<td>op:add-dayTimeDurations(A, B)</td>
<td>xs:dayTimeDuration</td>
</tr>
<tr>
<td>A - B</td>
<td>numeric</td>
<td>numeric</td>
<td>op:numeric-subtract(A, B)</td>
<td>numeric</td>
</tr>
<tr>
<td>A - B</td>
<td>xs:date</td>
<td>xs:date</td>
<td>op:subtract-dates(A, B)</td>
<td>xs:dayTimeDuration</td>
</tr>
<tr>
<td>A - B</td>
<td>xs:date</td>
<td>xs:yearMonthDuration</td>
<td>op:subtract-yearMonthDuration-from-date(A, B)</td>
<td>xs:date</td>
</tr>
<tr>
<td>A - B</td>
<td>xs:date</td>
<td>xs:dayTimeDuration</td>
<td>op:subtract-dayTimeDuration-from-date(A, B)</td>
<td>xs:date</td>
</tr>
<tr>
<td>A - B</td>
<td>xs:time</td>
<td>xs:time</td>
<td>op:subtract-times(A, B)</td>
<td>xs:dayTimeDuration</td>
</tr>
<tr>
<td>A - B</td>
<td>xs:time</td>
<td>xs:dayTimeDuration</td>
<td>op:subtract-dayTimeDuration-from-time(A, B)</td>
<td>xs:time</td>
</tr>
<tr>
<td>A - B</td>
<td>xs:dateTime</td>
<td>xs:dateTime</td>
<td>op:subtract-dateTimes(A, B)</td>
<td>xs:dayTimeDuration</td>
</tr>
<tr>
<td>A - B</td>
<td>xs:dateTime</td>
<td>xs:yearMonthDuration</td>
<td>op:subtract-yearMonthDuration-from-dateTime(A, B)</td>
<td>xs:dateTime</td>
</tr>
<tr>
<td>A - B</td>
<td>xs:dateTime</td>
<td>xs:dayTimeDuration</td>
<td>op:subtract-dayTimeDuration-from-dateTime(A, B)</td>
<td>xs:dateTime</td>
</tr>
<tr>
<td>A - B</td>
<td>xs:yearMonthDuration</td>
<td>xs:yearMonthDuration</td>
<td>op:subtract-yearMonthDurations(A, B)</td>
<td>xs:yearMonthDuration</td>
</tr>
<tr>
<td>A - B</td>
<td>xs:dayTimeDuration</td>
<td>xs:dayTimeDuration</td>
<td>op:subtract-dayTimeDurations(A, B)</td>
<td>xs:dayTimeDuration</td>
</tr>
<tr>
<td>A * B</td>
<td>numeric</td>
<td>numeric</td>
<td>op:numeric-multiply(A, B)</td>
<td>numeric</td>
</tr>
<tr>
<td>A * B</td>
<td>xs:yearMonthDuration</td>
<td>numeric</td>
<td>op:multiply-yearMonthDuration(A, B)</td>
<td>xs:yearMonthDuration</td>
</tr>
<tr>
<td>A * B</td>
<td>numeric</td>
<td>xs:yearMonthDuration</td>
<td>op:multiply-yearMonthDuration(B, A)</td>
<td>xs:yearMonthDuration</td>
</tr>
<tr>
<td>A * B</td>
<td>xs:dayTimeDuration</td>
<td>numeric</td>
<td>op:multiply-dayTimeDuration(A, B)</td>
<td>xs:dayTimeDuration</td>
</tr>
<tr>
<td>A * B</td>
<td>numeric</td>
<td>xs:dayTimeDuration</td>
<td>op:multiply-dayTimeDuration(B, A)</td>
<td>xs:dayTimeDuration</td>
</tr>
<tr>
<td>A idiv B</td>
<td>numeric</td>
<td>numeric</td>
<td>op:numeric-integer-divide(A, B)</td>
<td>xs:integer</td>
</tr>
<tr>
<td>A div B</td>
<td>numeric</td>
<td>numeric</td>
<td>op:numeric-divide(A, B)</td>
<td>numeric; but xs:decimal if both operands are xs:integer</td>
</tr>
<tr>
<td>A div B</td>
<td>xs:yearMonthDuration</td>
<td>numeric</td>
<td>op:divide-yearMonthDuration(A, B)</td>
<td>xs:yearMonthDuration</td>
</tr>
<tr>
<td>A div B</td>
<td>xs:dayTimeDuration</td>
<td>numeric</td>
<td>op:divide-dayTimeDuration(A, B)</td>
<td>xs:dayTimeDuration</td>
</tr>
<tr>
<td>A div B</td>
<td>xs:yearMonthDuration</td>
<td>xs:yearMonthDuration</td>
<td>op:divide-yearMonthDuration-by-yearMonthDuration (A, B)</td>
<td>xs:decimal</td>
</tr>
<tr>
<td>A div B</td>
<td>xs:dayTimeDuration</td>
<td>xs:dayTimeDuration</td>
<td>op:divide-dayTimeDuration-by-dayTimeDuration (A, B)</td>
<td>xs:decimal</td>
</tr>
<tr>
<td>A mod B</td>
<td>numeric</td>
<td>numeric</td>
<td>op:numeric-mod(A, B)</td>
<td>numeric</td>
</tr>
<tr>
<td>A eq B</td>
<td>numeric</td>
<td>numeric</td>
<td>op:numeric-equal(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A eq B</td>
<td>xs:boolean</td>
<td>xs:boolean</td>
<td>op:boolean-equal(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A eq B</td>
<td>xs:string</td>
<td>xs:string</td>
<td>op:numeric-equal(fn:compare(A, B), 0)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A eq B</td>
<td>xs:date</td>
<td>xs:date</td>
<td>op:date-equal(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A eq B</td>
<td>xs:time</td>
<td>xs:time</td>
<td>op:time-equal(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A eq B</td>
<td>xs:dateTime</td>
<td>xs:dateTime</td>
<td>op:dateTime-equal(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A eq B</td>
<td>xs:duration</td>
<td>xs:duration</td>
<td>op:duration-equal(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A eq B</td>
<td>Gregorian</td>
<td>Gregorian</td>
<td>op:gYear-equal(A, B) etc.</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A eq B</td>
<td>xs:hexBinary</td>
<td>xs:hexBinary</td>
<td><del class="diff-old">op:hex-binary-equal(A,</del> <ins 
class="diff-chg">op:hexBinary-equal(A,</ins> B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A eq B</td>
<td>xs:base64Binary</td>
<td>xs:base64Binary</td>
<td><del class="diff-old">op:base64-binary-equal(A,</del>
<ins class="diff-chg">op:base64Binary-equal(A,</ins> B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A eq B</td>
<td>xs:anyURI</td>
<td>xs:anyURI</td>
<td>op:numeric-equal(fn:compare(A, B), 0)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A eq B</td>
<td>xs:QName</td>
<td>xs:QName</td>
<td>op:QName-equal(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A eq B</td>
<td>xs:NOTATION</td>
<td>xs:NOTATION</td>
<td>op:NOTATION-equal(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ne B</td>
<td>numeric</td>
<td>numeric</td>
<td>fn:not(op:numeric-equal(A, B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ne B</td>
<td>xs:boolean</td>
<td>xs:boolean</td>
<td>fn:not(op:boolean-equal(A, B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ne B</td>
<td>xs:string</td>
<td>xs:string</td>
<td>fn:not(op:numeric-equal(fn:compare(A, B), 0))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ne B</td>
<td>xs:date</td>
<td>xs:date</td>
<td>fn:not(op:date-equal(A, B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ne B</td>
<td>xs:time</td>
<td>xs:time</td>
<td>fn:not(op:time-equal(A, B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ne B</td>
<td>xs:dateTime</td>
<td>xs:dateTime</td>
<td>fn:not(op:dateTime-equal(A, B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ne B</td>
<td>xs:duration</td>
<td>xs:duration</td>
<td>fn:not(op:duration-equal(A, B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ne B</td>
<td>Gregorian</td>
<td>Gregorian</td>
<td>fn:not(op:gYear-equal(A, B)) etc.</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ne B</td>
<td>xs:hexBinary</td>
<td>xs:hexBinary</td>
<td><del class="diff-old">fn:not(op:hex-binary-equal(A,</del>
<ins class="diff-chg">fn:not(op:hexBinary-equal(A,</ins> B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ne B</td>
<td>xs:base64Binary</td>
<td>xs:base64Binary</td>
<td><del class="diff-old">fn:not(op:base64-binary-equal(A,</del>
<ins class="diff-chg">fn:not(op:base64Binary-equal(A,</ins>
B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ne B</td>
<td>xs:anyURI</td>
<td>xs:anyURI</td>
<td>fn:not(op:numeric-equal(fn:compare(A, B), 0))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ne B</td>
<td>xs:QName</td>
<td>xs:QName</td>
<td>fn:not(op:QName-equal(A, B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ne B</td>
<td>xs:NOTATION</td>
<td>xs:NOTATION</td>
<td>fn:not(op:NOTATION-equal(A, B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A gt B</td>
<td>numeric</td>
<td>numeric</td>
<td>op:numeric-greater-than(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A gt B</td>
<td>xs:boolean</td>
<td>xs:boolean</td>
<td>op:boolean-greater-than(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A gt B</td>
<td>xs:string</td>
<td>xs:string</td>
<td>op:numeric-greater-than(fn:compare(A, B), 0)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A gt B</td>
<td>xs:date</td>
<td>xs:date</td>
<td>op:date-greater-than(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A gt B</td>
<td>xs:time</td>
<td>xs:time</td>
<td>op:time-greater-than(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A gt B</td>
<td>xs:dateTime</td>
<td>xs:dateTime</td>
<td>op:dateTime-greater-than(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A gt B</td>
<td>xs:yearMonthDuration</td>
<td>xs:yearMonthDuration</td>
<td>op:yearMonthDuration-greater-than(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A gt B</td>
<td>xs:dayTimeDuration</td>
<td>xs:dayTimeDuration</td>
<td>op:dayTimeDuration-greater-than(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A gt B</td>
<td>xs:anyURI</td>
<td>xs:anyURI</td>
<td>op:numeric-greater-than(fn:compare(A, B), 0)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A lt B</td>
<td>numeric</td>
<td>numeric</td>
<td>op:numeric-less-than(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A lt B</td>
<td>xs:boolean</td>
<td>xs:boolean</td>
<td>op:boolean-less-than(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A lt B</td>
<td>xs:string</td>
<td>xs:string</td>
<td>op:numeric-less-than(fn:compare(A, B), 0)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A lt B</td>
<td>xs:date</td>
<td>xs:date</td>
<td>op:date-less-than(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A lt B</td>
<td>xs:time</td>
<td>xs:time</td>
<td>op:time-less-than(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A lt B</td>
<td>xs:dateTime</td>
<td>xs:dateTime</td>
<td>op:dateTime-less-than(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A lt B</td>
<td>xs:yearMonthDuration</td>
<td>xs:yearMonthDuration</td>
<td>op:yearMonthDuration-less-than(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A lt B</td>
<td>xs:dayTimeDuration</td>
<td>xs:dayTimeDuration</td>
<td>op:dayTimeDuration-less-than(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A lt B</td>
<td>xs:anyURI</td>
<td>xs:anyURI</td>
<td>op:numeric-less-than(fn:compare(A, B), 0)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ge B</td>
<td>numeric</td>
<td>numeric</td>
<td>op:numeric-greater-than(A, B) or op:numeric-equal(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ge B</td>
<td>xs:boolean</td>
<td>xs:boolean</td>
<td>fn:not(op:boolean-less-than(A, B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ge B</td>
<td>xs:string</td>
<td>xs:string</td>
<td>op:numeric-greater-than(fn:compare(A, B), -1)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ge B</td>
<td>xs:date</td>
<td>xs:date</td>
<td>fn:not(op:date-less-than(A, B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ge B</td>
<td>xs:time</td>
<td>xs:time</td>
<td>fn:not(op:time-less-than(A, B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ge B</td>
<td>xs:dateTime</td>
<td>xs:dateTime</td>
<td>fn:not(op:dateTime-less-than(A, B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ge B</td>
<td>xs:yearMonthDuration</td>
<td>xs:yearMonthDuration</td>
<td>fn:not(op:yearMonthDuration-less-than(A, B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ge B</td>
<td>xs:dayTimeDuration</td>
<td>xs:dayTimeDuration</td>
<td>fn:not(op:dayTimeDuration-less-than(A, B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A ge B</td>
<td>xs:anyURI</td>
<td>xs:anyURI</td>
<td>op:numeric-greater-than(fn:compare(A, B), -1)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A le B</td>
<td>numeric</td>
<td>numeric</td>
<td>op:numeric-less-than(A, B) or op:numeric-equal(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A le B</td>
<td>xs:boolean</td>
<td>xs:boolean</td>
<td>fn:not(op:boolean-greater-than(A, B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A le B</td>
<td>xs:string</td>
<td>xs:string</td>
<td>op:numeric-less-than(fn:compare(A, B), 1)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A le B</td>
<td>xs:date</td>
<td>xs:date</td>
<td>fn:not(op:date-greater-than(A, B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A le B</td>
<td>xs:time</td>
<td>xs:time</td>
<td>fn:not(op:time-greater-than(A, B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A le B</td>
<td>xs:dateTime</td>
<td>xs:dateTime</td>
<td>fn:not(op:dateTime-greater-than(A, B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A le B</td>
<td>xs:yearMonthDuration</td>
<td>xs:yearMonthDuration</td>
<td>fn:not(op:yearMonthDuration-greater-than(A, B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A le B</td>
<td>xs:dayTimeDuration</td>
<td>xs:dayTimeDuration</td>
<td>fn:not(op:dayTimeDuration-greater-than(A, B))</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A le B</td>
<td>xs:anyURI</td>
<td>xs:anyURI</td>
<td>op:numeric-less-than(fn:compare(A, B), 1)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A is B</td>
<td>node()</td>
<td>node()</td>
<td>op:is-same-node(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A &lt;&lt; B</td>
<td>node()</td>
<td>node()</td>
<td>op:node-before(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A &gt;&gt; B</td>
<td>node()</td>
<td>node()</td>
<td>op:node-after(A, B)</td>
<td>xs:boolean</td>
</tr>
<tr>
<td>A union B</td>
<td>node()*</td>
<td>node()*</td>
<td>op:union(A, B)</td>
<td>node()*</td>
</tr>
<tr>
<td>A | B</td>
<td>node()*</td>
<td>node()*</td>
<td>op:union(A, B)</td>
<td>node()*</td>
</tr>
<tr>
<td>A intersect B</td>
<td>node()*</td>
<td>node()*</td>
<td>op:intersect(A, B)</td>
<td>node()*</td>
</tr>
<tr>
<td>A except B</td>
<td>node()*</td>
<td>node()*</td>
<td>op:except(A, B)</td>
<td>node()*</td>
</tr>
<tr>
<td>A to B</td>
<td>xs:integer</td>
<td>xs:integer</td>
<td>op:to(A, B)</td>
<td>xs:integer*</td>
</tr>
<tr>
<td>A , B</td>
<td>item()*</td>
<td>item()*</td>
<td>op:concatenate(A, B)</td>
<td>item()*</td>
</tr>
</tbody>
</table>
<table summary="Unary operators" class="small" border="1">
<caption>Unary Operators</caption>
<tbody>
<tr>
<th colspan="1">Operator</th>
<th colspan="1">Operand type</th>
<th colspan="1">Function</th>
<th colspan="1">Result type</th>
</tr>
<tr>
<td>+ A</td>
<td>numeric</td>
<td>op:numeric-unary-plus(A)</td>
<td>numeric</td>
</tr>
<tr>
<td>- A</td>
<td>numeric</td>
<td>op:numeric-unary-minus(A)</td>
<td>numeric</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="div1">
<h2><a id="id-xq-context-components" name="id-xq-context-components"></a>
 C Context Components</h2>
<p>The tables in this section describe how values are assigned to
the various components of the static context and dynamic context,
and to the parameters that control the serialization process.</p>
<p><ins class="diff-new">[</ins> <a title="scope of a component" 
id="dt-scope" name="dt-scope"><ins class="diff-new">Definition</ins></a>
 :<ins class="diff-new">The</ins>
<b><ins class="diff-new">scope of a component</ins></b> <ins 
class="diff-new">is the context in which the component is associated 
with
a value.] The following scopes are defined:</ins></p>
<ul>
<li>
<p><ins class="diff-new">[</ins> <a title="global scope" 
id="td-global-scope" name="td-global-scope"><ins class="diff-new">Definition</ins></a>
 :<ins class="diff-new">If a
component has</ins> <b><ins class="diff-new">global scope</ins></b>
,<ins class="diff-new">then every expression in the query has the
same value for that component, and it can not be overwritten by the
query module or by an expression.]</ins></p>
</li>
<li>
<p><ins class="diff-new">[</ins> <a title="module scope" 
id="td-module-scope" name="td-module-scope"><ins class="diff-new">Definition</ins></a>
 :<ins class="diff-new">If a
component has</ins> <b><ins class="diff-new">module scope</ins></b>
,<ins class="diff-new">then every expression in a given module has
the same value for that component, and it can be overwritten or
augmented for a given module.]</ins></p>
</li>
<li>
<p><ins class="diff-new">[</ins> <a title="lexical scope" 
id="td-lexical-scope" name="td-lexical-scope"><ins class="diff-new">Definition</ins></a>
 :<ins class="diff-new">If a
component has</ins> <b><ins class="diff-new">lexical
scope</ins></b> ,<ins class="diff-new">then it is defined by a
query expression, and its scope is defined by the semantics of the
expression that defines it.]</ins></p>
</li>
<li>
<p><ins class="diff-new">[</ins> <a title="dynamic scope" 
id="td-dynamic-scope" name="td-dynamic-scope"><ins class="diff-new">Definition</ins></a>
 :<ins class="diff-new">If a
component has</ins> <b><ins class="diff-new">dynamic
scope</ins></b> ,<ins class="diff-new">then it is defined by a
query expression, its scope is defined by the semantics of the
expression that defines it, and run-time evaluation may influence
its value.]</ins></p>
</li>
</ul>
<div class="div2">
<h3><a id="id-xq-static-context-components" 
name="id-xq-static-context-components"></a> C.1 Static Context
Components</h3>
<p>The following table describes the components of the <b>static
context</b> . The following aspects of each component are
described:</p>
<ul>
<li>
<p><em>Default initial value:</em> This is the initial value of the
component if it is not overridden or augmented by the
implementation or by a query.</p>
</li>
<li>
<p><em>Can be overwritten or augmented by implementation:</em>
Indicates whether an XQuery implementation is allowed to replace
the default initial value of the component by a different,
<a title="implementation defined" href="#dt-implementation-defined">implementation-defined</a>
 value
and/or to augment the default initial value by additional <a 
title="implementation defined" href="#dt-implementation-defined">implementation-defined</a>
 values.</p>
</li>
<li>
<p><em>Can be overwritten or augmented by a query:</em> Indicates
whether a query is allowed to replace and/or augment the initial
value provided by default or by the implementation. If so,
indicates how this is accomplished (for example, by a declaration
in the prolog).</p>
</li>
<li>
<p><em>Scope:</em> <del class="diff-old">Indicates where the
component is applicable. "Global" indicates that the component
applies globally, throughout all</del> the <del class="diff-old">modules
 used in a query. "Module" indicates that</del>
<a title="scope of a component" href="#dt-scope"><ins class="diff-chg">scope
 of</ins> the component <del class="diff-old">applies throughout a 
module</del></a> . <del class="diff-old">"Lexical" indicates that the 
component applies within
the expression in which it is defined (equivalent to "module" if
the component is declared in a Prolog .)</del></p>
</li>
<li>
<p><em>Consistency Rules:</em> Indicates rules that must be
observed in assigning values to the component. Additional
consistency rules may be found in <a href="#id-consistency-constraints"><b>2.2.5
 Consistency
Constraints</b></a> .</p>
</li>
</ul>
<table summary="Static Context" class="small" width="100%" border="1">
<caption>Static Context Components</caption>
<tbody>
<tr>
<th colspan="1">Component</th>
<th colspan="1">Default initial value</th>
<th colspan="1">Can be overwritten or augmented by
implementation?</th>
<th colspan="1">Can be overwritten or augmented by a query?</th>
<th colspan="1">Scope</th>
<th colspan="1">Consistency rules</th>
</tr>
<tr>
<td>XPath 1.0 Compatibility Mode</td>
<td><code>false</code></td>
<td>no</td>
<td>no</td>
<td>global</td>
<td>Must be <code>false</code> .</td>
</tr>
<tr>
<td>Statically known namespaces</td>
<td><code>fn</code> , <code>xml</code> , <code>xs</code> ,
<code>xsi</code> , <code>local</code></td>
<td>overwriteable and augmentable (except for <code>xml</code>
)</td>
<td>overwriteable and augmentable by prolog or element
constructor</td>
<td>lexical</td>
<td>Only one namespace can be assigned to a given prefix per
lexical scope.</td>
</tr>
<tr>
<td>Default element/type namespace</td>
<td>no namespace</td>
<td>overwriteable</td>
<td>overwriteable by prolog or element constructor</td>
<td>lexical</td>
<td>Only one default namespace per lexical scope.</td>
</tr>
<tr>
<td>Default function namespace</td>
<td><code>fn</code></td>
<td>overwriteable (not recommended)</td>
<td>overwriteable by prolog</td>
<td>module</td>
<td>None.</td>
</tr>
<tr>
<td>In-scope schema types</td>
<td>built-in types in <code>xs</code></td>
<td>augmentable</td>
<td>augmentable by schema import in prolog</td>
<td>module</td>
<td>Only one definition per global or local type.</td>
</tr>
<tr>
<td>In-scope element declarations</td>
<td>none</td>
<td>augmentable</td>
<td>augmentable by schema import in prolog</td>
<td>module</td>
<td>Only one definition per global or local element name.</td>
</tr>
<tr>
<td>In-scope attribute declarations</td>
<td>none</td>
<td>augmentable</td>
<td>augmentable by schema import in prolog</td>
<td>module</td>
<td>Only one definition per global or local attribute name.</td>
</tr>
<tr>
<td>In-scope variables</td>
<td>none</td>
<td>augmentable</td>
<td>overwriteable and augmentable by prolog and by variable-binding
expressions</td>
<td>lexical</td>
<td>Only one definition per variable per lexical scope.</td>
</tr>
<tr>
<td>Context item static type</td>
<td>none <del class="diff-old">(raises error on access)</del></td>
<td>overwriteable</td>
<td><del class="diff-old">not explicitly, but can be
influenced</del> <ins class="diff-chg">overwriteable via a context
item declaration, and</ins> by <del class="diff-old">expressions</del> <ins
 class="diff-chg">expresssions
that set the context item</ins></td>
<td>lexical</td>
<td>None.</td>
</tr>
<tr>
<td>Function signatures</td>
<td>functions in <code>fn</code> namespace, and constructors for
built-in atomic types</td>
<td>augmentable</td>
<td>augmentable by module import and by function declaration in
<del class="diff-old">prolog</del> <ins class="diff-chg">prolog;
augmentable by schema import (which adds constructor functions for
user-defined types)</ins></td>
<td>module</td>
<td>Each function must have a unique <a title="expanded QName" 
href="#dt-expanded-qname">expanded QName</a> and number of
arguments.</td>
</tr>
<tr>
<td>Statically known collations</td>
<td>only the default collation</td>
<td>augmentable</td>
<td>no</td>
<td>module</td>
<td>Each URI uniquely identifies a collation.</td>
</tr>
<tr>
<td>Default collation</td>
<td>Unicode codepoint collation</td>
<td>overwriteable</td>
<td>overwriteable by prolog</td>
<td>module</td>
<td>None.</td>
</tr>
<tr>
<td>Construction mode</td>
<td><code>preserve</code></td>
<td>overwriteable</td>
<td>overwriteable by prolog</td>
<td>module</td>
<td>Value must be <code>preserve</code> or <code>strip</code>
.</td>
</tr>
<tr>
<td>Ordering mode</td>
<td><code>ordered</code></td>
<td>overwriteable</td>
<td>overwriteable by prolog or expression</td>
<td>lexical</td>
<td>Value must be <code>ordered</code> or <code>unordered</code>
.</td>
</tr>
<tr>
<td>Default order for empty sequences</td>
<td>implementation-defined</td>
<td>overwriteable</td>
<td>overwriteable by prolog</td>
<td>module</td>
<td>Value must be <code>greatest</code> or <code>least</code>
.</td>
</tr>
<tr>
<td>Boundary-space policy</td>
<td><code>strip</code></td>
<td>overwriteable</td>
<td>overwriteable by prolog</td>
<td>module</td>
<td>Value must be <code>preserve</code> or <code>strip</code>
.</td>
</tr>
<tr>
<td>Copy-namespaces mode</td>
<td><code>inherit, preserve</code></td>
<td>overwriteable</td>
<td>overwriteable by prolog</td>
<td>module</td>
<td>Value consists of <code>inherit</code> or
<code>no-inherit</code> , and <code>preserve</code> or
<code>no-preserve</code> .</td>
</tr>
<tr>
<td>Base URI</td>
<td>See rules in <a href="#id-base-uri-decl"><b>4.5 Base URI
Declaration</b></a></td>
<td>overwriteable</td>
<td>overwriteable by prolog</td>
<td>module</td>
<td>Value must be a valid lexical representation of the type
xs:anyURI.</td>
</tr>
<tr>
<td>Statically known documents</td>
<td>none</td>
<td>augmentable</td>
<td>no</td>
<td>module</td>
<td>None.</td>
</tr>
<tr>
<td>Statically known collections</td>
<td>none</td>
<td>augmentable</td>
<td>no</td>
<td>module</td>
<td>None.</td>
</tr>
<tr>
<td>Statically known default collection type</td>
<td><code>node()*</code></td>
<td>overwriteable</td>
<td>no</td>
<td>module</td>
<td>None.</td>
</tr>
</tbody>
</table>
</div>
<div class="div2">
<h3><a id="id-xq-evaluation-context-components" 
name="id-xq-evaluation-context-components"></a> C.2 Dynamic Context
Components</h3>
<p>The following table describes the components of the <b>dynamic
context</b> . The following aspects of each component are
described:</p>
<ul>
<li>
<p><em>Default initial value:</em> This is the initial value of the
component if it is not overridden or augmented by the
implementation or by a query.</p>
</li>
<li>
<p><em>Can be overwritten or augmented by implementation:</em>
Indicates whether an XQuery implementation is allowed to replace
the default initial value of the component by a different <a 
title="implementation defined" href="#dt-implementation-defined">implementation-defined</a>
 value
and/or to augment the default initial value by additional <a 
title="implementation defined" href="#dt-implementation-defined">implementation-defined</a>
 values.</p>
</li>
<li>
<p><em>Can be overwritten or augmented by a query:</em> Indicates
whether a query is allowed to replace and/or augment the initial
value provided by default or by the implementation. If so,
indicates how this is accomplished.</p>
</li>
<li>
<p><em>Scope:</em> <del class="diff-old">Indicates where the
component is applicable. "Global" indicates that the component
applies globally, throughout all the modules used in a query, and
remains constant during evaluation of a query. "Dynamic" indicates
that evalation of an expression may influence</del> the <del 
class="diff-old">value</del> <a title="scope of a component" 
href="#dt-scope"><ins class="diff-chg">scope</ins> of the component
<del class="diff-old">for that expression and for nested
expressions.</del></a> .</p>
</li>
<li>
<p><em>Consistency Rules:</em> Indicates rules that must be
observed in assigning values to the component. Additional
consistency rules may be found in <a href="#id-consistency-constraints"><b>2.2.5
 Consistency
Constraints</b></a> .</p>
</li>
</ul>
<table summary="Static Context" class="small" width="100%" border="1">
<caption>Dynamic Context Components</caption>
<tbody>
<tr>
<th colspan="1">Component</th>
<th colspan="1">Default initial value</th>
<th colspan="1">Can be overwritten or augmented by
implementation?</th>
<th colspan="1">Can be overwritten or augmented by a query?</th>
<th colspan="1">Scope</th>
<th colspan="1">Consistency rules</th>
</tr>
<tr>
<td>Context item</td>
<td>none</td>
<td>overwriteable</td>
<td>overwritten during evaluation of path expressions and
predicates <ins class="diff-new">- initial value may be overwritten
with a context item declaration.</ins></td>
<td>dynamic</td>
<td>None</td>
</tr>
<tr>
<td>Context position</td>
<td>none</td>
<td>overwriteable</td>
<td>overwritten during evaluation of path expressions and
predicates</td>
<td>dynamic</td>
<td>If context item is defined, context position must be &gt;0 and
&lt;= context size; else context position is undefined.</td>
</tr>
<tr>
<td>Context size</td>
<td>none</td>
<td>overwriteable</td>
<td>overwritten during evaluation of path expressions and
predicates</td>
<td>dynamic</td>
<td>If context item is defined, context size must be &gt;0; else
context size is undefined.</td>
</tr>
<tr>
<td>Variable values</td>
<td>none</td>
<td>augmentable</td>
<td>overwriteable and augmentable by prolog and by variable-binding
expressions</td>
<td>dynamic</td>
<td>Names and values must be consistent with in-scope
variables.</td>
</tr>
<tr>
<td>Function implementations</td>
<td>functions in <code>fn</code> namespace, and constructors for
built-in atomic types</td>
<td>augmentable</td>
<td>augmentable by module import and by function declaration in
<del class="diff-old">prolog</del> <ins class="diff-chg">prolog;
augmentable by schema import (which adds constructor functions for
user-defined types)</ins></td>
<td>global</td>
<td>Must be consistent with function signatures</td>
</tr>
<tr>
<td>Current dateTime</td>
<td>none</td>
<td>must be initialized by implementation</td>
<td>no</td>
<td>global</td>
<td>Must include a timezone. Remains constant during evaluation of
a query.</td>
</tr>
<tr>
<td>Implicit timezone</td>
<td>none</td>
<td>must be initialized by implementation</td>
<td>no</td>
<td>global</td>
<td>Remains constant during evaluation of a query.</td>
</tr>
<tr>
<td>Available documents</td>
<td>none</td>
<td>must be initialized by implementation</td>
<td>no</td>
<td>global</td>
<td>None</td>
</tr>
<tr>
<td>Available collections</td>
<td>none</td>
<td>must be initialized by implementation</td>
<td>no</td>
<td>global</td>
<td>None</td>
</tr>
<tr>
<td>Default collection</td>
<td>none</td>
<td>overwriteable</td>
<td>no</td>
<td>global</td>
<td>None</td>
</tr>
</tbody>
</table>
</div>
<div class="div2">
<h3><a id="id-xq-serialization-parameters" 
name="id-xq-serialization-parameters"></a> C.3 Serialization
Parameters</h3>
<p>The following table specifies default values for the parameters
that control the process of serializing an <a title="XDM instance" 
href="#dt-data-model-instance">XDM instance</a> into XML notation (
<code>method = "xml"</code> ). The meanings of the various
parameters are defined in <a href="#xslt-xquery-serialization-11">[XSLT <del
 class="diff-old">2.0</del> and XQuery <del class="diff-old">1.0
Serialization]</del> <ins class="diff-chg">Serialization
1.1]</ins></a> . For each parameter, an XQuery implementation may
(but is not required to) <del class="diff-old">provide a means
whereby</del> <ins class="diff-chg">allow</ins> a <del class="diff-old">user
 can</del> <ins class="diff-chg">query to</ins>
override the default <del class="diff-old">value.</del> <ins 
class="diff-chg">value with an option declaration, as discussed in</ins>
<a href="#id-serialization"><b><ins class="diff-chg">2.2.4
Serialization</ins></b></a> .</p>
<table summary="Unary operators" class="small" width="60%" border="1">
<caption>Serialization Parameters</caption>
<tbody>
<tr>
<th colspan="1">Parameter</th>
<th colspan="1">Default Value</th>
</tr>
<tr>
<td>byte-order-mark</td>
<td>implementation-defined</td>
</tr>
<tr>
<td>cdata-section-elements</td>
<td>empty</td>
</tr>
<tr>
<td>doctype-public</td>
<td>(none)</td>
</tr>
<tr>
<td>doctype-system</td>
<td>(none)</td>
</tr>
<tr>
<td>encoding</td>
<td>implementation-defined choice between "utf-8" and "utf-16"</td>
</tr>
<tr>
<td>escape-uri-attributes</td>
<td>(not applicable when method = xml)</td>
</tr>
<tr>
<td>include-content-type</td>
<td>(not applicable when method = xml)</td>
</tr>
<tr>
<td>indent</td>
<td>no</td>
</tr>
<tr>
<td>media-type</td>
<td>implementation-defined</td>
</tr>
<tr>
<td>method</td>
<td>xml</td>
</tr>
<tr>
<td>normalization-form</td>
<td>implementation-defined</td>
</tr>
<tr>
<td>omit-xml-declaration</td>
<td>implementation-defined</td>
</tr>
<tr>
<td>standalone</td>
<td>implementation-defined</td>
</tr>
<tr>
<td><ins class="diff-new">suppress-indentation</ins></td>
<td><ins class="diff-new">empty</ins></td>
</tr>
<tr>
<td>undeclare-prefixes</td>
<td>no</td>
</tr>
<tr>
<td>use-character-maps</td>
<td>empty</td>
</tr>
<tr>
<td>version</td>
<td>implementation-defined</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="div1">
<h2><a id="id-impl-defined-items" name="id-impl-defined-items"></a>
D Implementation-Defined Items</h2>
<p>The following items in this specification are <a 
title="implementation defined" href="#dt-implementation-defined">implementation-defined</a>
 :</p>
<ol class="enumar">
<li>
<p>The version of Unicode that is used to construct
expressions.</p>
</li>
<li>
<p>The <a title="statically known collations" 
href="#dt-static-collations">statically-known collations</a> .</p>
</li>
<li>
<p>The <a title="implicit timezone" href="#dt-timezone">implicit
timezone</a> .</p>
</li>
<li>
<p>The circumstances in which <a title="warning" href="#dt-warning">warnings</a>
 are raised, and the ways in which
warnings are handled.</p>
</li>
<li>
<p>The method by which errors are reported to the external
processing environment.</p>
</li>
<li>
<p>Whether the implementation is based on the rules of <a href="#XML">[XML
 1.0]</a> and <a href="#XMLNAMES">[XML Names]</a> or the
rules of <a href="#XML1.1">[XML 1.1]</a> and <a href="#XMLNAMES11">[XML 
Names 1.1]</a> . One of these sets of rules must
be applied consistently by all aspects of the implementation.
<ins class="diff-new">If the implementation is based on the rules
of</ins> <a href="#XML"><ins class="diff-new">[XML 1.0]</ins></a>
,<ins class="diff-new">the edition used must be at least Third
Edition; the edition used is</ins> <a title="implementation defined" 
href="#dt-implementation-defined"><ins class="diff-new">implementation-defined</ins></a>
 ,<ins class="diff-new">but we recommend that implementations use the 
latest
version.</ins></p>
</li>
<li>
<p>Any components of the <a title="static context" 
href="#dt-static-context">static context</a> or <a title="dynamic 
context" href="#dt-dynamic-context">dynamic context</a>
that are overwritten or augmented by the implementation.</p>
<del class="diff-old">Which of the optional axes are supported by
the implementation, if the Full-Axis Feature is not
supported.</del></li>
<li>
<p>The default handling of empty sequences returned by an ordering
key <del class="diff-old">(sortspec)</del> <ins class="diff-chg">(orderspec)</ins>
 in an <code>order by</code> clause (
<code>empty least</code> or <code>empty greatest</code> ).</p>
</li>
<li>
<p>The names and semantics of any <a title="extension expression" 
href="#dt-extension-expression">extension expressions</a> (
<a title="pragma" href="#dt-pragma">pragmas</a> ) recognized by the
implementation.</p>
</li>
<li>
<p>The names and semantics of any <a title="option declaration" 
href="#dt-option-declaration">option declarations</a> recognized by
the implementation.</p>
</li>
<li>
<p>Protocols (if any) by which parameters can be passed to an
external function, and the result of the function can returned to
the invoking query.</p>
</li>
<li>
<p>The process by which the specific modules to be imported by a
<a title="module import" href="#dt-module-import">module import</a>
are identified, if the <a title="module feature" 
href="#dt-module-feature">Module Feature</a> is supported (includes
processing of location hints, if any.)</p>
<del class="diff-old">Any static typing extensions supported by the
implementation, if the Static Typing Feature is
supported.</del></li>
<li>
<p>The means by which serialization is invoked, if the <a 
title="serialization feature" href="#dt-serialization-feature">Serialization
 Feature</a> is
supported.</p>
</li>
<li>
<p>The default values for the <code>byte-order-mark</code> ,
<code>encoding</code> , <code>media-type</code> ,
<code>normalization-form</code> , <code>omit-xml-declaration</code>
, <code>standalone</code> , and <code>version</code> parameters, if
the <a title="serialization feature" href="#dt-serialization-feature">Serialization
 Feature</a> is
supported.</p>
</li>
<li>
<p>The result of an unsuccessful call to an external function (for
example, if the function implementation cannot be found or does not
return a value of the declared type).</p>
</li>
<li>
<p>Limits on ranges of values for various data types, as enumerated
in <a href="#id-data-model-conformance"><b>5.3 Data Model
Conformance</b></a> .</p>
</li>
<li>
<p><ins class="diff-new">Syntactic extensions to XQuery, including
both their syntax and semantics, as discussed in</ins> <a 
href="#id-syntax-extensions"><b><ins class="diff-new">5.4 Syntax
Extensions</ins></b></a> .</p>
</li>
</ol>
<div class="note">
<p class="prefix"><b>Note:</b></p>
<p>Additional <a title="implementation defined" 
href="#dt-implementation-defined">implementation-defined</a> items are
listed in <del class="diff-old">[XQuery/XPath</del> <a 
href="#xpath-datamodel-11"><ins class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> and <a href="#xpath-functions-11">[XQuery <del 
class="diff-old">1.0</del> and
XPath <del class="diff-old">2.0</del> Functions and <del 
class="diff-old">Operators]</del> <ins class="diff-chg">Operators
1.1]</ins></a> .</p>
</div>
</div>
<div class="div1">
<h2><a id="id-references" name="id-references"></a> E
References</h2>
<div class="div2">
<h3><a id="id-normative-references" name="id-normative-references"></a> 
E.1 Normative References</h3>
<dl>
<dt class="label"><span><a id="RFC2119" name="RFC2119"></a> RFC
2119</span></dt>
<dd>
<div>S. Bradner. <em>Key Words for use in RFCs to Indicate
Requirement Levels.</em> IETF RFC 2119. See <a 
href="http://rfc.net/rfc2119.html">http://www.ietf.org/rfc/rfc2119.txt</a>
.</div>
</dd>
<dt class="label"><span><del class="diff-old">RFC2396 T.
Berners-Lee, R. Fielding, and L. Masinter. Uniform Resource
Identifiers (URI): Generic Syntax . IETF RFC 2396. See
http://www.ietf.org/rfc/rfc2396.txt .</del> <a id="RFC3986" 
name="RFC3986"></a> RFC3986</span></dt>
<dd>
<div>T. Berners-Lee, R. Fielding, and L. Masinter. <em>Uniform
Resource Identifiers (URI): Generic Syntax</em> . IETF RFC 3986.
See <a href="http://www.ietf.org/rfc/rfc3986.txt">http://www.ietf.org/rfc/rfc3986.txt</a>
.</div>
</dd>
<dt class="label"><span><a id="RFC3987" name="RFC3987"></a>
RFC3987</span></dt>
<dd>
<div>M. Duerst and M. Suignard. <em>Internationalized Resource
Identifiers (IRIs)</em> . IETF RFC 3987. See <a 
href="http://www.ietf.org/rfc/rfc3987.txt">http://www.ietf.org/rfc/rfc3987.txt</a>
.</div>
</dd>
<dt class="label"><span><a id="ISO10646" name="ISO10646"></a>
ISO/IEC 10646</span></dt>
<dd>
<div>ISO (International Organization for Standardization).
<em>ISO/IEC 10646:2003. Information technology—Universal
Multiple-Octet Coded Character Set (UCS)</em> , as, from time to
time, amended, replaced by a new edition, or expanded by the
addition of new parts. [Geneva]: International Organization for
Standardization. (See <a href="http://www.iso.org/">http://www.iso.org</a>
 for the latest
version.)</div>
</dd>
<dt class="label"><span><a id="Unicode" name="Unicode"></a>
Unicode</span></dt>
<dd>
<div>The Unicode Consortium. <em>The Unicode Standard</em> Reading,
Mass.: Addison-Wesley, 2003, as updated from time to time by the
publication of new versions. See <a 
href="http://www.unicode.org/unicode/standard/versions">http://www.unicode.org/unicode/standard/versions</a>
for the latest version and additional information on versions of
the standard and of the Unicode Character Database. The version of
Unicode to be used is <a title="implementation defined" 
href="#dt-implementation-defined">implementation-defined</a> , but
implementations are recommended to use the latest Unicode
version.</div>
</dd>
<dt class="label"><span><a id="XML" name="XML"></a> XML
1.0</span></dt>
<dd>
<div>World Wide Web Consortium. <em>Extensible Markup Language
(XML) 1.0. <del class="diff-old">(Third Edition)</del></em> W3C
Recommendation. See <a href="http://www.w3.org/TR/REC-xml">http://www.w3.org/TR/REC-xml</a>
 .
<ins class="diff-chg">The edition of XML 1.0 must be no earlier
than the Third Edition; the edition used is</ins> <a 
title="implementation defined" href="#dt-implementation-defined"><ins 
class="diff-chg">implementation-defined</ins></a> ,<ins class="diff-chg">but
 we recommend that implementations use the latest
version.</ins></div>
</dd>
<dt class="label"><span><a id="XML1.1" name="XML1.1"></a> XML
1.1</span></dt>
<dd>
<div>World Wide Web Consortium. <em>Extensible Markup Language
(XML) 1.1.</em> W3C Recommendation. See <a 
href="http://www.w3.org/TR/xml11/">http://www.w3.org/TR/xml11/</a></div>
</dd>
<dt class="label"><span><a id="XMLBASE" name="XMLBASE"></a> XML
Base</span></dt>
<dd>
<div>World Wide Web Consortium. <em>XML Base.</em> W3C
Recommendation. See <a href="http://www.w3.org/TR/xmlbase/">http://www.w3.org/TR/xmlbase/</a></div>
</dd>
<dt class="label"><span><a id="XMLNAMES" name="XMLNAMES"></a> XML
Names</span></dt>
<dd>
<div>World Wide Web Consortium. <em>Namespaces in XML.</em> W3C
Recommendation. See <a href="http://www.w3.org/TR/REC-xml-names/">http://www.w3.org/TR/REC-xml-names/</a></div>
</dd>
<dt class="label"><span><a id="XMLNAMES11" name="XMLNAMES11"></a>
XML Names 1.1</span></dt>
<dd>
<div>World Wide Web Consortium. <em>Namespaces in XML 1.1.</em> W3C
Recommendation. See <a href="http://www.w3.org/TR/xml-names11/">http://www.w3.org/TR/xml-names11/</a></div>
</dd>
<dt class="label"><span><a id="XMLID" name="XMLID"></a> XML
ID</span></dt>
<dd>
<div>World Wide Web Consortium. <em>xml:id Version 1.0.</em> W3C
Recommendation. See <a href="http://www.w3.org/TR/xml-id/">http://www.w3.org/TR/xml-id/</a></div>
</dd>
<dt class="label"><span><a id="XMLSchema" name="XMLSchema"></a> XML
Schema</span></dt>
<dd>
<div>World Wide Web Consortium. <em>XML Schema, Parts 0, 1, and 2
(Second Edition)</em> . W3C Recommendation, 28 October 2004. See
<a href="http://www.w3.org/TR/xmlschema-0/">http://www.w3.org/TR/xmlschema-0/</a>
, <a href="http://www.w3.org/TR/xmlschema-1/">http://www.w3.org/TR/xmlschema-1/</a>
, and <a href="http://www.w3.org/TR/xmlschema-2/">http://www.w3.org/TR/xmlschema-2/</a>
.</div>
</dd>
<dt class="label"><span><a id="xpath-datamodel-11" 
name="xpath-datamodel-11"></a> <del class="diff-old">XQuery/XPath</del>
<ins class="diff-chg">XQuery and XPath</ins> Data Model (XDM)
<ins class="diff-new">1.1</ins></span></dt>
<dd>
<div><del class="diff-old">World Wide Web Consortium.</del>
<a href="http://www.w3.org/TR/xpath-datamodel-11/"><cite>XQuery
<del class="diff-old">1.0</del> and XPath <del class="diff-old">2.0</del>
 Data Model (XDM) <del class="diff-old">. W3C
Recommendation, 23 Jan. 2007. See
http://www.w3.org/TR/xpath-datamodel/ . XQuery 1.0 and XPath 2.0
Formal Semantics</del> <ins class="diff-chg">1.1</ins></cite></a> ,
<ins class="diff-chg">Norman Walsh, John Snelson, Editors.</ins>
World Wide Web <del class="diff-old">Consortium. XQuery 1.0 and
XPath 2.0 Formal Semantics . W3C Recommendation, 23 Jan. 2007. See
http://www.w3.org/TR/xquery-semantics/ .</del> <ins class="diff-chg">Consortium,
 15 December 2009. This version is
http://www.w3.org/TR/2009/WD-xpath-datamodel-11-20091215/.
The</ins> <a href="http://www.w3.org/TR/xpath-datamodel-11/"><ins 
class="diff-chg">latest version</ins></a> <ins class="diff-chg">is
available at http://www.w3.org/TR/xpath-datamodel-11/.</ins></div>
</dd>
<dt class="label"><span><a id="xpath-functions-11" 
name="xpath-functions-11"></a> XQuery <del class="diff-old">1.0</del>
and XPath <del class="diff-old">2.0</del> Functions and Operators
<ins class="diff-new">1.1</ins></span></dt>
<dd>
<div><del class="diff-old">World Wide Web Consortium.</del>
<a href="http://www.w3.org/TR/xpath-functions-11/"><cite>XQuery
<del class="diff-old">1.0</del> and XPath <del class="diff-old">2.0</del>
 Functions and Operators <del class="diff-old">W3C Recommendation, 23 
Jan. 2007. See
http://www.w3.org/TR/xpath-functions/ .</del> <ins class="diff-chg">1.1</ins></cite></a>
 ,<ins class="diff-chg">Michael Kay,
Editor. World Wide Web Consortium, 15 December 2009. This version
is http://www.w3.org/TR/2009/WD-xpath-functions-11-20091215/.
The</ins> <a href="http://www.w3.org/TR/xpath-functions-11/"><ins 
class="diff-chg">latest version</ins></a> <ins class="diff-chg">is
available at http://www.w3.org/TR/xpath-functions-11/.</ins></div>
</dd>
<dt class="label"><span><a id="xslt-xquery-serialization-11" 
name="xslt-xquery-serialization-11"></a> XSLT <del class="diff-old">2.0</del>
 and XQuery <del class="diff-old">1.0</del>
Serialization <ins class="diff-new">1.1</ins></span></dt>
<dd>
<div><del class="diff-old">World Wide Web Consortium.</del>
<a href="http://www.w3.org/TR/xslt-xquery-serialization-11/"><cite>XSLT
<del class="diff-old">2.0</del> and XQuery <del class="diff-old">1.0</del>
 Serialization <del class="diff-old">. W3C
Recommendation, 23 Jan. 2007. See
http://www.w3.org/TR/xslt-xquery-serialization/ .</del> <ins 
class="diff-chg">1.1</ins></cite></a> ,<ins class="diff-chg">Henry
Zongaro, Editor. World Wide Web Consortium, 15 December 2009. This
version is
http://www.w3.org/TR/2009/WD-xslt-xquery-serialization-11-20091215/.
The</ins> <a href="http://www.w3.org/TR/xslt-xquery-serialization-11/"><ins
 class="diff-chg">latest version</ins></a> <ins class="diff-chg">is
available at
http://www.w3.org/TR/xslt-xquery-serialization-11/.</ins></div>
</dd>
</dl>
</div>
<div class="div2">
<h3><a id="id-non-normative-references" 
name="id-non-normative-references"></a> E.2 Non-normative
References</h3>
<dl>
<dt class="label"><span class="xquery"><a id="xquery-11-requirements" 
name="xquery-11-requirements"></a>
<del class="diff-old">XML Query 1.0</del> <ins class="diff-chg">XQuery 
1.1</ins> Requirements</span></dt>
<dd>
<div class="xquery"><a 
href="http://www.w3.org/TR/xquery-11-requirements/"><cite><ins 
class="diff-new">XQuery 1.1 Requirements</ins></cite></a> ,<ins 
class="diff-new">Daniel Engovatov, Jonathan Robie, Editors.</ins> World
Wide Web <del class="diff-old">Consortium.</del> <ins class="diff-chg">Consortium,
 15&nbsp;December&nbsp;2009. This version is
http://www.w3.org/TR/2009/WD-xquery-11-requirements-20091215/.
The</ins> <a href="http://www.w3.org/TR/xquery-11-requirements"><ins 
class="diff-chg">latest version</ins></a> <ins class="diff-chg">is
available at
http://www.w3.org/TR/xquery-11-requirements/.</ins></div>
</dd>
<dt class="label"><span class="xpath21 xquery xquery11"><a id="xpath-21"
 name="xpath-21"></a> XML <del class="diff-old">Query 1.0
Requirements . W3C Working Draft, 14 Nov 2003. See
http://www.w3.org/TR/xquery-requirements/ .</del> <ins class="diff-chg">Path
 Language (XPath) 2.1</ins></span></dt>
<dd>
<div class="xpath21 xquery xquery11"><a 
href="http://www.w3.org/TR/xpath-21/"><cite><ins class="diff-chg">XML
Path Language (XPath) 2.1</ins></cite></a> ,<ins class="diff-chg">Jonathan
 Robie, Don Chamberlin, Michael Dyck, John
Snelson, Editors. World Wide Web Consortium, 15 December 2009. This
version is http://www.w3.org/TR/2009/WD-xpath-21-20091215/.
The</ins> <a href="http://www.w3.org/TR/xpath-21/"><ins class="diff-chg">latest
 version</ins></a> <ins class="diff-chg">is
available at http://www.w3.org/TR/xpath-21/.</ins></div>
</dd>
<dt class="label"><span><a id="xquery-semantics" name="xquery-semantics"></a>
 <ins class="diff-new">XQuery 1.0 and</ins>
XPath 2.0 <ins class="diff-new">Formal Semantics</ins></span></dt>
<dd>
<div><a href="http://www.w3.org/TR/xquery-semantics/"><cite><ins 
class="diff-chg">XQuery 1.0 and XPath 2.0 Formal
Semantics</ins></cite></a> ,<ins class="diff-chg">Jérôme Siméon,
Denise Draper, Peter Frankhauser,</ins> <em><ins class="diff-chg">et. 
al.</ins></em> ,<ins class="diff-chg">Editors.</ins>
World Wide Web <del class="diff-old">Consortium. XML Path Language
(XPath) Version 2.0 . W3C Recommendation,</del> <ins class="diff-chg">Consortium,</ins>
 23 <del class="diff-old">Jan.</del>
<ins class="diff-chg">January</ins> 2007. <del class="diff-old">See
http://www.w3.org/TR/xpath20/ .</del> <ins class="diff-chg">This
version is
http://www.w3.org/TR/2007/REC-xquery-semantics-20070123/. The</ins>
<a href="http://www.w3.org/TR/xquery-semantics/"><ins class="diff-chg">latest
 version</ins></a> <ins class="diff-chg">is
available at http://www.w3.org/TR/xquery-semantics/.</ins></div>
</dd>
<dt class="label"><span class="xquery"><a id="xqueryx-11" 
name="xqueryx-11"></a> XQueryX <del class="diff-old">1.0</del>
<ins class="diff-chg">1.1</ins></span></dt>
<dd>
<div class="xquery"><a href="http://www.w3.org/TR/xqueryx-11/"><cite><ins
 class="diff-new">XQueryX 1.1</ins></cite></a> ,<ins class="diff-new">Jim
Melton,
 Editor.</ins> World Wide Web <del class="diff-old">Consortium. XQueryX,
 Version 1.0 . W3C Recommendation,
23 Jan. 2007. See http://www.w3.org/TR/xqueryx/ .</del> <ins 
class="diff-chg">Consortium, 15 December 2009. This version is
http://www.w3.org/TR/2009/WD-xqueryx-11-20091215/. The</ins>
<a href="http://www.w3.org/TR/xqueryx-11/"><ins class="diff-chg">latest 
version</ins></a> <ins class="diff-chg">is
available at http://www.w3.org/TR/xqueryx-11/.</ins></div>
</dd>
<dt class="label"><span><a id="xslt-21" name="xslt-21"></a>
<del class="diff-old">XSLT 2.0</del> <ins class="diff-chg">XSL
Transformations (XSLT) Version 2.1</ins></span></dt>
<dd>
<div><del class="diff-old">World Wide Web Consortium.</del>
<a href="http://www.w3.org/TR/xslt-21"><cite>XSL Transformations
(XSLT) <del class="diff-old">2.0. W3C Recommendation, 23 Jan. 2007.
See http://www.w3.org/TR/xslt20/</del> <ins class="diff-chg">Version 2.1</ins></cite></a>
 , <ins class="diff-new">Michael Kay, Editor. World Wide Web Consortium,
«awaiting First Public Working Draft publication». This version is
http://www.w3.org/TR/2007/WD-xslt-21-YYYYMMDD/. The</ins> <a 
href="http://www.w3.org/TR/xslt-21/"><ins class="diff-new">latest
version</ins></a> <ins class="diff-new">is available at
http://www.w3.org/TR/xslt-21/.</ins></div>
</dd>
<dt class="label"><span><a id="DOM" name="DOM"></a> Document Object
Model</span></dt>
<dd>
<div>World Wide Web Consortium. <em>Document Object Model (DOM)
Level 3 Core Specification.</em> W3C Recommendation, April 7, 2004.
See <a href="http://www.w3.org/TR/DOM-Level-3-Core/">http://www.w3.org/TR/DOM-Level-3-Core/</a>
.</div>
</dd>
<dt class="label"><span><a id="XINFO" name="XINFO"></a> XML
Infoset</span></dt>
<dd>
<div>World Wide Web Consortium. <em>XML Information Set.</em> W3C
Recommendation 24 October 2001. See <a 
href="http://www.w3.org/TR/xml-infoset/">http://www.w3.org/TR/xml-infoset/</a></div>
</dd>
<dt class="label"><span><a id="xpath" name="xpath"></a> <del 
class="diff-old">XPath</del> <ins class="diff-chg">XML Path Language
(XPath) Version</ins> 1.0</span></dt>
<dd>
<div><del class="diff-old">World Wide Web Consortium.</del>
<a href="http://www.w3.org/TR/xpath"><cite>XML Path Language
(XPath) Version 1.0 <del class="diff-old">. W3C Recommendation,
Nov. 16, 1999. See http://www.w3.org/TR/xpath.html</del></cite></a>
, <ins class="diff-new">Steven DeRose and James Clark, Editors.
World Wide Web Consortium, 16&nbsp;Nov&nbsp;1999. This version is
http://www.w3.org/TR/1999/REC-xpath-19991116. The</ins> <a 
href="http://www.w3.org/TR/xpath"><ins class="diff-new">latest
version</ins></a> <ins class="diff-new">is available at
http://www.w3.org/TR/xpath.</ins></div>
</dd>
<dt class="label"><span><a id="XPTR" name="XPTR"></a>
XPointer</span></dt>
<dd>
<div>World Wide Web Consortium. <em>XML Pointer Language
(XPointer).</em> W3C Last Call Working Draft 8 January 2001. See
<a href="http://www.w3.org/TR/WD-xptr">http://www.w3.org/TR/WD-xptr</a></div>
</dd>
<dt class="label"><span class="xquery"><a id="UseCases" name="UseCases"></a>
 XML Query Use Cases</span></dt>
<dd>
<div class="xquery">World Wide Web Consortium. <em>XML Query Use
Cases</em> . W3C Working Draft, 8 June 2006. See <a 
href="http://www.w3.org/TR/xquery-use-cases/">http://www.w3.org/TR/xquery-use-cases/</a>
.</div>
</dd>
<dt class="label"><span class="xquery"><a id="xml11schema10" 
name="xml11schema10"></a> XML 1.1 and Schema 1.0</span></dt>
<dd>
<div class="xquery">World Wide Web Consortium. <em>Processing XML
1.0 Documents with XML Schema 1.0 Processors</em> . W3C Working
Group Note, 11 May 2005. See <a 
href="http://www.w3.org/TR/xml11schema10/">http://www.w3.org/TR/xml11schema10/</a>
.</div>
</dd>
<dt class="label"><span class="xquery"><a id="RFC1738" name="RFC1738"></a>
 Uniform Resource Locators (URL)</span></dt>
<dd>
<div class="xquery">Internet Engineering Task Force (IETF).
<em>Uniform Resource Locators (URL)</em> . Request For Comment No.
1738, Dec. 1994. See <a href="http://www.ietf.org/rfc/rfc1738.txt">http://www.ietf.org/rfc/rfc1738.txt</a>
.</div>
</dd>
<dt class="label"><span class="xquery"><a id="ODMG" name="ODMG"></a> 
ODMG</span></dt>
<dd>
<div class="xquery">Rick Cattell et al. <em>The Object Database
Standard: ODMG-93, Release 1.2</em> . Morgan Kaufmann Publishers,
San Francisco, 1996.</div>
</dd>
<dt class="label"><span class="xquery"><a id="Quilt" name="Quilt"></a> 
Quilt</span></dt>
<dd>
<div class="xquery">Don Chamberlin, Jonathan Robie, and Daniela
Florescu. <em>Quilt: an XML Query Language for Heterogeneous Data
Sources</em> . In <em>Lecture Notes in Computer Science</em> ,
Springer-Verlag, Dec. 2000. Also available at <a 
href="http://www.almaden.ibm.com/cs/people/chamberlin/quilt_lncs.pdf">http://www.almaden.ibm.com/cs/people/chamberlin/quilt_lncs.pdf</a>
. See also <a 
href="http://www.almaden.ibm.com/cs/people/chamberlin/quilt.html">http://www.almaden.ibm.com/cs/people/chamberlin/quilt.html</a>
.</div>
</dd>
<dt class="label"><span class="xquery"><a id="XML-QL" name="XML-QL"></a>
 XML-QL</span></dt>
<dd>
<div class="xquery">Alin Deutsch, Mary Fernandez, Daniela Florescu,
Alon Levy, and Dan Suciu. <em>A Query Language for XML</em> .</div>
</dd>
<dt class="label"><span class="xquery"><a id="SQL" name="SQL"></a>
SQL</span></dt>
<dd>
<div class="xquery">International Organization for Standardization
(ISO). <em>Information <del class="diff-old">Technology-Database</del> <ins
 class="diff-chg">Technology — Database</ins> Language SQL</em> . 
Standard
No. ISO/IEC <del class="diff-old">9075:2003.</del> <ins class="diff-chg">9075:2008.</ins>
 (Available from American National
Standards Institute, New York, NY 10036, (212) 642-4900.)</div>
</dd>
<dt class="label"><span class="xquery"><a id="XQL" name="XQL"></a>
XQL</span></dt>
<dd>
<div class="xquery">J. Robie, J. Lapp, D. Schach. <em>XML Query
Language (XQL)</em> . See <a 
href="http://www.w3.org/TandS/QL/QL98/pp/xql.html">http://www.w3.org/TandS/QL/QL98/pp/xql.html</a>
.</div>
</dd>
</dl>
</div>
<div class="div2">
<h3><a id="id-background-material" name="id-background-material"></a> 
E.3 Background Material</h3>
<dl>
<dt class="label"><span><a id="CHARMOD" name="CHARMOD"></a>
Character Model</span></dt>
<dd>
<div>World Wide Web Consortium. <em>Character Model for the World
Wide Web.</em> W3C Working Draft. See <a 
href="http://www.w3.org/TR/charmod/">http://www.w3.org/TR/charmod/</a>
.</div>
</dd>
<dt class="label"><span><a id="xslt" name="xslt"></a> <del 
class="diff-old">XSLT</del> <ins class="diff-chg">XSL Transformations
(XSLT) Version</ins> 1.0</span></dt>
<dd>
<div><del class="diff-old">World Wide Web Consortium.</del>
<a href="http://www.w3.org/TR/xslt"><cite>XSL Transformations
(XSLT) <del class="diff-old">1.0. W3C Recommendation. See</del>
<ins class="diff-chg">Version 1.0</ins></cite></a> ,<ins 
class="diff-chg">James Clark, Editor. World Wide Web Consortium,
16&nbsp;Nov&nbsp;1999. This version is
http://www.w3.org/TR/1999/REC-xslt-19991116. The</ins> <a 
href="http://www.w3.org/TR/xslt"><del class="diff-old">http://www.w3.org/TR/xslt</del>
 <ins class="diff-chg">latest version</ins></a> <ins class="diff-chg">is
available at http://www.w3.org/TR/xslt.</ins></div>
</dd>
<dt class="label"><span class="xquery"><a id="UseCaseQueries" 
name="UseCaseQueries"></a> Use Case Sample Queries</span></dt>
<dd>
<div class="xquery">Queries from the XQuery 1.0 Use Cases,
presented in a single file. See <del class="diff-old">http://www.w3.org/TR/xquery-use-cases/xquery-use-case-queries.txt</del>
<a 
href="http://www.w3.org/TR/xquery-11-use-cases/xquery-11-use-case-queries.txt">
<ins class="diff-chg">http://www.w3.org/TR/xquery-11-use-cases/xquery-11-use-case-queries.txt</ins></a>
.</div>
</dd>
<dt class="label"><span class="xquery"><a id="XQueryQueries" 
name="XQueryQueries"></a> XQuery Sample Queries</span></dt>
<dd>
<div class="xquery">Queries from this document, presented in a
single file. See <del class="diff-old">http://www.w3.org/TR/xquery-use-cases/xquery-wd-queries.txt</del>
<a 
href="http://www.w3.org/TR/xquery-11-use-cases/xquery-11-wd-queries.txt">
<ins class="diff-chg">http://www.w3.org/TR/xquery-11-use-cases/xquery-11-wd-queries.txt</ins></a>
.</div>
</dd>
</dl>
</div>
</div>
<div class="div1">
<h2><a id="id-errors" name="id-errors"></a> F Error Conditions</h2>
<dl>
<dt><a name="ERRXPST0001" id="ERRXPST0001"></a> err:XPST0001</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if analysis of an expression relies on some component of
the <a title="static context" href="#dt-static-context">static
context</a> that has not been assigned a value.</p>
</dd>
<dt><a name="ERRXPDY0002" id="ERRXPDY0002"></a> err:XPDY0002</dt>
<dd>
<p>It is a <a title="dynamic error" href="#dt-dynamic-error">dynamic 
error</a> if evaluation of an
expression relies on some part of the <a title="dynamic context" 
href="#dt-dynamic-context">dynamic context</a> that has not been
assigned a value.</p>
</dd>
<dt><a name="ERRXPST0003" id="ERRXPST0003"></a> err:XPST0003</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if an expression is not a valid instance of the grammar
defined in <a href="#id-grammar"><b>A.1 EBNF</b></a> .</p>
</dd>
<dt><a name="ERRXPTY0004" id="ERRXPTY0004"></a> err:XPTY0004</dt>
<dd>
<p>It is a <a title="type error" href="#dt-type-error">type
error</a> if, during the <a title="static analysis phase" 
href="#dt-static-analysis">static analysis phase</a> , an expression is
found to have a <a title="static type" href="#dt-static-type">static 
type</a> that is not appropriate for the
context in which the expression occurs, or during the <a title="dynamic 
evaluation phase" href="#dt-dynamic-evaluation">dynamic
evaluation phase</a> , the <a title="dynamic type" 
href="#dt-dynamic-type">dynamic type</a> of a value does not match a
required type as specified by the matching rules in <a 
href="#id-sequencetype-matching"><b>2.5.4 SequenceType Matching</b></a>
.</p>
</dd>
<dt><a name="ERRXPST0005" id="ERRXPST0005"></a> err:XPST0005</dt>
<dd>
<p>During the analysis phase, it is a <a title="static error" 
href="#dt-static-error">static error</a> if the <a title="static type" 
href="#dt-static-type">static type</a> assigned to an expression
other than the expression <code>()</code> or <code>data(())</code>
is <code>empty-sequence()</code> .</p>
</dd>
<dt><a name="ERRXPTY0006" id="ERRXPTY0006"></a> err:XPTY0006</dt>
<dd>
<p>(Not currently used.)</p>
</dd>
<dt><a name="ERRXPTY0007" id="ERRXPTY0007"></a> err:XPTY0007</dt>
<dd>
<p>(Not currently used.)</p>
</dd>
<dt><a name="ERRXPST0008" id="ERRXPST0008"></a> err:XPST0008</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if an expression refers to an element name, attribute
name, schema type name, namespace prefix, or variable name that is
not defined in the <a title="static context" href="#dt-static-context">static
 context</a> , except for an ElementName
in an <a href="#doc-xquery11-ElementTest">ElementTest</a> or an
AttributeName in an <a href="#doc-xquery11-AttributeTest">AttributeTest</a>
 .</p>
</dd>
<dt><a name="ERRXQST0009" id="ERRXQST0009"></a> err:XQST0009</dt>
<dd>
<p>An implementation that does not support the Schema Import
Feature must raise a <a title="static error" href="#dt-static-error">static
 error</a> if a Prolog contains a schema
import.</p>
</dd>
<dt><a name="ERRXPST0010" id="ERRXPST0010"></a> err:XPST0010</dt>
<dd>
<p>An implementation must raise a <a title="static error" 
href="#dt-static-error">static error</a> if it encounters a reference to
an axis that it does not support.</p>
</dd>
<dt><a name="ERRXQST0012" id="ERRXQST0012"></a> err:XQST0012</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if the set of definitions contained in all schemas
imported by a Prolog do not satisfy the conditions for schema
validity specified in Sections 3 and 5 of <a href="#XMLSchema">[XML
Schema]</a> Part 1--i.e., each definition must be valid, complete,
and unique.</p>
</dd>
<dt><a name="ERRXQST0013" id="ERRXQST0013"></a> err:XQST0013</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if an implementation recognizes a pragma but determines
that its content is invalid.</p>
</dd>
<dt><a name="ERRXQST0014" id="ERRXQST0014"></a> err:XQST0014</dt>
<dd>
<p>(Not currently used.)</p>
</dd>
<dt><a name="ERRXQST0015" id="ERRXQST0015"></a> err:XQST0015</dt>
<dd>
<p>(Not currently used.)</p>
</dd>
<dt><a name="ERRXQST0016" id="ERRXQST0016"></a> err:XQST0016</dt>
<dd>
<p>An implementation that does not support the Module Feature
raises a <a title="static error" href="#dt-static-error">static
error</a> if it encounters a <a title="module declaration" 
href="#dt-module-declaration">module declaration</a> or a <a 
title="module import" href="#dt-module-import">module import</a> .</p>
</dd>
<dt><a name="ERRXPST0017" id="ERRXPST0017"></a> err:XPST0017</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if the <a title="expanded QName" href="#dt-expanded-qname">expanded
 QName</a> and number of arguments in
a function call do not match the name and arity of a <a title="function 
signature" href="#dt-function-signature">function
signature</a> in the <a title="static context" href="#dt-static-context">static
 context</a> .</p>
</dd>
<dt><a name="ERRXPTY0018" id="ERRXPTY0018"></a> err:XPTY0018</dt>
<dd>
<p>It is a <a title="type error" href="#dt-type-error">type
error</a> if the result of the last step in a path expression
contains both nodes and <del class="diff-old">atomic values.</del>
<ins class="diff-chg">non-nodes.</ins></p>
</dd>
<dt><a name="ERRXPTY0019" id="ERRXPTY0019"></a> err:XPTY0019</dt>
<dd>
<p>It is a <a title="type error" href="#dt-type-error">type
error</a> if the result of a step (other than the last step) in a
path expression contains an atomic value.</p>
</dd>
<dt><a name="ERRXPTY0020" id="ERRXPTY0020"></a> err:XPTY0020</dt>
<dd>
<p>It is a <a title="type error" href="#dt-type-error">type
error</a> if, in an axis step, the context item is not a node.</p>
</dd>
<dt><a name="ERRXPDY0021" id="ERRXPDY0021"></a> err:XPDY0021</dt>
<dd>
<p>(Not currently used.)</p>
</dd>
<dt><a name="ERRXQST0022" id="ERRXQST0022"></a> err:XQST0022</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if the value of a <a title="namespace declaration attribute" 
href="#dt-namespace-decl-attr">namespace declaration attribute</a> is
not a <a href="#doc-xquery11-URILiteral">URILiteral</a> .</p>
</dd>
<dt><a name="ERRXQTY0023" id="ERRXQTY0023"></a> err:XQTY0023</dt>
<dd>
<p>(Not currently used.)</p>
</dd>
<dt><a name="ERRXQTY0024" id="ERRXQTY0024"></a> err:XQTY0024</dt>
<dd>
<p>It is a <a title="type error" href="#dt-type-error">type
error</a> if the content sequence in an element constructor
contains an attribute node following a node that is not an
attribute node.</p>
</dd>
<dt><a name="ERRXQDY0025" id="ERRXQDY0025"></a> err:XQDY0025</dt>
<dd>
<p>It is a <a title="dynamic error" href="#dt-dynamic-error">dynamic 
error</a> if any attribute of a
constructed element does not have a name that is distinct from the
names of all other attributes of the constructed element.</p>
</dd>
<dt><a name="ERRXQDY0026" id="ERRXQDY0026"></a> err:XQDY0026</dt>
<dd>
<p>It is a <a title="dynamic error" href="#dt-dynamic-error">dynamic 
error</a> if the result of the content
expression of a computed processing instruction constructor
contains the string " <code>?&gt;</code> ".</p>
</dd>
<dt><a name="ERRXQDY0027" id="ERRXQDY0027"></a> err:XQDY0027</dt>
<dd>
<p>In a validate expression, it is a <a title="dynamic error" 
href="#dt-dynamic-error">dynamic error</a> if the root element
information item in the PSVI resulting from validation does not
have the expected validity property: <code>valid</code> if
validation mode is <code>strict</code> , or either
<code>valid</code> or <code>notKnown</code> if validation mode is
<code>lax</code> .</p>
</dd>
<dt><a name="ERRXQTY0028" id="ERRXQTY0028"></a> err:XQTY0028</dt>
<dd>
<p>(Not currently used.)</p>
</dd>
<dt><a name="ERRXQDY0029" id="ERRXQDY0029"></a> err:XQDY0029</dt>
<dd>
<p>(Not currently used.)</p>
</dd>
<dt><a name="ERRXQTY0030" id="ERRXQTY0030"></a> err:XQTY0030</dt>
<dd>
<p>It is a <a title="type error" href="#dt-type-error">type
error</a> if the argument of a <code>validate</code> expression
does not evaluate to exactly one document or element node.</p>
</dd>
<dt><a name="ERRXQST0031" id="ERRXQST0031"></a> err:XQST0031</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if the version number specified in a version declaration
is not supported by the implementation.</p>
</dd>
<dt><a name="ERRXQST0032" id="ERRXQST0032"></a> err:XQST0032</dt>
<dd>
<p>A <a title="static error" href="#dt-static-error">static
error</a> is raised if a Prolog contains more than one <a title="base 
URI declaration" href="#dt-base-uri-decl">base URI
declaration</a> .</p>
</dd>
<dt><a name="ERRXQST0033" id="ERRXQST0033"></a> err:XQST0033</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if a module contains multiple bindings for the same
namespace prefix.</p>
</dd>
<dt><a name="ERRXQST0034" id="ERRXQST0034"></a> err:XQST0034</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if multiple functions declared or imported by a <a 
title="module" href="#dt-module">module</a> have the <span><ins 
class="diff-new">same</ins></span> number of arguments and their
<a title="expanded QName" href="#dt-expanded-qname">expanded
QNames</a> are equal (as defined by the <code>eq</code>
operator).</p>
</dd>
<dt><a name="ERRXQST0035" id="ERRXQST0035"></a> err:XQST0035</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> to import two schema components that both define the same
name in the same symbol space and in the same scope.</p>
</dd>
<dt><a name="ERRXQST0036" id="ERRXQST0036"></a> err:XQST0036</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> to import a module if the <del class="diff-old">importing
module's</del> <a title="in-scope schema definitions" href="#dt-issd">in-scope
 schema <del class="diff-old">types</del>
<ins class="diff-chg">definitions</ins></a> <ins class="diff-new">of the
 importing module</ins> do not include <del class="diff-old">definitions
 for</del> <ins class="diff-chg">all of</ins>
the <ins class="diff-new">following:</ins></p>
<ol class="enumar">
<li>
<p><ins class="diff-new">An</ins> <a title="in-scope schema type" 
href="#dt-is-types"><ins class="diff-new">in-scope</ins> schema
type <del class="diff-old">names</del></a> <ins class="diff-chg">for 
each type-name</ins> that <del class="diff-old">appear</del> <ins 
class="diff-chg">appears:</ins></p>
<ol class="enumla">
<li>
<p>in the <del class="diff-old">declarations</del> <ins class="diff-chg">type</ins>
 of <del class="diff-old">variables</del>
<ins class="diff-chg">a variable that is declared in the imported
module</ins> and <del class="diff-old">functions (whether</del>
<ins class="diff-chg">referenced</ins> in <del class="diff-old">an
argument type</del> <ins class="diff-chg">the importing module,
OR</ins></p>
</li>
<li>
<p><ins class="diff-chg">in a parameter-type</ins> or <del 
class="diff-old">return type)</del> <ins class="diff-chg">result-type of
a function</ins> that <del class="diff-old">are present</del>
<ins class="diff-chg">is declared</ins> in the imported module and
<del class="diff-old">are</del> referenced in the importing
module.</p>
</li>
</ol>
</li>
<li>
<p><ins class="diff-new">An</ins> <a title="in-scope element 
declarations" href="#dt-is-elems"><ins class="diff-new">in-scope element
 declaration</ins></a> <ins class="diff-new">for each element-name</ins>
 <code><ins class="diff-new">EN</ins></code> <ins class="diff-new">such
that:</ins></p>
<ol class="enumla">
<li>
<p><code><ins class="diff-new">schema-element(EN)</ins></code>
<ins class="diff-new">appears in the declared type of a variable in
the imported module, and that variable is referenced in the
importing module, OR</ins></p>
</li>
<li>
<p><code><ins class="diff-new">schema-element(EN)</ins></code>
<ins class="diff-new">appears in a parameter-type or result-type of
a function declared in the imported module, and that function is
referenced in the importing module.</ins></p>
</li>
</ol>
</li>
<li>
<p><ins class="diff-new">An</ins> <a title="in-scope attribute 
declarations" href="#dt-is-attrs"><ins class="diff-new">in-scope 
attribute declaration</ins></a> <ins class="diff-new">for each 
attribute-name</ins> <code><ins class="diff-new">AN</ins></code> <ins 
class="diff-new">such
that:</ins></p>
<ol class="enumla">
<li>
<p><code><ins class="diff-new">schema-attribute(AN)</ins></code>
<ins class="diff-new">appears in the declared type of a variable in
the imported module, and that variable is referenced in the
importing module, OR</ins></p>
</li>
<li>
<p><code><ins class="diff-new">schema-attribute(AN)</ins></code>
<ins class="diff-new">appears in a parameter-type or result-type of
a function declared in the imported module, and that function is
referenced in the importing module.</ins></p>
</li>
</ol>
</li>
</ol>
</dd>
<dt><a name="ERRXQST0037" id="ERRXQST0037"></a> err:XQST0037</dt>
<dd>
<p>(Not currently used.)</p>
</dd>
<dt><a name="ERRXQST0038" id="ERRXQST0038"></a> err:XQST0038</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if a Prolog contains more than one <a title="default collation
 declaration" href="#dt-default-collation-decl">default collation 
declaration</a> , or
the value specified by a default collation declaration is not
present in <a title="statically known collations" 
href="#dt-static-collations">statically known collations</a> .</p>
</dd>
<dt><a name="ERRXQST0039" id="ERRXQST0039"></a> err:XQST0039</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> for a function declaration to have more than one
parameter with the same name.</p>
</dd>
<dt><a name="ERRXQST0040" id="ERRXQST0040"></a> err:XQST0040</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if the attributes specified by a direct element
constructor do not have distinct <a title="expanded QName" 
href="#dt-expanded-qname">expanded <del class="diff-old">QNames.</del>
<ins class="diff-chg">QNames</ins></a> .</p>
</dd>
<dt><a name="ERRXQDY0041" id="ERRXQDY0041"></a> err:XQDY0041</dt>
<dd>
<p>It is a <a title="dynamic error" href="#dt-dynamic-error">dynamic 
error</a> if the value of the name
expression in a computed processing instruction constructor cannot
be cast to the type <code>xs:NCName</code> .</p>
</dd>
<dt><a name="ERRXQST0042" id="ERRXQST0042"></a> err:XQST0042</dt>
<dd>
<p>(Not currently used.)</p>
</dd>
<dt><a name="ERRXQST0043" id="ERRXQST0043"></a> err:XQST0043</dt>
<dd>
<p>(Not currently used.)</p>
</dd>
<dt><a name="ERRXQDY0044" id="ERRXQDY0044"></a> err:XQDY0044</dt>
<dd>
<p>It is a <a title="dynamic error" href="#dt-dynamic-error">dynamic 
error</a> <del class="diff-old">if</del> the node-name <del 
class="diff-old">property</del> of <del class="diff-old">the</del>
<ins class="diff-chg">a</ins> node constructed by a computed
attribute constructor <del class="diff-old">is in</del> <ins 
class="diff-chg">has any of</ins> the <del class="diff-old">namespace
http://www.w3.org/2000/xmlns/ (corresponding to</del> <ins 
class="diff-chg">following properties:</ins></p>
<ul>
<li>
<p><ins class="diff-chg">Its</ins> namespace prefix <ins 
class="diff-new">is</ins> <code>xmlns <del class="diff-old">), or is
in</del></code> .</p>
</li>
<li>
<p><ins class="diff-chg">It has</ins> no namespace <ins class="diff-new">prefix</ins>
 and <del class="diff-old">has</del>
<ins class="diff-chg">its</ins> local name <ins class="diff-new">is</ins>
 <code>xmlns</code> .</p>
</li>
<li>
<p><ins class="diff-new">Its namespace URI is</ins>
<code><ins class="diff-new">http://www.w3.org/2000/xmlns/</ins></code> .</p>
</li>
<li>
<p><ins class="diff-new">Its namespace prefix is</ins>
<code><ins class="diff-new">xml</ins></code> <ins class="diff-new">and 
its namespace URI is not</ins> <code><ins class="diff-new">http://www.w3.org/XML/1998/namespace</ins></code>
 .</p>
</li>
<li>
<p><ins class="diff-new">Its namespace prefix is other than</ins>
<code><ins class="diff-new">xml</ins></code> <ins class="diff-new">and 
its namespace URI is</ins> <code><ins class="diff-new">http://www.w3.org/XML/1998/namespace</ins></code>
 .</p>
</li>
</ul>
</dd>
<dt><a name="ERRXQST0045" id="ERRXQST0045"></a> err:XQST0045</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if the function name in a function declaration is in one
of the following namespaces:
<code>http://www.w3.org/XML/1998/namespace,
http://www.w3.org/2001/XMLSchema,
http://www.w3.org/2001/XMLSchema-instance,
http://www.w3.org/2005/xpath-functions</code> .</p>
</dd>
<dt><a name="ERRXQST0046" id="ERRXQST0046"></a> err:XQST0046</dt>
<dd>
<p>An implementation <a title="may" href="#may">MAY</a> raise a
<a title="static error" href="#dt-static-error">static error</a> if
the value of a <a href="#doc-xquery11-URILiteral">URILiteral</a> is
of nonzero length and is not in the lexical space of
<code>xs:anyURI</code> .</p>
</dd>
<dt><a name="ERRXQST0047" id="ERRXQST0047"></a> err:XQST0047</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if multiple module imports in the same Prolog specify the
same target namespace.</p>
</dd>
<dt><a name="ERRXQST0048" id="ERRXQST0048"></a> err:XQST0048</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if a function or variable declared in a library module is
not in the target namespace of the library module.</p>
</dd>
<dt><a name="ERRXQST0049" id="ERRXQST0049"></a> err:XQST0049</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if two or more variables declared or imported by a
<a title="module" href="#dt-module">module</a> have equal <a 
title="expanded QName" href="#dt-expanded-qname">expanded QNames</a> (as
defined by the <code>eq</code> operator.)</p>
</dd>
<dt><a name="ERRXPDY0050" id="ERRXPDY0050"></a> err:XPDY0050</dt>
<dd>
<p>It is a <a title="dynamic error" href="#dt-dynamic-error">dynamic 
error</a> if the <a title="dynamic type" href="#dt-dynamic-type">dynamic
 type</a> of the
operand of a <code>treat</code> expression does not match the
<a title="sequence type" href="#dt-sequence-type">sequence type</a>
specified by the <code>treat</code> expression. This error might
also be raised by a path expression beginning with " <code>/</code>
" or " <code>//</code> " if the context node is not in a tree that
is rooted at a document node. This is because a leading "
<code>/</code> " or " <code>//</code> " in a path expression is an
abbreviation for an initial step that includes the clause
<code>treat as document-node()</code> .</p>
</dd>
<dt><a name="ERRXPST0051" id="ERRXPST0051"></a> err:XPST0051</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if <del class="diff-old">a</del> <ins class="diff-chg">the</ins>
 <a title="expanded QName" href="#dt-expanded-qname"><ins 
class="diff-chg">expanded</ins> QName
<del class="diff-old">that is used as</del></a> <ins class="diff-chg">for</ins>
 an <a href="#doc-xquery11-AtomicType">AtomicType</a> in a <a 
href="#doc-xquery11-SequenceType">SequenceType</a> is not defined in the
<a title="in-scope schema type" href="#dt-is-types">in-scope schema
types</a> as an atomic type.</p>
</dd>
<dt><a name="ERRXQDY0052" id="ERRXQDY0052"></a> err:XQDY0052</dt>
<dd>
<p>(Not currently used.)</p>
</dd>
<dt><a name="ERRXQST0053" id="ERRXQST0053"></a> err:XQST0053</dt>
<dd>
<p>(Not currently used.)</p>
</dd>
<dt><a name="ERRXQST0054" id="ERRXQST0054"></a> err:XQST0054</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if a variable <a title="depends on a variable" 
href="#dt-depends-on-variable">depends</a> on itself.</p>
</dd>
<dt><a name="ERRXQST0055" id="ERRXQST0055"></a> err:XQST0055</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if a Prolog contains more than one <a title="copy-namespaces 
declaration" href="#dt-copy-namespaces-decl">copy-namespaces declaration</a>
 .</p>
</dd>
<dt><a name="ERRXQST0056" id="ERRXQST0056"></a> err:XQST0056</dt>
<dd>
<p>(Not currently used.)</p>
</dd>
<dt><a name="ERRXQST0057" id="ERRXQST0057"></a> err:XQST0057</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if a schema import binds a namespace prefix but does not
specify a target namespace other than a zero-length string.</p>
</dd>
<dt><a name="ERRXQST0058" id="ERRXQST0058"></a> err:XQST0058</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if multiple schema imports specify the same target
namespace.</p>
</dd>
<dt><a name="ERRXQST0059" id="ERRXQST0059"></a> err:XQST0059</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if an implementation is unable to process a schema or
module import by finding a schema or module with the specified
target namespace.</p>
</dd>
<dt><a name="ERRXQST0060" id="ERRXQST0060"></a> err:XQST0060</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if the name of a function in a function declaration is
not in a namespace <del class="diff-old">(expanded</del>
<ins class="diff-chg">(</ins> <a title="expanded QName" 
href="#dt-expanded-qname"><ins class="diff-chg">expanded</ins> QName</a>
has a null namespace URI).</p>
</dd>
<dt><a name="ERRXQDY0061" id="ERRXQDY0061"></a> err:XQDY0061</dt>
<dd>
<p>It is a <a title="dynamic error" href="#dt-dynamic-error">dynamic 
error</a> if the operand of a validate
expression is a document node whose children do not consist of
exactly one element node and zero or more comment and processing
instruction nodes, in any order.</p>
</dd>
<dt><a name="ERRXQDY0062" id="ERRXQDY0062"></a> err:XQDY0062</dt>
<dd>
<p>(Not currently used.)</p>
</dd>
<dt><a name="ERRXQST0063" id="ERRXQST0063"></a> err:XQST0063</dt>
<dd>
<p>(Not currently used.)</p>
</dd>
<dt><a name="ERRXQDY0064" id="ERRXQDY0064"></a> err:XQDY0064</dt>
<dd>
<p>It is a <a title="dynamic error" href="#dt-dynamic-error">dynamic 
error</a> if the value of the name
expression in a computed processing instruction constructor is
equal to "XML" (in any combination of upper and lower case).</p>
</dd>
<dt><a name="ERRXQST0065" id="ERRXQST0065"></a> err:XQST0065</dt>
<dd>
<p>A <a title="static error" href="#dt-static-error">static
error</a> is raised if a Prolog contains more than one <a 
title="ordering mode declaration" href="#dt-ordering-mode-decl">ordering
mode declaration</a> .</p>
</dd>
<dt><a name="ERRXQST0066" id="ERRXQST0066"></a> err:XQST0066</dt>
<dd>
<p>A <a title="static error" href="#dt-static-error">static
error</a> is raised if a Prolog contains more than one default
element/type namespace declaration, or more than one default
function namespace declaration.</p>
</dd>
<dt><a name="ERRXQST0067" id="ERRXQST0067"></a> err:XQST0067</dt>
<dd>
<p>A <a title="static error" href="#dt-static-error">static
error</a> is raised if a Prolog contains more than one <a 
title="construction declaration" href="#dt-construction-decl">construction
 declaration</a> .</p>
</dd>
<dt><a name="ERRXQST0068" id="ERRXQST0068"></a> err:XQST0068</dt>
<dd>
<p>A <a title="static error" href="#dt-static-error">static
error</a> is raised if a Prolog contains more than one <a 
title="boundary-space declaration" href="#dt-boundary-space-decl">boundary-space
 declaration</a> .</p>
</dd>
<dt><a name="ERRXQST0069" id="ERRXQST0069"></a> err:XQST0069</dt>
<dd>
<p>A <a title="static error" href="#dt-static-error">static
error</a> is raised if a Prolog contains more than one <a title="empty 
order declaration" href="#dt-empty-order-decl">empty order
declaration</a> .</p>
</dd>
<dt><a name="ERRXQST0070" id="ERRXQST0070"></a> err:XQST0070</dt>
<dd>
<p>A <a title="static error" href="#dt-static-error">static
error</a> is raised if <del class="diff-old">a namespace URI is
bound to</del> <ins class="diff-chg">one of</ins> the predefined
<del class="diff-old">prefix</del> <ins class="diff-chg">prefixes</ins> <code><ins
 class="diff-chg">xml</ins></code> <ins class="diff-chg">or</ins>
<code>xmlns <del class="diff-old">,</del></code> <ins class="diff-chg">appears
 in a namespace declaration,</ins> or if
<del class="diff-old">a</del> <ins class="diff-chg">any of the
following conditions is statically detected in any expression or
declaration:</ins></p>
<ul>
<li>
<p><ins class="diff-chg">The prefix</ins> <code><ins class="diff-chg">xml</ins></code>
 <ins class="diff-chg">is bound to
some</ins> namespace URI other than
<code>http://www.w3.org/XML/1998/namespace</code> .</p>
</li>
<li>
<p><ins class="diff-new">A prefix other than</ins>
<code><ins class="diff-new">xml</ins></code> is bound to the
<del class="diff-old">prefix</del> <ins class="diff-chg">namespace
URI</ins> <code><del class="diff-old">xml , or if the</del>
<ins class="diff-chg">http://www.w3.org/XML/1998/namespace</ins></code> .</p>
</li>
<li>
<p><ins class="diff-chg">The</ins> prefix <code><del class="diff-old">xml</del>
 <ins class="diff-chg">xmlns</ins></code> is
bound to <del class="diff-old">a</del> <ins class="diff-chg">any</ins> 
namespace <del class="diff-old">URI</del>
<ins class="diff-chg">URI.</ins></p>
</li>
<li>
<p><ins class="diff-chg">A prefix</ins> other than
<code><del class="diff-old">http://www.w3.org/XML/1998/namespace</del>
<ins class="diff-chg">xmlns</ins></code> <ins class="diff-chg">is
bound to the namespace URI</ins> <code><ins class="diff-chg">http://www.w3.org/2000/xmlns/</ins></code>
 .</p>
</li>
</ul>
</dd>
<dt><a name="ERRXQST0071" id="ERRXQST0071"></a> err:XQST0071</dt>
<dd>
<p>A <a title="static error" href="#dt-static-error">static
error</a> is raised if the namespace declaration attributes of a
direct element constructor do not have distinct names.</p>
</dd>
<dt><a name="ERRXQDY0072" id="ERRXQDY0072"></a> err:XQDY0072</dt>
<dd>
<p>It is a <a title="dynamic error" href="#dt-dynamic-error">dynamic 
error</a> if the result of the content
expression of a computed comment constructor contains two adjacent
hyphens or ends with a hyphen.</p>
</dd>
<dt><a name="ERRXQST0073" id="ERRXQST0073"></a> err:XQST0073</dt>
<dd>
<p><del class="diff-old">It is a static error if the graph of
module imports contains a cycle (that is, if there exists a
sequence of modules M 1 ... M n such that each M i imports M i+1
and M n imports M 1 ), unless all the modules in the cycle share a
common namespace.</del> <ins class="diff-chg">(Not currently
used.)</ins></p>
</dd>
<dt><a name="ERRXQDY0074" id="ERRXQDY0074"></a> err:XQDY0074</dt>
<dd>
<p>It is a <a title="dynamic error" href="#dt-dynamic-error">dynamic 
error</a> if the value of the name
expression in a computed element or attribute constructor cannot be
converted to an <a title="expanded QName" href="#dt-expanded-qname">expanded
 QName</a> (for example, because it
contains a namespace prefix not found in <a title="statically known 
namespaces" href="#dt-static-namespaces">statically known namespaces</a>
 .)</p>
</dd>
<dt><a name="ERRXQST0075" id="ERRXQST0075"></a> err:XQST0075</dt>
<dd>
<p>An implementation that does not support the Validation Feature
must raise a <a title="static error" href="#dt-static-error">static
error</a> if it encounters a <code>validate</code> expression.</p>
</dd>
<dt><a name="ERRXQST0076" id="ERRXQST0076"></a> err:XQST0076</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if a <code>collation</code> subclause in an <code>order
by</code> clause of a FLWOR expression does not identify a
collation that is present in <a title="statically known collations" 
href="#dt-static-collations">statically known collations</a> .</p>
</dd>
<dt><a name="ERRXQST0077" id="ERRXQST0077"></a> err:XQST0077</dt>
<dd>
<p>(Not currently used.)</p>
</dd>
<dt><a name="ERRXQST0078" id="ERRXQST0078"></a> err:XQST0078</dt>
<dd>
<p>(Not currently used.)</p>
</dd>
<dt><a name="ERRXQST0079" id="ERRXQST0079"></a> err:XQST0079</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if an extension expression contains neither a <a 
title="pragma" href="#dt-pragma">pragma</a> that is recognized by the
implementation nor an expression enclosed in curly braces.</p>
</dd>
<dt><a name="ERRXPST0080" id="ERRXPST0080"></a> err:XPST0080</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if the target type of a <code>cast</code> or
<code>castable</code> expression is <code>xs:NOTATION</code> or
<code>xs:anyAtomicType</code> .</p>
</dd>
<dt><a name="ERRXPST0081" id="ERRXPST0081"></a> err:XPST0081</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if a QName used in <span class="xquery">a query</span>
contains a namespace prefix that cannot be expanded into a
namespace URI by using the <a title="statically known namespaces" 
href="#dt-static-namespaces">statically known namespaces</a> .</p>
</dd>
<dt><a name="ERRXQST0082" id="ERRXQST0082"></a> err:XQST0082</dt>
<dd>
<p>(Not currently used.)</p>
</dd>
<dt><a name="ERRXPST0083" id="ERRXPST0083"></a> err:XPST0083</dt>
<dd>
<p>(Not currently used.)</p>
</dd>
<dt><a name="ERRXQDY0084" id="ERRXQDY0084"></a> err:XQDY0084</dt>
<dd>
<p>It is a <a title="dynamic error" href="#dt-dynamic-error">dynamic 
error</a> if the element validated by a
<code>validate</code> statement does not have a top-level element
declaration in the <a title="in-scope element declarations" 
href="#dt-is-elems">in-scope element declarations</a> , if validation
mode is <code>strict</code> .</p>
</dd>
<dt><a name="ERRXQST0085" id="ERRXQST0085"></a> err:XQST0085</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if the namespace URI in a namespace declaration attribute
is a zero-length string, and the implementation does not support
<a href="#XMLNAMES11">[XML Names 1.1]</a> .</p>
</dd>
<dt><a name="ERRXQTY0086" id="ERRXQTY0086"></a> err:XQTY0086</dt>
<dd>
<p>It is a <a title="type error" href="#dt-type-error">type
error</a> if the typed value of a copied element or attribute node
is <a title="namespace-sensitive" href="#dt-namespace-sensitive">namespace-sensitive</a>
 when <a title="construction mode" href="#dt-construction-mode">construction
mode</a> is <code>preserve</code> and <a title="copy-namespaces mode" 
href="#dt-copy-namespaces-mode">copy-namespaces mode</a> is
<code>no-preserve</code> .</p>
</dd>
<dt><a name="ERRXQST0087" id="ERRXQST0087"></a> err:XQST0087</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if the encoding specified in a Version Declaration does
not conform to the definition of <code>EncName</code> specified in
<a href="#XML">[XML 1.0]</a> .</p>
</dd>
<dt><a name="ERRXQST0088" id="ERRXQST0088"></a> err:XQST0088</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if the literal that specifies the target namespace in a
<a title="module import" href="#dt-module-import">module import</a>
or a <a title="module declaration" href="#dt-module-declaration">module 
declaration</a> is of zero
length.</p>
</dd>
<dt><a name="ERRXQST0089" id="ERRXQST0089"></a> err:XQST0089</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if a variable bound in a <code>for</code> <ins 
class="diff-new">or</ins> <code><ins class="diff-new">window</ins></code>
clause of a FLWOR expression, and its associated positional
variable, do not have distinct names <del class="diff-old">(expanded 
QNames).</del> <ins class="diff-chg">(</ins>
<a title="expanded QName" href="#dt-expanded-qname"><ins 
class="diff-chg">expanded QNames</ins></a> <ins class="diff-chg">).</ins></p>
</dd>
<dt><a name="ERRXQST0090" id="ERRXQST0090"></a> err:XQST0090</dt>
<dd>
<p>It is a <a title="static error" href="#dt-static-error">static
error</a> if a <a title="character reference" 
href="#dt-character-reference">character reference</a> does not identify
a valid character in the version of XML that is in use.</p>
</dd>
<dt><a name="ERRXQDY0091" id="ERRXQDY0091"></a> err:XQDY0091</dt>
<dd>
<p>An implementation <a title="may" href="#may">MAY</a> raise a
<a title="dynamic error" href="#dt-dynamic-error">dynamic error</a>
if an <code>xml:id</code> error, as defined in <a href="#XMLID">[XML ID]</a>
 , is encountered during construction of an
attribute named <code>xml:id</code> .</p>
</dd>
<dt><a name="ERRXQDY0092" id="ERRXQDY0092"></a> err:XQDY0092</dt>
<dd>
<p>An implementation <a title="may" href="#may">MAY</a> raise a
<a title="dynamic error" href="#dt-dynamic-error">dynamic error</a>
if a constructed attribute named <code>xml:space</code> has a value
other than <code>preserve</code> or <code>default</code> .</p>
</dd>
<dt><a name="ERRXQST0094" id="ERRXQST0094"></a> <del class="diff-old">err:XQST0093</del>
 <ins class="diff-chg">err:XQST0094</ins></dt>
<dd>
<p><del class="diff-old">It</del> <ins class="diff-chg">In
the</ins> <code><ins class="diff-chg">group by</ins></code>
<ins class="diff-chg">clause of a FLWOR expression, it</ins> is a
<a title="static error" href="#dt-static-error">static error</a>
<ins class="diff-new">if the name of a grouping variable is not
equal (by the</ins> <code><ins class="diff-new">eq</ins></code>
<ins class="diff-new">operator on</ins> <a title="expanded QName" 
href="#dt-expanded-qname"><ins class="diff-new">expanded
QNames</ins></a> <ins class="diff-new">)</ins> to <del class="diff-old">import</del>
 <ins class="diff-chg">the name of</ins> a
<del class="diff-old">module M 1</del> <ins class="diff-chg">variable 
that is bound by a</ins> <code><ins class="diff-chg">for</ins></code> <ins
 class="diff-chg">or</ins>
<code><ins class="diff-chg">let</ins></code> <ins class="diff-chg">clause
 that precedes the</ins> <code><ins class="diff-chg">group by</ins></code>
 <ins class="diff-chg">clause.</ins></p>
</dd>
<dt><a name="ERRXQDY0095" id="ERRXQDY0095"></a><ins class="diff-chg">err:XQDY0095</ins></dt>
<dd>
<p><ins class="diff-chg">In the</ins> <code><ins class="diff-chg">group 
by</ins></code> <ins class="diff-chg">clause of a
FLWOR expression, it is a</ins> <a title="dynamic error" 
href="#dt-dynamic-error"><ins class="diff-chg">dynamic error</ins></a>
if <del class="diff-old">there exists</del> <ins class="diff-chg">the 
value bound to a grouping variable consists of</ins>
a sequence of <del class="diff-old">modules M 1 ... M i ... M 1
such</del> <ins class="diff-chg">more than one item.</ins></p>
</dd>
<dt><a name="ERRXQDY0096" id="ERRXQDY0096"></a><ins class="diff-chg">err:XQDY0096</ins></dt>
<dd>
<p><ins class="diff-chg">It is a</ins> <a title="dynamic error" 
href="#dt-dynamic-error"><ins class="diff-chg">dynamic
error</ins></a> <ins class="diff-chg">the node-name of a node
constructed by a computed element constructor has any of the
following properties:</ins></p>
<ul>
<li>
<p><ins class="diff-chg">Its namespace prefix is</ins>
<code><ins class="diff-chg">xmlns</ins></code> .</p>
</li>
<li>
<p><ins class="diff-chg">Its namespace URI is</ins>
<code><ins class="diff-chg">http://www.w3.org/2000/xmlns/</ins></code> .</p>
</li>
<li>
<p><ins class="diff-chg">Its namespace prefix is</ins>
<code><ins class="diff-chg">xml</ins></code> <ins class="diff-chg">and 
its namespace URI is not</ins> <code><ins class="diff-chg">http://www.w3.org/XML/1998/namespace</ins></code>
 .</p>
</li>
<li>
<p><ins class="diff-chg">Its namespace prefix is other than</ins>
<code><ins class="diff-chg">xml</ins></code> <ins class="diff-chg">and 
its namespace URI is</ins> <code><ins class="diff-chg">http://www.w3.org/XML/1998/namespace</ins></code>
 .</p>
</li>
</ul>
</dd>
<dt><a name="ERRXQST0097" id="ERRXQST0097"></a><ins class="diff-chg">err:XQST0097</ins></dt>
<dd>
<p><ins class="diff-chg">It is a static error for a decimal-format
to specify a value</ins> that <ins class="diff-new">is not legal
for a given property, as described in</ins> <a title="statically known 
decimal formats" href="#dt-static-decimal-formats"><ins class="diff-new">statically
 known
decimal formats</ins></a></p>
</dd>
<dt><a name="ERRXQST0098" id="ERRXQST0098"></a><ins class="diff-new">err:XQST0098</ins></dt>
<dd>
<p><ins class="diff-new">It is a static error if, for any named or
unnamed decimal format, the properties representing characters used
in a picture string do not</ins> each <del class="diff-old">module
directly depends</del> <ins class="diff-chg">have distinct values.
These properties are</ins> <a title="decimal-separator" 
href="#id-static-decimal-separator"><ins class="diff-chg">decimal-separator-sign</ins></a>
 ,<a title="grouping-separator" 
href="#id-static-decimal-format-grouping-separator"><ins 
class="diff-chg">grouping-separator</ins></a> ,<a title="percent-sign" 
href="#id-static-decimal-format-percent-sign"><ins class="diff-chg">percent-sign</ins></a>
 ,<a title="per-mille-sign" 
href="#id-static-decimal-format-per-mille-sign"><ins class="diff-chg">per-mille-sign</ins></a>
 ,<a title="zero-digit" href="#id-static-decimal-format-zero-digit"><ins
 class="diff-chg">zero-digit</ins></a> ,<a title="digit-sign" 
href="#id-static-decimal-format-digit-sign"><ins class="diff-chg">digit-sign</ins></a>
 ,<ins class="diff-chg">and</ins>
<a title="pattern-separator-sign" 
href="#id-static-decimal-format-pattern-separator-sign"><ins 
class="diff-chg">pattern-separator-sign</ins></a> .</p>
</dd>
<dt><a name="ERRXQST0099" id="ERRXQST0099"></a> <ins class="diff-new">err:XQST0099</ins></dt>
<dd>
<p><ins class="diff-new">A</ins> <code><ins class="diff-new">ContextItemDecl</ins></code>
 <ins class="diff-new">must
not occur after an expression that relies</ins> on the <del 
class="diff-old">next module</del> <ins class="diff-chg">initial context
item, and no query may contain more than one
ContextItemDecl.</ins></p>
</dd>
<dt><a name="ERRXQST0100" id="ERRXQST0100"></a><ins class="diff-chg">err:XQST0100</ins></dt>
<dd>
<p><ins class="diff-chg">It is a static error if any of the
following decimal format properties is not a single
character.</ins></p>
<ul>
<li>
<p><a title="decimal-separator" href="#id-static-decimal-separator"><ins
 class="diff-chg">decimal-separator</ins></a></p>
</li>
<li>
<p><a title="grouping-separator" 
href="#id-static-decimal-format-grouping-separator"><ins 
class="diff-chg">grouping-separator</ins></a></p>
</li>
<li>
<p><a title="percent-sign" href="#id-static-decimal-format-percent-sign"><ins
 class="diff-chg">percent-sign</ins></a></p>
</li>
<li>
<p><a title="per-mille-sign" 
href="#id-static-decimal-format-per-mille-sign"><ins class="diff-chg">per-mille-sign</ins></a></p>
</li>
<li>
<p><a title="zero-digit" href="#id-static-decimal-format-zero-digit"><ins
 class="diff-chg">zero-digit</ins></a></p>
</li>
<li>
<p><a title="digit-sign" href="#id-static-decimal-format-digit-sign"><ins
 class="diff-chg">digit-sign</ins></a></p>
</li>
<li>
<p><a title="pattern-separator-sign" 
href="#id-static-decimal-format-pattern-separator-sign"><ins 
class="diff-chg">pattern-separator-sign</ins></a></p>
</li>
</ul>
</dd>
<dt><a name="ERRXQDY0101" id="ERRXQDY0101"></a><ins class="diff-chg">err:XQDY0101</ins></dt>
<dd>
<p><ins class="diff-chg">An error is raised if the namespace URI in
a computed namespace constructor is bound to the predefined
prefix</ins> <code><ins class="diff-chg">xmlns</ins></code>
,<ins class="diff-chg">or if a namespace URI other than</ins>
<code><ins class="diff-chg">http://www.w3.org/XML/1998/namespace</ins></code>
<ins class="diff-chg">is bound to the prefix</ins>
<code><ins class="diff-chg">xml</ins></code> ,<ins class="diff-chg">or 
if the prefix</ins> <code><ins class="diff-chg">xml</ins></code> <ins 
class="diff-chg">is bound to a
namespace URI other than</ins> <code><ins class="diff-chg">http://www.w3.org/XML/1998/namespace.</ins></code></p>
</dd>
<dt><a name="ERRXQTY0102" id="ERRXQTY0102"></a><ins class="diff-chg">err:XQTY0102</ins></dt>
<dd>
<p><ins class="diff-chg">In an element constructor, if two or more
namespace bindings in the in-scope bindings would have the same
prefix, then an error is raised if they have different URIs; if
they would have the same prefix and URI, duplicate bindings are
ignored.</ins></p>
</dd>
<dt><a name="ERRXQST0103" id="ERRXQST0103"></a><ins class="diff-chg">err:XQST0103</ins></dt>
<dd>
<p><ins class="diff-chg">All variables in a</ins> <code><ins 
class="diff-chg">window</ins></code> <ins class="diff-chg">clause must
have distinct names.</ins></p>
</dd>
<dt><a name="ERRXQST0104" id="ERRXQST0104"></a><ins class="diff-chg">err:XQST0104</ins></dt>
<dd>
<p><ins class="diff-chg">A</ins> <a href="#doc-xquery11-TypeName"><ins 
class="diff-chg">TypeName</ins></a>
<ins class="diff-chg">that is specified in a</ins>
<code><ins class="diff-chg">validate</ins></code> <ins class="diff-chg">expression
 must be found</ins> in the <a title="in-scope schema definitions" 
href="#dt-issd"><ins class="diff-new">in-scope schema definitions</ins></a></p>
</dd>
<dt><a name="ERRXQTY0105" id="ERRXQTY0105"></a><ins class="diff-new">err:XQTY0105</ins></dt>
<dd>
<p><ins class="diff-new">It is a</ins> <a title="type error" 
href="#dt-type-error"><ins class="diff-new">type error</ins></a>
<ins class="diff-new">if the content</ins> sequence <del 
class="diff-old">(informally,</del> <ins class="diff-chg">in an element
constructor contains a function item.</ins></p>
</dd>
<dt><a name="ERRXQST0106" id="ERRXQST0106"></a><ins class="diff-chg">err:XQST0106</ins></dt>
<dd>
<p><ins class="diff-chg">It is a</ins> <a title="static error" 
href="#dt-static-error"><ins class="diff-chg">static
error</ins></a> if <del class="diff-old">M 1</del> <ins class="diff-chg">a
 function's annotations contain more than one
annotation named</ins> <code><ins class="diff-chg">%private</ins></code>
 <ins class="diff-chg">or</ins>
<code><ins class="diff-chg">%public</ins></code> .</p>
<p><ins class="diff-chg">It is a</ins> <a title="static error" 
href="#dt-static-error"><ins class="diff-chg">static
error</ins></a> <ins class="diff-chg">if a function's annotations
contain more than one annotation named</ins> <code><ins class="diff-chg">%deterministic</ins></code>
 <ins class="diff-chg">or</ins> <code><ins class="diff-chg">%nondeterministic</ins></code>
 .</p>
</dd>
<dt><a name="ERRXQST0107" id="ERRXQST0107"></a><ins class="diff-chg">err:XQST0107</ins></dt>
<dd>
<p><ins class="diff-chg">It is a</ins> <a title="static error" 
href="#dt-static-error"><ins class="diff-chg">static
error</ins></a> <ins class="diff-chg">if the initializer of the
context item</ins> <a title="expression depends on" 
href="#dt-depends-on-context-item">depends on <del class="diff-old">itself
 through some chain</del></a> <ins class="diff-chg">the context item.</ins></p>
</dd>
<dt><a name="ERRXQST0108" id="ERRXQST0108"></a><ins class="diff-chg">err:XQST0108</ins></dt>
<dd>
<p><ins class="diff-chg">It is a</ins> <a title="static error" 
href="#dt-static-error"><ins class="diff-chg">static
error</ins></a> <ins class="diff-chg">if an</ins> <a title="output 
declaration" href="#dt-output-declaration"><ins class="diff-chg">output 
declaration</ins></a> <ins class="diff-chg">occurs in a</ins> <a 
title="library module" href="#dt-library-module"><ins class="diff-chg">library
 module</ins></a>
.</p>
</dd>
<dt><a name="ERRXQST0109" id="ERRXQST0109"></a><ins class="diff-chg">err:XQST0109</ins></dt>
<dd>
<p><ins class="diff-chg">It is a</ins> <a title="static error" 
href="#dt-static-error"><ins class="diff-chg">static
error</ins></a> <ins class="diff-chg">if the local name of an
output declaration in the</ins> <code><ins class="diff-chg">http://www.w3.org/2009/xquery-serialization</ins></code>
<ins class="diff-chg">namespace is not one</ins> of <ins 
class="diff-new">the serialization parameter names listed in</ins>
<a href="#id-xq-serialization-parameters"><b><ins class="diff-new">C.3 
Serialization Parameters</ins></b></a> .</p>
</dd>
<dt><a name="ERRXQST0110" id="ERRXQST0110"></a><ins class="diff-new">err:XQST0110</ins></dt>
<dd>
<p><ins class="diff-new">It is a</ins> <a title="static error" 
href="#dt-static-error"><ins class="diff-new">static
error</ins></a> <ins class="diff-new">if the same serialization
parameter is used more than once in an</ins> <a title="output 
declaration" href="#dt-output-declaration"><ins class="diff-new">output 
declaration</ins></a> .</p>
</dd>
<dt><a name="ERRXQST0111" id="ERRXQST0111"></a><ins class="diff-new">err:XQST0111</ins></dt>
<dd>
<p><ins class="diff-new">It is a</ins> <a title="static error" 
href="#dt-static-error"><ins class="diff-new">static
error</ins></a> <ins class="diff-new">for a query prolog to contain
two decimal formats with the same name, or to contain two default
decimal formats. [</ins> <a title="err:XQST0111" href="#ERRXQST0111"><ins
 class="diff-new">err:XQST0111</ins></a>
<ins class="diff-new">].</ins></p>
</dd>
<dt><a name="ERRXPST0112" id="ERRXPST0112"></a><ins class="diff-new">err:XPST0112</ins></dt>
<dd>
<p><ins class="diff-new">It is a</ins> <a title="static error" 
href="#dt-static-error"><ins class="diff-new">static
error</ins></a> <ins class="diff-new">to partially apply or create
a function item for a function which accesses the focus [</ins>
<a title="err:XPST0112" href="#ERRXPST0112"><ins class="diff-new">err:XPST0112</ins></a>
 <ins class="diff-new">].</ins></p>
</dd>
<dt><a name="ERRXQST0113" id="ERRXQST0113"></a><ins class="diff-new">err:XQST0113</ins></dt>
<dd>
<p><ins class="diff-new">Specifying a</ins> <a 
href="#doc-xquery11-VarValue"><ins class="diff-new">VarValue</ins></a>
<ins class="diff-new">or</ins> <a href="#doc-xquery11-VarDefaultValue"><ins
 class="diff-new">VarDefaultValue</ins></a> <ins class="diff-new">for a
context item declaration in a library</ins> module <del class="diff-old">dependencies.)</del>
 <ins class="diff-chg">is a</ins>
<a title="static error" href="#dt-static-error"><ins class="diff-chg">static
 error</ins></a> .</p>
</dd>
</dl>
</div>
<div class="div1">
<h2><a id="id-mime-type" name="id-mime-type"></a> G The
<code>application/xquery</code> Media Type</h2>
<p>This Appendix specifies the media type for XQuery Version 1.0.
XQuery is a language for querying over collections of data from XML
data sources, as specified in the main body of this document. This
media type is being submitted to the IESG (Internet Engineering
Steering Group) for review, approval, and registration with IANA
(Internet Assigned Numbers Authority.)</p>
<div class="div2">
<h3><a id="id-mime-type-intro" name="id-mime-type-intro"></a> G.1
Introduction</h3>
<p>This document, found at <a href="http://www.w3.org/TR/xquery/">http://www.w3.org/TR/xquery/
<del class="diff-old">,</del></a> , together with its normative
references, defines the language XQuery Version 1.0. This Appendix
provides information about the <code>application/xquery</code>
media type, which is intended to be used for transmitting queries
written in the XQuery language.</p>
<p>This document was prepared by members of the W3C XML Query
Working Group. Please send comments to public-qt-comments@w3.org, a
public mailing list with archives at <a 
href="http://lists.w3.org/Archives/Public/public-qt-comments">http://lists.w3.org/Archives/Public/public-qt-comments</a>
.</p>
</div>
<div class="div2">
<h3><a id="id-registration-of-mime-type" 
name="id-registration-of-mime-type"></a> G.2 Registration of MIME Media
Type <code>application/xquery</code></h3>
<p>MIME media type name: <code>application</code></p>
<p>MIME subtype name: <code>xquery</code></p>
<p>Required parameters: none</p>
<p>Optional parameters: none</p>
<p>The syntax of XQuery is expressed in Unicode but may be written
with any Unicode-compatible character encoding, including UTF-8 or
UTF-16, or transported as US-ASCII or <del class="diff-old">Latin-1</del>
 <ins class="diff-chg">ISO-8859-1</ins>
with Unicode characters outside the range of the given encoding
represented using an XML-style <code>&amp;#xddd;</code> syntax.</p>
<div class="div3">
<h4><a id="id-interoperability-considerations" 
name="id-interoperability-considerations"></a> G.2.1 Interoperability
Considerations</h4>
<p>None known.</p>
</div>
<div class="div3">
<h4><a id="id-applications-of-media-type" 
name="id-applications-of-media-type"></a> G.2.2 Applications Using this
Media Type</h4>
<p>The public <a href="http://www.w3.org/XML/Query">XQuery Web
page</a> lists more than two dozen implementations of the XQuery
language, both proprietary and open source.</p>
<p>This new media type is being registered to allow for deployment
of XQuery on the World Wide Web.</p>
</div>
<div class="div3">
<h4><a id="id-file-extensions" name="id-file-extensions"></a> G.2.3
File Extensions</h4>
<p>The most common file extensions in use for XQuery are
<code>.xq</code> and <code>.xquery</code> .</p>
<p>The appropriate Macintosh file type code is <code>TEXT</code>
.</p>
</div>
<div class="div3">
<h4><a id="id-intended-usage" name="id-intended-usage"></a> G.2.4
Intended Usage</h4>
<p>The intended usage of this media type is for interchange of
XQuery expressions.</p>
</div>
<div class="div3">
<h4><a id="id-author-change-controller" 
name="id-author-change-controller"></a> G.2.5 Author/Change
Controller</h4>
<p>XQuery was produced by, and is maintained by, the World Wide Web
Consortium's XML Query Working Group. The W3C has change control
over this specification.</p>
</div>
</div>
<div class="div2">
<h3><a id="xquery-mime-encoding" name="xquery-mime-encoding"></a>
G.3 Encoding Considerations</h3>
<p>For use with transports that are not 8-bit clean,
quoted-printable encoding is recommended since the XQuery syntax
itself uses the US-ASCII-compatible subset of Unicode.</p>
<p>An XQuery document may contain an <a title="encoding declaration" 
href="#dt-encoding-declaration">encoding
declaration</a> as part of its <a title="version declaration" 
href="#dt-version-declaration">version declaration</a> :</p>
<div class="exampleInner">
<pre>xquery version "1.0" encoding "utf-8";
</pre></div>
</div>
<div class="div2">
<h3><a id="xquery-mime-recognizing" name="xquery-mime-recognizing"></a> 
G.4 Recognizing XQuery Files</h3>
<p>An XQuery file may have the string <code>xquery version
"V.V"</code> near the beginning of the document, where
<code>"V.V"</code> is a version number. Currently the version
number, if present, must be <code>"1.0"</code> .</p>
</div>
<div class="div2">
<h3><a id="id-charset-default-rules" name="id-charset-default-rules"></a>
 G.5 Charset Default Rules</h3>
<p>XQuery documents use the Unicode character set and, by default,
the UTF-8 encoding.</p>
</div>
<div class="div2">
<h3><a id="id-security-considerations" name="id-security-considerations"></a>
 G.6 Security Considerations</h3>
<p>Queries written in XQuery may cause arbitrary URIs or IRIs to be
dereferenced. Therefore, the security issues of <a href="#RFC3987">[RFC3987]</a>
 Section 8 should be considered. In
addition, the contents of resources identified by
<code>file:</code> URIs can in some cases be accessed, processed
and returned as results. XQuery expressions can invoke any of the
functions defined in <a href="#xpath-functions-11">[XQuery
<del class="diff-old">1.0</del> and XPath <del class="diff-old">2.0</del>
 Functions and <del class="diff-old">Operators]</del> <ins 
class="diff-chg">Operators
1.1]</ins></a> . For example, the <code>fn:doc()</code> and
<code>fn:doc-available()</code> functions allow local filesystem
probes as well as access to any URI-defined resource accessible
from the system evaluating the XQuery expression.</p>
<p>XQuery is a full declarative programming language, and supports
user-defined functions, external function libraries (modules)
referenced by URI, and system-specific "native" functions.</p>
<p>Arbitrary recursion is possible, as is arbitrarily large memory
usage, and implementations may place limits on CPU and memory
usage, as well as restricting access to system-defined
functions.</p>
<p>The XML Query Working group is working on a facility to allow
XQuery expressions to create and update persistent data. Untrusted
queries should not be given write access to data.</p>
<p>Furthermore, because the XQuery language permits extensions, it
is possible that <code>application/xquery</code> may describe
content that has security implications beyond those described
here.</p>
</div>
</div>
<div class="div1">
<h2><a id="id-glossary" name="id-glossary"></a> H Glossary
(Non-Normative)</h2>
<dl>
<dt><a name="GLdt-annotation-assertion" id="GLdt-annotation-assertion"></a>
 <ins class="diff-new">annotation
assertion</ins></dt>
<dd>
<p><ins class="diff-new">If an annotation is present in a
FunctionTest, it is called an</ins> <b><ins class="diff-new">annotation 
assertion</ins></b> .</p>
</dd>
<dt><a name="GLdt-arg-expr" id="GLdt-arg-expr"></a><ins class="diff-new">argument
 expression</ins></dt>
<dd>
<p><ins class="diff-new">An argument to a function call is either
an</ins> <b><ins class="diff-new">argument expression</ins></b>
<ins class="diff-new">or an ArgumentPlaceholder ("?").</ins></p>
</dd>
<dt><a name="GLdt-arg-value" id="GLdt-arg-value"></a><ins 
class="diff-new">argument value</ins></dt>
<dd>
<p><a title="argument expression" href="#dt-arg-expr"><ins 
class="diff-new">Argument expressions</ins></a> <ins class="diff-new">are
evaluated,
 producing</ins> <b><ins class="diff-new">argument
values</ins></b> .</p>
</dd>
<dt><a name="GLdt-atomic-value" id="GLdt-atomic-value"></a> atomic
value</dt>
<dd>
<p>An <b>atomic value</b> is a value in the value space of an
<b>atomic type</b> , as defined in <a href="#XMLSchema">[XML
Schema]</a> .</p>
</dd>
<dt><a name="GLdt-atomization" id="GLdt-atomization"></a>
atomization</dt>
<dd>
<p><b>Atomization</b> of a sequence is defined as the result of
invoking the <code>fn:data</code> function on the sequence, as
defined in <a href="#xpath-functions-11">[XQuery <del class="diff-old">1.0</del>
 and XPath <del class="diff-old">2.0</del>
Functions and <del class="diff-old">Operators]</del> <ins 
class="diff-chg">Operators 1.1]</ins></a> .</p>
</dd>
<dt><a name="GLdt-available-collections" id="GLdt-available-collections"></a>
 available collections</dt>
<dd>
<p><b>Available collections.</b> This is a mapping of strings onto
sequences of nodes. The string represents the absolute URI of a
resource. The sequence of nodes represents the result of the
<code>fn:collection</code> function when that URI is supplied as
the argument.</p>
</dd>
<dt><a name="GLdt-available-docs" id="GLdt-available-docs"></a>
available documents</dt>
<dd>
<p><b>Available documents.</b> This is a mapping of strings onto
document nodes. The string represents the absolute URI of a
resource. The document node is the root of a tree that represents
that resource using the <a title="data model" href="#dt-datamodel">data 
model</a> . The document node is returned by
the <code>fn:doc</code> function when applied to that URI.</p>
</dd>
<dt><a name="GLdt-axis-step" id="GLdt-axis-step"></a> axis
step</dt>
<dd>
<p>An <b>axis step</b> returns a sequence of nodes that are
reachable from the context node via a specified axis. Such a step
has two parts: an <b>axis</b> , which defines the "direction of
movement" for the step, and a <a title="node test" href="#dt-node-test">node
 test</a> , which selects nodes based on their
kind, name, and/or <a title="type annotation" href="#dt-type-annotation">type
 annotation</a> .</p>
</dd>
<dt><a name="GLdt-base-uri" id="GLdt-base-uri"></a> base URI</dt>
<dd>
<p><b>Base URI.</b> This is an absolute URI, used when necessary in
the resolution of relative URIs (for example, by the
<code>fn:resolve-uri</code> function.)</p>
</dd>
<dt><a name="GLdt-base-uri-decl" id="GLdt-base-uri-decl"></a> base
URI declaration</dt>
<dd>
<p>A <b>base URI declaration</b> specifies the <a title="base URI" 
href="#dt-base-uri">base URI</a> property of the <a title="static 
context" href="#dt-static-context">static context</a> . The
<a title="base URI" href="#dt-base-uri">base URI</a> property is
used when resolving relative URIs within a <a title="module" 
href="#dt-module">module</a> .</p>
</dd>
<dt><a name="GLdt-binding-sequence" id="GLdt-binding-sequence"></a>
binding sequence</dt>
<dd>
<p><del class="diff-old">The value of the expression associated
with a variable in</del> <ins class="diff-chg">In</ins> a
<code>for</code> clause <ins class="diff-new">or</ins>
<code><ins class="diff-new">window</ins></code> <ins class="diff-new">clause,
 when an expression</ins> is <del class="diff-old">called</del> <ins 
class="diff-chg">preceded by the
keyword</ins> <code><ins class="diff-chg">in</ins></code> , the
<ins class="diff-new">value of that expression is called a</ins>
<b>binding sequence <del class="diff-old">for that
variable.</del></b> .</p>
</dd>
<dt><a name="GLdt-boundary-space-decl" id="GLdt-boundary-space-decl"></a>
 boundary-space declaration</dt>
<dd>
<p>A <b>boundary-space declaration</b> sets the <a title="boundary-space
 policy" href="#dt-boundary-space-policy">boundary-space policy</a> in 
the
<a title="static context" href="#dt-static-context">static
context</a> , overriding any implementation-defined default.
Boundary-space policy controls whether <a title="boundary whitespace" 
href="#dt-boundary-whitespace">boundary
whitespace</a> is preserved by element constructors during
processing of the query.</p>
</dd>
<dt><a name="GLdt-boundary-space-policy" id="GLdt-boundary-space-policy"></a>
 boundary-space policy</dt>
<dd>
<p><b>Boundary-space policy.</b> This component controls the
processing of <a title="boundary whitespace" 
href="#dt-boundary-whitespace">boundary whitespace</a> by <a 
title="direct element constructor" href="#dt-direct-elem-const">direct
element constructors</a> , as described in <a href="#id-whitespace"><b><del
 class="diff-old">3.7.1.4</del> <ins class="diff-chg">3.8.1.4</ins> 
Boundary Whitespace</b></a> .</p>
</dd>
<dt><a name="GLdt-boundary-whitespace" id="GLdt-boundary-whitespace"></a>
 boundary whitespace</dt>
<dd>
<p><b>Boundary whitespace</b> is a sequence of consecutive
whitespace characters within the content of a <a title="direct element 
constructor" href="#dt-direct-elem-const">direct
element constructor</a> , that is delimited at each end either by
the start or end of the content, or by a <a 
href="#doc-xquery11-DirectConstructor">DirectConstructor</a> , or by an
<a href="#doc-xquery11-EnclosedExpr">EnclosedExpr</a> . For this
purpose, characters generated by <a title="character reference" 
href="#dt-character-reference">character references</a> such as
<code>&amp;#x20;</code> or by <a href="#doc-xquery11-CDataSection">CdataSections</a>
 are not considered
to be whitespace characters.</p>
</dd>
<dt><a name="GLdt-built-in-function" id="GLdt-built-in-function"></a> 
built-in function</dt>
<dd>
<p>The <b>built-in functions</b> supported by XQuery <ins 
class="diff-new">1.1</ins> are defined in <a href="#xpath-functions-11">[XQuery
 <del class="diff-old">1.0</del> and
XPath <del class="diff-old">2.0</del> Functions and <del 
class="diff-old">Operators]</del> <ins class="diff-chg">Operators
1.1]</ins></a> .</p>
</dd>
<dt><a name="GLdt-character-reference" id="GLdt-character-reference"></a>
 character reference</dt>
<dd>
<p>A <b>character reference</b> is an XML-style reference to a
<a href="#Unicode">[Unicode]</a> character, identified by its
decimal or hexadecimal <del class="diff-old">code point.</del>
<ins class="diff-chg">codepoint.</ins></p>
</dd>
<dt><a name="GLdt-collation" id="GLdt-collation"></a>
collation</dt>
<dd>
<p>A <b>collation</b> is a specification of the manner in which
strings and URIs are compared and, by extension, ordered. For a
more complete definition of collation, see <a href="#xpath-functions-11">[XQuery
 <del class="diff-old">1.0</del> and
XPath <del class="diff-old">2.0</del> Functions and <del 
class="diff-old">Operators]</del> <ins class="diff-chg">Operators
1.1]</ins></a> .</p>
</dd>
<dt><a name="GLdt-comma-operator" id="GLdt-comma-operator"></a>
comma operator</dt>
<dd>
<p>One way to construct a sequence is by using the <b>comma
operator</b> , which evaluates each of its operands and
concatenates the resulting sequences, in order, into a single
result sequence.</p>
</dd>
<dt><a name="GLdt-computed-elem-const" id="GLdt-computed-elem-const"></a>
 computed element constructor</dt>
<dd>
<p>A <b>computed element constructor</b> creates an element node,
allowing both the name and the content of the node to be
computed.</p>
</dd>
<dt><a name="GLdt-construction-decl" id="GLdt-construction-decl"></a> 
construction declaration</dt>
<dd>
<p>A <b>construction declaration</b> sets the <a title="construction 
mode" href="#dt-construction-mode">construction
mode</a> in the <a title="static context" href="#dt-static-context">static
 context</a> , overriding any
implementation-defined default.</p>
</dd>
<dt><a name="GLdt-construction-mode" id="GLdt-construction-mode"></a> 
construction mode</dt>
<dd>
<p><b>Construction mode.</b> The construction mode governs the
behavior of element and document node constructors. If construction
mode is <code>preserve</code> , the type of a constructed element
node is <code>xs:anyType</code> , and all attribute and element
nodes copied during node construction retain their original types.
If construction mode is <code>strip</code> , the type of a
constructed element node is <code>xs:untyped</code> ; all element
nodes copied during node construction receive the type
<code>xs:untyped</code> , and all attribute nodes copied during
node construction receive the type <code>xs:untypedAtomic</code>
.</p>
</dd>
<dt><a name="GLdt-constructor-function" id="GLdt-constructor-function"></a>
 constructor function</dt>
<dd>
<p>The <b>constructor function</b> for a given type is used to
convert instances of other atomic types into the given type. The
semantics of the constructor function call <code>T($arg)</code> are
defined to be equivalent to the expression <code>(($arg) cast as
T?)</code> .</p>
</dd>
<dt><a name="GLdt-content-expression" id="GLdt-content-expression"></a> 
content expression</dt>
<dd>
<p>The final part of a computed constructor is an expression
enclosed in braces, called the <b>content expression</b> of the
constructor, that generates the content of the node.</p>
</dd>
<dt><a name="GLdt-context-item" id="GLdt-context-item"></a> context
item</dt>
<dd>
<p>The <b>context item</b> is the item currently being processed.
An item is either an atomic value or a node.</p>
</dd>
<dt><a name="GLdt-context-item-static-type" 
id="GLdt-context-item-static-type"></a> context item static type</dt>
<dd>
<p><b>Context item static type.</b> This component defines the
<a title="static type" href="#dt-static-type">static type</a> of
the context item within the scope of a given expression.</p>
</dd>
<dt><a name="GLdt-context-node" id="GLdt-context-node"></a> context
node</dt>
<dd>
<p>When the context item is a node, it can also be referred to as
the <b>context node</b> .</p>
</dd>
<dt><a name="GLdt-context-position" id="GLdt-context-position"></a>
context position</dt>
<dd>
<p>The <b>context position</b> is the position of the context item
within the sequence of items currently being processed.</p>
</dd>
<dt><a name="GLdt-context-size" id="GLdt-context-size"></a> context
size</dt>
<dd>
<p>The <b>context size</b> is the number of items in the sequence
of items currently being processed.</p>
</dd>
<dt><a name="GLdt-copy-namespaces-decl" id="GLdt-copy-namespaces-decl"></a>
 copy-namespaces declaration</dt>
<dd>
<p>A <b>copy-namespaces declaration</b> sets the value of <a 
title="copy-namespaces mode" href="#dt-copy-namespaces-mode">copy-namespaces
 mode</a> in the
<a title="static context" href="#dt-static-context">static
context</a> , overriding any implementation-defined default.
Copy-namespaces mode controls the namespace bindings that are
assigned when an existing element node is copied by an element
constructor or document constructor.</p>
</dd>
<dt><a name="GLdt-copy-namespaces-mode" id="GLdt-copy-namespaces-mode"></a>
 copy-namespaces mode</dt>
<dd>
<p><b>Copy-namespaces mode.</b> This component controls the
namespace bindings that are assigned when an existing element node
is copied by an element constructor, as described in <a 
href="#id-element-constructor"><b><del class="diff-old">3.7.1</del>
<ins class="diff-chg">3.8.1</ins> Direct Element
Constructors</b></a> . Its value consists of two parts:
<code>preserve</code> or <code>no-preserve</code> , and
<code>inherit</code> or <code>no-inherit</code> .</p>
</dd>
<dt><a name="GLdt-date-time" id="GLdt-date-time"></a> current
dateTime</dt>
<dd>
<p><b>Current dateTime.</b> This information represents an
<a title="implementation dependent" href="#dt-implementation-dependent">implementation-dependent</a>
 point
in time during the processing of <span class="xquery">a
query</span> , and includes an explicit timezone. It can be
retrieved by the <code>fn:current-dateTime</code> function. If
invoked multiple times during the execution of <span class="xquery">a 
query</span> , this function always returns the same
result.</p>
</dd>
<dt><a name="GLdt-datamodel" id="GLdt-datamodel"></a> data
model</dt>
<dd>
<p>XQuery <ins class="diff-new">1.1</ins> operates on the abstract,
logical structure of an XML document, rather than its surface
syntax. This logical structure, known as the <b>data model</b> , is
defined in <del class="diff-old">[XQuery/XPath</del> <a 
href="#xpath-datamodel-11"><ins class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> .</p>
</dd>
<dt><a name="GLdt-data-model-schema" id="GLdt-data-model-schema"></a> 
data model schema</dt>
<dd>
<p>For a given node in an <a title="XDM instance" 
href="#dt-data-model-instance">XDM instance</a> , the <b>data model
schema</b> is defined as the schema from which the <a title="type 
annotation" href="#dt-type-annotation">type annotation</a> of
that node was derived.</p>
</dd>
<dt><a name="GLdt-decimal-format-decl" id="GLdt-decimal-format-decl"></a>
 <ins class="diff-new">decimal-format declaration</ins></dt>
<dd>
<p><ins class="diff-new">A</ins> <b><ins class="diff-new">decimal-format
 declaration</ins></b> <ins class="diff-new">defines</ins> <a 
title="statically known decimal formats" 
href="#dt-static-decimal-formats"><ins class="diff-new">statically known
decimal formats</ins></a> ,<ins class="diff-new">which define the
properties used to format numbers using the</ins> <code><ins 
class="diff-new">fn:format-number()</ins></code> <ins class="diff-new">function</ins></p>
</dd>
<dt><a name="GLid-static-decimal-separator" 
id="GLid-static-decimal-separator"></a><ins class="diff-new">decimal-separator</ins></dt>
<dd>
<p><b><ins class="diff-new">decimal-separator</ins></b> <ins 
class="diff-new">specifies the character used for the
decimal-separator-sign; the default value is the period character
(.)</ins></p>
</dd>
<dt><a name="GLdt-def-collation" id="GLdt-def-collation"></a>
default collation</dt>
<dd>
<p><b>Default collation.</b> This identifies one of the collations
in <a title="statically known collations" href="#dt-static-collations">statically
 known collations</a> as the
collation to be used by functions and operators for comparing and
ordering values of type <code>xs:string</code> and
<code>xs:anyURI</code> (and types derived from them) when no
explicit collation is specified.</p>
</dd>
<dt><a name="GLdt-default-collation-decl" 
id="GLdt-default-collation-decl"></a> default collation
declaration</dt>
<dd>
<p>A <b>default collation declaration</b> sets the value of the
<a title="default collation" href="#dt-def-collation">default
collation</a> in the <a title="static context" href="#dt-static-context">static
 context</a> , overriding any
implementation-defined default.</p>
</dd>
<dt><a name="GLdt-default-collection" id="GLdt-default-collection"></a> 
default collection</dt>
<dd>
<p><b>Default collection.</b> This is the sequence of nodes that
would result from calling the <code>fn:collection</code> function
with no arguments.</p>
</dd>
<dt><a name="GLdt-def-elemtype-ns" id="GLdt-def-elemtype-ns"></a>
default element/type namespace</dt>
<dd>
<p><b>Default element/type namespace.</b> This is a namespace URI
or "none". The namespace URI, if present, is used for any
unprefixed QName appearing in a position where an element or type
name is expected.</p>
</dd>
<dt><a name="GLdt-def-fn-ns" id="GLdt-def-fn-ns"></a> default
function namespace</dt>
<dd>
<p><b>Default function namespace.</b> This is a namespace URI or
"none". The namespace URI, if present, is used for any unprefixed
QName appearing in a position where a function name is
expected.</p>
</dd>
<dt><a name="GLdt-default-empty-order" id="GLdt-default-empty-order"></a>
 default order for empty
sequences</dt>
<dd>
<p><b>Default order for empty sequences.</b> This component
controls the processing of empty sequences and <code>NaN</code>
values as ordering keys in an <code>order by</code> clause in a
FLWOR expression, as described in <a href="#id-order-by-clause"><b><del 
class="diff-old">3.8.3</del>
<ins class="diff-chg">3.9.8</ins> Order By <del class="diff-old">and 
Return Clauses</del> <ins class="diff-chg">Clause</ins></b></a> .</p>
</dd>
<dt><a name="GLdelimiting-token" id="GLdelimiting-token"></a>
delimiting terminal symbol</dt>
<dd>
<p>The <b>delimiting terminal symbols</b> are: <a 
href="#prod-xquery11-S">S</a> , "-", (comma), (semi-colon), (colon),
"::", ":=", "!=", "?", "?&gt;", "/", "//", "/&gt;", (dot), "..",
<a href="#prod-xquery11-StringLiteral">StringLiteral</a> , "(",
"(#", ")", "[", "]", "]]&gt;", "{", "}", "@", "$", "*", <ins 
class="diff-new">"#",</ins> "#)", <ins class="diff-new">"%",</ins> "+",
"&lt;", "&lt;!--", "&lt;![CDATA[", "&lt;?", "&lt;/", "&lt;&lt;",
"&lt;=", "=", "&gt;", "--&gt;", "&gt;=", "&gt;&gt;", "|"</p>
</dd>
<dt><a name="GLdt-depends-on-function" id="GLdt-depends-on-function"></a>
 <ins class="diff-new">depends on a
function</ins></dt>
<dd>
<p><ins class="diff-new">An expression</ins> <code><ins class="diff-new">E</ins></code>
 <b><ins class="diff-new">depends on a
function</ins></b> <ins class="diff-new">if any of the following is
true:</ins></p>
<table>
<tbody>
<tr>
<td>
<ul>
<li>
<p><code><ins class="diff-new">E</ins></code> <ins class="diff-new">is a
 call on function</ins> <code><ins class="diff-new">F</ins></code></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <a title="depends on a 
function" href="#dt-depends-on-function"><ins class="diff-new">depends 
on a function</ins></a> <ins class="diff-new">whose body</ins> <a 
title="depends on a function" href="#dt-depends-on-function"><ins 
class="diff-new">depends
on</ins></a> <code><ins class="diff-new">F</ins></code> .</p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <a title="expression 
depends on" href="#dt-depends-on-context-item"><ins class="diff-new">depends
 on the
context item</ins></a> <ins class="diff-new">and the initializer of
the context item</ins> <a title="depends on a function" 
href="#dt-depends-on-function"><ins class="diff-new">depends
on</ins></a> <code><ins class="diff-new">F</ins></code></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <a title="depends on a 
variable" href="#dt-depends-on-variable"><ins class="diff-new">depends 
on a variable</ins></a> <ins class="diff-new">whose initializer</ins> <a
 title="depends on a function" href="#dt-depends-on-function"><ins 
class="diff-new">depends
on</ins></a> <code><ins class="diff-new">F</ins></code></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <ins class="diff-new">contains
 (directly or indirectly) an expression
that</ins> <a title="depends on a function" 
href="#dt-depends-on-function"><ins class="diff-new">depends
on</ins></a> <code><ins class="diff-new">F</ins></code></p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd>
<dt><a name="GLdt-depends-on-variable" id="GLdt-depends-on-variable"></a><ins
 class="diff-new">depends on a
variable</ins></dt>
<dd>
<p><ins class="diff-new">An expression</ins> <code><ins class="diff-new">E</ins></code>
 <b><ins class="diff-new">depends on a
variable</ins></b> <code><ins class="diff-new">V</ins></code>
<ins class="diff-new">if any of the following is true:</ins></p>
<table>
<tbody>
<tr>
<td>
<ul>
<li>
<p><code><ins class="diff-new">E</ins></code> <ins class="diff-new">is a
 variable reference bound to variable</ins>
<code><ins class="diff-new">V</ins></code></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <a title="depends on a 
variable" href="#dt-depends-on-variable"><ins class="diff-new">depends 
on a variable</ins></a> <ins class="diff-new">whose initializer depends 
on</ins> <code><ins class="diff-new">V</ins></code></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <a title="expression 
depends on" href="#dt-depends-on-context-item"><ins class="diff-new">depends
 on the
context item</ins></a> <ins class="diff-new">and the initializer of
the context item</ins> <a title="depends on a variable" 
href="#dt-depends-on-variable"><ins class="diff-new">depends
on</ins></a> <code><ins class="diff-new">V</ins></code></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <a title="depends on a 
function" href="#dt-depends-on-function"><ins class="diff-new">depends 
on a function</ins></a> <ins class="diff-new">whose body</ins> <a 
title="depends on a variable" href="#dt-depends-on-variable"><ins 
class="diff-new">depends
on</ins></a> <code><ins class="diff-new">V</ins></code></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <ins class="diff-new">contains
 (directly or indirectly) an expression
that</ins> <a title="depends on a variable" 
href="#dt-depends-on-variable"><ins class="diff-new">depends
on</ins></a> <code><ins class="diff-new">V</ins></code></p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd>
<dt><a name="GLdt-deterministic-function" 
id="GLdt-deterministic-function"></a><ins class="diff-new">deterministic
 function</ins></dt>
<dd>
<p><ins class="diff-new">A</ins> <b><ins class="diff-new">deterministic 
function</ins></b> <ins class="diff-new">is a function that always 
evaluates to the same result
if it is invoked with the same arguments.</ins></p>
</dd>
<dt><a name="GLid-static-decimal-format-digit-sign" 
id="GLid-static-decimal-format-digit-sign"></a><ins class="diff-new">digit-sign</ins></dt>
<dd>
<p><b><ins class="diff-new">digit-sign</ins></b> <ins class="diff-new">specifies
 the character used for the digit-sign in the
picture string; the default value is the number sign character
(#)</ins></p>
</dd>
<dt><a name="GLdt-direct-elem-const" id="GLdt-direct-elem-const"></a> 
direct element constructor</dt>
<dd>
<p>A <b>direct element constructor</b> is a form of element
constructor in which the name of the constructed element is a
constant.</p>
</dd>
<dt><a name="GLdt-document-order" id="GLdt-document-order"></a>
document order</dt>
<dd>
<p>Informally, <b>document order</b> is the order in which nodes
appear in the XML serialization of a document.</p>
</dd>
<dt><a name="GLdt-dynamic-context" id="GLdt-dynamic-context"></a>
dynamic context</dt>
<dd>
<p>The <b>dynamic context</b> of an expression is defined as
information that is available at the time the expression is
evaluated.</p>
</dd>
<dt><a name="GLdt-dynamic-error" id="GLdt-dynamic-error"></a>
dynamic error</dt>
<dd>
<p>A <b>dynamic error</b> is an error that must be detected during
the dynamic evaluation phase and may be detected during the static
analysis phase. Numeric overflow is an example of a dynamic
error.</p>
</dd>
<dt><a name="GLdt-dynamic-evaluation" id="GLdt-dynamic-evaluation"></a> 
dynamic evaluation phase</dt>
<dd>
<p>The <b>dynamic evaluation phase</b> is the phase during which
the value of an expression is computed.</p>
</dd>
<dt><a name="GLdt-dynamic-function-invocation" 
id="GLdt-dynamic-function-invocation"></a> <ins class="diff-new">dynamic
 function invocation</ins></dt>
<dd>
<p><ins class="diff-new">A</ins> <b><ins class="diff-new">dynamic
function invocation</ins></b> <ins class="diff-new">consists of a
PrimaryExpr that returns the function item and a parenthesized list
of zero or more arguments (</ins> <a title="argument expression" 
href="#dt-arg-expr"><ins class="diff-new">argument
expressions</ins></a> <ins class="diff-new">or
ArgumentPlaceholders).</ins></p>
</dd>
<dt><a name="GLdt-dynamic-function-invoction" 
id="GLdt-dynamic-function-invoction"></a><ins class="diff-new">dynamic
function invocation</ins></dt>
<dd>
<p><ins class="diff-new">An expression (other than a raw EQName)
followed by an argument list in parentheses (that is,</ins>
<code><ins class="diff-new">E1(E2, E3, ...)</ins></code>
<ins class="diff-new">) is referred to as a</ins> <b><ins 
class="diff-new">dynamic function invocation</ins></b> .<ins 
class="diff-new">Its effect is to evaluate</ins> <code><ins 
class="diff-new">E1</ins></code> <ins class="diff-new">to obtain a
function item, and then call the function represented by that
function item, with</ins> <code><ins class="diff-new">E2</ins></code> ,<code><ins
 class="diff-new">E3</ins></code> ,<code>...</code><ins class="diff-new">as
 arguments.</ins></p>
</dd>
<dt><a name="GLtd-dynamic-scope" id="GLtd-dynamic-scope"></a><ins 
class="diff-new">dynamic
scope</ins></dt>
<dd>
<p><ins class="diff-new">If a component has</ins> <b><ins 
class="diff-new">dynamic scope</ins></b> ,<ins class="diff-new">then it
is defined by a query expression, its scope is defined by the
semantics of the expression that defines it, and run-time
evaluation may influence its value.</ins></p>
</dd>
<dt><a name="GLdt-dynamic-type" id="GLdt-dynamic-type"></a> dynamic
type</dt>
<dd>
<p>A <b>dynamic type</b> is associated with each value as it is
computed. The dynamic type of a value may be more specific than the
<a title="static type" href="#dt-static-type">static type</a> of
the expression that computed it (for example, the static type of an
expression might be <code>xs:integer*</code> , denoting a sequence
of zero or more integers, but at evaluation time its value may have
the dynamic type <code>xs:integer</code> , denoting exactly one
integer.)</p>
</dd>
<dt><a name="GLdt-ebv" id="GLdt-ebv"></a> effective boolean
value</dt>
<dd>
<p>The <b>effective boolean value</b> of a value is defined as the
result of applying the <code>fn:boolean</code> function to the
value, as defined in <a href="#xpath-functions-11">[XQuery
<del class="diff-old">1.0</del> and XPath <del class="diff-old">2.0</del>
 Functions and <del class="diff-old">Operators]</del> <ins 
class="diff-chg">Operators
1.1]</ins></a> .</p>
</dd>
<dt><a name="GLid-effective-case-switch-expression" 
id="GLid-effective-case-switch-expression"></a> <ins class="diff-new">effective
 case</ins></dt>
<dd>
<p><ins class="diff-new">The</ins> <b><ins class="diff-new">effective 
case</ins></b> <ins class="diff-new">of a
switch expression is the first case clause that matches, using the
rules given above.</ins></p>
</dd>
<dt><a name="GLdt-effective-case" id="GLdt-effective-case"></a>
effective case</dt>
<dd>
<p>The <b>effective case</b> in a <code>typeswitch</code>
expression is the first <code>case</code> clause <del class="diff-old">such
 that</del> <ins class="diff-chg">in which</ins> the
value of the operand expression matches <del class="diff-old">the</del> <ins
 class="diff-chg">a</ins> <a href="#doc-xquery11-SequenceType">SequenceType</a>
 in the <a href="#doc-xquery11-SequenceType"><ins class="diff-new">SequenceTypeUnion</ins></a>
 <ins class="diff-new">of
the</ins> <code>case</code> clause, using the rules of <a 
title="SequenceType matching" href="#dt-sequencetype-matching">SequenceType
 matching</a> .</p>
</dd>
<dt><a name="GLdt-empty-order-decl" id="GLdt-empty-order-decl"></a>
empty order declaration</dt>
<dd>
<p>An <b>empty order declaration</b> sets the <a title="default order 
for empty sequences" href="#dt-default-empty-order">default order for 
empty sequences</a> in
the <a title="static context" href="#dt-static-context">static
context,</a> overriding any implementation-defined default. This
declaration controls the processing of empty sequences and
<code>NaN</code> values as ordering keys in an <code>order
by</code> clause in a FLWOR expression.</p>
</dd>
<dt><a name="GLdt-empty-sequence" id="GLdt-empty-sequence"></a>
empty sequence</dt>
<dd>
<p>A sequence containing zero items is called an <b>empty
sequence</b> .</p>
</dd>
<dt><a name="GLdt-encoding-declaration" id="GLdt-encoding-declaration"></a>
 encoding declaration</dt>
<dd>
<p>If present, a version declaration may optionally include an
<b>encoding declaration</b> . The value of the string literal
following the keyword <code>encoding</code> is an encoding name,
and must conform to the definition of <code>EncName</code>
specified in <a href="#XML">[XML 1.0]</a> [ <a title="err:XQST0087" 
href="#ERRXQST0087">err:XQST0087</a> ]. The purpose of an encoding
declaration is to allow the writer of a query to provide a string
that indicates how the query is encoded, such as "
<code>UTF-8</code> ", " <code>UTF-16</code> ", or "
<code>US-ASCII</code> ".</p>
</dd>
<dt><a name="GLdt-equivalent-grouping-keys" 
id="GLdt-equivalent-grouping-keys"></a> <ins class="diff-new">equivalent
 grouping keys</ins></dt>
<dd>
<p><ins class="diff-new">Two tuples</ins> <var><ins class="diff-new">T1</ins></var>
 <ins class="diff-new">and</ins>
<var><ins class="diff-new">T2</ins></var> <ins class="diff-new">have</ins>
 <b><ins class="diff-new">equivalent grouping
keys</ins></b> <ins class="diff-new">if and only if, for each
grouping variable</ins> <var><ins class="diff-new">GV</ins></var>
,<ins class="diff-new">the atomized value of</ins> <var><ins 
class="diff-new">GV</ins></var> <ins class="diff-new">in</ins>
<var><ins class="diff-new">T1</ins></var> <ins class="diff-new">is
deep-equal to the atomized value of</ins> <var><ins class="diff-new">GV</ins></var>
 <ins class="diff-new">in</ins>
<var><ins class="diff-new">T2</ins></var> ,<ins class="diff-new">as
defined by applying the function</ins> <code><ins class="diff-new">fn:deep-equal</ins></code>
 <ins class="diff-new">using
the appropriate collation.</ins></p>
</dd>
<dt><a name="GLdt-error-value" id="GLdt-error-value"></a> error
value</dt>
<dd>
<p>In addition to its identifying QName, a dynamic error may also
carry a descriptive string and one or more additional values called
<b>error values</b> .</p>
</dd>
<dt><a name="GLdt-expanded-qname" id="GLdt-expanded-qname"></a>
expanded QName</dt>
<dd>
<p>An <b>expanded QName</b> consists of an optional namespace URI
and a local name. An expanded QName also retains its original
namespace prefix (if any), to facilitate casting the expanded QName
into a string.</p>
</dd>
<dt><a name="GLdt-expression-context" id="GLdt-expression-context"></a> 
expression context</dt>
<dd>
<p>The <b>expression context</b> for a given expression consists of
all the information that can affect the result of the
expression.</p>
</dd>
<dt><a name="GLdt-depends-on-context-item" 
id="GLdt-depends-on-context-item"></a> <ins class="diff-new">expression 
depends on</ins></dt>
<dd>
<p><ins class="diff-new">An expression</ins> <code><ins class="diff-new">E</ins></code>
 <b><ins class="diff-new">depends on the
context item</ins></b> <ins class="diff-new">if any of the
following is true:</ins></p>
<table>
<tbody>
<tr>
<td>
<ul>
<li>
<p><code><ins class="diff-new">E</ins></code> <ins class="diff-new">is 
"."</ins></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <ins class="diff-new">is 
"/", or any path expression beginning with "/" or
"//"</ins></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <ins class="diff-new">is</ins>
 <code><ins class="diff-new">position()</ins></code> <ins 
class="diff-new">or</ins>
<code><ins class="diff-new">last()</ins></code></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <ins class="diff-new">is 
an axis step (including an abbreviated axis step such
as '..' or '@x')</ins></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <ins class="diff-new">is a
 call to a built-in function that takes the context
item as an implicit argument</ins></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <ins class="diff-new">has a
 subexpression that depends on the context item,
and</ins> <code><ins class="diff-new">E</ins></code> <ins 
class="diff-new">does not bind the context item for that
subexpression</ins></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <a title="depends on a 
variable" href="#dt-depends-on-variable"><ins class="diff-new">depends 
on</ins></a> <ins class="diff-new">a variable
whose initializer</ins> <a title="expression depends on" 
href="#dt-depends-on-context-item"><ins class="diff-new">depends
on</ins></a> <ins class="diff-new">the context item</ins></p>
</li>
<li>
<p><code><ins class="diff-new">E</ins></code> <a title="depends on a 
function" href="#dt-depends-on-function"><ins class="diff-new">depends 
on</ins></a> <ins class="diff-new">a function
whose body</ins> <a title="expression depends on" 
href="#dt-depends-on-context-item"><ins class="diff-new">depends
on</ins></a> <ins class="diff-new">the context item</ins></p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd>
<dt><a name="GLdt-extension-expression" id="GLdt-extension-expression"></a>
 extension expression</dt>
<dd>
<p>An <b>extension expression</b> is an expression whose semantics
are <a title="implementation defined" href="#dt-implementation-defined">implementation-defined</a>
 .</p>
</dd>
<dt><a name="GLdt-external-function" id="GLdt-external-function"></a> 
external function</dt>
<dd>
<p><b>External functions</b> are functions that are implemented
outside the query environment.</p>
</dd>
<dt><a name="GLdt-filter-expression" id="GLdt-filter-expression"></a> 
filter expression</dt>
<dd>
<p><del class="diff-old">A filter expression consists simply of a
primary</del> <ins class="diff-chg">An</ins> expression followed by
<del class="diff-old">zero or more predicates . The result of
the</del> <ins class="diff-chg">a predicate (that is,</ins>
<code><ins class="diff-chg">E1[E2]</ins></code> <ins class="diff-chg">) 
is referred to as a</ins> <b>filter expression
<del class="diff-old">consists of the</del></b> : <ins class="diff-chg">its
 effect is to return those</ins> items <del class="diff-old">returned by</del>
 <ins class="diff-chg">from the value
of</ins> <code><ins class="diff-chg">E1</ins></code> <ins 
class="diff-chg">that satisfy</ins> the <del class="diff-old">primary
expression, filtered by applying each</del> predicate in
<del class="diff-old">turn, working from left to right.</del>
<ins class="diff-chg">E2.</ins></p>
</dd>
<dt><a name="GLdt-focus" id="GLdt-focus"></a> focus</dt>
<dd>
<p>The first three components of the <a title="dynamic context" 
href="#dt-dynamic-context">dynamic context</a> (context item,
context position, and context size) are called the <b>focus</b> of
the expression.</p>
</dd>
<dt><del class="diff-old">Full Axis Feature A conforming XQuery
implementation that supports the Full Axis Feature MUST support all
the optional axes .</del> <a name="GLdt-function-conversion" 
id="GLdt-function-conversion"></a> function <del class="diff-old">depends</del>
 <ins class="diff-chg">conversion
rules</ins></dt>
<dd>
<p><del class="diff-old">A function f1</del> <ins class="diff-chg">The</ins>
 <b><del class="diff-old">depends</del>
<ins class="diff-chg">function conversion rules</ins></b>
<del class="diff-old">on a variable $y</del> <ins class="diff-chg">are 
used to convert an argument value</ins> <span class="xquery">or a <del 
class="diff-old">function f2 if a
reference</del> <ins class="diff-chg">return value</ins></span>
<ins class="diff-chg">to its expected type; that is,</ins> to
<del class="diff-old">$y or f2 appears in</del> the <del 
class="diff-old">body</del> <ins class="diff-chg">declared type</ins> of
<del class="diff-old">f1 , or if there exists a variable $z or
a</del> <ins class="diff-chg">the</ins> function <del class="diff-old">f3
 such that f1 depends on $z or f3 and $z or f3 depends
on $y</del> <span class="xquery"><ins class="diff-chg">parameter</ins> 
or <del class="diff-old">f2 .</del>
<ins class="diff-chg">return.</ins></span></p>
</dd>
<dt><a name="GLdt-function-implementation" 
id="GLdt-function-implementation"></a> function implementation</dt>
<dd>
<p><b>Function implementations</b> . Each function in <a title="function
 signature" href="#dt-function-signature">function
signatures</a> has a function implementation that enables the
function to map instances of its parameter types into an instance
of its result type. <span class="xquery">For a <a title="user-defined 
function" href="#dt-udf">user-defined function</a> ,
the function implementation is an XQuery expression. For a
<a title="built-in function" href="#dt-built-in-function">built-in
function</a> or <a title="external function" 
href="#dt-external-function">external function</a> , the function
implementation is <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a>
.</span></p>
</dd>
<dt><a name="GLdt-function-item-coercion" 
id="GLdt-function-item-coercion"></a> <ins class="diff-new">function
item coercion</ins></dt>
<dd>
<p><b><ins class="diff-new">Function item coercion</ins></b>
<ins class="diff-new">wraps a</ins> <a 
href="http://www.w3.org/TR/xpath-datamodel-11/#dt-function-item"><ins 
class="diff-new">
function item</ins></a> <sup><small><ins class="diff-new">DM11</ins></small></sup>
 <ins class="diff-new">in a
new</ins> <a title="inline function" href="#dt-inline-func"><ins 
class="diff-new">inline function</ins></a>
<ins class="diff-new">with signature the same as the expected type.
This effectively delays the checking of the argument and return
types until the function item is invoked.</ins></p>
</dd>
<dt><a name="GLdt-function-signature" id="GLdt-function-signature"></a> 
function signature</dt>
<dd>
<p><b>Function signatures.</b> This component defines the set of
functions that are available to be called from within an
expression. Each function is uniquely identified by its <a 
title="expanded QName" href="#dt-expanded-qname">expanded QName</a> and
its arity (number of parameters).</p>
</dd>
<dt><a name="GLtd-global-scope" id="GLtd-global-scope"></a>
<ins class="diff-new">global scope</ins></dt>
<dd>
<p><ins class="diff-new">If a component has</ins> <b><ins 
class="diff-new">global scope</ins></b> ,<ins class="diff-new">then 
every
expression in the query has the same value for that component, and
it can not be overwritten by the query module or by an
expression.</ins></p>
</dd>
<dt><a name="GLdt-gregorian" id="GLdt-gregorian"></a>
Gregorian</dt>
<dd>
<p>In the operator mapping tables, the term <b>Gregorian</b> refers
to the types <code>xs:gYearMonth</code> , <code>xs:gYear</code> ,
<code>xs:gMonthDay</code> , <code>xs:gDay</code> , and
<code>xs:gMonth</code> .</p>
</dd>
<dt><a name="GLdt-grouping-key" id="GLdt-grouping-key"></a>
<ins class="diff-new">grouping key</ins></dt>
<dd>
<p><ins class="diff-new">The atomized value of a</ins> <a 
title="grouping variable" href="#dt-grouping-variable"><ins 
class="diff-new">grouping variable</ins></a> <ins class="diff-new">is
called a</ins> <b><ins class="diff-new">grouping key</ins></b>
.</p>
</dd>
<dt><a name="GLid-static-decimal-format-grouping-separator" 
id="GLid-static-decimal-format-grouping-separator"></a><ins 
class="diff-new">grouping-separator</ins></dt>
<dd>
<p><b><ins class="diff-new">grouping-separator</ins></b>
<ins class="diff-new">specifies the character used for the
grouping-sign, which is typically used as a thousands separator;
the default value is the comma character (,)</ins></p>
</dd>
<dt><a name="GLdt-grouping-variable" id="GLdt-grouping-variable"></a><ins
 class="diff-new">grouping
variable</ins></dt>
<dd>
<p><ins class="diff-new">A</ins> <code><ins class="diff-new">group
by</ins></code> <ins class="diff-new">clause consists of the
keywords</ins> <code><ins class="diff-new">group by</ins></code>
<ins class="diff-new">followed by one or more variables
called</ins> <b><ins class="diff-new">grouping variables</ins></b>
.</p>
</dd>
<dt><a name="GLIgnorableWhitespace" id="GLIgnorableWhitespace"></a>
ignorable whitespace</dt>
<dd>
<p><b>Ignorable whitespace</b> consists of any <a title="whitespace" 
href="#Whitespace">whitespace</a> characters that may
occur between <a title="terminal" href="#terminal">terminals</a> ,
unless these characters occur in the context of a production marked
with a <a href="#ExplicitWhitespaceHandling">ws:explicit</a>
annotation, in which case they can occur only where explicitly
specified (see <a href="#ExplicitWhitespaceHandling"><b>A.2.4.2
Explicit Whitespace Handling</b></a> ).</p>
</dd>
<dt><a name="GLdt-implementation-defined" 
id="GLdt-implementation-defined"></a> implementation defined</dt>
<dd>
<p><b>Implementation-defined</b> indicates an aspect that may
differ between implementations, but must be specified by the
implementor for each particular implementation.</p>
</dd>
<dt><a name="GLdt-implementation-dependent" 
id="GLdt-implementation-dependent"></a> implementation dependent</dt>
<dd>
<p><b>Implementation-dependent</b> indicates an aspect that may
differ between implementations, is not specified by this or any W3C
specification, and is not required to be specified by the
implementor for any particular implementation.</p>
</dd>
<dt><a name="GLdt-timezone" id="GLdt-timezone"></a> implicit
timezone</dt>
<dd>
<p><b>Implicit timezone.</b> This is the timezone to be used when a
date, time, or dateTime value that does not have a timezone is used
in a comparison or arithmetic operation. The implicit timezone is
an <a title="implementation defined" href="#dt-implementation-defined">implementation-defined</a>
 value of
type <code>xs:dayTimeDuration</code> . See <a href="#XMLSchema">[XML 
Schema]</a> for the range of legal values of a
timezone.</p>
</dd>
<dt><a name="GLid-static-decimal-format-infinity" 
id="GLid-static-decimal-format-infinity"></a> <ins class="diff-new">infinity</ins></dt>
<dd>
<p><b><ins class="diff-new">infinity</ins></b> <ins class="diff-new">specifies
 the string used for the infinity-symbol; the
default value is the string Infinity</ins></p>
</dd>
<dt><a name="GLdt-initializing-expression" 
id="GLdt-initializing-expression"></a> initializing expression</dt>
<dd>
<p>If a variable declaration includes an <del class="diff-old">expression,</del>
 <ins class="diff-chg">expression
(</ins> <code><ins class="diff-chg">VarValue</ins></code>
<ins class="diff-chg">or</ins> <code><ins class="diff-chg">VarDefaultValue</ins></code>
 <ins class="diff-chg">),</ins> the expression is called an <b>initializing
<ins class="diff-new">expression.</ins></b> <ins class="diff-new">The 
static context for an initializing</ins> expression
<del class="diff-old">.</del> <ins class="diff-chg">includes all
functions, variables, and namespaces that are declared or imported
anywhere in the Prolog, other than the variable being
declared.</ins></p>
</dd>
<dt><a name="GLdt-inline-func" id="GLdt-inline-func"></a><ins 
class="diff-chg">inline
function</ins></dt>
<dd>
<p><ins class="diff-chg">An</ins> <b><ins class="diff-chg">inline
function</ins></b> <ins class="diff-chg">expression creates a</ins>
<a href="http://www.w3.org/TR/xpath-datamodel-11/#dt-function-item"><ins
 class="diff-chg">
function item</ins></a> <sup><small><ins class="diff-chg">DM11</ins></small></sup>
 <ins class="diff-chg">that
represents an anonymous function defined directly in the inline
function expression itself.</ins></p>
</dd>
<dt><a name="GLdt-is-attrs" id="GLdt-is-attrs"></a> in-scope
attribute declarations</dt>
<dd>
<p><b>In-scope attribute declarations.</b> Each attribute
declaration is identified either by an <a title="expanded QName" 
href="#dt-expanded-qname">expanded QName</a> (for a top-level
attribute declaration) or by an <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a>
attribute identifier (for a local attribute declaration).
<span class="xquery">If the <a title="schema import feature" 
href="#dt-schema-import-feature">Schema Import Feature</a> is supported,
in-scope attribute declarations include all attribute declarations
found in imported schemas.</span></p>
</dd>
<dt><a name="GLdt-is-elems" id="GLdt-is-elems"></a> in-scope
element declarations</dt>
<dd>
<p><b>In-scope element declarations.</b> Each element declaration
is identified either by an <a title="expanded QName" 
href="#dt-expanded-qname">expanded QName</a> (for a top-level element
declaration) or by an <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a> element
identifier (for a local element declaration). <span class="xquery">If 
the <a title="schema import feature" href="#dt-schema-import-feature">Schema
 Import Feature</a> is supported,
in-scope element declarations include all element declarations
found in imported schemas.</span></p>
</dd>
<dt><a name="GLdt-in-scope-namespaces" id="GLdt-in-scope-namespaces"></a>
 in-scope namespaces</dt>
<dd>
<p>The <b>in-scope namespaces</b> property of an element node is a
set of <b>namespace bindings</b> , each of which associates a
namespace prefix with a URI, thus defining the set of namespace
prefixes that are available for interpreting <a title="lexical QName" 
href="#dt-qname"><ins class="diff-new">lexical</ins> QNames</a> within 
the scope of the
element. For a given element, one namespace binding may have an
empty prefix; the URI of this namespace binding is the default
namespace within the scope of the element.</p>
</dd>
<dt><a name="GLdt-issd" id="GLdt-issd"></a> in-scope schema
definitions</dt>
<dd>
<p><b>In-scope schema definitions.</b> This is a generic term for
all the element declarations, attribute declarations, and schema
type definitions that are in scope during processing of an
expression.</p>
</dd>
<dt><a name="GLdt-is-types" id="GLdt-is-types"></a> in-scope schema
type</dt>
<dd>
<p><b>In-scope schema types.</b> Each schema type definition is
identified either by an <a title="expanded QName" 
href="#dt-expanded-qname">expanded QName</a> (for a <b>named type</b> )
or by an <a title="implementation dependent" 
href="#dt-implementation-dependent">implementation-dependent</a> type
identifier (for an <b>anonymous type</b> ). The in-scope schema
types include the predefined schema types described in <a 
href="#id-predefined-types"><b>2.5.1 Predefined Schema Types</b></a> .
<span class="xquery">If the <a title="schema import feature" 
href="#dt-schema-import-feature">Schema Import Feature</a> is supported,
in-scope schema types also include all type definitions found in
imported schemas.</span></p>
</dd>
<dt><a name="GLdt-in-scope-variables" id="GLdt-in-scope-variables"></a> 
in-scope variables</dt>
<dd>
<p><b>In-scope variables.</b> This is a set of <del class="diff-old">(expanded
 QName,</del> <ins class="diff-chg">(</ins>
<a title="expanded QName" href="#dt-expanded-qname"><ins 
class="diff-chg">expanded QName</ins></a> , type) pairs. It defines the
set of variables that are available for reference within an
expression. The <a title="expanded QName" href="#dt-expanded-qname">expanded
 QName</a> is the name of the
variable, and the type is the <a title="static type" 
href="#dt-static-type">static type</a> of the variable.</p>
</dd>
<dt><a name="GLdt-item" id="GLdt-item"></a> item</dt>
<dd>
<p>An <b>item</b> is either an <a title="atomic value" 
href="#dt-atomic-value">atomic value</a> or a <a title="node" 
href="#dt-node">node</a> .</p>
</dd>
<dt><a name="GLdt-kind-test" id="GLdt-kind-test"></a> kind
test</dt>
<dd>
<p>An alternative form of a node test called a <b>kind test</b> can
select nodes based on their kind, name, and <a title="type annotation" 
href="#dt-type-annotation">type annotation</a>
.</p>
</dd>
<dt><a name="GLdt-qname" id="GLdt-qname"></a> <ins class="diff-new">lexical
 QName</ins></dt>
<dd>
<p><ins class="diff-new">A</ins> <b><ins class="diff-new">lexical
QName</ins></b> <ins class="diff-new">is a name that conforms to
the syntax of</ins> <a 
href="http://www.w3.org/TR/REC-xml-names/#NT-QName"><ins 
class="diff-new">[http://www.w3.org/TR/REC-xml-names/#NT-QName]</ins></a>
.</p>
</dd>
<dt><a name="GLtd-lexical-scope" id="GLtd-lexical-scope"></a><ins 
class="diff-new">lexical
scope</ins></dt>
<dd>
<p><ins class="diff-new">If a component has</ins> <b><ins 
class="diff-new">lexical scope</ins></b> ,<ins class="diff-new">then it
is defined by a query expression, and its scope is defined by the
semantics of the expression that defines it.</ins></p>
</dd>
<dt><a name="GLdt-library-module" id="GLdt-library-module"></a>
library module</dt>
<dd>
<p>A module that does not contain a <a title="query body" 
href="#dt-queryBody">Query Body</a> is called a <b>library module</b> .
A library module consists of a <a title="module declaration" 
href="#dt-module-declaration">module declaration</a> followed by a
<a title="Prolog" href="#dt-prolog">Prolog</a> .</p>
</dd>
<dt><a name="GLdt-literal" id="GLdt-literal"></a> literal</dt>
<dd>
<p>A <b>literal</b> is a direct syntactic representation of an
atomic value.</p>
</dd>
<dt><a name="GLdt-literal-func-item" id="GLdt-literal-func-item"></a> <ins
 class="diff-new">literal
function item</ins></dt>
<dd>
<p><ins class="diff-new">A</ins> <b><ins class="diff-new">literal
function item</ins></b> <ins class="diff-new">creates a</ins>
<a href="http://www.w3.org/TR/xpath-datamodel-11/#dt-function-item"><ins
 class="diff-new">
function item</ins></a> <sup><small><ins class="diff-new">DM11</ins></small></sup>
 <ins class="diff-new">that
represents a</ins> <a title="named function" href="#tm-named-func"><ins 
class="diff-new">named function</ins></a>
.</p>
</dd>
<dt><a name="GLdt-main-module" id="GLdt-main-module"></a> main
module</dt>
<dd>
<p>A <b>main module</b> consists of a <a title="Prolog" 
href="#dt-prolog">Prolog</a> followed by a <a title="query body" 
href="#dt-queryBody">Query Body</a> .</p>
</dd>
<dt><a name="GLmay" id="GLmay"></a> may</dt>
<dd>
<p><b>MAY</b> means that an item is truly optional.</p>
</dd>
<dt><a name="GLid-static-decimal-format-minus-sign" 
id="GLid-static-decimal-format-minus-sign"></a> <ins class="diff-new">minus-sign</ins></dt>
<dd>
<p><b><ins class="diff-new">minus-sign</ins></b> <ins class="diff-new">specifies
 the character used for the minus-symbol; the
default value is the hyphen-minus character (-, #x2D). The value
must be a single character.</ins></p>
</dd>
<dt><a name="GLdt-module" id="GLdt-module"></a> module</dt>
<dd>
<p>A <b>module</b> is a fragment of XQuery code that conforms to
the <a href="#doc-xquery11-Module">Module</a> grammar and can
independently undergo the <a title="static analysis phase" 
href="#dt-static-analysis">static analysis phase</a> described in
<a href="#id-expression-processing"><b>2.2.3 Expression
Processing</b></a> . Each module is either a <a title="main module" 
href="#dt-main-module">main module</a> or a <a title="library module" 
href="#dt-library-module">library module</a> .</p>
</dd>
<dt><a name="GLdt-module-declaration" id="GLdt-module-declaration"></a> 
module declaration</dt>
<dd>
<p>A <b>module declaration</b> serves to identify a <a title="module" 
href="#dt-module">module</a> as a <a title="library module" 
href="#dt-library-module">library module</a> . A
module declaration begins with the keyword <code>module</code> and
contains a namespace prefix and a <a href="#doc-xquery11-URILiteral">URILiteral</a>
 .</p>
</dd>
<dt><del class="diff-old">module directly depends A module M 1
directly depends on another module M 2 (different from M 1 ) if a
variable or function declared in M 1 depends on a variable or
function declared in M 2 .</del> <a name="GLdt-module-feature" 
id="GLdt-module-feature"></a> module feature</dt>
<dd>
<p>A conforming XQuery implementation that supports the <b>Module
Feature</b> allows a query Prolog to contain a <b>Module Import</b>
and allows <b>library modules</b> to be created.</p>
</dd>
<dt><a name="GLdt-module-import" id="GLdt-module-import"></a>
module import</dt>
<dd>
<p>A <b>module import</b> imports the <del class="diff-old">function</del>
 <span><ins class="diff-chg">variable</ins> declarations and <del 
class="diff-old">variable</del> <ins class="diff-chg">public
function</ins> declarations</span> from one or more <a title="library 
module" href="#dt-library-module">library modules</a> into
the <a title="function signature" href="#dt-function-signature">function
 signatures</a> and <a title="in-scope variables" 
href="#dt-in-scope-variables">in-scope
variables</a> of the importing <a title="module" href="#dt-module">module</a>
 .</p>
</dd>
<dt><a name="GLtd-module-scope" id="GLtd-module-scope"></a>
<ins class="diff-new">module scope</ins></dt>
<dd>
<p><ins class="diff-new">If a component has</ins> <b><ins 
class="diff-new">module scope</ins></b> ,<ins class="diff-new">then 
every
expression in a given module has the same value for that component,
and it can be overwritten or augmented for a given
module.</ins></p>
</dd>
<dt><a name="GLmust" id="GLmust"></a> must</dt>
<dd>
<p><b>MUST</b> means that the item is an absolute requirement of
the specification.</p>
</dd>
<dt><a name="GLtm-named-func" id="GLtm-named-func"></a> <ins 
class="diff-new">named function</ins></dt>
<dd>
<p><ins class="diff-new">A</ins> <b><ins class="diff-new">named
function</ins></b> <ins class="diff-new">is a function defined in
the static context for the query. To uniquely identify a particular
named function, both its name as a QName and its arity are
required.</ins></p>
</dd>
<dt><a name="GLdt-name-expression" id="GLdt-name-expression"></a>
name expression</dt>
<dd>
<p>When an expression is used to specify the name of a constructed
node, that expression is called the <b>name expression</b> of the
constructor.</p>
</dd>
<dt><a name="GLdt-namespace-declaration" id="GLdt-namespace-declaration"></a>
 namespace declaration</dt>
<dd>
<p>A <b>namespace declaration</b> declares a namespace prefix and
associates it with a namespace URI, adding the (prefix, URI) pair
to the set of <a title="statically known namespaces" 
href="#dt-static-namespaces">statically known namespaces</a> .</p>
</dd>
<dt><a name="GLdt-namespace-decl-attr" id="GLdt-namespace-decl-attr"></a>
 namespace declaration
attribute</dt>
<dd>
<p>A <b>namespace declaration attribute</b> is used inside a direct
element constructor. Its purpose is to bind a namespace prefix or
to set the <a title="default element/type namespace" 
href="#dt-def-elemtype-ns">default element/type namespace</a> for the
constructed element node, including its attributes.</p>
</dd>
<dt><a name="GLdt-namespace-sensitive" id="GLdt-namespace-sensitive"></a>
 namespace-sensitive</dt>
<dd>
<p>A value is <b>namespace-sensitive</b> if it includes an item
whose <a title="dynamic type" href="#dt-dynamic-type">dynamic
type</a> is <code>xs:QName</code> or <code>xs:NOTATION</code> or is
derived by restriction from <code>xs:QName</code> or
<code>xs:NOTATION</code> .</p>
</dd>
<dt><a name="GLdt-name-test" id="GLdt-name-test"></a> name
test</dt>
<dd>
<p>A node test that consists only of a <del class="diff-old">QName</del>
 <ins class="diff-chg">EQName</ins> or a
Wildcard is called a <b>name test</b> .</p>
</dd>
<dt><a name="GLid-static-decimal-format-NaN" 
id="GLid-static-decimal-format-NaN"></a> <ins class="diff-new">NaN</ins></dt>
<dd>
<p><b><ins class="diff-new">NaN</ins></b> <ins class="diff-new">specifies
 the string used for the NaN-symbol, which is
used to represent the value NaN (not-a-number); the default value
is the string NaN</ins></p>
</dd>
<dt><a name="GLdt-node" id="GLdt-node"></a> node</dt>
<dd>
<p>A <b>node</b> is an instance of one of the <b>node kinds</b>
defined in <del class="diff-old">[XQuery/XPath</del> <a 
href="#xpath-datamodel-11"><ins class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> .</p>
</dd>
<dt><a name="GLdt-node-test" id="GLdt-node-test"></a> node
test</dt>
<dd>
<p>A <b>node test</b> is a condition that must be true for each
node selected by a <a title="step" href="#dt-step">step</a> .</p>
</dd>
<dt><a name="GLnon-delimiting-token" id="GLnon-delimiting-token"></a> 
non-delimiting terminal symbol</dt>
<dd>
<p>The <b>non-delimiting terminal symbols</b> are: <a 
href="#prod-xquery11-IntegerLiteral">IntegerLiteral</a> , <a 
href="#prod-xquery11-NCName">NCName</a> , <a href="#prod-xquery11-QName">QName</a>
 , <a href="#prod-xquery11-DecimalLiteral">DecimalLiteral</a> , <a 
href="#prod-xquery11-DoubleLiteral">DoubleLiteral</a> , <ins 
class="diff-new">"allowing",</ins> "ancestor", "ancestor-or-self", 
"and",
"as", "ascending", "at", "attribute", "base-uri", "boundary-space",
"by", "case", "cast", "castable", <ins class="diff-new">"catch",</ins> 
"child", "collation", "comment",
"construction", <ins class="diff-new">"context",</ins>
"copy-namespaces", <ins class="diff-new">"count", "decimal-format",
"decimal-separator",</ins> "declare", "default", "descendant",
"descendant-or-self", "descending", <ins class="diff-new">"digit",</ins>
 "div", "document", "document-node",
"element", "else", "empty", "empty-sequence", "encoding",
<ins class="diff-new">"end",</ins> "eq", "every", "except",
"external", "following", "following-sibling", "for", "function",
"ge", "greatest", <ins class="diff-new">"group",
"grouping-separator",</ins> "gt", "idiv", "if", "import", "in",
<ins class="diff-new">"infinity",</ins> "inherit", "instance",
"intersect", "is", "item", "lax", "le", "least", "let", "lt",
<ins class="diff-new">"minus-sign",</ins> "mod", "module",
"namespace", <ins class="diff-new">"namespace-node", "NaN",</ins>
"ne", <ins class="diff-new">"next",</ins> "node", "no-inherit",
"no-preserve", "of", <ins class="diff-new">"only",</ins> "option",
"or", "order", "ordered", "ordering", "parent", <ins class="diff-new">"pattern-separator",
 "percent", "per-mille",</ins>
"preceding", "preceding-sibling", "preserve", <ins class="diff-new">"previous",</ins>
 "processing-instruction", "return",
"satisfies", "schema", "schema-attribute", "schema-element",
"self", <ins class="diff-new">"sliding",</ins> "some", "stable",
<ins class="diff-new">"start",</ins> "strict", "strip", <ins 
class="diff-new">"switch",</ins> "text", "then", "to", "treat",
<ins class="diff-new">"try", "tumbling", "type",</ins>
"typeswitch", "union", "unordered", "validate", "variable",
"version", <ins class="diff-new">"when",</ins> "where", <del 
class="diff-old">"xquery"</del> <ins class="diff-chg">"window", 
"xquery",
"zero-digit"</ins></p>
</dd>
<dt><a name="GLdt-nondeterministic-function" 
id="GLdt-nondeterministic-function"></a><ins class="diff-chg">nondeterministic
 function</ins></dt>
<dd>
<p><ins class="diff-chg">A</ins> <b><ins class="diff-chg">nondeterministic
 function</ins></b> <ins class="diff-chg">is a function that is not 
guaranteed to always return
the same result when it is invoked with the same
arguments.</ins></p>
</dd>
<dt><a name="GLdt-numeric" id="GLdt-numeric"></a> numeric</dt>
<dd>
<p>When referring to a type, the term <b>numeric</b> denotes the
types <code>xs:integer</code> , <code>xs:decimal</code> ,
<code>xs:float</code> , and <code>xs:double</code> .</p>
</dd>
<dt><a name="GLdt-numeric-predicate" id="GLdt-numeric-predicate"></a> 
numeric predicate</dt>
<dd>
<p>A predicate whose predicate expression returns a numeric type is
called a <b>numeric predicate</b> .</p>
</dd>
<dt><a name="GLdt-operator-function" id="GLdt-operator-function"></a> 
operator function</dt>
<dd>
<p>For each operator and valid combination of operand types, the
operator mapping tables specify a result type and an <b>operator
function</b> that implements the semantics of the operator for the
given types.</p>
</dd>
<dt><del class="diff-old">optional axis The following axes are
designated as optional axes : ancestor , ancestor-or-self ,
following , following-sibling , preceding , and preceding-sibling
.</del> <a name="GLdt-option-declaration" id="GLdt-option-declaration"></a>
 option declaration</dt>
<dd>
<p>An <b>option declaration</b> declares an option that affects the
behavior of a particular implementation. Each option consists of an
identifying <del class="diff-old">QName</del> <ins class="diff-chg">EQName</ins>
 and a StringLiteral.</p>
</dd>
<dt><a name="GLdt-ordering-mode" id="GLdt-ordering-mode"></a>
ordering mode</dt>
<dd>
<p><b>Ordering mode.</b> Ordering mode, which has the value
<code>ordered</code> or <code>unordered</code> , affects the
ordering of the result sequence returned by certain <a title="path 
expression" href="#dt-path-expression">path expressions</a> ,
<ins class="diff-new">FLWOR expressions, and</ins>
<code>union</code> , <code>intersect</code> , and
<code>except</code> <del class="diff-old">expressions, and FLWOR
expressions that have no order by clause.</del> <ins class="diff-chg">expressions.</ins></p>
</dd>
<dt><a name="GLdt-ordering-mode-decl" id="GLdt-ordering-mode-decl"></a> 
ordering mode declaration</dt>
<dd>
<p>An <b>ordering mode declaration</b> sets the <a title="ordering mode"
 href="#dt-ordering-mode">ordering mode</a> in the
<a title="static context" href="#dt-static-context">static
context</a> , overriding any implementation-defined default.</p>
</dd>
<dt><a name="GLdt-output-declaration" id="GLdt-output-declaration"></a> <ins
 class="diff-new">output
declaration</ins></dt>
<dd>
<p><ins class="diff-new">An</ins> <b><ins class="diff-new">output
declaration</ins></b> <ins class="diff-new">is an option
declaration in the predeclared namespace associated with the</ins>
<code><ins class="diff-new">output</ins></code> <ins class="diff-new">prefix;
 it is used to declare an output parameter for
serializing the output of the query.</ins></p>
</dd>
<dt><a name="GLdt-partial-function-application" 
id="GLdt-partial-function-application"></a><ins class="diff-new">partial
 function application</ins></dt>
<dd>
<p><ins class="diff-new">A function call is a</ins> <b><ins 
class="diff-new">partial function application</ins></b> <ins 
class="diff-new">if one or more arguments is an
ArgumentPlaceholder.</ins></p>
</dd>
<dt><a name="GLdt-path-expression" id="GLdt-path-expression"></a>
path expression</dt>
<dd>
<p>A <b>path expression</b> can be used to locate nodes within
trees. A path expression consists of a series of one or more
<a title="step" href="#dt-step">steps</a> , separated by "
<code>/</code> " or " <code>//</code> ", and optionally beginning
with " <code>/</code> " or " <code>//</code> ".</p>
</dd>
<dt><a name="GLid-static-decimal-format-pattern-separator-sign" 
id="GLid-static-decimal-format-pattern-separator-sign"></a>
<ins class="diff-new">pattern-separator-sign</ins></dt>
<dd>
<p><b><ins class="diff-new">pattern-separator-sign</ins></b>
<ins class="diff-new">specifies the character used for the
pattern-separator-sign, which separates positive and negative
sub-pictures in a picture string; the default value is the
semi-colon character (;)</ins></p>
</dd>
<dt><a name="GLid-static-decimal-format-percent-sign" 
id="GLid-static-decimal-format-percent-sign"></a><ins class="diff-new">percent-sign</ins></dt>
<dd>
<p><b><ins class="diff-new">percent-sign</ins></b> <ins class="diff-new">specifies
 the character used for the percent-sign; the
default value is the percent character (%)</ins></p>
</dd>
<dt><a name="GLid-static-decimal-format-per-mille-sign" 
id="GLid-static-decimal-format-per-mille-sign"></a><ins class="diff-new">per-mille-sign</ins></dt>
<dd>
<p><b><ins class="diff-new">per-mille-sign</ins></b> <ins 
class="diff-new">specifies the character used for the per-mille-sign; 
the
default value is the Unicode per-mille character (#x2030)</ins></p>
</dd>
<dt><a name="GLdt-positional-variable" id="GLdt-positional-variable"></a><ins
 class="diff-new">positional
variable</ins></dt>
<dd>
<p><ins class="diff-new">A</ins> <b><ins class="diff-new">positional 
variable</ins></b> <ins class="diff-new">is a
variable that is preceded by the keyword</ins> <code><ins 
class="diff-new">at</ins></code> .</p>
</dd>
<dt><a name="GLdt-pragma" id="GLdt-pragma"></a> pragma</dt>
<dd>
<p>A <b>pragma</b> is denoted by the delimiters <code>(#</code> and
<code>#)</code> , and consists of an identifying <del class="diff-old">QName</del>
 <ins class="diff-chg">EQName</ins> followed
by <a title="implementation defined" href="#dt-implementation-defined">implementation-defined</a>
content.</p>
</dd>
<dt><a name="GLdt-predefined-entity-reference" 
id="GLdt-predefined-entity-reference"></a> predefined entity
reference</dt>
<dd>
<p>A <b>predefined entity reference</b> is a short sequence of
characters, beginning with an ampersand, that represents a single
character that might otherwise have syntactic significance.</p>
</dd>
<dt><del class="diff-old">predicate A predicate consists of an
expression, called a predicate expression , enclosed in square
brackets. A predicate serves to filter a sequence, retaining some
items and discarding others.</del> <a name="GLdt-primary-expression" 
id="GLdt-primary-expression"></a> primary
expression</dt>
<dd>
<p><b>Primary expressions</b> are the basic primitives of the
language. They include literals, variable references, context item
expressions, <span class="xquery">constructors,</span> and function
calls. A primary expression may also be created by enclosing any
expression in parentheses, which is sometimes helpful in
controlling the precedence of operators.</p>
</dd>
<dt><a name="GLdt-principal-node-kind" id="GLdt-principal-node-kind"></a>
 principal node kind</dt>
<dd>
<p>Every axis has a <b>principal node kind</b> . If an axis can
contain elements, then the principal node kind is element;
otherwise, it is the kind of nodes that the axis can contain.</p>
</dd>
<dt><a name="GLdt-private-function" id="GLdt-private-function"></a>
<ins class="diff-new">private function</ins></dt>
<dd>
<p><ins class="diff-new">A</ins> <b><ins class="diff-new">private
function</ins></b> <ins class="diff-new">is hidden from</ins>
<a title="module import" href="#dt-module-import"><ins class="diff-new">module
 import</ins></a> ,<ins class="diff-new">which can
not import it into the</ins> <a title="function signature" 
href="#dt-function-signature"><ins class="diff-new">function
signatures</ins></a> <ins class="diff-new">of another
module.</ins></p>
</dd>
<dt><a name="GLdt-prolog" id="GLdt-prolog"></a> Prolog</dt>
<dd>
<p>A <b>Prolog</b> is a series of declarations and imports that
define the processing environment for the <a title="module" 
href="#dt-module">module</a> that contains the Prolog.</p>
</dd>
<dt><a name="GLdt-public-function" id="GLdt-public-function"></a>
<del class="diff-old">QName</del> <ins class="diff-chg">public
function</ins></dt>
<dd>
<p><del class="diff-old">Lexically, a</del> <ins class="diff-chg">A</ins>
 <b><del class="diff-old">QName</del> <ins class="diff-chg">public 
function</ins></b> <del class="diff-old">consists
of an optional namespace prefix and a local name. If the namespace
prefix</del> is <del class="diff-old">present,</del> <ins 
class="diff-chg">accessible to</ins> <a title="module import" 
href="#dt-module-import"><ins class="diff-chg">module import</ins></a>
,<ins class="diff-chg">which can import</ins> it <del class="diff-old">is
 separated from</del> <ins class="diff-chg">into</ins>
the <del class="diff-old">local name by a colon.</del> <a 
title="function signature" href="#dt-function-signature"><ins 
class="diff-chg">function signatures</ins></a> <ins class="diff-chg">of
another module.</ins></p>
</dd>
<dt><a name="GLdt-query" id="GLdt-query"></a> query</dt>
<dd>
<p>A <b>query</b> consists of one or more <a title="module" 
href="#dt-module">modules</a> .</p>
</dd>
<dt><a name="GLdt-queryBody" id="GLdt-queryBody"></a> query
body</dt>
<dd>
<p>The <b>Query Body</b> , if present, consists of an expression
that defines the result of the query.</p>
</dd>
<dt><a name="GLdt-reverse-document-order" 
id="GLdt-reverse-document-order"></a> reverse document order</dt>
<dd>
<p>The node ordering that is the reverse of document order is
called <b>reverse document order</b> .</p>
</dd>
<dt><a name="GLdt-schema-import" id="GLdt-schema-import"></a>
schema import</dt>
<dd>
<p>A <b>schema import</b> imports the element declarations,
attribute declarations, and type definitions from a schema into the
<a title="in-scope schema definitions" href="#dt-issd">in-scope
schema definitions</a> . <span><ins class="diff-new">For each
user-defined atomic type in the schema, schema import also adds a
corresponding</ins> <a title="constructor function" 
href="#dt-constructor-function"><ins class="diff-new">constructor
function</ins></a> .</span></p>
</dd>
<dt><a name="GLdt-schema-import-feature" id="GLdt-schema-import-feature"></a>
 schema import feature</dt>
<dd>
<p>The <b>Schema Import Feature</b> permits the query Prolog to
contain a <a title="schema import" href="#dt-schema-import">schema
import</a> .</p>
</dd>
<dt><a name="GLdt-schema-type" id="GLdt-schema-type"></a> schema
type</dt>
<dd>
<p>A <b>schema type</b> is a type that is (or could be) defined
using the facilities of <a href="#XMLSchema">[XML Schema]</a>
(including the built-in types of <a href="#XMLSchema">[XML
Schema]</a> ).</p>
</dd>
<dt><a name="GLdt-schema-validation-feature" 
id="GLdt-schema-validation-feature"></a> schema validation
feature</dt>
<dd>
<p>The <b>Schema Validation Feature</b> permits a query to contain
a <code>validate</code> expression (see <a href="#id-validate"><b><del 
class="diff-old">3.13</del> <ins class="diff-chg">3.16</ins> Validate 
Expressions</b></a> .)</p>
</dd>
<dt><a name="GLdt-scope" id="GLdt-scope"></a> <ins class="diff-new">scope
 of a component</ins></dt>
<dd>
<p><ins class="diff-new">The</ins> <b><ins class="diff-new">scope
of a component</ins></b> <ins class="diff-new">is the context in
which the component is associated with a value.</ins></p>
</dd>
<dt><a name="GLdt-sequence" id="GLdt-sequence"></a> sequence</dt>
<dd>
<p>A <b>sequence</b> is an ordered collection of zero or more
<a title="item" href="#dt-item">items</a> .</p>
</dd>
<dt><a name="GLdt-sequence-type" id="GLdt-sequence-type"></a>
sequence type</dt>
<dd>
<p>A <b>sequence type</b> is a type that can be expressed using the
<a href="#doc-xquery11-SequenceType">SequenceType</a> syntax.
Sequence types are used whenever it is necessary to refer to a type
in an XQuery <ins class="diff-new">1.1</ins> expression. The term
<b>sequence type</b> suggests that this syntax is used to describe
the type of an XQuery <ins class="diff-new">1.1</ins> value, which
is always a sequence.</p>
</dd>
<dt><a name="GLdt-sequencetype-matching" id="GLdt-sequencetype-matching"></a>
 SequenceType matching</dt>
<dd>
<p>During evaluation of an expression, it is sometimes necessary to
determine whether a value with a known <a title="dynamic type" 
href="#dt-dynamic-type">dynamic type</a> "matches" an expected
<a title="sequence type" href="#dt-sequence-type">sequence type</a>
. This process is known as <b>SequenceType matching</b> .</p>
</dd>
<dt><a name="GLdt-serialization" id="GLdt-serialization"></a>
serialization</dt>
<dd>
<p><b>Serialization</b> is the process of converting an <a title="XDM 
instance" href="#dt-data-model-instance">XDM instance</a> into
a sequence of octets (step DM4 in Figure 1.)</p>
</dd>
<dt><a name="GLdt-serialization-feature" id="GLdt-serialization-feature"></a>
 serialization feature</dt>
<dd>
<p>A conforming XQuery implementation that supports the
<b>Serialization Feature</b> <a title="must" href="#must">MUST</a>
provide means for serializing the result of a query, as specified
in <a href="#id-serialization"><b>2.2.4 Serialization</b></a> .</p>
</dd>
<dt><a name="GLdt-setter" id="GLdt-setter"></a> setter</dt>
<dd>
<p><b>Setters</b> are declarations that set the value of some
property that affects query processing, such as construction mode,
ordering mode, or default collation.</p>
</dd>
<dt><a name="GLshould" id="GLshould"></a> should</dt>
<dd>
<p><b>SHOULD</b> means that there may exist valid reasons in
particular circumstances to ignore a particular item, but the full
implications must be understood and carefully weighed before
choosing a different course.</p>
</dd>
<dt><a name="GLdt-singleton" id="GLdt-singleton"></a>
singleton</dt>
<dd>
<p>A sequence containing exactly one item is called a
<b>singleton</b> .</p>
</dd>
<dt><a name="GLstable" id="GLstable"></a> stable</dt>
<dd>
<p>Document order is <b>stable</b> , which means that the relative
order of two nodes will not change during the processing of a given
<span class="xquery">query</span> , even if this order is <a 
title="implementation dependent" href="#dt-implementation-dependent">implementation-dependent</a>
 .</p>
</dd>
<dt><a name="GLdt-static-collations" id="GLdt-static-collations"></a> 
statically known collations</dt>
<dd>
<p><b>Statically known collations.</b> This is an <a 
title="implementation defined" href="#dt-implementation-defined">implementation-defined</a>
 set of
(URI, collation) pairs. It defines the names of the collations that
are available for use in processing <span class="xquery">queries
and</span> expressions.</p>
</dd>
<dt><a name="GLdt-known-collections" id="GLdt-known-collections"></a> 
statically known collections</dt>
<dd>
<p><b>Statically known collections.</b> This is a mapping from
strings onto types. The string represents the absolute URI of a
resource that is potentially available using the
<code>fn:collection</code> function. The type is the type of the
sequence of nodes that would result from calling the
<code>fn:collection</code> function with this URI as its
argument.</p>
</dd>
<dt><a name="GLdt-static-decimal-formats" 
id="GLdt-static-decimal-formats"></a> <ins class="diff-new">statically
known decimal formats</ins></dt>
<dd>
<p><b><ins class="diff-new">Statically known decimal
formats.</ins></b> <ins class="diff-new">This is the set of known
decimal formats. Each format is used for serializing decimal
numbers using</ins> <code><ins class="diff-new">fn:format-number()</ins></code>
 .</p>
</dd>
<dt><a name="GLdt-known-default-collection" 
id="GLdt-known-default-collection"></a> statically known default
collection type</dt>
<dd>
<p><b>Statically known default collection type.</b> This is the
type of the sequence of nodes that would result from calling the
<code>fn:collection</code> function with no arguments.</p>
</dd>
<dt><a name="GLdt-known-docs" id="GLdt-known-docs"></a> statically
known documents</dt>
<dd>
<p><b>Statically known documents.</b> This is a mapping from
strings onto types. The string represents the absolute URI of a
resource that is potentially available using the
<code>fn:doc</code> function. The type is the <a title="static type" 
href="#dt-static-type">static type</a> of a call to
<code>fn:doc</code> with the given URI as its literal argument.</p>
</dd>
<dt><a name="GLdt-static-namespaces" id="GLdt-static-namespaces"></a> 
statically known namespaces</dt>
<dd>
<p><b>Statically known namespaces.</b> This is a set of (prefix,
URI) pairs that define all the namespaces that are known during
static processing of a given expression.</p>
</dd>
<dt><a name="GLdt-static-analysis" id="GLdt-static-analysis"></a>
static analysis phase</dt>
<dd>
<p>The <b>static analysis phase</b> depends on the expression
itself and on the <a title="static context" href="#dt-static-context">static
 context</a> . The <b>static analysis
phase</b> does not depend on input data (other than schemas).</p>
</dd>
<dt><a name="GLdt-static-context" id="GLdt-static-context"></a>
static context</dt>
<dd>
<p>The <b>static context</b> of an expression is the information
that is available during static analysis of the expression, prior
to its evaluation.</p>
</dd>
<dt><a name="GLdt-static-error" id="GLdt-static-error"></a> static
error</dt>
<dd>
<p>A <b>static error</b> is an error that must be detected during
the static analysis phase. A syntax error is an example of a
<a title="static error" href="#dt-static-error">static error</a>
.</p>
</dd>
<dt><a name="GLdt-static-type" id="GLdt-static-type"></a> static
type</dt>
<dd>
<p>The <b>static type</b> of an expression is <del class="diff-old">a 
type such that, when</del> the <del class="diff-old">expression is 
evaluated,</del> <ins class="diff-chg">best inference that</ins> the <del
 class="diff-old">resulting value will always conform</del> <ins 
class="diff-chg">processor is able</ins> to <ins class="diff-new">make
statically about</ins> the <del class="diff-old">static type.
static typing extension A static typing extension is an
implementation-defined type inference rule that infers a more
precise static</del> type <del class="diff-old">than that inferred
by</del> <ins class="diff-chg">of</ins> the <del class="diff-old">type 
inference rules in [XQuery 1.0 and XPath 2.0 Formal
Semantics] .</del> <ins class="diff-chg">result of the
expression.</ins></p>
</dd>
<dt><a name="GLdt-static-typing-feature" id="GLdt-static-typing-feature"></a>
 static typing feature</dt>
<dd>
<p>The <b>Static Typing Feature</b> <del class="diff-old">provides
support for the static semantics defined in [XQuery 1.0 and XPath
2.0 Formal Semantics] , and</del> requires implementations to
<del class="diff-old">detect and</del> report <ins class="diff-chg">all</ins>
 <a title="type error" href="#dt-type-error">type errors</a> during the <a
 title="static analysis phase" href="#dt-static-analysis">static 
analysis
phase</a> .</p>
</dd>
<dt><a name="GLdt-step" id="GLdt-step"></a> step</dt>
<dd>
<p>A <b>step</b> is a part of a <a title="path expression" 
href="#dt-path-expression">path expression</a> that generates a sequence
of items and then filters the sequence by zero or more <a title="" 
href="#dt-predicate">predicates</a> . The value of the step
consists of those items that satisfy the predicates, working from
left to right. A step may be either an <a title="axis step" 
href="#dt-axis-step">axis step</a> or a <del class="diff-old">filter
expression .</del> <ins class="diff-chg">postfix
expression.</ins></p>
</dd>
<dt><a name="GLdt-string-value" id="GLdt-string-value"></a> string
value</dt>
<dd>
<p>The <b>string value</b> of a node is a string and can be
extracted by applying the <code>fn:string</code> function to the
node.</p>
</dd>
<dt><a name="GLdt-substitution-group" id="GLdt-substitution-group"></a> 
substitution group</dt>
<dd>
<p><b>Substitution groups</b> are defined in <a href="#XMLSchema">[XML 
Schema]</a> Part 1, Section 2.2.2.2. Informally,
the substitution group headed by a given element (called the
<b>head element</b> ) consists of the set of elements that can be
substituted for the head element without affecting the outcome of
schema validation.</p>
</dd>
<dt><a name="GLdt-subtype" id="GLdt-subtype"></a> <ins class="diff-new">subtype</ins></dt>
<dd>
<p><ins class="diff-new">A</ins> <a title="sequence type" 
href="#dt-sequence-type"><ins class="diff-new">sequence type</ins></a>
<code><ins class="diff-new">A</ins></code> <ins class="diff-new">is
a</ins> <b><ins class="diff-new">subtype</ins></b> <ins class="diff-new">of
 a sequence type</ins> <code><ins class="diff-new">B</ins></code> <ins 
class="diff-new">if and only if, for
every value</ins> <code><ins class="diff-new">V</ins></code>
,<ins class="diff-new">if</ins> <code><ins class="diff-new">V</ins></code>
 <ins class="diff-new">matches</ins>
<code><ins class="diff-new">A</ins></code> <ins class="diff-new">according
 to the rules of</ins> <a title="SequenceType matching" 
href="#dt-sequencetype-matching"><ins class="diff-new">SequenceType
matching</ins></a> ,<ins class="diff-new">then</ins>
<code><ins class="diff-new">V</ins></code> <ins class="diff-new">also 
matches</ins> <code><ins class="diff-new">B</ins></code> .</p>
</dd>
<dt><a name="GLdt-subtype-substitution" id="GLdt-subtype-substitution"></a>
 subtype substitution</dt>
<dd>
<p>The use of a value whose <a title="dynamic type" 
href="#dt-dynamic-type">dynamic type</a> is derived from an expected
type is known as <b>subtype substitution</b> .</p>
</dd>
<dt><a name="GLsymbol" id="GLsymbol"></a> symbol</dt>
<dd>
<p>Each rule in the grammar defines one <b>symbol</b> , using the
following format:</p>
<div class="exampleInner">
<pre>symbol ::= expression
</pre></div>
</dd>
<dt><a name="GLsymbolseparators" id="GLsymbolseparators"></a>
symbol separators</dt>
<dd>
<p><a title="whitespace" href="#Whitespace">Whitespace</a> and
<a href="#doc-xquery11-Comment">Comments</a> function as <b>symbol
separators</b> . For the most part, they are not mentioned in the
grammar, and may occur between any two terminal symbols mentioned
in the grammar, except where that is forbidden by the <a 
href="#ws-explicit">/* ws: explicit */</a> annotation in the EBNF, or by
the <a href="#parse-note-xml-version">/* <del class="diff-old">xgs:</del>
 <ins class="diff-chg">xgc:</ins> xml-version
*/</a> annotation.</p>
</dd>
<dt><a name="GLdt-target-namespace" id="GLdt-target-namespace"></a>
target namespace</dt>
<dd>
<p>Each imported schema or module is identified by its <b>target
namespace</b> , which is the namespace of the objects (such as
elements or functions) that are defined by the schema or
module.</p>
</dd>
<dt><a name="GLterminal" id="GLterminal"></a> terminal</dt>
<dd>
<p>A <b>terminal</b> is a symbol or string or pattern that can
appear in the right-hand side of a rule, but never appears on the
left hand side in the main grammar, although it may appear on the
left-hand side of a rule in the grammar for terminals.</p>
</dd>
<dt><a name="GLid-tuple-foobar" id="GLid-tuple-foobar"></a>
<ins class="diff-new">tuple</ins></dt>
<dd>
<p><ins class="diff-new">A</ins> <b><ins class="diff-new">tuple</ins></b>
 <ins class="diff-new">is a set of zero
or more named variables, each of which is bound to a value that is
an</ins> <a title="XDM instance" href="#dt-data-model-instance"><ins 
class="diff-new">XDM
instance</ins></a> .</p>
</dd>
<dt><a name="GLid-tuple-stream-foobar" id="GLid-tuple-stream-foobar"></a><ins
 class="diff-new">tuple
stream</ins></dt>
<dd>
<p><ins class="diff-new">A</ins> <b><ins class="diff-new">tuple
stream</ins></b> <ins class="diff-new">is an ordered sequence of
zero or more</ins> <b><ins class="diff-new">tuples</ins></b> .</p>
</dd>
<dt><a name="GLdt-type-annotation" id="GLdt-type-annotation"></a>
type annotation</dt>
<dd>
<p>Each element node and attribute node in an <a title="XDM instance" 
href="#dt-data-model-instance">XDM instance</a> has
a <b>type annotation</b> (referred to in <del class="diff-old">[XQuery/XPath</del>
 <a href="#xpath-datamodel-11"><ins class="diff-chg">[XQuery and XPath</ins>
Data Model <del class="diff-old">(XDM)]</del> <ins class="diff-chg">(XDM)
 1.1]</ins></a> as its <code>type-name</code>
property.) The type annotation of a node is a <a title="schema type" 
href="#dt-schema-type">schema type</a> that describes
the relationship between the <a title="string value" 
href="#dt-string-value">string value</a> of the node and its <a 
title="typed value" href="#dt-typed-value">typed value</a> .</p>
</dd>
<dt><a name="GLdt-type-declaration" id="GLdt-type-declaration"></a>
<ins class="diff-new">type declaration</ins></dt>
<dd>
<p><ins class="diff-new">A variable binding may be accompanied by
a</ins> <b><ins class="diff-new">type declaration</ins></b>
,<ins class="diff-new">which consists of the keyword</ins>
<code><ins class="diff-new">as</ins></code> <ins class="diff-new">followed
 by the static type of the variable, declared
using the syntax in</ins> <a href="#id-sequencetype-syntax"><b><ins 
class="diff-new">2.5.3
SequenceType Syntax</ins></b></a> .</p>
</dd>
<dt><a name="GLdt-typed-value" id="GLdt-typed-value"></a> typed
value</dt>
<dd>
<p>The <b>typed value</b> of a node is a sequence of atomic values
and can be extracted by applying the <code>fn:data</code> function
to the node.</p>
</dd>
<dt><a name="GLdt-type-error" id="GLdt-type-error"></a> type
error</dt>
<dd>
<p>A <b>type error</b> may be raised during the static analysis
phase or the dynamic evaluation phase. During the static analysis
phase, a <a title="type error" href="#dt-type-error">type error</a>
occurs when the <a title="static type" href="#dt-static-type">static 
type</a> of an expression does not match
the expected type of the context in which the expression occurs.
During the dynamic evaluation phase, a <a title="type error" 
href="#dt-type-error">type error</a> occurs when the <a title="dynamic 
type" href="#dt-dynamic-type">dynamic type</a> of a value
does not match the expected type of the context in which the value
occurs.</p>
</dd>
<dt><a name="GLdt-type-promotion" id="GLdt-type-promotion"></a>
type promotion</dt>
<dd>
<p>Under certain circumstances, an atomic value can be promoted
from one type to another. <b>Type promotion</b> is used in
evaluating function calls (see <a href="#id-function-calls"><b>3.1.5 
Function Calls</b></a> ) <del class="diff-old">,</del> <span 
class="xquery">, <code>order by</code>
clauses (see <a href="#id-order-by-clause"><b><del class="diff-old">3.8.3</del>
 <ins class="diff-chg">3.9.8</ins> Order By
<del class="diff-old">and Return Clauses</del> <ins class="diff-chg">Clause</ins></b></a>
 ),</span> and operators that accept
numeric or string operands (see <a href="#mapping"><b>B.2 Operator
Mapping</b></a> ).</p>
</dd>
<dt><a name="GLdt-undefined" id="GLdt-undefined"></a> <ins 
class="diff-new">undefined</ins></dt>
<dd>
<p><ins class="diff-new">In certain situations a value is said to
be</ins> <b><ins class="diff-new">undefined</ins></b> <ins 
class="diff-new">(for example, the value of the context item, or the
typed value of an element node). This term indicates that the
property in question has no value and that any attempt to use its
value results in an error.</ins></p>
</dd>
<dt><a name="GLdt-URI" id="GLdt-URI"></a> URI</dt>
<dd>
<p>Within this specification, the term <b>URI</b> refers to a
Universal Resource Identifier as defined in <a href="#RFC3986">[RFC3986]</a>
 and extended in <a href="#RFC3987">[RFC3987]</a> with the new name <b>IRI</b>
 .</p>
</dd>
<dt><a name="GLdt-udf" id="GLdt-udf"></a> user-defined
function</dt>
<dd>
<p><del class="diff-old">For a</del> <b><del class="diff-old">user-defined
 function , the function declaration
includes an expression called the</del> <ins class="diff-chg">User
defined functions</ins></b> <ins class="diff-chg">are functions
that contain a</ins> <b>function body <del class="diff-old">that
defines how</del></b> , <ins class="diff-chg">which provides</ins>
the <del class="diff-old">result</del> <ins class="diff-chg">implementation</ins>
 of the function <del class="diff-old">is computed from its parameters.</del>
 <ins class="diff-chg">as an XQuery expression.</ins></p>
</dd>
<dt><a name="GLdt-value" id="GLdt-value"></a> value</dt>
<dd>
<p>In the <a title="data model" href="#dt-datamodel">data model</a>
, a <b>value</b> is always a <a title="sequence" href="#dt-sequence">sequence</a>
 .</p>
</dd>
<dt><del class="diff-old">variable depends A variable $x depends on
a variable $y or a function f2 if a reference to $y or f2 appears
in the initializing expression of $x , or if there exists a
variable $z or a function f3 such that $x depends on $z or f3 and
$z or f3 depends on $y or f2 .</del> <a name="GLdt-variable-reference" 
id="GLdt-variable-reference"></a>
variable reference</dt>
<dd>
<p>A <b>variable reference</b> is <del class="diff-old">a
QName</del> <ins class="diff-chg">an EQName</ins> preceded by a
$-sign.</p>
</dd>
<dt><a name="GLdt-variable-values" id="GLdt-variable-values"></a>
variable values</dt>
<dd>
<p><b>Variable values</b> . This is a set of <del class="diff-old">(expanded
 QName,</del> <ins class="diff-chg">(</ins>
<a title="expanded QName" href="#dt-expanded-qname"><ins 
class="diff-chg">expanded QName</ins></a> , value) pairs. It contains 
the
same <a title="expanded QName" href="#dt-expanded-qname">expanded
QNames</a> as the <a title="in-scope variables" 
href="#dt-in-scope-variables">in-scope variables</a> in the <a 
title="static context" href="#dt-static-context">static context</a> for
the expression. The <a title="expanded QName" href="#dt-expanded-qname">expanded
 QName</a> is the name of the variable
and the value is the dynamic value of the variable, which includes
its <a title="dynamic type" href="#dt-dynamic-type">dynamic
type</a> .</p>
</dd>
<dt><a name="GLdt-version-declaration" id="GLdt-version-declaration"></a>
 version declaration</dt>
<dd>
<p><del class="diff-old">Any module may contain a</del> <ins 
class="diff-chg">A</ins> <b>version declaration <del class="diff-old">.
If present, the version declaration occurs at the beginning of the
module and identifies</del></b> <ins class="diff-chg">can
identify</ins> the applicable XQuery syntax and semantics for
<del class="diff-old">the</del> <ins class="diff-chg">a</ins>
<a title="module" href="#dt-module">module <del class="diff-old">.</del></a>
 , <ins class="diff-chg">as well as its
encoding.</ins></p>
</dd>
<dt><a name="GLdt-warning" id="GLdt-warning"></a> warning</dt>
<dd>
<p>In addition to <a title="static error" href="#dt-static-error">static
 errors</a> , <a title="dynamic error" href="#dt-dynamic-error">dynamic 
errors</a> , and <a title="type error" href="#dt-type-error">type errors</a>
 , an XQuery
<ins class="diff-new">1.1</ins> implementation may raise
<b>warnings</b> , either during the <a title="static analysis phase" 
href="#dt-static-analysis">static analysis
phase</a> or the <a title="dynamic evaluation phase" 
href="#dt-dynamic-evaluation">dynamic evaluation phase</a> . The
circumstances in which warnings are raised, and the ways in which
warnings are handled, are <a title="implementation defined" 
href="#dt-implementation-defined">implementation-defined</a> .</p>
</dd>
<dt><a name="GLWhitespace" id="GLWhitespace"></a> whitespace</dt>
<dd>
<p>A <b>whitespace</b> character is any of the characters defined
by <a href="http://www.w3.org/TR/REC-xml#NT-S">[http://www.w3.org/TR/REC-xml#NT-S]</a>
.</p>
</dd>
<dt><a name="GLdt-window" id="GLdt-window"></a> <ins class="diff-new">window</ins></dt>
<dd>
<p><ins class="diff-new">A</ins> <b><ins class="diff-new">window</ins></b>
 <ins class="diff-new">is a sequence of
consecutive items drawn from the</ins> <a title="binding sequence" 
href="#dt-binding-sequence"><ins class="diff-new">binding
sequence</ins></a> .</p>
</dd>
<dt><a name="GLdt-data-model-instance" id="GLdt-data-model-instance"></a>
 XDM instance</dt>
<dd>
<p>The term <b>XDM instance</b> is used, synonymously with the term
<b>value</b> , to denote an unconstrained sequence of <a title="node" 
href="#dt-node">nodes</a> and/or <a title="atomic value" 
href="#dt-atomic-value">atomic values</a> in the <a title="data model" 
href="#dt-datamodel">data model</a> .</p>
</dd>
<dt><a name="GLdt-xpath-compat-mode" id="GLdt-xpath-compat-mode"></a> 
XPath 1.0 compatibility mode</dt>
<dd>
<p><b>XPath 1.0 compatibility mode.</b> <span class="xquery">This
component must be set by all host languages that include XPath
<del class="diff-old">2.0</del> <ins class="diff-chg">2.1</ins> as
a subset, indicating whether rules for compatibility with XPath 1.0
are in effect. XQuery sets the value of this component to
<code>false</code> .</span></p>
</dd>
<dt><a name="GLdt-xquery-10-processor" id="GLdt-xquery-10-processor"></a>
 <ins class="diff-new">XQuery 1.0
Processor</ins></dt>
<dd>
<p><ins class="diff-new">An</ins> <b><ins class="diff-new">XQuery
1.0 Processor</ins></b> <ins class="diff-new">processes a query
according to the XQuery 1.0 specification.</ins></p>
</dd>
<dt><a name="GLdt-xquery-11-processor" id="GLdt-xquery-11-processor"></a><ins
 class="diff-new">XQuery 1.1
Processor</ins></dt>
<dd>
<p><ins class="diff-new">An</ins> <b><ins class="diff-new">XQuery
1.1 Processor</ins></b> <ins class="diff-new">processes a query
according to the XQuery 1.1 specification.</ins></p>
</dd>
<dt><a name="GLdt-anyAtomicType" id="GLdt-anyAtomicType"></a>
xs:anyAtomicType</dt>
<dd>
<p><code>xs:anyAtomicType</code> is an atomic type that includes
all atomic values (and no values that are not atomic). Its base
type is <code>xs:anySimpleType</code> from which all simple types,
including atomic, list, and union types, are derived. All primitive
atomic types, such as <code><del class="diff-old">xs:integer ,
xs:string ,</del> <ins class="diff-chg">xs:decimal</ins></code> and
<code><del class="diff-old">xs:untypedAtomic</del> <ins class="diff-chg">xs:string</ins></code>
 , have
<code>xs:anyAtomicType</code> as their base type.</p>
</dd>
<dt><a name="GLdt-dayTimeDuration" id="GLdt-dayTimeDuration"></a>
xs:dayTimeDuration</dt>
<dd>
<p><code>xs:dayTimeDuration</code> is derived by restriction from
<code>xs:duration</code> . The lexical representation of
<code>xs:dayTimeDuration</code> is restricted to contain only day,
hour, minute, and second components.</p>
</dd>
<dt><a name="GLdt-untyped" id="GLdt-untyped"></a> xs:untyped</dt>
<dd>
<p><code>xs:untyped</code> is used as the <a title="type annotation" 
href="#dt-type-annotation">type annotation</a> of
an element node that has not been validated, or has been validated
in <code>skip</code> mode.</p>
</dd>
<dt><a name="GLdt-untypedAtomic" id="GLdt-untypedAtomic"></a>
xs:untypedAtomic</dt>
<dd>
<p><code>xs:untypedAtomic</code> is an atomic type that is used to
denote untyped atomic data, such as text that has not been assigned
a more specific type.</p>
</dd>
<dt><a name="GLdt-yearMonthDuration" id="GLdt-yearMonthDuration"></a> 
xs:yearMonthDuration</dt>
<dd>
<p><code>xs:yearMonthDuration</code> is derived by restriction from
<code>xs:duration</code> . The lexical representation of
<code>xs:yearMonthDuration</code> is restricted to contain only
year and month components.</p>
</dd>
<dt><a name="GLid-static-decimal-format-zero-digit" 
id="GLid-static-decimal-format-zero-digit"></a> <ins class="diff-new">zero-digit</ins></dt>
<dd>
<p><b><ins class="diff-new">zero-digit</ins></b> <ins class="diff-new">specifies
 the character used for the digit-zero-sign;
the default value is the digit zero (0). This character must be a
digit (category Nd in the Unicode property database), and it must
have the numeric value zero. This attribute implicitly defines the
Unicode character that is used to represent each of the values 0 to
9 in the final result string: Unicode is organized so that each set
of decimal digits forms a contiguous block of characters in
numerical sequence.</ins></p>
</dd>
</dl>
</div>
<div class="div1">
<h2><a id="id-example-applications" name="id-example-applications"></a> I
 Example Applications
(Non-Normative)</h2>
<p>This section contains examples of several important classes of
queries that can be expressed using XQuery. The applications
described here include joins across multiple data sources, grouping
and aggregation, queries based on sequential relationships,
recursive transformations, and selection of distinct combinations
of values.</p>
<div class="note">
<p class="prefix"><b><ins class="diff-new">Note:</ins></b></p>
<p><ins class="diff-new">This section needs to be rewritten in
light of the new features of XQuery 1.1, which can significantly
simplify some of these queries.</ins></p>
</div>
<div class="div2">
<h3><a id="id-joins" name="id-joins"></a> I.1 Joins</h3>
<p>Joins, which combine data from multiple sources into a single
result, are a very important type of query. In this section we will
illustrate how several types of joins can be expressed in XQuery.
We will base our examples on the following three documents:</p>
<ol class="enumar">
<li>
<p>A document named <code>parts.xml</code> that contains many
<code>part</code> elements; each <code>part</code> element in turn
contains <code>partno</code> and <code>description</code>
subelements.</p>
</li>
<li>
<p>A document named <code>suppliers.xml</code> that contains many
<code>supplier</code> elements; each <code>supplier</code> element
in turn contains <code>suppno</code> and <code>suppname</code>
subelements.</p>
</li>
<li>
<p>A document named <code>catalog.xml</code> that contains
information about the relationships between suppliers and parts.
The catalog document contains many <code>item</code> elements, each
of which in turn contains <code>partno</code> , <code>suppno</code>
, and <code>price</code> subelements.</p>
</li>
</ol>
<p>A conventional ("inner") join returns information from two or
more related sources, as illustrated by the following example,
which combines information from three documents. The example
generates a "descriptive catalog" derived from the catalog
document, but containing part descriptions instead of part numbers
and supplier names instead of supplier numbers. The new catalog is
ordered alphabetically by part description and secondarily by
supplier name.</p>
<div class="exampleInner">
<pre>&lt;descriptive-catalog&gt;
   { 
     for $i in fn:doc("catalog.xml")/items/item,
         $p in fn:doc("parts.xml")/parts/part[partno = $i/partno],
         $s in fn:doc("suppliers.xml")/suppliers
                  /supplier[suppno = $i/suppno]
     order by $p/description, $s/suppname
     return
        &lt;item&gt;
           {
           $p/description,
           $s/suppname,
           $i/price
           }
        &lt;/item&gt;
   }
&lt;/descriptive-catalog&gt;
</pre></div>
<p>The previous query returns information only about parts that
have suppliers and suppliers that have parts. An <b>outer join</b>
is a join that preserves information from one or more of the
participating sources, including elements that have no matching
element in the other source. For example, a <b>left outer join</b>
between suppliers and parts might return information about
suppliers that have no matching parts.</p>
<p>The following query demonstrates a left outer join. It returns
names of all the suppliers in alphabetic order, including those
that supply no parts. In the result, each supplier element contains
the descriptions of all the parts it supplies, in alphabetic
order.</p>
<div class="exampleInner">
<pre>for $s in fn:doc("suppliers.xml")/suppliers/supplier
order by $s/suppname
return
   &lt;supplier&gt;
      { 
        $s/suppname,
        for $i in fn:doc("catalog.xml")/items/item
                 [suppno = $s/suppno],
            $p in fn:doc("parts.xml")/parts/part
                 [partno = $i/pno]
        order by $p/description
        return $p/description 
      }
   &lt;/supplier&gt;
</pre></div>
<p>The previous query preserves information about suppliers that
supply no parts. Another type of join, called a <b>full outer
join</b> , might be used to preserve information about both
suppliers that supply no parts and parts that have no supplier. The
result of a full outer join can be structured in any of several
ways. The following query generates a list of <code>supplier</code>
elements, each containing nested <code>part</code> elements for the
parts that it supplies (if any), followed by a list of
<code>part</code> elements for the parts that have no supplier.
This might be thought of as a "supplier-centered" full outer join.
Other forms of outer join queries are also possible.</p>
<div class="exampleInner">
<pre>&lt;master-list&gt;
 {
    for $s in fn:doc("suppliers.xml")/suppliers/supplier
    order by $s/suppname
    return
        &lt;supplier&gt;
           { 
             $s/suppname,
             for $i in fn:doc("catalog.xml")/items/item
                     [suppno = $s/suppno],
                 $p in fn:doc("parts.xml")/parts/part
                     [partno = $i/partno]
             order by $p/description
             return
                &lt;part&gt;
                   {
                     $p/description,
                     $i/price
                   }
                &lt;/part&gt; 
           }
        &lt;/supplier&gt; 
    ,
    (: parts that have no supplier :)
    &lt;orphan-parts&gt;
       { for $p in fn:doc("parts.xml")/parts/part
         where fn:empty(fn:doc("catalog.xml")/items/item
               [partno = $p/partno] )
         order by $p/description
         return $p/description 
       }
    &lt;/orphan-parts&gt;
 }
&lt;/master-list&gt;
</pre></div>
<p>The previous query uses an element constructor to enclose its
output inside a <code>master-list</code> element. The concatenation
operator (",") is used to combine the two main parts of the query.
The result is an ordered sequence of <code>supplier</code> elements
followed by an <code>orphan-parts</code> element that contains
descriptions of all the parts that have no supplier.</p>
</div>
<div class="div2">
<h3><del class="diff-old">I.2 Grouping Many queries involve forming
data into groups and applying some aggregation function such as
fn:count or fn:avg to each group. The following example shows how
such a query might be expressed in XQuery, using the catalog
document defined in the previous section. This query finds the part
number and average price for parts that have at least 3 suppliers.
for $pn in fn:distinct-values(
fn:doc("catalog.xml")/items/item/partno) let $i :=
fn:doc("catalog.xml")/items/item[partno = $pn] where fn:count($i)
&gt;= 3 order by $pn return &lt;well-supplied-item&gt;
&lt;partno&gt; {$p} &lt;/partno&gt; &lt;avgprice&gt;
{fn:avg($i/price)} &lt;/avgprice&gt; &lt;/well-supplied-item&gt;
The fn:distinct-values function in this query eliminates duplicate
part numbers from the set of all part numbers in the catalog
document. The result of fn:distinct-values is a sequence in which
order is not significant. Note that $pn , bound by a for clause,
represents an individual part number, whereas $i , bound by a let
clause, represents a set of items which serves as argument to the
aggregate functions fn:count($i) and fn:avg($i/price) . The query
uses an element constructor to enclose each part number and average
price in a containing element called well-supplied-item . The
method illustrated above generalizes easily to grouping by more
than one data value. For example, consider a census document
containing a sequence of person elements, each with subelements
named state , job , and income . A census analyst might need to
prepare a report listing the average income for each combination of
state and job . This report might be produced using the following
query: for $s in fn:distinct-values(
fn:doc("census.xml")/census/person/state), $j in
fn:distinct-values( fn:doc("census.xml")/census/person/job) let $p
:= fn:doc("census.xml")/census/person [state = $s and job = $j]
order by $s, $j return if (fn:exists($p)) then &lt;group&gt;
&lt;state&gt; {$s} &lt;/state&gt; &lt;job&gt; {$j} &lt;/job&gt;
&lt;avgincome&gt; {fn:avg($p/income)} &lt;/avgincome&gt;
&lt;/group&gt; else () The if-then-else expression in the above
example prevents generation of groups that contain no data. For
example, the census data may contain some persons who live in
Nebraska, and some persons whose job is Deep Sea Fisherman, but no
persons who live in Nebraska and have the job of Deep Sea
Fisherman. If output groups are desired for all possible
combinations of states and jobs, the if-then-else expression can be
omitted from the query. In this case, the output may include
"empty" groups such as the following: &lt;group&gt;
&lt;state&gt;Nebraska&lt;/state&gt; &lt;job&gt;Deep Sea
Fisherman&lt;/job&gt; &lt;avgincome/&gt; &lt;/group&gt;</del>
<a id="id-queries-on-sequence" name="id-queries-on-sequence"></a>
<del class="diff-old">I.3</del> <ins class="diff-chg">I.2</ins>
Queries on Sequence</h3>
<p>XQuery uses the <code>&lt;&lt;</code> and <code>&gt;&gt;</code>
operators to compare nodes based on document order. Although these
operators are quite simple, they can be used to express complex
queries for XML documents in which sequence is meaningful. The
first two queries in this section involve a surgical report that
contains <code>procedure</code> , <code>incision</code> ,
<code>instrument</code> , <code>action</code> , and
<code>anesthesia</code> elements.</p>
<p>The following query returns all the <code>action</code> elements
that occur between the first and second <code>incision</code>
elements inside the first procedure. The original document order
among these nodes is preserved in the result of the query.</p>
<div class="exampleInner">
<pre>let $proc := /report/procedure[1]
for $i in $proc//action
where $i &gt;&gt; ($proc//incision)[1]
   and $i &lt;&lt; ($proc//incision)[2]
return $i
</pre></div>
<p>It is worth noting here that document order is defined in such a
way that a node is considered to precede its descendants in
document order. In the surgical report, an <code>action</code> is
never part of an <code>incision</code> , but an
<code>instrument</code> is. Since the <code>&gt;&gt;</code>
operator is based on document order, the predicate <code>$i
&gt;&gt; ($proc//incision)[1]</code> is true for any
<code>instrument</code> element that is a descendant of the first
<code>incision</code> element in the first procedure.</p>
<p>For some queries, it may be helpful to define a function that
can test whether a node precedes another node without being its
ancestor. The following function returns <code>true</code> if its
first operand precedes its second operand but is not an ancestor of
its second operand; otherwise it returns <code>false</code> :</p>
<div class="exampleInner">
<pre>declare function local:precedes($a as node(), $b as node()) 
   as boolean
   {
      $a &lt;&lt; $b
        and
      fn:empty($a//node() intersect $b) 
   };
</pre></div>
<p>Similarly, a <code>local:follows</code> function could be
written:</p>
<div class="exampleInner">
<pre>declare function local:follows($a as node(), $b as node()) 
   as boolean
   {
      $a &gt;&gt; $b
        and
      fn:empty($b//node() intersect $a) 
   };
</pre></div>
<p>Using the <code>local:precedes</code> function, we can write a
query that finds <code>instrument</code> elements between the first
two incisions, excluding from the query result any
<code>instrument</code> that is a descendant of the first
<code>incision</code> :</p>
<div class="exampleInner">
<pre>let $proc := /report/procedure[1]
for $i in $proc//instrument
where local:precedes(($proc//incision)[1], $i)
   and local:precedes($i, ($proc//incision)[2])
return $i
</pre></div>
<p>The following query reports incisions for which no prior
anesthesia was recorded in the surgical report. Since an
<code>anesthesia</code> is never part of an <code>incision</code> ,
we can use <code>&lt;&lt;</code> instead of the less-efficient
<code>local:precedes</code> function:</p>
<div class="exampleInner">
<pre>for $proc in /report/procedure
where some $i in $proc//incision satisfies
         fn:empty($proc//anesthesia[. &lt;&lt; $i])
return $proc
</pre></div>
<p>In some documents, particular sequences of elements may indicate
a logical hierarchy. This is most commonly true of HTML. The
following query returns the introduction of an XHTML document,
wrapping it in a <code>div</code> element. In this example, we
assume that an <code>h2</code> element containing the text
"Introduction" marks the beginning of the introduction, and the
introduction continues until the next <code>h2</code> or
<code>h1</code> element, or the end of the document, whichever
comes first.</p>
<div class="exampleInner">
<pre>let $intro := //h2[text()="Introduction"],
    $next-h := //(h1|h2)[. &gt;&gt; $intro][1]
return
   &lt;div&gt;
     {
       $intro,
       if (fn:empty($next-h))
         then //node()[. &gt;&gt; $intro]
         else //node()[. &gt;&gt; $intro and . &lt;&lt; $next-h]
     }
   &lt;/div&gt;
</pre></div>
<p>Note that the above query makes explicit the hierarchy that was
implicit in the original document. In this example, we assume that
the <code>h2</code> element containing the text "Introduction" has
no subelements.</p>
</div>
<div class="div2">
<h3><a id="id-recursive-transformations" 
name="id-recursive-transformations"></a> <del class="diff-old">I.4</del>
<ins class="diff-chg">I.3</ins> Recursive Transformations</h3>
<p>Occasionally it is necessary to scan over a hierarchy of
elements, applying some transformation at each level of the
hierarchy. In XQuery this can be accomplished by defining a
recursive function. In this section we will present two examples of
such recursive functions.</p>
<p>Suppose that we need to compute a table of contents for a given
document by scanning over the document, retaining only elements
named <code>section</code> or <code>title</code> , and preserving
the hierarchical relationships among these elements. For each
<code>section</code> , we retain subelements named
<code>section</code> or <code>title</code> ; but for each
<code>title</code> , we retain the full content of the element.
This might be accomplished by the following recursive function:</p>
<div class="exampleInner">
<pre>declare function local:sections-and-titles($n as node()) as node()?
   {
   if (fn:local-name($n) = "section")
   then element
          { fn:local-name($n) }
          { for $c in $n/* return local:sections-and-titles($c) }
   else if (fn:local-name($n) = "title")
   then $n
   else ( )
   };
</pre></div>
<p>The "skeleton" of a given document, containing only its sections
and titles, can then be obtained by invoking the
<code>local:sections-and-titles</code> function on the root node of
the document, as follows:</p>
<div class="exampleInner">
<pre>local:sections-and-titles(fn:doc("cookbook.xml"))
</pre></div>
<p>As another example of a recursive transformation, suppose that
we wish to scan over a document, transforming every attribute named
<code>color</code> to an element named <code>color</code> , and
every element named <code>size</code> to an attribute named
<code>size</code> . This can be accomplished by the following
recursive function (note that the element constructor in case
<code>$e</code> generates attributes before child elements):</p>
<div class="exampleInner">
<pre>declare function local:swizzle($n as node()) as node() 
  { 
   typeswitch($n)
     case $a as attribute(color)
       return element color { fn:string($a) } 
     case $es as element(size) 
       return attribute size { fn:string($es) } 
     case $e as element() 
       return element 
         { fn:local-name($e) } 
         { for $c in 
             ($e/@* except $e/@color,     (: attr -&gt; attr :)
              $e/size,                    (: elem -&gt; attr :)
              $e/@color,                  (: attr -&gt; elem :)
              $e/node() except $e/size )  (: elem -&gt; elem :)
           return local:swizzle($c) }
     case $d as document-node() 
       return document 
         { for $c in $d/* return local:swizzle($c) } 
     default return $n 
  };
</pre></div>
<p>The transformation can be applied to a whole document by
invoking the <code>local:swizzle</code> function on the root node
of the document, as follows:</p>
<div class="exampleInner">
<pre>local:swizzle(fn:doc("plans.xml"))
</pre></div>
</div>
<div class="div2">
<h3><a id="id-select-distinct" name="id-select-distinct"></a>
<del class="diff-old">I.5</del> <ins class="diff-chg">I.4</ins>
Selecting Distinct Combinations</h3>
<p>It is sometimes necessary to search through a set of data to
find all the distinct combinations of a given list of properties.
For example, an input data set might consist of a large set of
<code>order</code> elements, each of which has the same basic
structure, as illustrated by the following example:</p>
<div class="exampleInner">
<pre>&lt;order&gt;
   &lt;date&gt;2003-10-15&lt;/date&gt;
   &lt;product&gt;Dress Shirt&lt;/product&gt;
   &lt;size&gt;M&lt;/size&gt;
   &lt;color&gt;Blue&lt;/color&gt;
   &lt;supplier&gt;Fashion Trends&lt;/supplier&gt;
   &lt;quantity&gt;50&lt;/quantity&gt;
&lt;/order&gt;
</pre></div>
<p>From this data set, a user might wish to find all the distinct
combinations of <code>product</code> , <code>size</code> , and
<code>color</code> that occur together in an <code>order</code> .
The following query returns this list, enclosing each distinct
combination in a new element named <code>option</code> :</p>
<div class="exampleInner">
<pre>for $p in fn:distinct-values(/orders/order/product),
    $s in fn:distinct-values(/orders/order/size),
    $c in fn:distinct-values(/orders/order/color)
    order by $p, $s, $c
    return
       if (fn:exists(/orders/order[product eq $p
<del class="diff-old">                and 
</del>
<ins class="diff-chg">                and size eq $s and color eq $c]))
       then
          &lt;option&gt;
             &lt;product&gt;{$p}&lt;/product&gt;
             &lt;size&gt;{$s}&lt;/size&gt;
             &lt;color&gt;{$c}&lt;/color&gt;
          &lt;/option&gt;
       else ()
</ins>
</pre></div>
</div>
</div>
<div class="div1">
<h2><a id="id-revision-log" name="id-revision-log"></a><ins 
class="diff-chg">J Change Log (Non-Normative)</ins></h2>
<p class="xquery"><ins class="diff-chg">This appendix lists the
changes that have been made to this specification since the
publication of the XQuery 1.0 Recommendation on 23 January
2007.</ins></p>
<div class="div2">
<h3><a id="N1B0CF" name="N1B0CF"></a><ins class="diff-chg">J.1
Substantive Changes</ins></h3>
<p><ins class="diff-chg">The following substantive changes have
been made.</ins></p>
<ol class="enumar">
<li>
<p><ins class="diff-chg">Applied all</ins> <a 
href="http://www.w3.org/XML/2007/qt-errata/xquery-errata.html"><ins 
class="diff-chg">
XQuery 2ed errata</ins></a> .</p>
</li>
<li>
<p><ins class="diff-chg">Added</ins> <code><ins class="diff-chg">group 
by</ins></code> <ins class="diff-chg">clause to
FLWOR Expressions (</ins> <a href="#id-group-by"><b><ins 
class="diff-chg">3.9.7 Group By Clause</ins></b></a> <ins 
class="diff-chg">).</ins></p>
</li>
<li>
<p><ins class="diff-chg">Added</ins> <code><ins class="diff-chg">tumbling
 window</ins></code> <ins class="diff-chg">and</ins> <code><ins 
class="diff-chg">sliding
window</ins></code> <ins class="diff-chg">in FLWOR Expressions
(</ins> <a href="#id-windows"><b><ins class="diff-chg">3.9.4 Window
Clause</ins></b></a> <ins class="diff-chg">).</ins></p>
</li>
<li>
<p><ins class="diff-chg">Added</ins> <code><ins class="diff-chg">count</ins></code>
 <ins class="diff-chg">clause in FLWOR
Expressions (</ins> <a href="#id-count"><b><ins class="diff-chg">3.9.6 
Count Clause</ins></b></a> <ins class="diff-chg">).</ins></p>
</li>
<li>
<p><ins class="diff-chg">Added</ins> <code><ins class="diff-chg">allowing
 empty</ins></code> <ins class="diff-chg">in</ins> <a 
href="#id-xquery-for-clause"><b><ins class="diff-chg">3.9.2 For Clause</ins></b></a>
 ,<ins class="diff-chg">for functionality similar to outer joins in
SQL.</ins></p>
</li>
<li>
<p><ins class="diff-chg">Added</ins> <a href="#id-try-catch"><b><ins 
class="diff-chg">3.14 Try/Catch
Expressions</ins></b></a> <ins class="diff-chg">for handling
dynamic errors and type errors.</ins></p>
</li>
<li>
<p><ins class="diff-chg">Added literal function items (</ins>
<a href="#id-literal-func-ref"><b><ins class="diff-chg">3.1.6
Literal Function Items</ins></b></a> <ins class="diff-chg">).</ins></p>
</li>
<li>
<p><ins class="diff-chg">Added inline functions (</ins> <a 
href="#id-inline-func"><b><ins class="diff-chg">3.1.7 Inline
Functions</ins></b></a> <ins class="diff-chg">).</ins></p>
</li>
<li>
<p><ins class="diff-chg">Added dynamic function invocation (</ins>
<a href="#id-dynamic-function-invocation"><b><ins class="diff-chg">3.2.2
 Dynamic Function Invocation</ins></b></a>
<ins class="diff-chg">).</ins></p>
</li>
<li>
<p><ins class="diff-chg">Added</ins> <a href="#id-function-coercion"><b><ins
 class="diff-chg">3.1.5.3 Function
Item Coercion</ins></b></a> .</p>
</li>
<li>
<p><ins class="diff-chg">Added</ins> <a href="#id-sequencetype-subtype"><b><ins
 class="diff-chg">2.5.5
SequenceType Subtype Relationships</ins></b></a> ,<ins class="diff-chg">moving
 sequence type subtype judgements into the
language specification rather than the formal semantics.</ins></p>
</li>
<li>
<p><ins class="diff-chg">Added private functions (</ins> <a 
href="#FunctionDeclns"><b><ins class="diff-chg">4.18 Function
Declaration</ins></b></a> <ins class="diff-chg">).</ins></p>
</li>
<li>
<p><ins class="diff-chg">Added support for nondeterministic
functions (</ins> <a href="#FunctionDeclns"><b><ins class="diff-chg">4.18
 Function Declaration</ins></b></a> <ins class="diff-chg">)</ins></p>
</li>
<li>
<p><ins class="diff-chg">Added switch expressions (</ins> <a 
href="#id-switch"><b><ins class="diff-chg">3.12 Switch
Expression</ins></b></a> <ins class="diff-chg">)</ins></p>
</li>
<li>
<p><ins class="diff-chg">Added computed namespace constructors
(</ins> <a href="#id-computed-namespaces"><b><ins class="diff-chg">3.8.3.7
 Computed Namespace Constructors</ins></b></a>
<ins class="diff-chg">).</ins></p>
</li>
<li>
<p><ins class="diff-chg">Added output declarations (</ins> <a 
href="#id-serialization"><b><ins class="diff-chg">2.2.4
Serialization</ins></b></a> <ins class="diff-chg">).</ins></p>
</li>
<li>
<p><ins class="diff-chg">Added annotations (</ins> <a 
href="#id-annotations"><b><ins class="diff-chg">4.15
Annotations</ins></b></a> <ins class="diff-chg">).</ins></p>
</li>
<li>
<p><ins class="diff-chg">Added annotation assertions (</ins>
<b><a href="#id-annotation-assertion"><ins class="diff-chg">???</ins></a></b>
 <ins class="diff-chg">).</ins></p>
</li>
<li>
<p><ins class="diff-chg">Simplified BNF for FLWOR expressions,
changed description of semantics so that each clause is understood
as accepting a tuple stream as input, acting on that tuple stream,
and producing a tuple stream as output.</ins></p>
</li>
<li>
<p><ins class="diff-chg">Modified</ins> <a 
href="#doc-xquery11-ValidateExpr"><ins class="diff-chg">validate
expressions</ins></a> <ins class="diff-chg">to allow validation
against a type that is explicitly specified in the query using
the</ins> <code><ins class="diff-chg">type</ins></code> <ins 
class="diff-chg">keyword.</ins></p>
</li>
<li>
<p><ins class="diff-chg">Added support for declaring
nondeterministic external functions in</ins> <a href="#FunctionDeclns"><b><ins
 class="diff-chg">4.18 Function
Declaration</ins></b></a> ,<ins class="diff-chg">using
annotations.</ins></p>
</li>
<li>
<p><ins class="diff-chg">Extended</ins> <a href="#doc-xquery11-VarDecl"><ins
 class="diff-chg">variable
declarations</ins></a> <ins class="diff-chg">to allow default
values for external variables.</ins></p>
</li>
<li>
<p><ins class="diff-chg">Added</ins> <a 
href="#id-context-item-declarations"><b><ins class="diff-chg">4.17
Context Item Declaration</ins></b></a> .</p>
</li>
<li>
<p><ins class="diff-chg">Modified</ins> <a 
href="#id-version-declaration"><b><ins class="diff-chg">4.1 Version
Declaration</ins></b></a> <ins class="diff-chg">to add support for
XQuery 1.1.</ins></p>
</li>
<li>
<p><ins class="diff-chg">Added</ins> <a href="#id-decimal-format-decl"><b><ins
 class="diff-chg">4.10
Decimal-Format Declaration</ins></b></a> <ins class="diff-chg">to
allow a query to specify formats for</ins> <code><ins class="diff-chg">fn:format-number()</ins></code>
 .<ins class="diff-chg">Added corresponding properties to the static
context.</ins></p>
</li>
<li>
<p><ins class="diff-chg">Relaxed constraints on module imports
in</ins> <a href="#id-module-import"><b><ins class="diff-chg">4.12
Module Import</ins></b></a> <ins class="diff-chg">to allow modules
to reference each other without restriction and to remove
restrictions on forwards references to global variables.</ins></p>
</li>
<li>
<p><ins class="diff-chg">Modified</ins> <a 
href="#id-variable-declarations"><b><ins class="diff-chg">4.16 Variable
Declaration</ins></b></a> <ins class="diff-chg">to clarify type
information and remove ambiguities with respect to types.</ins></p>
</li>
<li>
<p><ins class="diff-chg">Removed obsolete Latin-1, using ISO-8859-1
instead. Resolves</ins> <a 
href="http://www.w3.org/Bugs/Public/show_bug.cgi?id=7797"><ins 
class="diff-chg">Bug 7797</ins></a> .</p>
</li>
<li>
<p><ins class="diff-chg">Changed conformance section to make
full-axis support mandatory. Added note saying the Working Group
has not yet decided which XQuery 1.1 features are
optional.</ins></p>
</li>
<li>
<p><ins class="diff-chg">Added normative rules for resolving module
URIs to</ins> <a href="#id-module-import"><b><ins class="diff-chg">4.12</ins></b></a></p>
</li>
</ol>
</div>
</div>
</div>
</body></html>