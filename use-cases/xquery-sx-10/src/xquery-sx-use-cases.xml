<?xml version="1.0" encoding="utf-8"?>
<!-- <!DOCTYPE spec SYSTEM "../../../schema/xsl-query.dtd" [ -->
<!DOCTYPE spec PUBLIC "-//W3C//DTD Specification V2.0//EN" "../../../schema/xmlspec.dtd" [
<!ENTITY doc.version "1.0">
<!ENTITY doc.version-code "10">
<!ENTITY doc.stage "NOTE">
<!ENTITY doc.w3c-doctype "wgnote">
<!ENTITY doc.w3c-doctype-full "Working Group Note">
<!ENTITY date.day "20">
<!ENTITY date.DD "20">
<!ENTITY date.month "June">
<!ENTITY date.monthnum "06">
<!ENTITY date.year "2017">
<!ENTITY doc.date "&date.year;&date.monthnum;&date.DD;">

<!ENTITY w3c.tr "https://www.w3.org/TR">
<!ENTITY doc.parent.shortname "xquery-sx-&doc.version-code;">
<!ENTITY doc.shortname "&doc.parent.shortname;-use-cases">
<!ENTITY doc.w3c-designation "&doc.stage;-&doc.shortname;">
<!ENTITY doc.publoc "&w3c.tr;/&date.year;/&doc.w3c-designation;-&doc.date;/">
<!ENTITY doc.latestloc "&w3c.tr;/&doc.shortname;/">
<!ENTITY doc.parent.latestloc "&w3c.tr;/&doc.parent.shortname;/">
<!ENTITY language "XQuery Scripting Extension &doc.version;">

<!ENTITY % status-entities SYSTEM "../../../etc/status-entities.dtd">
%status-entities;

<!ENTITY doc.WD-pubdate "3 December 2008">
<!ENTITY doc.LC-pubdate "TO BE SPECIFIED">
<!ENTITY doc.LC-comments-due "TO BE SPECIFIED">
<!ENTITY doc.CR-pubdate "TO BE SPECIFIED">
<!ENTITY doc.CR-comments-due "TO BE SPECIFIED">
<!ENTITY doc.PR-expected "TO BE SPECIFIED">
<!ENTITY doc.PR-pubdate "TO BE SPECIFIED">
<!ENTITY doc.PR-comments-due "TO BE SPECIFIED">
<!ENTITY doc.REC-pubdate "20 June 2017">

<!ENTITY doc.pubdate "&doc.REC-pubdate;">
<!ENTITY doc.comments-due "$doc.WD-comments-due;">

<!ENTITY status-section-id "status">
<!ENTITY spec-devby    "&devby.xquery;">
<!ENTITY changelog-id  "id-revisions-log">
<!ENTITY changes-para  "&post.WD.changes;">
<!ENTITY implementation-report-location "">
<!ENTITY implementation-report-availability "">
<!ENTITY implementation-report "&implementation-report-irrelevant;">
<!ENTITY disclosure.one    "&disclosure.xquery;"> 
<!ENTITY Bugzilla-key "SXUC">
<!ENTITY patent-policy-paragraph "&ppp-one;">
<!ENTITY documents-and-relationships "&not-set-of-documents;">
<!ENTITY advancement.statement "">

<!ENTITY doc-stability "&doc-stability-NOTE;">
<!ENTITY PR-entrance-criteria '<p>The &XQWG; intends to submit
this document for consideration as a W3C &ProposedRec;
at the same time that &language; is submitted for the same consideration. </p>'>
<!ENTITY features-at-risk-para "&no-features-at-risk;">
<!ENTITY document-stage "&doc-stage-NOTE;">
<!--ENTITY customized-paragraph '<p>This document provides
a number of use cases designed to evaluate the language defined in 
<loc href="&doc.parent.latestloc;" xlink:type="simple" 
xlink:show="replace" xlink:actuate="onRequest">&language;</loc> at 
the time that it was issued as a Working Draft on &date.day; &date.month; &date.year;.
Organizations and individuals should review this document to ascertain whether or not 
adequate coverage of the requirements is provided by these use cases. </p>'-->

<!ENTITY customized-paragraph '<p>This &doc.w3c-doctype-full; has been published in order to
document the work that the XML Query Working Group has done in the area of providing an
imperative extension to XQuery.  The WG was unable to achieve consensus on several
significant aspects of this technology and determined to terminate work on the project in mid-2014. </p>'>


<!ENTITY status-section SYSTEM "../../../etc/status-general.xml">

]>

<spec w3c-doctype="&doc.w3c-doctype;">
<header>
<title>&language; Use Cases</title>
<w3c-designation>&doc.w3c-designation;</w3c-designation>
<w3c-doctype>W3C &doc.w3c-doctype-full;</w3c-doctype>
<pubdate>
  <day>&date.day;</day>
  <month>&date.month;</month>
  <year>&date.year;</year>
</pubdate>
<publoc>
  <loc href="&doc.publoc;">&doc.publoc;</loc>
</publoc>
<latestloc>
  <loc href="&doc.latestloc;">&doc.latestloc;</loc>
</latestloc>
<prevlocs>
  <loc href="https://www.w3.org/TR/2008/WD-xquery-sx-10-use-cases-20081203/"/>
  <loc href="https://www.w3.org/TR/2008/WD-xquery-sx-10-use-cases-20080328/"/>
</prevlocs>

<authlist>
  <author>
    <name><phrase><loc href="http://snelson.org.uk/john">John Snelson</loc></phrase></name>
    <affiliation>MarkLogic</affiliation>
    <email href="mailto:john.snelson@marklogic.com">john.snelson@marklogic.com</email>
  </author>
</authlist>

&status-section;

		<abstract>
			<p>This document specifies usage scenarios for the XQuery Scripting Extension.</p>
		</abstract>

		<langusage>
			<language id="EN">English</language>
		</langusage>

		<revisiondesc>
			<p></p>
		</revisiondesc>

	</header>

	<body>

<!--

http://www.w3.org/Bugs/Public/show_bug.cgi?id=2796#c1

* implement a simple queue: insert appends a child element, remove removes
  the first element and returns it

--><!--

http://www.w3.org/Bugs/Public/show_bug.cgi?id=2796#c2

The current spec seems to make it impossible, for example,
to express web application logic in XQuery. If even top-level queries must
either return a value OR perform an update, but never both, then *something*
(other than XQuery) is going to have to co-ordinate the response to requests
that involve updates. And the revolution is once again deferred.

--><!--

Perform a set of updates without which a document would be invalid according to
a schema.

--><!--

Applications that perform complex manipulations on persistent XML data
    Writing applications that modify persistent data, stored in files or in databases.
    Such applications may need to operate on data in stages, and may need to verify that
    the modified data meet some constraints.

Complex XML to XML transformations
    Writing code that performs complex XML to XML transformations.

Implementation of web services
    Writing code that implements a web service, with the ability to access and modify
    persistent XML data.

Processing RSS feeds
    Writing code that generates or aggregates RSS feeds.

XML data verification
    Expressing complex constraints on XML data.

-->

		<div1 id="use-cases-for-xquery-sx">
			<head>Use Cases for XQuery Scripting Extension</head>

			<p>
      The use cases listed below were created by the <loc href="http://www.w3.org/XML/Query/">XML Query Working Group</loc>
      to illustrate important applications for an XQuery scripting extension.
<!-- 			Each use case is focused on a specific application -->
<!-- 			area, and contains a Document Type Definition -->
<!-- 			(DTD) and example input data. Each use case -->
<!-- 			specifies a set of updates that might be -->
<!-- 			applied to the input data, and the expected -->
<!-- 			resulting value of the modified input  -->
<!-- 			for each update. Since the English -->
<!-- 			description of each query is concise, the -->
<!-- 			expected results form an important part of the -->
<!-- 			definition of each update directive. -->
<!--       These use cases are inspired by  -->
<!-- 			the <loc href="http://www.w3.org/TR/2005/WD-xquery-update-requirements-20050603/">W3C -->
<!-- 			XQuery Update Facility Requirements</loc> document. -->
      </p>

<!-- 			<p>These use cases represent a snapshot of an -->
<!--           ongoing work. Some important application areas and important -->
<!--           operations are not yet adequately covered by a use case. The -->
<!--           XML Query Working Group reserves the right to add, delete, -->
<!--           or modify individual queries or whole use cases as the work -->
<!--           progresses. The presence of a query in this set of use cases -->
<!--           does not necessarily indicate that the query will be -->
<!--           expressible in the XQuery Update Facility to be created by -->
<!--           the XML Query Working Group.</p> -->

<!--**************************************************-->

			<div2 id="rdb">
				<head>Use Case "R" - Scripting Relational Data</head>

					<p>This use case is based on performing updates on the data used in Use Case "R" from 
					the <bibref ref="XQueryUseCases"/>. The DTD and sample data from this Use Case are copied below
					for convenience, and exactly match those found in the XQuery Use Cases.</p>

                    <p>The data represents a relational database used by an
                        online auction. The auction maintains a USERS table
                        containing information on registered users, each
                        identified by a unique userid, who can either offer
                        items for sale or bid on items. An ITEMS table lists
                        items currently or recently for sale, with the userid of
                        the user who offered each item. A BIDS table contains
                        all bids on record, keyed by the userid of the bidder
                        and the item number of the item to which the bid
                        applies.</p>

                    <p>The three tables used by the online auction are below,
                        with their column-names indicated in parentheses.</p>

                    <eg>USERS ( USERID, NAME, RATING )
ITEMS ( ITEMNO, DESCRIPTION, OFFERED_BY, 
        START_DATE, END_DATE, RESERVE_PRICE ) 
BIDS ( USERID, ITEMNO, BID, BID_DATE )</eg>

                <div3 id="rdb-dtd">
                    <head>Document Type Definition (DTD)</head>

                    <p>This use case is based on three separate input documents
                        named users.xml, items.xml, and bids.xml. Each of the
                        documents represents one of the tables in the relational
                      database described above, using the following DTDs:</p>

                  <div4 id="dtd-for-usres.xml">
                    <head>DTD for users.xml</head>

                    <eg>
                      <![CDATA[                      
<!ELEMENT users (user_tuple*)> 
<!ELEMENT user_tuple (userid, name, rating?)> 
<!ELEMENT userid (#PCDATA)> 
<!ELEMENT name (#PCDATA)> 
<!ELEMENT rating (#PCDATA)>
 ]]></eg>
                   </div4>

              <div4 id="dtd-for-items.xml">
                <head>DTD for items.xml</head>

                <eg>
                  <![CDATA[
<!ELEMENT items (item_tuple*)>
<!ELEMENT item_tuple (itemno, description, offered_by, 
                      start_date?, end_date?, reserve_price?)> 
<!ELEMENT itemno (#PCDATA)>
<!ELEMENT description (#PCDATA)>
<!ELEMENT offered_by (#PCDATA)>
<!ELEMENT start_date (#PCDATA)>
<!ELEMENT end_date (#PCDATA)>
<!ELEMENT reserve_price (#PCDATA)>]]>
</eg>
              </div4>        

                  <div4 id="dtd-for-bids.xml"> 
                    <head>DTD for bids.xml</head>

                    <eg>
                      <![CDATA[
<!ELEMENT bids (bid_tuple*)> 
<!ELEMENT bid_tuple (userid, itemno, bid, bid_date)> 
<!ELEMENT userid (#PCDATA)> 
<!ELEMENT itemno (#PCDATA)> 
<!ELEMENT bid (#PCDATA)>
<!ELEMENT bid_date (#PCDATA)>
]]>
                      </eg>
                  </div4>

                </div3>

                <div3 id="rdb-data">
                    <head>Input Data</head>

                    <p>Here is an abbreviated set of data showing the XML format of the instances:</p>

                    <eg role="data"><![CDATA[<items>
  <item_tuple>
    <itemno>1001</itemno>
    <description>Red Bicycle</description>
    <offered_by>U01</offered_by>
    <start_date>1999-01-05</start_date>
    <end_date>1999-01-20</end_date>
    <reserve_price>40</reserve_price>
  </item_tuple>]]>
  <emph>  ... Snip ... </emph>
<![CDATA[</items>
<users>
  <user_tuple>
    <userid>U01</userid>
    <name>Tom Jones</name>
    <rating>B</rating>
  </user_tuple>]]>
  <emph>  ... Snip ... </emph>
<![CDATA[</users>
<bids>
  <bid_tuple> 
    <userid>U02</userid> 
    <itemno>1001</itemno> 
    <bid>35</bid> 
    <bid_date>1999-01-07</bid_date> 
    </bid_tuple> 
  <bid_tuple> ]]>
  <emph>  ... Snip ... </emph>
<![CDATA[</bids>]]>
                    </eg>

                    <p>The entire data set is represented by the following
                        table:</p>

                    <table border="1" summary="Data set table">
                        <caption>USERS</caption>

                        <thead>
                            <tr>
                                <td>USERID</td>
                                <td>NAME</td>
                                <td>RATING</td>
                            </tr>
                        </thead>

                        <tbody>
                            <tr>
                                <td>U01</td>
                                <td>Tom Jones</td>
                                <td>B</td>
                            </tr>
                            <tr>
                                <td>U02</td>
                                <td>Mary Doe</td>
                                <td>A</td>
                            </tr>
                            <tr>
                                <td>U03</td>
                                <td>Dee Linquent</td>
                                <td>D</td>
                            </tr>
                            <tr>
                                <td>U04</td>
                                <td>Roger Smith</td>
                                <td>C</td>
                            </tr>
                            <tr>
                                <td>U05</td>
                                <td>Jack Sprat</td>
                                <td>B</td>
                            </tr>
                            <tr>
                                <td>U06</td>
                                <td>Rip Van Winkle</td>
                                <td>B</td>
                            </tr>
                        </tbody>
                    </table>

                    <table border="1" summary="Data set table">
                        <caption>ITEMS</caption>

                        <thead>
                            <tr>
                                <td>ITEMNO</td>
                                <td>DESCRIPTION</td>
                                <td>OFFERED_BY</td>
                                <td>START_DATE</td>
                                <td>END_DATE</td>
                                <td>RESERVE_PRICE</td>
                            </tr>
                        </thead>

                        <tbody>

                            <tr>
                                <td>1001</td>
                                <td>Red Bicycle</td>
                                <td>U01</td>
                                <td>1999-01-05</td>
                                <td>1999-01-20</td>
                                <td>40</td>
                            </tr>
                            <tr>
                                <td>1002</td>
                                <td>Motorcycle</td>
                                <td>U02</td>
                                <td>1999-02-11</td>
                                <td>1999-03-15</td>
                                <td>500</td>
                            </tr>
                            <tr>
                                <td>1003</td>
                                <td>Old Bicycle</td>
                                <td>U02</td>
                                <td>1999-01-10</td>
                                <td>1999-02-20</td>
                                <td>25</td>
                            </tr>
                            <tr>
                                <td>1004</td>
                                <td>Tricycle</td>
                                <td>U01</td>
                                <td>1999-02-25</td>
                                <td>1999-03-08</td>
                                <td>15</td>
                            </tr>
                            <tr>
                                <td>1005</td>
                                <td>Tennis Racket</td>
                                <td>U03</td>
                                <td>1999-03-19</td>
                                <td>1999-04-30</td>
                                <td>20</td>
                            </tr>
                            <tr>
                                <td>1006</td>
                                <td>Helicopter</td>
                                <td>U03</td>
                                <td>1999-05-05</td>
                                <td>1999-05-25</td>
                                <td>50000</td>
                            </tr>
                            <tr>
                                <td>1007</td>
                                <td>Racing Bicycle</td>
                                <td>U04</td>
                                <td>1999-01-20</td>
                                <td>1999-02-20</td>
                                <td>200</td>
                            </tr>
                            <tr>
                                <td>1008</td>
                                <td>Broken Bicycle</td>
                                <td>U01</td>
                                <td>1999-02-05</td>
                                <td>1999-03-06</td>
                                <td>25</td>
                            </tr>

                        </tbody>

                    </table>

                    <table border="1" summary="Data set table">
                        <caption>BIDS</caption>

                        <thead>

                            <tr>
                                <td>USERID</td>
                                <td>ITEMNO</td>
                                <td>BID</td>
                                <td>BID_DATE</td>
                            </tr>
                        </thead>

                        <tbody>
                            <tr>
                                <td>U02</td>
                                <td>1001</td>
                                <td>35</td>
                                <td>1999-01-07</td>
                            </tr>
                            <tr>
                                <td>U04</td>
                                <td>1001</td>
                                <td>40</td>
                                <td>1999-01-08</td>
                            </tr>
                            <tr>
                                <td>U02</td>
                                <td>1001</td>
                                <td>45</td>
                                <td>1999-01-11</td>
                            </tr>
                            <tr>
                                <td>U04</td>
                                <td>1001</td>
                                <td>50</td>
                                <td>1999-01-13</td>
                            </tr>
                            <tr>
                                <td>U02</td>
                                <td>1001</td>
                                <td>55</td>
                                <td>1999-01-15</td>
                            </tr>
                            <tr>
                                <td>U01</td>
                                <td>1002</td>
                                <td>400</td>
                                <td>1999-02-14</td>
                            </tr>
                            <tr>
                                <td>U02</td>
                                <td>1002</td>
                                <td>600</td>
                                <td>1999-02-16</td>
                            </tr>
                            <tr>
                                <td>U03</td>
                                <td>1002</td>
                                <td>800</td>
                                <td>1999-02-17</td>
                            </tr>
                            <tr>
                                <td>U04</td>
                                <td>1002</td>
                                <td>1000</td>
                                <td>1999-02-25</td>
                            </tr>
                            <tr>
                                <td>U02</td>
                                <td>1002</td>
                                <td>1200</td>
                                <td>1999-03-02</td>
                            </tr>
                            <tr>
                                <td>U04</td>
                                <td>1003</td>
                                <td>15</td>
                                <td>1999-01-22</td>
                            </tr>
                            <tr>
                                <td>U05</td>
                                <td>1003</td>
                                <td>20</td>
                                <td>1999-02-03</td>
                            </tr>
                            <tr>
                                <td>U01</td>
                                <td>1004</td>
                                <td>40</td>
                                <td>1999-03-05</td>
                            </tr>
                            <tr>
                                <td>U03</td>
                                <td>1007</td>
                                <td>175</td>
                                <td>1999-01-25</td>
                            </tr>
                            <tr>
                                <td>U05</td>
                                <td>1007</td>
                                <td>200</td>
                                <td>1999-02-08</td>
                            </tr>
                            <tr>
                                <td>U04</td>
                                <td>1007</td>
                                <td>225</td>
                                <td>1999-02-12</td>
                            </tr>

                        </tbody>

                    </table>
	
                </div3>			  

				<div3 id="rdb-sx-results">
					<head>Queries and Results</head>

<!--**************************************************-->

					<div4 id="rdb-sx-results-q1">
						<head>Q1</head>
            <!-- http://lists.w3.org/Archives/Member/w3c-xml-query-wg/2006Aug/0015.html -->

            <p>Insert a new bid for Roger Smith on item 1002, adding 10% to the best bid
            received so far for this item, and report back what bid was just entered.</p>

						<p>
							<emph>Solution in the XQuery Scripting Extension:</emph>
						</p>
						<eg><![CDATA[
let $uid := doc("users.xml")/users/user_tuple[name = "Roger Smith"]/userid
let $topbid := max(doc("bids.xml")/bids/bid_tuple[itemno = 1002]/bid)
let $newbid := $topbid * 1.1
return (
  insert nodes
    <bid_tuple> 
      <userid>{ data($uid) }</userid> 
      <itemno>1002</itemno> 
      <bid>{ $newbid }</bid> 
      <bid_date>1999-03-03</bid_date> 
    </bid_tuple>
  into doc("bids.xml")/bids,
  <new_bid>{ $newbid }</new_bid>
)
]]>
</eg>

						<p>
							<emph>Expected Result:</emph>
						</p>
						<p>The best bid for item 1002 had been at 1200, thus Roger's bid is at 1320.</p>

						<eg role="result"><![CDATA[
<new_bid>1320</new_bid>
            ]]></eg>


						<p>
							<emph>Expected resulting content of bids.xml:</emph>
						</p>

						<eg role="result"><![CDATA[<bids>
  <bid_tuple> 
    <userid>U02</userid> 
    <itemno>1001</itemno> 
    <bid>35</bid> 
    <bid_date>1999-01-07</bid_date> 
  </bid_tuple>]]> 
  <emph>  ... Snip ... </emph>
<![CDATA[  <bid_tuple> 
    <userid>U01</userid> 
    <itemno>1002</itemno> 
    <bid>400</bid> 
    <bid_date>1999-02-14</bid_date> 
  </bid_tuple>]]> 
  <emph>  ... Snip ... </emph>
<![CDATA[   <bid_tuple> 
    <userid>U04</userid> 
    <itemno>1007</itemno> 
    <bid>225</bid> 
    <bid_date>1999-02-12</bid_date> 
  </bid_tuple>]]> 
  <emph>  ... Snip ... </emph>
<![CDATA[  <bid_tuple> 
    <userid>U04</userid> 
    <itemno>1002</itemno> 
    <bid>1320</bid> 
    <bid_date>1999-03-03</bid_date> 
  </bid_tuple> 
</bids>]]>
						</eg>

					</div4>

<!--**************************************************-->

					<div4 id="rdb-sx-results-q2">
						<head>Q2</head>
            <!-- http://lists.w3.org/Archives/Member/w3c-xml-query-wg/2006Aug/0015.html -->

            <p>Place a bid for Roger Smith on item 1007, adding 10% to the best bid received
            so far on that item, but only if the bid amount does not exceed a given
            limit.  Otherwise return the current top bid.</p>

						<p>
							<emph>Solution in the XQuery Scripting Extension:</emph>
						</p>
						<eg><![CDATA[
let $uid := doc("users.xml")/users/user_tuple[name = "Roger Smith"]/userid
let $topbid := max(doc("bids.xml")/bids/bid_tuple[itemno = 1007]/bid)
let $newbid := $topbid * 1.1
return
  if($newbid <= 240) then (
    insert nodes
      <bid_tuple>
        <userid>{ data($uid) }</userid>
        <itemno>1002</itemno>
        <bid>{ $newbid }</bid>
        <bid_date>1999-03-03</bid_date>
      </bid_tuple>
    into doc("bids.xml")/bids,
    <new_bid>{ $newbid }</new_bid>
  ) else (
    <top_bid>{ $topbid }</top_bid>
  )
]]>
</eg>

						<p>
							<emph>Expected Result:</emph>
						</p>
					<p>Adding 10% to the best bid on item 1007 would require a bid of 247.5, which is more than the allowed limit of 240. Thus,
          the bids.xml document does not change.</p>

						<eg role="result"><![CDATA[
<top_bid>225</top_bid>
            ]]></eg>


					</div4>

<!--**************************************************-->

					<div4 id="rdb-sx-results-q3">
						<head>Q3</head>
            <!-- http://www.w3.org/Bugs/Public/show_bug.cgi?id=2796#c1 -->

						<p>Erase user Dee Linquent and the corresponding associated items and bids.
            Return a count of the items and bids deleted.</p>

						<p>
							<emph>Solution in the XQuery Scripting Extension:</emph>
						</p>

<eg><![CDATA[
let $user := doc("users.xml")/users/user_tuple[name = "Dee Linquent"]
let $items := doc("items.xml")/items/item_tuple[offered_by = $user/userid]
let $bids := doc("bids.xml")/bids/bid_tuple[userid = $user/userid]
return (
  delete nodes ($user, $items, $bids),
  <deleted>
    <items>{ count($items) }</items>
    <bids>{ count($bids) }</bids>
  </deleted>
)
]]></eg>

						<p>
							<emph>Expected Result:</emph>
						</p>

						<eg role="result"><![CDATA[
<deleted>
  <items>2</items>
  <bids>2</bids>
</deleted>
]]></eg>

						<p>
							<emph>Expected resulting content of items.xml:</emph>
						</p>

						<eg role="result"><![CDATA[<items>
  <item_tuple>
    <itemno>1001</itemno>
    <description>Red Bicycle</description>
    <offered_by>U01</offered_by>
    <start_date>1999-01-05</start_date>
    <end_date>1999-01-20</end_date>
    <reserve_price>40</reserve_price>
  </item_tuple>]]>
  <emph>  ... Snip ... </emph>
<![CDATA[  <item_tuple>
    <itemno>1004</itemno>
    <description>Tricycle</description>
    <offered_by>U01</offered_by>
    <start_date>1999-02-25</start_date>
    <end_date>1999-03-08</end_date>
    <reserve_price>15</reserve_price>
  </item_tuple>
  <item_tuple>
    <itemno>1007</itemno>
    <description>Racing bicycle</description>
    <offered_by>U04</offered_by>
    <start_date>1999-01-20</start_date>
    <end_date>1999-02-20</end_date>
    <reserve_price>200</reserve_price>
  </item_tuple>
  <item_tuple>
    <itemno>1008</itemno>
    <description>Broken bicycle</description>
    <offered_by>U01</offered_by>
    <start_date>1999-02-05</start_date>
    <end_date>1999-03-06</end_date>
    <reserve_price>25</reserve_price>
  </item_tuple>
</items>]]>
</eg>

						<p>
							<emph>Expected resulting content of users.xml:</emph>
						</p>

						<eg role="result"><![CDATA[<users>
  <user_tuple>
    <userid>U01</userid>
    <name>Tom Jones</name>
    <rating>B</rating>
  </user_tuple>
  <user_tuple>
    <userid>U02</userid>
    <name>Mary Doe</name>
    <rating>A</rating>
  </user_tuple>
   <user_tuple>
    <userid>U04</userid>
    <name>Roger Smith</name>
    <rating>C</rating>
  </user_tuple>]]>
<emph>  ... Snip ... </emph>
<![CDATA[  <user_tuple>
   <userid>U06</userid>
   <name>Rip Van Winkle</name>
   <rating>B</rating>
  </user_tuple>
</users>]]>
</eg>

						<p>
							<emph>Expected resulting content of bids.xml:</emph>
						</p>

						<eg role="result"><![CDATA[<bids>
  <bid_tuple> 
    <userid>U02</userid> 
    <itemno>1001</itemno> 
    <bid>35</bid> 
    <bid_date>1999-01-07</bid_date> 
  </bid_tuple> 
  <bid_tuple> 
    <userid>U04</userid> 
    <itemno>1001</itemno> 
    <bid>40</bid> 
    <bid_date>1999-01-08</bid_date> 
  </bid_tuple>]]> 
<emph>  ... Snip ... </emph>
<![CDATA[  <bid_tuple> 
    <userid>U02</userid> 
    <itemno>1002</itemno> 
    <bid>600</bid> 
    <bid_date>1999-02-16</bid_date> 
  </bid_tuple> 
  <bid_tuple> 
    <userid>U04</userid> 
    <itemno>1002</itemno> 
    <bid>1000</bid> 
    <bid_date>1999-02-25</bid_date> 
  </bid_tuple>]]> 
<emph>  ... Snip ... </emph>
<![CDATA[  <bid_tuple> 
    <userid>U04</userid> 
    <itemno>1007</itemno> 
    <bid>225</bid> 
    <bid_date>1999-02-12</bid_date> 
  </bid_tuple> 
</bids>
]]>
</eg>

					</div4>

<!--**************************************************-->

					<div4 id="rdb-sx-results-q4">
						<head>Q4</head>

            <p>Monitor the bidding on the helicopter. If Roger Smith does not have the current
            highest bid, add a bid for him that is one higher than the top bid, unless the
            bid amount exceeds a given limit. Stop monitoring when the auction has finished.</p>

						<p>
							<emph>Solution in the XQuery Scripting Extension:</emph>

            <ednote>
              <date>2008-01-25</date>
              <edtext>
                A naive execution of this query would form a busy loop waiting for the auction to end.
                This is not very desirable, so it's possible an alternative solution should be found.
              </edtext>
            </ednote>

						</p>

						<eg><![CDATA[
declare variable $uid := doc("users.xml")/users/user_tuple
  [name = "Roger Smith"]/userid;
declare variable $item := doc("items.xml")/items/item_tuple
  [description = "Helicopter"];
declare assignable variable $result :=
  "Error: The auction has already ended or no bids were placed";
declare assignable variable $maximumExceeded := false();

while(xs:date($item/end_date) >= fn:current-date() and not($maximumExceeded)) {
  let $bids := doc("bids.xml")/bids/bid_tuple[itemno = $item/itemno]
  let $topbid := max($bids/bid)
  let $newbid := $topbid + 1
  where $bids[bid = $topbid]/userid != $uid
  return
    if($newbid <= 60000) then (
      insert nodes
        <bid_tuple>
          { $uid, $item/itemno }
          <bid>{ $newbid }</bid> 
          <bid_date>{ fn:current-date() }</bid_date> 
        </bid_tuple>
      into doc("bids.xml")/bids;
      $result := concat("What a bargain! You got a helicopter for ",
        $newbid);
    ) else (
      $result := "Bidding exceeded 60000";
      $maximumExceeded := true();
    )
};

$result;
]]></eg>

						<p>
							<emph>Expected Result:</emph>
						</p>

            <p>Since this document was published after the end date for the auction ("1999-05-25"),
            the while loop will never be executed.</p>

						<eg role="result"><![CDATA[
Error: The auction has already ended or no bids were placed
]]></eg>

					</div4>

<!--**************************************************-->

        </div3>
      </div2>

<!--**************************************************-->
			<div2 id="xhtml">
				<head>Use Case "XHTML" - AJAX Scripting with XHTML</head>

        <p>XQuery is ideally suited to manipulating the XML trees of XHTML. This use case speculates
        that XQuery could be used in the way Javascript is now, to modify an XHTML web page whilst it
        is being displayed. In this way XQuery can be used to implement effects like those commonly
        referred to by the acronym AJAX.</p>

        <p>This use case deals with a web page that can be used to perform a search in a book database.
        In all queries, there is an assumption that the xhtml document is supplied as the context item.</p>

        <div3 id="xhtml-data">
          <head>Input Data</head>

          <p>The starting state of the web page consists of only a simple XHTML form.</p>

          <eg role="data"><![CDATA[
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Book Search</title>
  </head>
  <body>
    <form>
      Book Name: <input type="text" id="txtBookName"/>
      <input type="button" id="btnSend" value="Start Search"/>
    </form>
  </body>
</html>
]]></eg>
        </div3>

				<div3 id="xhtml-sx-results">
					<head>Queries and Results</head>

<!--**************************************************-->

					<div4 id="xhtml-sx-results-q1">
						<head>Q1</head>
            <!-- http://lists.w3.org/Archives/Member/w3c-xml-query-wg/2007May/0017.html -->

            <p>Write a script to act as an "onclick" event handler for the "btnSend" form button. The script calls a web
            service to search for the book entered by the user and retrieve detailed information for the book. While the user is
            waiting for the web service the message "Loading Book" is displayed. This message is later replaced with the detailed
            information for the book.</p>

						<p>
							<emph>Input web page:</emph>
						</p>

            <p>The web browser has already updated the content of the form's text input with the user's search string, "XQuery".</p>

						<eg role="result"><![CDATA[
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Book Search</title>
  </head>
  <body>
    <form>
      Book Name: <input type="text" id="txtBookName">XQuery</input>
      <input type="button" id="btnSend" value="Start Search"/>
    </form>
  </body>
</html>
]]></eg>

						<p>
							<emph>Solution in the XQuery Scripting Extension:</emph>
						</p>

            <p>The element that caused the event is supplied as an external variable called $eventNode. The web service is called
            using the external functions "book:search", and "book:get".</p>

						<eg><![CDATA[
declare namespace xhtml="http://www.w3.org/1999/xhtml";
declare namespace book="http://www.example.com/booksearch";

declare simple function book:search($name as xs:string) as element(book)* external;
declare simple function book:get($isbn as xs:string) as element(bookinfo) external;

declare variable $eventNode as element() external;
declare assignable variable $searchResults := ();

insert node <xhtml:div>Loading Book</xhtml:div>
after /xhtml:html/xhtml:body/xhtml:form;

$searchResults :=
  book:search($eventNode/preceding-sibling::xhtml:input[1]);

if($searchResults) then (
  replace node /xhtml:html/xhtml:body/xhtml:div
  with <xhtml:div>{
    book:get($searchResults[1]/isbn)/html/node()
  }</xhtml:div>;
)
else (
  replace node /xhtml:html/xhtml:body/xhtml:div
  with <xhtml:div>No books found!</xhtml:div>;
);
]]></eg>

						<p>
							<emph>Results returned to the query from the function call book:search("XQuery"):</emph>
						</p>

						<eg role="result"><![CDATA[
<book>
  <title>XQuery from the Experts: A Guide to the W3C XML Query Language</title>
  <isbn>0321180607</isbn>
</book>
<book>
  <title>XQuery: The XML Query Language</title>
  <isbn>0321165810</isbn>
</book>
]]></eg>

						<p>
							<emph>Results returned to the query from the function call book:get("0321180607"):</emph>
						</p>

						<eg role="result"><![CDATA[
<bookinfo>
  <title>XQuery from the Experts: A Guide to the W3C XML Query Language</title>
  <isbn>0321180607</isbn>
  <html>
    <h2 xmlns="http://www.w3.org/1999/xhtml">XQuery from the Experts: A Guide to the W3C XML Query Language</h2>
    ISBN: 0321180607
  </html>
</bookinfo>
]]></eg>

						<p>
							<emph>Expected intermediate content of the web page:</emph>
						</p>

						<eg role="result"><![CDATA[
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Book Search</title>
  </head>
  <body>
    <form>
      Book Name: <input type="text" id="txtBookName">XQuery</input>
      <input type="button" id="btnSend" value="Start Search"/>
    </form>
    <xhtml:div xmlns:xhtml="http://www.w3.org/1999/xhtml">Loading book</xhtml:div>
  </body>
</html>
]]></eg>

						<p>
							<emph>Expected resulting content of the web page:</emph>
						</p>

						<eg role="result"><![CDATA[
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Book Search</title>
  </head>
  <body>
    <form>
      Book Name: <input type="text" id="txtBookName">XQuery</input>
      <input type="button" id="btnSend" value="Start Search"/>
    </form>
    <xhtml:div xmlns:xhtml="http://www.w3.org/1999/xhtml">
      <h2>XQuery from the Experts: A Guide to the W3C XML Query Language</h2>
      ISBN: 0321180607
    </xhtml:div>
  </body>
</html>
]]></eg>

					</div4>

<!--**************************************************-->

					<div4 id="xhtml-sx-results-q2">
						<head>Q2</head>
            <!-- http://lists.w3.org/Archives/Member/w3c-xml-query-wg/2007May/0017.html -->

            <p>Write a script to act as an "onclick" event handler for the "btnSend" form button. The script calls a web
            service to search for the book entered by the user, and uses an additional web service to find which libraries
            have these books on the shelves. The information received is displayed asynchronously as it arrives.</p>

						<p>
							<emph>Input web page:</emph>
						</p>

            <p>The web browser has already updated the content of the form's text input with the user's search string, "XQuery".</p>

						<eg role="result"><![CDATA[
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Book Search</title>
  </head>
  <body>
    <form>
      Book Name: <input type="text" id="txtBookName">XQuery</input>
      <input type="button" id="btnSend" value="Start Search"/>
    </form>
  </body>
</html>
]]></eg>

						<p>
							<emph>Solution in the XQuery Scripting Extension:</emph>
						</p>

            <p>The element that caused the event is supplied as an external variable called $eventNode. The web services are called
            using the external functions "book:search", and "library:find".</p>

						<eg><![CDATA[
declare namespace xhtml="http://www.w3.org/1999/xhtml";
declare namespace book="http://www.example.com/booksearch";
declare namespace library="http://www.example.com/library";

declare simple function book:search($name as xs:string)
  as element(book)* external;
declare simple function library:find($isbn as xs:string)
  as element(library)* external;

declare variable $eventNode as element() external;
declare assignable variable $table := ();

insert node <xhtml:div><xhtml:table/></xhtml:div>
after /xhtml:html/xhtml:body/xhtml:form;
$table := //xhtml:table;

for $book in book:search($eventNode/preceding-sibling::xhtml:input[1])
return (
  insert node
    <xhtml:tr>
      <xhtml:td>{data($book/title)}</xhtml:td>
      <xhtml:td>{data($book/isbn)}</xhtml:td>
      <xhtml:td/>
    </xhtml:tr>
  as last into $table;
);

for $row in $table/xhtml:tr
return (
  replace value of node $row/xhtml:td[3]
  with string-join(library:find($row/xhtml:td[2])/name, ", ");
);
]]></eg>

						<p>
							<emph>Results returned to the query from the function call book:search("XQuery"):</emph>
						</p>

						<eg role="result"><![CDATA[
<book>
  <title>XQuery from the Experts: A Guide to the W3C XML Query Language</title>
  <isbn>0321180607</isbn>
</book>
<book>
  <title>XQuery: The XML Query Language</title>
  <isbn>0321165810</isbn>
</book>
]]></eg>

						<p>
							<emph>Results returned to the query from the function call library:find("0321180607"):</emph>
						</p>

						<eg role="result"><![CDATA[
<library>
  <name>Bodleian Library</name>
  <url>http://www.bodley.ox.ac.uk/</url>
  <lending>no</lending>
</library>
<library>
  <name>Radcliffe Science Library</name>
  <url>http://www.ouls.ox.ac.uk/rsl/</url>
  <lending>yes</lending>
</library>
]]></eg>

						<p>
							<emph>Results returned to the query from the function call library:find("0321165810"):</emph>
						</p>

						<eg role="result"><![CDATA[
<library>
  <name>Radcliffe Science Library</name>
  <url>http://www.ouls.ox.ac.uk/rsl/</url>
  <lending>yes</lending>
</library>
]]></eg>

						<p>
							<emph>Expected resulting content of the web page:</emph>
						</p>

            <p>The web page will be altered as the results are received from the web services, but the final result
            will look like this.</p>

						<eg role="result"><![CDATA[
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Book Search</title>
  </head>
  <body>
    <form>
      Book Name: <input type="text" id="txtBookName">XQuery</input>
      <input type="button" id="btnSend" value="Start Search"/>
    </form>
    <xhtml:div xmlns:xhtml="http://www.w3.org/1999/xhtml">
      <xhtml:table>
        <xhtml:tr>
          <xhtml:td>XQuery from the Experts: A Guide to the W3C XML Query Language</xhtml:td>
          <xhtml:td>0321180607</xhtml:td>
          <xhtml:td>Bodleian Library, Radcliffe Science Library</xhtml:td>
        </xhtml:tr>
        <xhtml:tr>
          <xhtml:td>XQuery: The XML Query Language</xhtml:td>
          <xhtml:td>0321165810</xhtml:td>
          <xhtml:td>Radcliffe Science Library</xhtml:td>
        </xhtml:tr>
      </xhtml:table>
    </xhtml:div>
  </body>
</html>
]]></eg>


					</div4>

<!--**************************************************-->

				</div3>
			</div2>

<!--**************************************************-->
			<div2 id="webservice">
				<head>Use Case "WS" - XQuery for Web Services</head>

        <p>This use case deals with the implementation of a REST based web service, specifically
        a micro-blog.</p>

        <!-- Add a post -->
        <!-- View a user's post, saving a record of the visit -->
        <!-- Add a friend -->
        
        <div3 id="webservice-data">
          <head>Input Data</head>

          <p>The default collection contains a forest of micro blog documents, one for
          each user. Initially the forest contains these documents.</p>

					<p>
					  <emph>John's micro-blog:</emph>
				  </p>

          <eg role="data"><![CDATA[
<micro-blog user="john">
  <entry timestamp="2007-10-17T10:02:53+01:00">
    <text>Still reading email...</text>
  </entry>
  <entry timestamp="2007-10-17T20:19:31+01:00">
    <text>Writing XQuery Scripting Extension use cases (ideas, anyone?)</text>
  </entry>
  <entry timestamp="2007-10-18T00:43:02+01:00">
    <text>Thinking of going to bed</text>
  </entry>
</micro-blog>
]]></eg>

					<p>
					  <emph>Emily's micro-blog:</emph>
				  </p>

          <eg role="data"><![CDATA[
<micro-blog user="emily">
  <entry timestamp="2007-10-16T18:12:51+01:00">
    <text>So how do you use a micro-blog?</text>
  </entry>
  <entry timestamp="2007-10-16T18:13:20+01:00">
    <text>Ah, I see</text>
  </entry>
  <entry timestamp="2007-10-17T07:33:44+01:00">
    <text>Morning, everybody!</text>
  </entry>
</micro-blog>
]]></eg>

					<p>
					  <emph>A document containing the blog access log:</emph>
				  </p>

          <eg role="data"><![CDATA[
<log>
</log>
]]></eg>

        </div3>

				<div3 id="webservice-sx-results">
					<head>Queries and Results</head>

<!--**************************************************-->

					<div4 id="webservice-sx-results-q1">
						<head>Q1</head>

            <p>Process a request from John to add a blog entry, returning a confirmation XHTML page.</p>

						<p>
							<emph>The element representing the request:</emph>
						</p>
						<eg><![CDATA[
<request>
  <method>POST</method>
  <url>http://blog.example.com/john/add</url>
  <param name="text">Making a post to my XQuery blog engine</param>
</request>
]]></eg>

						<p>
							<emph>Solution in the XQuery Scripting Extension:</emph>
						</p>

            <p>The request element is bound to the external variable $request.</p>

						<eg><![CDATA[
declare variable $request as element(request) external;

declare simple function local:error($message)
{
  <html xmlns="http://www.w3.org/1999/xhtml">
    <head>
      <title>Error</title>
    </head>
    <body>
      <h1>Error</h1>
      <p>{ $message }</p>
    </body>
  </html>
};

if($request/method = "POST") then () else
  exit returning local:error(concat("You cannot use the ",
    $request/method, " method with this URL."));

let $user := replace($request/url, "^http://.*/([^/]+)/add$", "$1")
let $blog := collection()/micro-blog[@user = $user]
return (
  if($blog) then () else
    exit returning local:error("Unknown user");

  insert node
    <entry timestamp="{ current-dateTime() }">
      <text>{ $request/param[@name = "text"] }</text>
    </entry>
  as last into $blog;

  <html xmlns="http://www.w3.org/1999/xhtml">
    <head>
      <title>Blog entry added for { $user }</title>
    </head>
    <body>
      <h1>Blog entry added for { $user }</h1>
      <p>{ $request/param[@name = "text"] }</p>
    </body>
  </html>;
);
]]></eg>

						<p>
							<emph>Expected Result:</emph>
						</p>

						<eg role="result"><![CDATA[
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Blog entry added for john</title>
  </head>
  <body>
    <h1>Blog entry added for john</h1>
    <p>Making a post to my XQuery blog engine</p>
  </body>
</html>
]]></eg>


						<p>
							<emph>Expected resulting content of John's micro-blog:</emph>
						</p>

						<eg role="result"><![CDATA[
<micro-blog user="john">
  <entry timestamp="2007-10-17T10:02:53+01:00">
    <text>Still reading email...</text>
  </entry>
  <entry timestamp="2007-10-17T20:19:31+01:00">
    <text>Writing XQuery Scripting Extension use cases (ideas, anyone?)</text>
  </entry>
  <entry timestamp="2007-10-18T00:43:02+01:00">
    <text>Thinking of going to bed</text>
  </entry>
  <entry timestamp="2007-10-18T08:53:9+01:00">
    <text>Making a post to my XQuery blog engine</text>
  </entry>
</micro-blog>
]]></eg>

					</div4>

<!--**************************************************-->

					<div4 id="webservice-sx-results-q2">
						<head>Q2</head>

            <p>Process the same request from John, using a function to check that "john"
            is a valid user name and to log the event.</p>

						<p>
							<emph>The element representing the request:</emph>
						</p>
						<eg><![CDATA[
<request>
  <method>POST</method>
  <url>http://blog.example.com/john/add</url>
  <param name="text">Making a post to my XQuery blog engine</param>
</request>
]]></eg>

						<p>
							<emph>Solution in the XQuery Scripting Extension:</emph>
						</p>

            <p>The request element is bound to the external variable $request.</p>

						<eg><![CDATA[
declare variable $request as element(request) external;

declare sequential function local:check-user-and-log($username as xs:string) 
  as element(micro-blog)?
{
  declare $entry as element() :=
    <access-attempt>
      <timestamp>{fn:current-dateTime()}</timestamp>
      <user-name>{$username}</user-name>
      <access-allowed/>
    </access-attempt>;
  declare $blog as element(micro-blog)? :=
    collection()/micro-blog[@user = $username];

  if($blog) then
    replace value of node $entry/access-allowed with "Yes"
  else
    replace value of node $entry/access-allowed with "No";

  insert node $entry as last into collection()/log;

  $blog;
}; 


declare simple function local:error($message)
{
  <html xmlns="http://www.w3.org/1999/xhtml">
    <head>
      <title>Error</title>
    </head>
    <body>
      <h1>Error</h1>
      <p>{ $message }</p>
    </body>
  </html>
};

if($request/method = "POST") then () else
  exit returning local:error(concat("You cannot use the ",
    $request/method, " method with this URL."));

let $user := replace($request/url, "^http://.*/([^/]+)/add$", "$1")
let $blog := local:check-user-and-log($user)
return (
  if($blog) then () else
    exit returning local:error("Unknown user");

  insert node
    <entry timestamp="{ current-dateTime() }">
      <text>{ $request/param[@name = "text"] }</text>
    </entry>
  as last into $blog;

  <html xmlns="http://www.w3.org/1999/xhtml">
    <head>
      <title>Blog entry added for { $user }</title>
    </head>
    <body>
      <h1>Blog entry added for { $user }</h1>
      <p>{ $request/param[@name = "text"] }</p>
    </body>
  </html>;
);
]]></eg>

						<p>
							<emph>Expected Result:</emph>
						</p>

						<eg role="result"><![CDATA[
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Blog entry added for john</title>
  </head>
  <body>
    <h1>Blog entry added for john</h1>
    <p>Making a post to my XQuery blog engine</p>
  </body>
</html>
]]></eg>


						<p>
							<emph>Expected resulting content of John's micro-blog:</emph>
						</p>

						<eg role="result"><![CDATA[
<micro-blog user="john">
  <entry timestamp="2007-10-17T10:02:53+01:00">
    <text>Still reading email...</text>
  </entry>
  <entry timestamp="2007-10-17T20:19:31+01:00">
    <text>Writing XQuery Scripting Extension use cases (ideas, anyone?)</text>
  </entry>
  <entry timestamp="2007-10-18T00:43:02+01:00">
    <text>Thinking of going to bed</text>
  </entry>
  <entry timestamp="2007-10-18T08:53:9+01:00">
    <text>Making a post to my XQuery blog engine</text>
  </entry>
</micro-blog>
]]></eg>

						<p>
							<emph>Expected resulting content of the log:</emph>
						</p>

						<eg role="result"><![CDATA[
<log>
  <access-attempt>
    <timestamp>2007-10-18T08:53:9+01:00</timestamp>
    <user-name>john</user-name>
    <access-allowed>Yes</access-allowed>
  </access-attempt>
</log>
]]></eg>

					</div4>

<!--**************************************************-->

<!-- 					<div4 id="webservice-sx-results-q"> -->
<!-- 						<head>Q</head> -->

<!--             <p></p> -->

<!-- 						<p> -->
<!-- 							<emph>Solution in the XQuery Scripting Extension:</emph> -->
<!-- 						</p> -->
<!-- 						<eg><![CDATA[ -->
<!-- ]]></eg> -->

<!-- 						<p> -->
<!-- 							<emph>Expected Result:</emph> -->
<!-- 						</p> -->

<!-- 						<eg role="result"><![CDATA[ -->
<!-- ]]></eg> -->


<!-- 						<p> -->
<!-- 							<emph>Expected resulting content of bids.xml:</emph> -->
<!-- 						</p> -->

<!-- 						<eg role="result"><![CDATA[ -->
<!-- ]]></eg> -->

<!-- 					</div4> -->

<!--**************************************************-->

				</div3>
			</div2>

<!--**************************************************-->
<!-- 			<div2 id="unknown"> -->
<!-- 				<head>Use Case "U" - Unknown</head> -->

<!--         <p></p> -->

<!--         <div3 id="unknown-dtd"> -->
<!--           <head>Document Type Definition (DTD)</head> -->

<!--           <p></p> -->
<!--         </div3> -->

<!--         <div3 id="unknown-data"> -->
<!--           <head>Input Data</head> -->

<!--           <p></p> -->

<!--           <eg role="data"><![CDATA[ -->
<!-- ]]></eg> -->
<!--         </div3> -->

<!-- 				<div3 id="unknown-sx-results"> -->
<!-- 					<head>Queries and Results</head> -->

<!-- 					<div4 id="unknown-sx-results-q"> -->
<!-- 						<head>Q</head> -->

<!--             <p></p> -->

<!-- 						<p> -->
<!-- 							<emph>Solution in the XQuery Scripting Extension:</emph> -->
<!-- 						</p> -->
<!-- 						<eg><![CDATA[ -->
<!-- ]]></eg> -->

<!-- 						<p> -->
<!-- 							<emph>Expected Result:</emph> -->
<!-- 						</p> -->

<!-- 						<eg role="result"><![CDATA[ -->
<!-- ]]></eg> -->


<!-- 						<p> -->
<!-- 							<emph>Expected resulting content of bids.xml:</emph> -->
<!-- 						</p> -->

<!-- 						<eg role="result"><![CDATA[ -->
<!-- ]]></eg> -->

<!-- 					</div4> -->

<!-- 				</div3> -->
<!-- 			</div2> -->

		</div1>

	</body>

	<back>

		<div1 id="references">

			<head>Normative References</head>

<blist>

<bibl key="XQuery 1.0" id="xquery">World Wide
Web Consortium. <emph>XQuery 1.0: An XML Query Language</emph>. W3C Recommendation, 23
January 2007. See <loc
href="http://www.w3.org/TR/xquery/">http://www.w3.org/TR/xquery/</loc>.</bibl>

<bibl key="XML Query Use Cases" id="XQueryUseCases">
World Wide
Web Consortium. <emph>XML Query Use Cases</emph>. W3C Working Group Note, 23 March 2007. See <loc
href="http://www.w3.org/TR/xquery-use-cases/">http://www.w3.org/TR/xquery-use-cases/</loc>.</bibl>

<bibl key="XQuery Update Facility" id="updatespec">World Wide
Web Consortium. <emph>XQuery Update Facility</emph>. W3C Working Draft, 28 August 2007. See <loc
href="http://www.w3.org/TR/xquery-update-10/"/>.</bibl>

<bibl key="XQuery Scripting Extension 1.0 Requirements" id="serequirements">World Wide
Web Consortium. <emph>XQuery Scripting Extension 1.0 Requirements</emph>. W3C Working Draft, 23 March 2007. See <loc
href="http://www.w3.org/TR/2007/WD-xquery-sx-10-requirements-20070323">http://www.w3.org/TR/2007/WD-xquery-sx-10-requirements-20070323</loc>.</bibl>

</blist>

		</div1>

	  <inform-div1 id="id-revisions-log">
	    <head>Revision Log</head>

	    <p>This log records the substantive changes that have been made to this document <!-- since the Working Draft of 8 May 2006 -->. Minor editorial changes are not included in this log.</p>
	    <div2 id="id-log-pending">
	       <head>Changes in internal WD</head>
		<ulist>
			<item><p>Added an editorial note detailing the problems with RDB Q4.</p></item>
			<item><p>Added the WS Q2 use case.</p></item>
			<item><p>2008-07-10: Updated the syntax to the lastest editor's draft.</p></item>
			<item><p>2008-11-09: Updated the syntax to the lastest editor's draft.</p></item>
			<item><p>2010-03-02: Updated the syntax to the lastest editor's draft.</p></item>
		</ulist>
	    </div2>

<!-- 	    <div2 id="id-log-28aug2007"> -->
<!-- 	      <head>28 Aug 2007 Publication</head> -->

<!-- 	      <ulist> -->

<!-- 	        <item><p>Clarified that updates for Use Case "R" are cumulative (see http://www.w3.org/Bugs/Public/show_bug.cgi?id=3567#c1).</p></item> -->

<!-- 	        <item><p>Fixed update conflict in Use Case "Address", and clarified that some things would be easier using updates together with the Scripting Extensions (see http://www.w3.org/Bugs/Public/show_bug.cgi?id=3578#c1).</p></item> -->

<!-- 	        <item><p>Fixed several errors in Use Case "SOAP" (see http://www.w3.org/Bugs/Public/show_bug.cgi?id=3578#c3).</p></item> -->

<!-- 	        <item><p>Fixed Use Case "R" Q4 so that it tests to see whether a rating already exists (see http://www.w3.org/Bugs/Public/show_bug.cgi?id=3578#c4).</p></item> -->

<!-- 	        <item><p>Fixed Use Case "Parts" Q3, fixing several bugs, see (http://www.w3.org/Bugs/Public/show_bug.cgi?id=3578#c6).</p></item> -->

<!-- 	      </ulist> -->

<!-- 	      </div2> -->

	    </inform-div1>

	</back>

</spec>
























